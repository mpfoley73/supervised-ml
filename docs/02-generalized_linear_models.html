<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Generalized Linear Models (GLM) – Supervised Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-linear_mixed_effects.html" rel="next">
<link href="./01-linear_regression.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">

<script src="site_libs/tabwid-1.1.3/tabwid.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-generalized_linear_models.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Generalized Linear Models (GLM)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Supervised Machine Learning</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-generalized_linear_models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Generalized Linear Models (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-linear_mixed_effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mixed Effects Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-nonlinear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Non-linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-decision_trees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Decision Trees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-support_vector_machines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-bayesian_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayesian Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-emmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimated Marginal Means</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#binomiallogistic" id="toc-binomiallogistic" class="nav-link active" data-scroll-target="#binomiallogistic"><span class="header-section-number">2.1</span> Binomial Logistic Regression</a>
  <ul>
  <li><a href="#cs1" id="toc-cs1" class="nav-link" data-scroll-target="#cs1">Case Study</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the Model</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  <li><a href="#evaluate-the-fit" id="toc-evaluate-the-fit" class="nav-link" data-scroll-target="#evaluate-the-fit">Evaluate the Fit</a></li>
  <li><a href="#reporting" id="toc-reporting" class="nav-link" data-scroll-target="#reporting">Reporting</a></li>
  </ul></li>
  <li><a href="#multinomiallogistic" id="toc-multinomiallogistic" class="nav-link" data-scroll-target="#multinomiallogistic"><span class="header-section-number">2.2</span> Multinomial Logistic Regression</a>
  <ul>
  <li><a href="#cs2" id="toc-cs2" class="nav-link" data-scroll-target="#cs2">Case Study</a></li>
  <li><a href="#fit-the-model-1" id="toc-fit-the-model-1" class="nav-link" data-scroll-target="#fit-the-model-1">Fit the Model</a></li>
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1">Interpretation</a></li>
  <li><a href="#assumptions-1" id="toc-assumptions-1" class="nav-link" data-scroll-target="#assumptions-1">Assumptions</a></li>
  <li><a href="#evaluate-the-fit-1" id="toc-evaluate-the-fit-1" class="nav-link" data-scroll-target="#evaluate-the-fit-1">Evaluate the Fit</a></li>
  <li><a href="#reporting-1" id="toc-reporting-1" class="nav-link" data-scroll-target="#reporting-1">Reporting</a></li>
  </ul></li>
  <li><a href="#ordinallogistic" id="toc-ordinallogistic" class="nav-link" data-scroll-target="#ordinallogistic"><span class="header-section-number">2.3</span> Ordinal Logistic Regression</a>
  <ul>
  <li><a href="#cs3" id="toc-cs3" class="nav-link" data-scroll-target="#cs3">Case Study</a></li>
  <li><a href="#fit-the-model-2" id="toc-fit-the-model-2" class="nav-link" data-scroll-target="#fit-the-model-2">Fit the Model</a></li>
  <li><a href="#assumptions-2" id="toc-assumptions-2" class="nav-link" data-scroll-target="#assumptions-2">Assumptions</a></li>
  <li><a href="#evaluate-the-fit-2" id="toc-evaluate-the-fit-2" class="nav-link" data-scroll-target="#evaluate-the-fit-2">Evaluate the Fit</a></li>
  <li><a href="#interpret-results" id="toc-interpret-results" class="nav-link" data-scroll-target="#interpret-results">Interpret Results</a></li>
  <li><a href="#reporting-2" id="toc-reporting-2" class="nav-link" data-scroll-target="#reporting-2">Reporting</a></li>
  </ul></li>
  <li><a href="#poissonregression" id="toc-poissonregression" class="nav-link" data-scroll-target="#poissonregression"><span class="header-section-number">2.4</span> Poisson Regression</a>
  <ul>
  <li><a href="#cs4" id="toc-cs4" class="nav-link" data-scroll-target="#cs4">Case Study 4</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Generalized Linear Models (GLM)</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The linear regression model, <span class="math inline">\(E(y|X) = X \beta\)</span>, structured as <span class="math inline">\(y_i = X_i \beta + \epsilon_i\)</span> where <span class="math inline">\(X_i \beta = \mu_i\)</span>, assumes the response is a linear function of the predictors and the residuals are independent random variables normally distributed with zero mean and constant variance, <span class="math inline">\(\epsilon \sim N \left(0, \sigma^2 \right)\)</span>. This implies that given a set of predictors, the response is normally distributed about its expected value, <span class="math inline">\(y_i \sim N \left(\mu_i, \sigma^2 \right)\)</span>. However, there are many situations where this normality assumption does not hold. Generalized linear models (GLMs) are a generalization of the linear regression model that work with non-normal response distributions.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The response will not have a normal distribution if the underlying data-generating process is binomial (Section @ref(binomiallogistic)) or multinomial (Section @ref(multinomiallogistic)), ordinal (Section @ref(ordinallogistic)), Poisson (counts, Section @ref(poissonregression)), or exponential (time-to-event). In these situations the linear regression model can predict probabilities and proportions outside [0, 1], or negative counts or times. GLMs solve this problem by modeling a <em>function</em> of the expected value of <span class="math inline">\(y\)</span>, <span class="math inline">\(f(E(y|X)) = X \beta\)</span>. There are three components to a GLM: a <em>random component</em> specified by the response variable’s probability distribution (normal, binomial, etc.); a <em>systematic component</em> in the form <span class="math inline">\(X\beta\)</span>; and a <em>link function</em>, <span class="math inline">\(\eta\)</span>, that specifies the link between the random and systematic components and converts the response to a range of <span class="math inline">\([-\infty, +\infty]\)</span>.</p>
<p>Linear regression is a special case of GLM where the link function is the identity function, <span class="math inline">\(f(E(y|X)) = E(y|X)\)</span>. For binary logistic regression, the link function is the logit,</p>
<p><span class="math display">\[f(E(y|X)) = \log \left( \frac{E(y|X)}{1 - E(y|X)} \right) = \log \left( \frac{\pi}{1 - \pi} \right) = \mathrm{logit}(\pi)\]</span></p>
<p>where <span class="math inline">\(\pi\)</span> is the response probability.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> For multinomial logistic regression, the link function is the logit again, but with respect to the baseline level, and there is set of logits (one for each non-baseline level),</p>
<p><span class="math display">\[f(E(y|X)) = \log \left( \frac{E(y_j|X)}{E(y_{j^*}|X)} \right) = \log \left( \frac{\pi_j}{\pi_{j^*}} \right) = \mathrm{logit}(\pi_j)\]</span></p>
<p>Where <span class="math inline">\(j\)</span> is a level in the dependent variable and <span class="math inline">\(j^*\)</span> is the baseline level. For Poisson regression, the link function is</p>
<p><span class="math display">\[f(E(y|X)) = \ln (E(y|X)) = \ln(\lambda)\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the expected event rate. For exponential regression, the link function is</p>
<p><span class="math display">\[f(E(y|X) = -E(y|X) = -\lambda\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the expected time to event.</p>
<p>GLM uses maximum likelihood estimation (MLE) rather than ordinary least squares (OLS) to estimate the parameters, and thus relies on large-sample approximations.</p>
<p>Fit a GLM just like an linear model, but with the <code>glm()</code> function, specifying the distribution with the <code>family = c("gaussian", "binomial", "poisson")</code> parameter. Fit a mulinomial logistic regression model with <code>nnet::multinom()</code>.</p>
<section id="binomiallogistic" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="binomiallogistic"><span class="header-section-number">2.1</span> Binomial Logistic Regression</h2>
<p>Logistic regression estimates the probability that a categorical dependent variable is a particular level. The dependent variable levels can be binomial, multinomial, or ordinal. The <em>binary</em> logistic regression model is</p>
<p><span class="math display">\[y_i = \mathrm{logit}(\pi_i) = \log \left( \frac{\pi_i}{1 - \pi_i} \right) = X_i \beta\]</span></p>
<p>where <span class="math inline">\(\pi_i\)</span> is the response <span class="math inline">\(i\)</span>’s binary level probability. The model predicts the <em>log odds</em> of the level. Why do this? The range of outcomes need to be between 0 and 1, and a sigmoid function, <span class="math inline">\(f(y) = 1 / \left(1 + e^y \right)\)</span>, does that. If the <em>log odds</em> of the level equals <span class="math inline">\(X_i\beta\)</span>, then the <em>odds</em> of the level equals <span class="math inline">\(e^{X\beta}\)</span>. You can solve for <span class="math inline">\(\pi_i\)</span> to get <span class="math inline">\(\pi = \mathrm{odds} / (\mathrm{odds} + 1)\)</span>. Substituting,</p>
<p><span class="math display">\[\pi_i = \frac{\exp(y_i)}{1 + \exp(y_i)} = \frac{e^{X_i\beta}}{1 + e^{X_i\beta}}\]</span></p>
<p>which you can simplify to <span class="math inline">\(\pi_i = 1 / (1 + e^{-X_i\beta})\)</span>, a sigmoid function. The upshot is <span class="math inline">\(X\beta\)</span> is the functional relationship between the independent variables and <em>a function of the response</em>, not the response itself.</p>
<p>The model parameters are estimated either by <em>iteratively reweighted least squares optimization</em> or by <em>maximum likelihood estimation</em> (MLE). MLE maximizes the probability produced by a set of parameters <span class="math inline">\(\beta\)</span> given a data set and probability distribution.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> In logistic regression the probability distribution is the binomial and each observation is the outcome of a single Bernoulli trial.</p>
<p><span class="math display">\[L(\beta; y, X) = \prod_{i=1}^n \pi_i^{y_i}(1 - \pi_i)^{(1-y_i)} = \prod_{i=1}^n\frac{\exp(y_i X_i \beta)}{1 + \exp(X_i \beta)}.\]</span></p>
<p>In practice, multiplying many small probabilities can be unstable, so MLE optimizes the log likelihood instead.</p>
<p><span class="math display">\[\begin{align}
l(\beta; y, X) &amp;= \sum_{i = 1}^n \left(y_i \log(\pi_i) + (1 - y_i) \log(1 - \pi_i) \right) \\
               &amp;= \sum_{i = 1}^n \left(y_i X_i \beta - \log(1 + e^{X_i\beta}) \right)
\end{align}\]</span></p>
<p>Sometimes you will see the <em>cost function</em> optimized. The cost function is the negative of of the log likelihood function.</p>
<p><strong>Assumptions</strong></p>
<p>The binomial logistic regression model requires a dichotomous dependent variable and independent observations. The sample size should be large, at least 10 observations per dependent variable level and independent variable. There are three conditions related to the data distribution: i) the logit transformation must be linearly related to any continuous independent variables, ii) there must be no multicollinearity, and iii) there must be no influential outliers.</p>
<p>Be aware of over-dispersion, a common issue with GLM. For a binomial logistic regression, the response variable should be distributed <span class="math inline">\(y_i \sim \mathrm{Bin}(n_i, \pi_i)\)</span> with <span class="math inline">\(\mu_i = n_i \pi_i\)</span> and <span class="math inline">\(\sigma^2 = \pi (1 - \pi)\)</span>. Over-dispersion means the data shows evidence of variance greater than <span class="math inline">\(\sigma^2\)</span>.</p>
<section id="cs1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="cs1">Case Study</h3>
<p>This case study uses the <a href="https://statistics.laerd.com/">Laerd Statistics</a> article on binomial logistic regression <a href="https://statistics.laerd.com/premium/spss/spss-files/logistic-regression.sav">data set</a>. A study investigates the relationship between the incidence of heart disease (Yes|No) and age, weight, gender, and maximal aerobic capacity using data from <em>n</em> = 100 participants.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cs1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.spss</span>(<span class="st">"./input/logistic-regression.sav"</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> heart_disease,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">include =</span> <span class="sc">-</span>caseno,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="st">"row"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean}, {sd}"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="lwuchqltdh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lwuchqltdh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lwuchqltdh thead, #lwuchqltdh tbody, #lwuchqltdh tfoot, #lwuchqltdh tr, #lwuchqltdh td, #lwuchqltdh th {
  border-style: none;
}

#lwuchqltdh p {
  margin: 0;
  padding: 0;
}

#lwuchqltdh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lwuchqltdh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lwuchqltdh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lwuchqltdh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lwuchqltdh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lwuchqltdh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lwuchqltdh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lwuchqltdh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lwuchqltdh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lwuchqltdh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lwuchqltdh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lwuchqltdh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lwuchqltdh .gt_spanner_row {
  border-bottom-style: hidden;
}

#lwuchqltdh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lwuchqltdh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lwuchqltdh .gt_from_md > :first-child {
  margin-top: 0;
}

#lwuchqltdh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lwuchqltdh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lwuchqltdh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lwuchqltdh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lwuchqltdh .gt_row_group_first td {
  border-top-width: 2px;
}

#lwuchqltdh .gt_row_group_first th {
  border-top-width: 2px;
}

#lwuchqltdh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lwuchqltdh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lwuchqltdh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lwuchqltdh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lwuchqltdh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lwuchqltdh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lwuchqltdh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lwuchqltdh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lwuchqltdh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lwuchqltdh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lwuchqltdh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lwuchqltdh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lwuchqltdh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lwuchqltdh .gt_left {
  text-align: left;
}

#lwuchqltdh .gt_center {
  text-align: center;
}

#lwuchqltdh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lwuchqltdh .gt_font_normal {
  font-weight: normal;
}

#lwuchqltdh .gt_font_bold {
  font-weight: bold;
}

#lwuchqltdh .gt_font_italic {
  font-style: italic;
}

#lwuchqltdh .gt_super {
  font-size: 65%;
}

#lwuchqltdh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lwuchqltdh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lwuchqltdh .gt_indent_1 {
  text-indent: 5px;
}

#lwuchqltdh .gt_indent_2 {
  text-indent: 10px;
}

#lwuchqltdh .gt_indent_3 {
  text-indent: 15px;
}

#lwuchqltdh .gt_indent_4 {
  text-indent: 20px;
}

#lwuchqltdh .gt_indent_5 {
  text-indent: 25px;
}

#lwuchqltdh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lwuchqltdh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>No</strong><br>
N = 65<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Yes</strong><br>
N = 35<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">age</td>
<td class="gt_row gt_center" headers="stat_1">39, 8</td>
<td class="gt_row gt_center" headers="stat_2">45, 9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">weight</td>
<td class="gt_row gt_center" headers="stat_1">77, 14</td>
<td class="gt_row gt_center" headers="stat_2">85, 15</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">gender</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="stat_1">29 (78%)</td>
<td class="gt_row gt_center" headers="stat_2">8 (22%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="stat_1">36 (57%)</td>
<td class="gt_row gt_center" headers="stat_2">27 (43%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">VO2max</td>
<td class="gt_row gt_center" headers="stat_1">45, 9</td>
<td class="gt_row gt_center" headers="stat_2">41, 6</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="3" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Mean, SD; n (%)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p><br></p>
<p>Overall, men are twice as likely to have heart disease. Male odds are .43/.57 = 0.8 and female odds are .22/.78 = 0.3, an male-to-female odds ratio of 2.7.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">row =</span> heart_disease, <span class="at">col =</span> gender, <span class="at">percent =</span> <span class="st">"column"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="gfaondnjfu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gfaondnjfu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gfaondnjfu thead, #gfaondnjfu tbody, #gfaondnjfu tfoot, #gfaondnjfu tr, #gfaondnjfu td, #gfaondnjfu th {
  border-style: none;
}

#gfaondnjfu p {
  margin: 0;
  padding: 0;
}

#gfaondnjfu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gfaondnjfu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gfaondnjfu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gfaondnjfu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gfaondnjfu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gfaondnjfu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfaondnjfu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gfaondnjfu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gfaondnjfu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gfaondnjfu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gfaondnjfu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gfaondnjfu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gfaondnjfu .gt_spanner_row {
  border-bottom-style: hidden;
}

#gfaondnjfu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gfaondnjfu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gfaondnjfu .gt_from_md > :first-child {
  margin-top: 0;
}

#gfaondnjfu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gfaondnjfu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gfaondnjfu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gfaondnjfu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gfaondnjfu .gt_row_group_first td {
  border-top-width: 2px;
}

#gfaondnjfu .gt_row_group_first th {
  border-top-width: 2px;
}

#gfaondnjfu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfaondnjfu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gfaondnjfu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gfaondnjfu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfaondnjfu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfaondnjfu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gfaondnjfu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gfaondnjfu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gfaondnjfu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gfaondnjfu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gfaondnjfu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfaondnjfu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gfaondnjfu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gfaondnjfu .gt_left {
  text-align: left;
}

#gfaondnjfu .gt_center {
  text-align: center;
}

#gfaondnjfu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gfaondnjfu .gt_font_normal {
  font-weight: normal;
}

#gfaondnjfu .gt_font_bold {
  font-weight: bold;
}

#gfaondnjfu .gt_font_italic {
  font-style: italic;
}

#gfaondnjfu .gt_super {
  font-size: 65%;
}

#gfaondnjfu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gfaondnjfu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gfaondnjfu .gt_indent_1 {
  text-indent: 5px;
}

#gfaondnjfu .gt_indent_2 {
  text-indent: 10px;
}

#gfaondnjfu .gt_indent_3 {
  text-indent: 15px;
}

#gfaondnjfu .gt_indent_4 {
  text-indent: 20px;
}

#gfaondnjfu .gt_indent_5 {
  text-indent: 25px;
}

#gfaondnjfu .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gfaondnjfu div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th colspan="2" id="level 1; stat_1" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
gender
</div></th>
<th rowspan="2" id="stat_0" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Total</th>
</tr>
<tr class="gt_col_headings even">
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Female</th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Male</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">heart_disease</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="stat_1">29 (78%)</td>
<td class="gt_row gt_center" headers="stat_2">36 (57%)</td>
<td class="gt_row gt_center" headers="stat_0">65 (65%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="stat_1">8 (22%)</td>
<td class="gt_row gt_center" headers="stat_2">27 (43%)</td>
<td class="gt_row gt_center" headers="stat_0">35 (35%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Total</td>
<td class="gt_row gt_center" headers="stat_1">37 (100%)</td>
<td class="gt_row gt_center" headers="stat_2">63 (100%)</td>
<td class="gt_row gt_center" headers="stat_0">100 (100%)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Age, weight, and poor max aerobic capacity are positively associated with heart disease.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> heart_disease, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="rmdnote">
<p>Consider centering the continuous variables around their means to facilitate model interpretation. The intercept term in the fitted model would represent a reasonable condition, not a zero-aged, zero-weighted person with no aerobic capacity. This is the way to go if you want to present your findings in the framework of a baseline probability (or odds) and the incremental effects of the independent variables. You might also standardize the continuous vars to get a more meaningful increment. On the other hand, if you want to use your model for predicting outcomes, you’ll have to back out of the centering when you predict values.</p>
</div>
<p>If your model is predictive rather than inferential, split the data into training/testing data sets.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For reproducibility</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(cs1<span class="sc">$</span>dat, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> heart_disease))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;Training/Testing/Total&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;69/31/100&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_training <span class="ot">&lt;-</span> <span class="fu">training</span>(x)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cs1<span class="sc">$</span>dat_training)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 69  6</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_testing <span class="ot">&lt;-</span> <span class="fu">testing</span>(x)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cs1<span class="sc">$</span>dat_testing)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 31  6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-the-model" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="fit-the-model">Fit the Model</h3>
<p>Fit the model using the tidymodels framework. If you want to continue using the classic methodology, the glm object is inside the tidymodels fit. The model fit returns a brief summary with the coefficients and model diagnostics.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>model <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="ot">&lt;-</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The fit object returned by glm(). You'll need this for interpretation and </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># checking assumptions.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="ot">&lt;-</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># If you are fitting a predictive model, use the training set.</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit_training <span class="ot">&lt;-</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat_training)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::glm(formula = heart_disease ~ age + weight + VO2max + 
    gender, family = stats::binomial, data = data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept) -1.676469   3.336079  -0.503  0.61530   
age          0.085098   0.028160   3.022  0.00251 **
weight       0.005727   0.022442   0.255  0.79858   
VO2max      -0.099024   0.047944  -2.065  0.03889 * 
genderMale   1.949639   0.842413   2.314  0.02065 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 129.49  on 99  degrees of freedom
Residual deviance: 102.09  on 95  degrees of freedom
AIC: 112.09

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>The null deviance, G^2, is the likelihood ratio of the intercept-only model with 69 rows - 1 parameter = 99 degrees of freedom. It is the sum of the squared deviance residuals. The residual deviance is the likelihood ratio of the full model with 100 - 5 parameters = 95 degrees of freedom.</p>
<p>The residual deviance is distributed chi-squared and can be used to test whether the model differs from the saturated model (model with as many coefficients as observations, G^2 = 0, <em>df</em> = 0) where <span class="math inline">\(H_0\)</span> = no difference. The deviance test for lack of fit fails to reject the null hypothesis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># G^2 calculations</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> .<span class="sc">^</span><span class="dv">2</span> <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 102.0878</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">deviance</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 102.0878</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># df</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">df.residual</span>(cs1<span class="sc">$</span>result)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 95</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># G^2 is distributed chi-squared with df degrees of freedom</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fu">deviance</span>(cs1<span class="sc">$</span>result), <span class="at">df =</span> <span class="fu">df.residual</span>(cs1<span class="sc">$</span>result), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.2911469</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>vcdExtra<span class="sc">::</span><span class="fu">LRstats</span>(cs1<span class="sc">$</span>result)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Likelihood summary table:</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="do">##               AIC    BIC LR Chisq Df Pr(&gt;Chisq)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">## cs1$result 112.09 125.11   102.09 95     0.2911</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These two deviances, the null and residual, are shown in the ANOVA summary. An ANOVA table shows the change in deviance from successively adding each variable to the model.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cs1<span class="sc">$</span>result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: heart_disease

Terms added sequentially (first to last)

       Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    
NULL                      99     129.49              
age     1  11.9074        98     117.58 0.0005591 ***
weight  1   9.1820        97     108.40 0.0024440 ** 
VO2max  1   0.5045        96     107.89 0.4775433    
gender  1   5.8076        95     102.09 0.0159568 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Deviance residuals are one of four residuals you can calculate from a binary logistic regression.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> One is the <em>raw residual</em>, <span class="math inline">\(\epsilon_i = y_i - \hat{p}_i\)</span>, where <span class="math inline">\(\hat{p}_i\)</span> is the predicted probability. Another is the <em>Pearson residual</em>, <span class="math inline">\(r_i = \frac{\epsilon_i}{\sqrt{\hat{p}_i(1 - \hat{p}_i)}}\)</span>, the raw residual rescaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. A third is the <em>standardized Pearson residual</em>, <span class="math inline">\(rs_i = r_i / \sqrt{1 - \hat{h}_i}\)</span>, the Pearson residual adjusted for the leverage of the predictors using the hat-values. Hat-values measure the predictor distances from the mean. This residual is especially useful to evaluate model fit because if the model fits well, these residuals have a standard normal distribution. Finally, there are the <em>deviance residuals</em>, <span class="math inline">\(d_i = \mathrm{sign}(\epsilon_i) \left[ -2(y_i \log \hat{p}_i + (1 - y_i) \log (1 - \hat{p}_i)) \right]^{.5}\)</span>. Deviance Residuals measure how much the estimated probabilities differ from the observed proportions of success. You want deviance residuals to be evenly distributed (in absolute values, 1Q <span class="math inline">\(\approx\)</span> 3Q, min <span class="math inline">\(\approx\)</span> max). You also want the min and max to be &lt;3 because deviance residuals are roughly approximated by a standard normal distribution.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Raw =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pearson =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"pearson"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Standardized Pearson</span><span class="st">`</span> <span class="ot">=</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">rstandard</span>(<span class="at">type =</span> <span class="st">"pearson"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deviance =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"Residual"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  Residual             Min.        `1st Qu.`   Median      Mean  `3rd Qu.` Max. 
  &lt;chr&gt;                &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;tab&gt; &lt;table[1&gt; &lt;tab&gt;
1 Raw                  -0.7954587  -0.2500077  -0.1061849  -8.0… 0.3532839 0.91…
2 Pearson              -1.9720520  -0.5773622  -0.3446596  -1.8… 0.7391867 3.34…
3 Standardized Pearson -2.1794172  -0.5918874  -0.3521058  -2.1… 0.7592960 3.39…
4 Deviance             -1.7815642  -0.7585405  -0.4738051  -8.0… 0.9336278 2.23…</code></pre>
</div>
</div>
</section>
<section id="interpretation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretation">Interpretation</h3>
<p>Before we look at the coefficient estimations, consider what it is they are predicting: the log odds of the binary response. To see what that means, plug in values for the explanatory variables to get predictions. <span class="math inline">\(\hat{y}\)</span> is the log odds of having heart disease.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(mean_person <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>caseno) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.by =</span> gender, <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean)))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender      age   weight   VO2max</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   Male 40.79365 84.83270 46.40095</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Female 41.62162 70.85324 38.91135</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>pred_log_odds <span class="ot">&lt;-</span> cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> mean_person, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pred_log_odds) <span class="ot">&lt;-</span> mean_person<span class="sc">$</span>gender</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>pred_log_odds</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">##       Male     Female </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.3643411 -1.5819310</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Exponentiate to get the <strong>odds</strong>, <span class="math inline">\(\exp (\hat{y}) = \frac{\pi}{1 - \pi}\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(pred_odds <span class="ot">&lt;-</span> <span class="fu">exp</span>(pred_log_odds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Male    Female 
0.6946542 0.2055777 </code></pre>
</div>
</div>
<p>Solve for <span class="math inline">\(\pi = \frac{\exp (\hat{y})}{1 + \exp (\hat{y})}\)</span> to get the <strong>probability</strong>. Do the math, or use <code>predict(type = "prob")</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(pred_prob <span class="ot">&lt;-</span> pred_odds <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pred_odds))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">##      Male    Female </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.4099091 0.1705222</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> mean_person, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 2</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   .pred_No .pred_Yes</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    0.590     0.410</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2    0.829     0.171</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s interpret the coefficients.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept) -1.68       3.34      -0.503 0.615  
2 age          0.0851     0.0282     3.02  0.00251
3 weight       0.00573    0.0224     0.255 0.799  
4 VO2max      -0.0990     0.0479    -2.07  0.0389 
5 genderMale   1.95       0.842      2.31  0.0206 </code></pre>
</div>
</div>
<p>The intercept term is the log-odds of heart disease for the reference case. The reference case in the model is <code>gender</code> = “Female”, <code>age</code> = 0, <code>weight</code> = 0, and <code>VO2max</code> = 0. If the data was centered, the reference case would actually meaningful.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">0</span>, <span class="at">weight =</span> <span class="dv">0</span>, <span class="at">VO2max =</span> <span class="dv">0</span>, <span class="at">gender =</span> <span class="st">"Female"</span>), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"raw"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
-1.676469 </code></pre>
</div>
</div>
<p>Column “statistic” is the Wald <span class="math inline">\(z\)</span> statistic, <span class="math inline">\(z = \hat{\beta} / SE(\hat{\beta})\)</span>. Its square is the Wald chi-squared statistic. The <em>p</em>-value is the area to the right of <span class="math inline">\(z^2\)</span> in the <span class="math inline">\(\chi_1^2\)</span> density curve:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.chisq =</span> <span class="fu">map_dbl</span>(statistic, <span class="sc">~</span><span class="fu">pchisq</span>(.<span class="sc">^</span><span class="dv">2</span>, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(p.chisq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.615297092 0.002511644 0.798578389 0.038885956 0.020648470</code></pre>
</div>
</div>
<p>Interpret the coefficient estimates as the change in the log odds of <span class="math inline">\(y\)</span> due to a one unit change in <span class="math inline">\(x\)</span>. If <span class="math inline">\(\delta = x_a - x_b\)</span>, then a <span class="math inline">\(\delta\)</span> change in <span class="math inline">\(x\)</span> is associated with a <span class="math inline">\(\delta \hat{\beta}\)</span> change in the log odds of <span class="math inline">\(y\)</span>. <span class="math inline">\(\beta\)</span> is the log odds ratio of <span class="math inline">\(x_a\)</span> vs <span class="math inline">\(x_b\)</span>.</p>
<p><span class="math display">\[\log \left(\pi / (1 - \pi) |_{x = x_a} \right) - \log \left(\pi / (1 - \pi) |_{x = x_b} \right) = \log \left( \frac{\pi / (1 - \pi) |_{x = x_a}}{\pi / (1 - \pi) |_{x = x_b}} \right) = \delta \hat{\beta}\]</span></p>
<p>The <em>exponential</em> of the coefficient estimates is the change in the <em>odds</em> of <span class="math inline">\(y\)</span> due to a <span class="math inline">\(\delta\)</span> change in <span class="math inline">\(x\)</span>. <span class="math inline">\(\exp \beta\)</span> is the odds ratio of <span class="math inline">\(x_a\)</span> vs <span class="math inline">\(x_b\)</span>.</p>
<p><span class="math display">\[\mathrm{odds}(y) = e^{\delta \hat{\beta}}\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)    0.187    3.34      -0.503 0.615  
2 age            1.09     0.0282     3.02  0.00251
3 weight         1.01     0.0224     0.255 0.799  
4 VO2max         0.906    0.0479    -2.07  0.0389 
5 genderMale     7.03     0.842      2.31  0.0206 </code></pre>
</div>
</div>
<p>All covariates held equal, a male’s log odds of heart disease are 1.95 times that of a female’s (log(OR)). A male’s odds are 7.03 times that of a female’s (OR). Of course, all covariate’s are <em>not</em> equal - males are heavier and have higher VO2max. Let’s run the calculations with the mean predictor values for male and female.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log OR</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>pred_log_odds[<span class="st">"Male"</span>] <span class="sc">/</span> pred_log_odds[<span class="st">"Female"</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">##      Male </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.2303142</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>pred_odds[<span class="st">"Male"</span>] <span class="sc">/</span> pred_odds[<span class="st">"Female"</span>]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     Male </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3.379034</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A one-unit increase in any of the continuous independent variables is interpreted similarly. The reference level is unimportant since the change is constant across the range of values. A one year increase in age increases the log-odds of heart disease by a factor of 0.09, and the odds by a factor of 1.09. To calculate the effect of a <em>decade</em> increase in age, multiply <span class="math inline">\(\beta\)</span> by 10 before exponentiating, or raise the exponentiated coeficient by 10. The effect of a 10-year increase in age is to increase the odds of heart disease by 2.34. The odds double every ten years.</p>
<p><code>oddsratio::or_glm()</code> is a handy way to calculate odds ratios from arbitrary increments to the predictors. Here are the ORs of a 10-year age change, 10 kg weight change, and VO2max change of 5.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>oddsratio<span class="sc">::</span><span class="fu">or_glm</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>dat, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>result, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">incr =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">10</span>, <span class="at">weight =</span> <span class="dv">25</span>, <span class="at">VO2max =</span> <span class="sc">-</span><span class="dv">12</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   predictor oddsratio ci_low (2.5) ci_high (97.5)          increment
1        age     2.342        1.391          4.270                 10
2     weight     1.154        0.381          3.572                 25
3     VO2max     3.281       11.033          1.124                -12
4 genderMale     7.026        1.428         40.155 Indicator variable</code></pre>
</div>
</div>
<p>Notice that the predicted probabilities have the sigmoidal shape of the binary relationship.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>fit, <span class="at">new_data =</span> cs1<span class="sc">$</span>dat, <span class="at">type =</span> <span class="st">"raw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(heart_disease <span class="sc">==</span> <span class="st">"Yes"</span>))) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred_Yes), <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred_Yes), <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Binary Fitted Line Plot"</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Healthy"</span>, <span class="st">"Heart Disease"</span>)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assumptions" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="assumptions">Assumptions</h3>
<p>Four assumptions relate to the study design: (1) the dependent variable is dichotomous; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid here. Three more assumptions related to the data distribution:</p>
<ul>
<li><p>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</p></li>
<li><p>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</p></li>
<li><p>There are no influential outliers. Test with Cook’s distance.</p></li>
</ul>
<p>Test the linearity assumption first. There are two ways to do this (do both). First, fit your model, then plot the <em>fitted values</em> against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the <em>logit</em> transformation. These plotted relationships look pretty linear.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs1<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> .pred_Yes)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y~x"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linearity Test: predicted vs continuous predictors"</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, <span class="math inline">\(x_{Tx} = x \log x\)</span>, then test their significance level in the fit.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_tx =</span> <span class="fu">log</span>(age) <span class="sc">*</span> age,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_tx =</span> <span class="fu">log</span>(weight) <span class="sc">*</span> weight,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">VO2max_tx =</span> <span class="fu">log</span>(VO2max) <span class="sc">*</span> VO2max</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>boxtidwell_fit <span class="ot">&lt;-</span> </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender <span class="sc">+</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        age_tx <span class="sc">+</span> weight_tx <span class="sc">+</span> VO2max_tx, </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> x)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>boxtidwell_fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept) -40.6       21.7      -1.87   0.0615
2 age           2.73       1.10      2.47   0.0135
3 weight        0.144      0.783     0.184  0.854 
4 VO2max        1.32       1.82      0.724  0.469 
5 genderMale    1.85       0.922     2.01   0.0443
6 age_tx       -0.543      0.227    -2.40   0.0164
7 weight_tx    -0.0266     0.146    -0.182  0.855 
8 VO2max_tx    -0.301      0.382    -0.788  0.431 </code></pre>
</div>
</div>
<p>Focus on the three transformed variables. <code>age_tx</code> is the only one with a <em>p</em>-value nearly &lt;.05, but it is customary to apply a Bonferroni adjustment when testing for linearity. There are eight predictors in the model (including the intercept term), so the Bonferroni adjusted <em>p</em>-value for <code>age_tx</code> is multiplied by 8. Do not reject the null hypothesis of linearity.</p>
<p>If the relationship <em>was</em> nonlinear, you could try transforming the variable by raising it to <span class="math inline">\(\lambda = 1 + b / \gamma\)</span> where <span class="math inline">\(b\)</span> is the estimated coefficient of the model without the interaction terms, and <span class="math inline">\(\gamma\)</span> is the estimated coefficient of the interaction term of the model with interactions. For <code>age</code>, <span class="math inline">\(b\)</span> is 0.085 and <span class="math inline">\(\gamma\)</span> is -0.543, so <span class="math inline">\(\lambda\)</span> = 0.843. This is approximately 1 (no transformation). It appears to be customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal.</p>
<p>Now check for multicollinearity. Variance inflation factors (VIF) estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[
\mathrm{VIF}_i = \frac{1}{1 - R_i^2}
\]</span></p>
<p>where <span class="math inline">\(R_i^2\)</span> is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of <span class="math inline">\(X_i\)</span> against all of the other predictors, <span class="math inline">\(X_i = X_{j \ne i} \beta + \epsilon\)</span>. If <span class="math inline">\(X_i\)</span> is totally unrelated to its covariates, then <span class="math inline">\(R_i^2\)</span> will be zero and <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 1. If <span class="math inline">\(R_i^2\)</span> is .8, <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 5. The rule of thumb is that <span class="math inline">\(R_i^2 \le 5\)</span> is tolerable, and <span class="math inline">\(R_i^2 &gt; 5\)</span> is “highly correlated” and you have to do something about it. These are excellent.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(cs1<span class="sc">$</span>result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     age   weight   VO2max   gender 
1.035274 1.900575 2.167067 2.502538 </code></pre>
</div>
</div>
<p>Try calculating the <span class="math inline">\(\mathrm{VIF}\)</span> for <code>age</code>.</p>
<div class="rmdnote">
<p>I don’t know why this doesn’t work. It <em>would</em> work if the underlying model was OLS instead of GLM. The answer seems to be related to GVIF vs VIF, but I didn’t figure it out.)</p>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(age <span class="sc">~</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat_training) <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"r.squared"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>(vif <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.049814</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now check for influential outliers. Predict the response probabilities and filter for the predictions more than two standard deviations from the actual value and a Cook’s Distance greater than 4/N = 0.04.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> Cook’s distance measures how much predicted values change when observation <em>i</em> is removed from the data. Only two fitted values were both an outlier and influential, row ids 59 and 70. An index plot of Cook’s Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of 2.01 and 2.27 standard deviations which were kept in the analysis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>result) <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">if_else</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>, <span class="st">"Outlier"</span>, <span class="st">"Other"</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">influential =</span> <span class="fu">if_else</span>(.cooksd <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="st">"Influential"</span>, <span class="st">"Other"</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">&amp;</span> influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential Outlier"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">~</span> <span class="st">"Outlier"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">if_else</span>(influential <span class="sc">==</span> <span class="st">"Influential"</span>, id, <span class="cn">NA_integer_</span>)), </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> .<span class="dv">025</span>) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"goldenrod"</span>) <span class="sc">+</span> </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Influential Outlier"</span> <span class="ot">=</span> <span class="st">"firebrick"</span>, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Influential"</span> <span class="ot">=</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Outlier"</span> <span class="ot">=</span> <span class="st">"slategray"</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Index Plot of Cook's Distance."</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Row id labeled for values &gt; 4 / N."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluate-the-fit" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="evaluate-the-fit">Evaluate the Fit</h3>
<p>There are several ways to evaluate the model fit.</p>
<ul>
<li>The likelihood ratio test</li>
<li>Pseudo R-squared<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</li>
<li>Accuracy measures</li>
<li>Gain and ROC curves</li>
</ul>
<p>The <strong>likelihood ratio test</strong> compares the log likelihood of the fitted model to an intercept-only model.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs1<span class="sc">$</span>dat)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>(cs1<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs1<span class="sc">$</span>result, intercept_only<span class="sc">$</span>fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: heart_disease ~ age + weight + VO2max + gender
Model 2: heart_disease ~ 1
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   5 -51.044                         
2   1 -64.745 -4 27.402  1.649e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The fitted model is significant, <span class="math inline">\(\chi^2\)</span>(4) = 27.4, <em>p</em> &lt; .001. Calculate the pseuedo-R2 with <code>DescTools::PseudoR2()</code>.</p>
<div class="rmdnote">
<p>I Can’t get this to work in the tidymodels framework. Using <code>glm()</code> for now.</p>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> cs1<span class="sc">$</span>dat,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>pseudo_r2 <span class="ot">&lt;-</span> DescTools<span class="sc">::</span><span class="fu">PseudoR2</span>(x, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">"CoxSnell"</span>, <span class="st">"Nagelkerke"</span>, <span class="st">"McFadden"</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>pseudo_r2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  CoxSnell Nagelkerke   McFadden 
 0.2396799  0.3301044  0.2116126 </code></pre>
</div>
</div>
<p>Laerd interprets this as the model explained 33.0% (Nagelkerke R2) of the variance in heart disease. This is how your would interpret R2 in an OLS model. <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">UCLA</a> points out that the various pseudo R-squareds measure other aspects of the model and are unique to the measured quantity. A pseudo R-squared is not very informative on its own; it is useful for comparing models. Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better way to go.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs1<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conf_mat requires truth to be first level of the factor variable.</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(heart_disease, .pred_class), <span class="sc">~</span><span class="fu">fct_relevel</span>(., <span class="st">"Yes"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> heart_disease, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="do">##           Truth</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Prediction Yes No</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="do">##        Yes  16 10</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="do">##        No   19 55</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 13 × 3</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="do">##    .metric              .estimator .estimate</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 accuracy             binary         0.71 </span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 kap                  binary         0.322</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 sens                 binary         0.457</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 spec                 binary         0.846</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 ppv                  binary         0.615</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 npv                  binary         0.743</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 mcc                  binary         0.330</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 j_index              binary         0.303</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 bal_accuracy         binary         0.652</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 detection_prevalence binary         0.26 </span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 precision            binary         0.615</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 recall               binary         0.457</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 f_meas               binary         0.525</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model accuracy, 71.0%, is the percent of observations correctly classified. The sensitivity, 45.7%, is the accuracy with regard to predicting positive cases. The specificity, 84.6%, is the accuracy with regard to predicting negative cases. If you are fitting a predictive model, use the testing data set for this.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit_training <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> heart_disease, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction No Yes
       No  16   5
       Yes  4   6</code></pre>
</div>
</div>
<p>Finally, plot the <a href="https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference">gain curve or ROC curve</a>. In the <strong>gain curve</strong>, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The “wizard” curve is the gain curve when the data is sorted by the true outcome. If the model’s gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the “gain” over a random prediction.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_testing <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(.pred_Yes, <span class="at">truth =</span> heart_disease, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>11 of the 31 participants had heart disease in the test data set.</p>
<ul>
<li>The gain curve encountered 6 heart disease cases (50%) within the first 8 observations (55%). It encountered all 11 heart disease cases on the 18th observation.</li>
<li>The bottom of the grey area is the outcome of a random model. Only half the heart disease cases would be observed within 50% of the observations.<br>
</li>
<li>The top of the grey area is the outcome of the perfect model, the “wizard curve”. Half the heart disease cases would be observed in 6/30=20% of the observations.</li>
</ul>
<p>The <strong>ROC</strong> (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_testing <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(.pred_Yes, <span class="at">truth =</span> heart_disease, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curve"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reporting" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reporting">Reporting</h3>
<blockquote class="blockquote">
<p>A binomial logistic regression was performed to ascertain the effects of age, weight, gender and VO2max on the likelihood that participants have heart disease. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when <em>p</em> &lt; 0.00625 (Tabachnick &amp; Fidell, 2014). Based on this assessment, all continuous independent variables were found to be linearly related to the logit of the dependent variable. There were two standardized residuals with value of 2.01 and 2.27 standard deviations, which were kept in the analysis. The logistic regression model was statistically significant, χ2(4) = 27.40, p &lt; .001. The model explained 33.0% (Nagelkerke R2) of the variance in heart disease and correctly classified 71.0% of cases. Sensitivity was 45.7%, specificity was 84.6%, positive predictive value was and negative predictive value was . Of the five predictor variables only three were statistically significant: age, gender and VO2max (as shown in Table 1). Females had 0.14 times lower odds to exhibit heart disease than males. Increasing age was associated with an increased likelihood of exhibiting heart disease, but increasing VO2max was associated with a reduction in the likelihood of exhibiting heart disease.</p>
</blockquote>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>fit,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="dmevsytvyn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dmevsytvyn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dmevsytvyn thead, #dmevsytvyn tbody, #dmevsytvyn tfoot, #dmevsytvyn tr, #dmevsytvyn td, #dmevsytvyn th {
  border-style: none;
}

#dmevsytvyn p {
  margin: 0;
  padding: 0;
}

#dmevsytvyn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dmevsytvyn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dmevsytvyn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dmevsytvyn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dmevsytvyn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmevsytvyn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmevsytvyn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmevsytvyn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dmevsytvyn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dmevsytvyn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dmevsytvyn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dmevsytvyn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dmevsytvyn .gt_spanner_row {
  border-bottom-style: hidden;
}

#dmevsytvyn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dmevsytvyn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dmevsytvyn .gt_from_md > :first-child {
  margin-top: 0;
}

#dmevsytvyn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dmevsytvyn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dmevsytvyn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dmevsytvyn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dmevsytvyn .gt_row_group_first td {
  border-top-width: 2px;
}

#dmevsytvyn .gt_row_group_first th {
  border-top-width: 2px;
}

#dmevsytvyn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmevsytvyn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dmevsytvyn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dmevsytvyn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmevsytvyn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmevsytvyn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dmevsytvyn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dmevsytvyn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dmevsytvyn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmevsytvyn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmevsytvyn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmevsytvyn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmevsytvyn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmevsytvyn .gt_left {
  text-align: left;
}

#dmevsytvyn .gt_center {
  text-align: center;
}

#dmevsytvyn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dmevsytvyn .gt_font_normal {
  font-weight: normal;
}

#dmevsytvyn .gt_font_bold {
  font-weight: bold;
}

#dmevsytvyn .gt_font_italic {
  font-style: italic;
}

#dmevsytvyn .gt_super {
  font-size: 65%;
}

#dmevsytvyn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dmevsytvyn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dmevsytvyn .gt_indent_1 {
  text-indent: 5px;
}

#dmevsytvyn .gt_indent_2 {
  text-indent: 10px;
}

#dmevsytvyn .gt_indent_3 {
  text-indent: 15px;
}

#dmevsytvyn .gt_indent_4 {
  text-indent: 20px;
}

#dmevsytvyn .gt_indent_5 {
  text-indent: 25px;
}

#dmevsytvyn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dmevsytvyn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>OR</strong></th>
<th id="conf.low" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">age</td>
<td class="gt_row gt_center" headers="estimate">1.09</td>
<td class="gt_row gt_center" headers="conf.low">1.03, 1.16</td>
<td class="gt_row gt_center" headers="p.value">0.003</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">weight</td>
<td class="gt_row gt_center" headers="estimate">1.01</td>
<td class="gt_row gt_center" headers="conf.low">0.96, 1.05</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">VO2max</td>
<td class="gt_row gt_center" headers="estimate">0.91</td>
<td class="gt_row gt_center" headers="conf.low">0.82, 0.99</td>
<td class="gt_row gt_center" headers="p.value">0.039</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">gender</td>
<td class="gt_row gt_center" headers="estimate"><br>
</td>
<td class="gt_row gt_center" headers="conf.low"><br>
</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="estimate">—</td>
<td class="gt_row gt_center" headers="conf.low">—</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="estimate">7.03</td>
<td class="gt_row gt_center" headers="conf.low">1.43, 40.2</td>
<td class="gt_row gt_center" headers="p.value">0.021</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="4" class="gt_sourcenote">Abbreviations: CI = Confidence Interval, OR = Odds Ratio</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</section>
</section>
<section id="multinomiallogistic" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="multinomiallogistic"><span class="header-section-number">2.2</span> Multinomial Logistic Regression</h2>
<p>The <em>multinomial</em> logistic regression model is <span class="math inline">\(J - 1\)</span> baseline logits,</p>
<p><span class="math display">\[y_i = \log \left( \frac{\pi_{ij}}{\pi_{ij^*}} \right) = X_i \beta_j, \hspace{5mm} j \ne j^*\]</span></p>
<p>where <span class="math inline">\(j\)</span> is a level of the multinomial response variable. Whereas binomial logistic regression models the <em>log odds</em> of the response level, multinomial logistic regression models the <em>log relative risk</em>, the probability relative to the baseline <span class="math inline">\(j^*\)</span> level.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<p>Interpret the <span class="math inline">\(k^{th}\)</span> element of <span class="math inline">\(\beta_j\)</span> as the increase in log relative risk of <span class="math inline">\(Y_i = j\)</span> relative to <span class="math inline">\(Y_i = j^*\)</span> given a one-unit increase in the <span class="math inline">\(k^{th}\)</span> element of <span class="math inline">\(X\)</span>, holding the other terms constant. The individual probabilities, <span class="math inline">\(\pi_{ij}\)</span>, are</p>
<p><span class="math display">\[\pi_{ij} = \frac{\exp(y_{ij})}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{e^{X_i\beta_j}}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}\]</span></p>
<p>and for the baseline category,</p>
<p><span class="math display">\[\pi_{ij^*} = \frac{1}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{1}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}\]</span></p>
<p><strong>Assumptions</strong></p>
<p>Multinomial logistic regression applies when the dependent variable is categorical. It presumes a linear relationship between the log relative risk of the dependent variable and <span class="math inline">\(X\)</span> with residuals <span class="math inline">\(\epsilon\)</span> that are independent. It also assumes there is no severe multicollinearity in the predictors, and there is independence of irrelevant alternatives (IIA). IIA means the relative likelihood of being in one category compared to the base category would not change if you added other categories.</p>
<section id="cs2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="cs2">Case Study</h3>
<p>This case study uses the data set from <a href="https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/">this UCLA tutorial</a>. A study measures the association between students’ academic program (academic, general, and vocational) and their socioeconomic status (SES) (low, middle, high) and writing score.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://stats.idre.ucla.edu/stat/data/hsbdemo.dta"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"./input/hsbdemo.dta"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cs2 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.dta</span>(<span class="st">"./input/hsbdemo.dta"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just keep cols relevant to study</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, prog, ses, write) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_relevel</span>(prog, <span class="st">"academic"</span>, <span class="at">after =</span> <span class="dv">0</span>))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> prog,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">include =</span> <span class="fu">c</span>(prog, ses, write),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean}, {sd}"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">add_overall</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="qbmxqcrbel" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qbmxqcrbel table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qbmxqcrbel thead, #qbmxqcrbel tbody, #qbmxqcrbel tfoot, #qbmxqcrbel tr, #qbmxqcrbel td, #qbmxqcrbel th {
  border-style: none;
}

#qbmxqcrbel p {
  margin: 0;
  padding: 0;
}

#qbmxqcrbel .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qbmxqcrbel .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qbmxqcrbel .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qbmxqcrbel .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qbmxqcrbel .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbmxqcrbel .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbmxqcrbel .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbmxqcrbel .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qbmxqcrbel .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qbmxqcrbel .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qbmxqcrbel .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qbmxqcrbel .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qbmxqcrbel .gt_spanner_row {
  border-bottom-style: hidden;
}

#qbmxqcrbel .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qbmxqcrbel .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qbmxqcrbel .gt_from_md > :first-child {
  margin-top: 0;
}

#qbmxqcrbel .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qbmxqcrbel .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qbmxqcrbel .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qbmxqcrbel .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qbmxqcrbel .gt_row_group_first td {
  border-top-width: 2px;
}

#qbmxqcrbel .gt_row_group_first th {
  border-top-width: 2px;
}

#qbmxqcrbel .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbmxqcrbel .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qbmxqcrbel .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qbmxqcrbel .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbmxqcrbel .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbmxqcrbel .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qbmxqcrbel .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qbmxqcrbel .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qbmxqcrbel .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbmxqcrbel .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbmxqcrbel .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbmxqcrbel .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbmxqcrbel .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbmxqcrbel .gt_left {
  text-align: left;
}

#qbmxqcrbel .gt_center {
  text-align: center;
}

#qbmxqcrbel .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qbmxqcrbel .gt_font_normal {
  font-weight: normal;
}

#qbmxqcrbel .gt_font_bold {
  font-weight: bold;
}

#qbmxqcrbel .gt_font_italic {
  font-style: italic;
}

#qbmxqcrbel .gt_super {
  font-size: 65%;
}

#qbmxqcrbel .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qbmxqcrbel .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qbmxqcrbel .gt_indent_1 {
  text-indent: 5px;
}

#qbmxqcrbel .gt_indent_2 {
  text-indent: 10px;
}

#qbmxqcrbel .gt_indent_3 {
  text-indent: 15px;
}

#qbmxqcrbel .gt_indent_4 {
  text-indent: 20px;
}

#qbmxqcrbel .gt_indent_5 {
  text-indent: 25px;
}

#qbmxqcrbel .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qbmxqcrbel div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_0" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Overall</strong><br>
N = 200<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>academic</strong><br>
N = 105<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>general</strong><br>
N = 45<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>vocation</strong><br>
N = 50<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">ses</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;low</td>
<td class="gt_row gt_center" headers="stat_0">47 (24%)</td>
<td class="gt_row gt_center" headers="stat_1">19 (18%)</td>
<td class="gt_row gt_center" headers="stat_2">16 (36%)</td>
<td class="gt_row gt_center" headers="stat_3">12 (24%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;middle</td>
<td class="gt_row gt_center" headers="stat_0">95 (48%)</td>
<td class="gt_row gt_center" headers="stat_1">44 (42%)</td>
<td class="gt_row gt_center" headers="stat_2">20 (44%)</td>
<td class="gt_row gt_center" headers="stat_3">31 (62%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;high</td>
<td class="gt_row gt_center" headers="stat_0">58 (29%)</td>
<td class="gt_row gt_center" headers="stat_1">42 (40%)</td>
<td class="gt_row gt_center" headers="stat_2">9 (20%)</td>
<td class="gt_row gt_center" headers="stat_3">7 (14%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">write</td>
<td class="gt_row gt_center" headers="stat_0">53, 9</td>
<td class="gt_row gt_center" headers="stat_1">56, 8</td>
<td class="gt_row gt_center" headers="stat_2">51, 9</td>
<td class="gt_row gt_center" headers="stat_3">47, 9</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n (%); Mean, SD</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p><br></p>
<p>Conduct a brief exploratory analysis to establish your expectations. Academic programs are associated with higher writing scores and SES. General and vocational programs are the opposite, although SES has opposing effects for general (increased probability) and vocational (decreased probability).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_bin =</span> <span class="fu">cut</span>(write, <span class="at">breaks =</span> <span class="dv">5</span>, <span class="at">dig.lab =</span> <span class="dv">1</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(prog, ses, write_bin) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.by =</span> <span class="fu">c</span>(ses, write_bin), <span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write_bin, <span class="at">y =</span> prob, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ses)) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Program Proportions by SES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If your model is predictive rather than inferential, split the data into training/testing data sets.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For reproducibility</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(cs2<span class="sc">$</span>dat, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> prog))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;Training/Testing/Total&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;139/61/200&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_training <span class="ot">&lt;-</span> <span class="fu">training</span>(x)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cs2<span class="sc">$</span>dat_training)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 139   4</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_testing <span class="ot">&lt;-</span> <span class="fu">testing</span>(x)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cs2<span class="sc">$</span>dat_testing)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 61  4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-the-model-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="fit-the-model-1">Fit the Model</h3>
<p>The multinomial logitistic regression model engines all seem to be related to neural networks and advise that predictors be set on a common scale by normalizing. I have only one predictor other than SES in this model, but I’ll normalize it anyway. Normalizing <code>write</code> will also facilitate model interpretation. The intercept will represent a reasonable condition (average writing score) and a one-unit increase in <code>write</code> will represent a 1 SD increase in writing.</p>
<div class="rmdnote">
<p>This case study will use both the <code>parsnip</code> package to fit a model directly to a data set, and the <code>recipes</code> package to preprocess the data. <code>parsnip</code> is fine for most applications and it seems to be better supported by other functions, like <code>tidy()</code>, so stick with it for inferential applications. <code>recipes</code> has the advantage of being able to process data in a workflow, so you don’t have to transform new data to make predictions. See more uses of <code>recipes</code> on the <a href="https://www.tidymodels.org/start/recipes/">tidy models documentation</a>.</p>
</div>
<p>Let’s first use <code>parsnip</code> to fit the full data set for an inferential application.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model. This much is the same for parsnip or recipes.</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>model <span class="ot">&lt;-</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multinom_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For parsnip, you need to normalize the data explicitly. nnet requires dummy</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># vars for factor predictors, but thankfully parsnip does that implicitly. </span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># However, I want the outcome variable base level to be "academic" and while</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co"># recipes can do that in pre-processing, I have to do it manually for parsnip.</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="ot">&lt;-</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cast to numeric, otherwise scale() returns an nmatrix. :(</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(write, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the whole data set for an explanatory model.</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit <span class="ot">&lt;-</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write, <span class="at">data =</span> cs2<span class="sc">$</span>dat_normalized)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the fit object returned by the engine. Use for interpretation and </span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># checking assumptions.</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="ot">&lt;-</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In parallel, let’s use <code>recipes</code> to fit a predictive model to the training data. The model object is already created, so we just need to pair a recipe object with a workflow.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>rec <span class="ot">&lt;-</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The `data` argument can be the base data, or training, or even testing. </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recipe() only uses it to catalog variable names and data types.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write, <span class="at">data =</span> cs2<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># You could have specified the formula as prog ~ ., then assigned roles. E.g.,</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep "id" in data set, but don't use it in the model like this:</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update_role(id, new_role = "ID") %&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unlike parsnip, recipe does not automatically create dummy vars.</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Not relevant here, but good practice: if a factor level has few values, it may</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># not appear in the training set. If so, its dummy will contain a single value</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (0). You can prevent that by dropping zero-value cols.</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the reference level of the outcome here if you want.</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_relevel</span>(prog, <span class="at">ref_level =</span> <span class="st">"academic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize write.</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(write)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The workflow pairs the model and recipe.</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>wflow <span class="ot">&lt;-</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(cs2<span class="sc">$</span>model) <span class="sc">%&gt;%</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(cs2<span class="sc">$</span>rec)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the training data set for a predictive model.</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit_training <span class="ot">&lt;-</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>wflow <span class="sc">%&gt;%</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> cs2<span class="sc">$</span>dat_training)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="co"># You can't extract the engine fit and pipe into summary. Seems like a bug</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cs2$result_training &lt;- cs2$fit_training %&gt;% extract_fit_engine()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at the explanatory model summary object. The model produces a set of coefficient estimates for each non-reference level of the dependent variable. The <code>nnet</code> engine presents the coefficient estimates, then their standard errors as a second section, but does not present the <em>z</em>-statistic or <em>p</em>-values!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
nnet::multinom(formula = prog ~ ses + write, data = data, trace = FALSE)

Coefficients:
         (Intercept)  sesmiddle    seshigh      write
general   -0.2049851 -0.5332857 -1.1628363 -0.5490814
vocation  -0.7771705  0.2913906 -0.9826773 -1.0767939

Std. Errors:
         (Intercept) sesmiddle   seshigh     write
general    0.3491296 0.4437324 0.5142201 0.2029457
vocation   0.4111072 0.4763734 0.5955665 0.2106132

Residual Deviance: 359.9635 
AIC: 375.9635 </code></pre>
</div>
</div>
<p>The residual deviance is <span class="math inline">\(G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}\)</span>. Another model diagnostic is the log-likelihood, <span class="math inline">\(-G^2 / 2\)</span> (not shown) and AIC. More on these in the Model Fit section.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(cs2<span class="sc">$</span>result)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(cs2<span class="sc">$</span>result, <span class="at">sum =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 'log Lik.' -179.9817 (df=8)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Wald <em>z</em>-statistic is <span class="math inline">\(z = \hat{\beta} / SE(\hat{\beta})\)</span>. Its square is the Wald chi-squared statistic. The <em>p</em>-value is the area to the right of <span class="math inline">\(z^2\)</span> in the <span class="math inline">\(\chi_1^2\)</span> density curve. Get these from <code>tidy()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 6
  y.level  term        estimate std.error statistic     p.value
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 general  (Intercept)   -0.205     0.349    -0.587 0.557      
2 general  sesmiddle     -0.533     0.444    -1.20  0.229      
3 general  seshigh       -1.16      0.514    -2.26  0.0237     
4 general  write         -0.549     0.203    -2.71  0.00682    
5 vocation (Intercept)   -0.777     0.411    -1.89  0.0587     
6 vocation sesmiddle      0.291     0.476     0.612 0.541      
7 vocation seshigh       -0.983     0.596    -1.65  0.0989     
8 vocation write         -1.08      0.211    -5.11  0.000000318</code></pre>
</div>
</div>
</section>
<section id="interpretation-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretation-1">Interpretation</h3>
<p>Start with interpreting the dependent variable. The model fits the <strong>log relative risk</strong> of belonging to program <span class="math inline">\(j \in\)</span> [vocation, general] vs.&nbsp;<span class="math inline">\(j^*\)</span> = academic. However, <code>predict()</code> returns either the risk (<code>type</code> = “probs”) or outcome (<code>type</code> = “class), not the log relative risk. Plug in values for the predictor variables to get predictions. The relative risk is <span class="math inline">\(RR = \exp (\hat{y}_j) = \pi_j / \pi_{j^*}\)</span>. We see here that a student of low SES and mean writing score is less likely to be in a general or vocation program than an academic program.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(risk <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>result, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">ses =</span> <span class="st">"low"</span>, <span class="at">write =</span> <span class="dv">0</span>), <span class="at">type =</span> <span class="st">"probs"</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  academic   general  vocation </span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.4396833 0.3581922 0.2021246</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative risk.</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>(rr <span class="ot">&lt;-</span> risk[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">/</span> risk[<span class="dv">1</span>])</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   general  vocation </span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.8146595 0.4597049</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-relative risk (the modeled outcome)</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>(log_rr <span class="ot">&lt;-</span> <span class="fu">log</span>(rr))</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.2049851 -0.7771705</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Move on to the coefficients. Interpret <span class="math inline">\(\hat{\beta}\)</span> as the change in the <em>log relative risk</em> of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> due to a <span class="math inline">\(\delta\)</span> = one unit change in <span class="math inline">\(x\)</span>. A <span class="math inline">\(\delta = x_a - x_b\)</span> change in <span class="math inline">\(x\)</span> is associated with a <span class="math inline">\(\delta \hat{\beta}\)</span> change. <span class="math inline">\(\delta\beta\)</span> is the log relative risk ratio.</p>
<p><span class="math display">\[\log \left(\pi_j / \pi_{j^*} |_{x = x_a} \right) - \log \left(\pi_j / \pi_{j^*} |_{x = x_b} \right) = \log \left( \frac{\pi_j / \pi_{j^*} |_{x = x_a}}{\pi_j / \pi_{j^*} |_{x = x_b}} \right) = \delta \hat{\beta}\]</span></p>
<p>The exponential of <span class="math inline">\(\hat{\beta}\)</span> is the change in the <em>relative risk</em> of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> due to a <span class="math inline">\(\delta\)</span> = one unit change in <span class="math inline">\(x\)</span>. <span class="math inline">\(\exp \delta \beta\)</span> is the relative risk ratio.</p>
<p><span class="math display">\[\pi_j / \pi_{j^*} |_{x = x_a} = \exp{\delta \hat{\beta}}\]</span></p>
<p>The intercept term is the log-relative risk of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> for the reference case. The reference case in the model is <code>ses</code> = “low” and <code>write</code> centered at 52.8. Notice how the intercept matches the predicted values above.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(ref_log_rr <span class="ot">&lt;-</span> <span class="fu">coef</span>(cs2<span class="sc">$</span>result)[,<span class="st">"(Intercept)"</span>])</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.2049851 -0.7771705</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># From log-relative risk to relative risk.</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>(ref_rr <span class="ot">&lt;-</span> <span class="fu">exp</span>(ref_log_rr))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   general  vocation </span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.8146595 0.4597049</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The log relative risks of a low SES student with a 52.8 writing score being in program general vs academic is <span class="math inline">\(\hat{y} = \mathrm{Intercept}_1\)</span> = -0.205, and <span class="math inline">\(\hat{y} = \mathrm{Intercept}_2\)</span> = -0.777 for vocation vs academic. The corresponding relative risks are <span class="math inline">\(\exp(\hat{y}_j)\)</span> = 0.815 and 0.460. The expected probabilities are 44.0%, 35.8%, and 20.2% for academic, general, and vocation respectively.</p>
<p>If SES was high instead of low, the expected probabilities of being in program general vs academic would be 70.1%, 17.8%, and 12.1% for academic, general, and vocation respectively.</p>
<p>What if the writing score increases by 1 SD (one unit)? The log RR of being in program general vs academic change by a factor of <code>coef(cs2$result)["general", "write"]</code> = -0.549, RR = 0.577. For program vocation vs academic, it would change by a factor of -1.077, RR = 0.341. To get a 2 SD increase, multiply the coefficient by 2, then exponentiate. The two RRs would then be 0.333 and 0.116.</p>
<p>Visualize the parameter estimates by plotting the predicted values.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ses =</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>ses),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">write =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">round</span>(<span class="fu">min</span>(cs2<span class="sc">$</span>dat_normalized<span class="sc">$</span>write)), </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">round</span>(<span class="fu">max</span>(cs2<span class="sc">$</span>dat_normalized<span class="sc">$</span>write)), </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  new_data,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> new_data, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(ses, write), <span class="at">names_to =</span> <span class="st">"prog"</span>, <span class="at">values_to =</span> <span class="st">"probability"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write, <span class="at">y =</span> probability, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assumptions-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="assumptions-1">Assumptions</h3>
<p>Four assumptions relate to the study design: (1) the dependent variable is multinomial; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid. Three more assumptions related to the data distribution:</p>
<ul>
<li><p>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</p></li>
<li><p>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</p></li>
<li><p>There are no influential outliers. Test with Cook’s distance.</p></li>
</ul>
<p>There are two ways to test for linearity (do both). First, plot the <em>fitted values</em> against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the <em>logit</em> transformation. These plotted relationships look good, except that in the <code>prog</code> = general level, writing score appears to interact with SES.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(.pred_academic<span class="sc">:</span>.pred_vocation), <span class="at">values_to =</span> <span class="st">".fitted"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="fu">as.character</span>(prog))) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write, <span class="at">y =</span> .fitted, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog), <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y~x"</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linearity Test: predicted vs continuous predictors"</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, <span class="math inline">\(x_{Tx} = x \log x\)</span>, then test their significance level in the fit. Focus on the transformed variable. <code>write_tx</code> has a <em>p</em>-value &lt;.05 for general. It is customary to apply a Bonferroni adjustment when testing for linearity. There are ten predictors in the model (including the intercept terms), so the Bonferroni adjusted <em>p</em>-values for <code>write_tx</code> are multiplied by 10. We should reject the null hypothesis of linearity because the adjusted p.value is still below .05.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>boxtidwell <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_tx =</span> <span class="fu">log</span>(write) <span class="sc">*</span> write) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cs2<span class="sc">$</span>model, prog <span class="sc">~</span> ses <span class="sc">+</span> write <span class="sc">+</span> write_tx, <span class="at">data =</span> .)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(cs2<span class="sc">$</span>boxtidwell) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"write_tx"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">adj_p =</span> p.value <span class="sc">*</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  y.level  term     estimate std.error statistic p.value  adj_p
  &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 general  write_tx   0.0713    0.0231     3.09  0.00198 0.0198
2 vocation write_tx   0.0125    0.0239     0.522 0.601   6.01  </code></pre>
</div>
</div>
<p>If the relationship is nonlinear, you can try transforming the variable by raising it to <span class="math inline">\(\lambda = 1 + b / \gamma\)</span> where <span class="math inline">\(b\)</span> is the estimated coefficient of the model without the interaction terms, and <span class="math inline">\(\gamma\)</span> is the estimated coefficient of the interaction term of the model with interactions. For <code>write</code>, <span class="math inline">\(b\)</span> is for general and <span class="math inline">\(\gamma\)</span> is , so <span class="math inline">\(\lambda\)</span> = 1 + / = . It seems customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal, so maybe try raising <code>write_c</code> to . It seems in this case that the better solution is to add an interaction between <code>write_c</code> and <code>ses</code> to the model. I’m not going to pursue this further here.</p>
<p>Check for multicollinearity using variance inflation factors (VIF). VIFs estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[
\mathrm{VIF}_i = \frac{1}{1 - R_i^2}
\]</span></p>
<p>where <span class="math inline">\(R_i^2\)</span> is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of <span class="math inline">\(X_i\)</span> against all of the other predictors, <span class="math inline">\(X_i = X_{j \ne i} \beta + \epsilon\)</span>. If <span class="math inline">\(X_i\)</span> is totally unrelated to its covariates, then <span class="math inline">\(R_i^2\)</span> will be zero and <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 1. If <span class="math inline">\(R_i^2\)</span> is .8, <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 5. The rule of thumb is that <span class="math inline">\(R_i^2 \le 5\)</span> is tolerable, and <span class="math inline">\(R_i^2 &gt; 5\)</span> is “highly correlated” and you have to do something about it. <code>car::vif()</code> doesn’t work for multinomial logistic regression. The model type is not actually important here - we’re concerned about the covariate relationships. Below, I successively collapse the dependent variable into two-levels, then fit a binomial logistic regression and pipe that into <code>car::vif()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tmp_fit_general <span class="ot">&lt;-</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    prog <span class="sc">~</span> ses <span class="sc">+</span> write, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_collapse</span>(prog, <span class="at">vocation =</span> <span class="st">"academic"</span>))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>tmp_fit_general <span class="sc">%&gt;%</span> car<span class="sc">::</span><span class="fu">vif</span>()</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="do">##           GVIF Df GVIF^(1/(2*Df))</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ses   1.037207  2        1.009175</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="do">## write 1.037207  1        1.018433</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>tmp_fit_vocation <span class="ot">&lt;-</span> </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    prog <span class="sc">~</span> ses <span class="sc">+</span> write, </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_collapse</span>(prog, <span class="at">general =</span> <span class="st">"academic"</span>))</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>tmp_fit_vocation <span class="sc">%&gt;%</span> car<span class="sc">::</span><span class="fu">vif</span>()</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="do">##           GVIF Df GVIF^(1/(2*Df))</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ses   1.020017  2        1.004967</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="do">## write 1.020017  1        1.009959</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check for influential outliers. Outliers are predicted values greater than two standard deviations from the actual value. Influential points have a Cook’s Distance greater than 4/N (4 / 200 = 0.02.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> Influential outliers are both. There is no simple way to do this for the multinomial regression because neither VGAM nor nnet support the <code>augment()</code> generic. Instead, I will use the two <em>binomial logistic</em> regressions from the VIF diagnostic.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>outlier_dat <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="fu">augment</span>(tmp_fit_general, <span class="at">type.predict =</span> <span class="st">"response"</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">vocation =</span> <span class="fu">augment</span>(tmp_fit_vocation, <span class="at">type.predict =</span> <span class="st">"response"</span>),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">"logit"</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">if_else</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>, <span class="st">"Outlier"</span>, <span class="st">"Other"</span>),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">influential =</span> <span class="fu">if_else</span>(.cooksd <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="st">"Influential"</span>, <span class="st">"Other"</span>),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">&amp;</span> influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential Outlier"</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">~</span> <span class="st">"Outlier"</span>,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>      influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential"</span>,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">factor</span>(status, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Influential"</span>, <span class="st">"Outlier"</span>, <span class="st">"Influential Outlier"</span>, <span class="st">"Other"</span>))</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>outlier_dat <span class="sc">%&gt;%</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">if_else</span>(influential <span class="sc">==</span> <span class="st">"Influential"</span>, id, <span class="cn">NA_integer_</span>)), </span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> .<span class="dv">025</span>) <span class="sc">+</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"goldenrod"</span>) <span class="sc">+</span> </span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Influential Outlier"</span> <span class="ot">=</span> <span class="st">"firebrick"</span>, </span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Influential"</span> <span class="ot">=</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Outlier"</span> <span class="ot">=</span> <span class="st">"salmon"</span>,</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Index Plot of Cook's Distance."</span>,</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Row id labeled for influential points."</span>) <span class="sc">+</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(logit), <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No fitted values were influential outliers in the first fit, and only two were influential outliers in the second fit.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>outliers <span class="ot">&lt;-</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  outlier_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(status <span class="sc">==</span> <span class="st">"Influential Outlier"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.std.resid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.202098 2.593458</code></pre>
</div>
</div>
<p>An index plot of Cook’s Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of 2.20 and 2.59 standard deviations which were kept in the analysis.</p>
</section>
<section id="evaluate-the-fit-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="evaluate-the-fit-1">Evaluate the Fit</h3>
<p>There are several ways to evaluate the model fit.</p>
<ul>
<li>Deviance and chi-squared tests for lack of fit</li>
<li>The likelihood ratio test</li>
<li>Pseudo R-squared<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>.</li>
<li>Accuracy measures</li>
<li>Gain and ROC curves</li>
</ul>
<p>The <strong>deviance test</strong> for lack of fit and the <strong>likelihood ratio test</strong> are residuals tests. The deviance residual is defined as <span class="math inline">\(d_i = \mathrm{sign}(\epsilon_i) \left[ -2(y_i \log \hat{\pi}_i + (1 - y_i) \log (1 - \hat{\pi}_i)) \right]^{.5}\)</span>. The model deviance, <span class="math inline">\(G^2\)</span>, is the sum of the squared deviance residuals. It also equals <span class="math inline">\(G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}\)</span>. You can calculate them by hand.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual values (1s and 0s for three response levels)</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> prog, <span class="at">values_from =</span> val, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values (probabilities for three response levels)</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>result, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw residuals, by hand or by formula</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># e &lt;- y - pi</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(cs2<span class="sc">$</span>result, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Deviance residuals</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">sign</span>(e) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> y <span class="sc">*</span> <span class="fu">log</span>(pi) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> y) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> pi))</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(d<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(y <span class="sc">*</span> <span class="fu">log</span>(y <span class="sc">/</span> pi), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(cs2<span class="sc">$</span>result))</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The related Pearson statistic, <span class="math inline">\(X\)</span>, is the sum of the squared <em>Pearson residuals</em>, <span class="math inline">\(pr_i = \epsilon_i / \sqrt{\hat{\pi}_i}\)</span>, the raw residual scaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial. I don’t see this calculated in the <code>residual()</code> functions. You can do it yourself.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((e <span class="sc">/</span> <span class="fu">sqrt</span>(pi))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 406.0656</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The deviance and Pearson statistic are distributed chi-squared with <span class="math inline">\((N - p)(r - 1)\)</span> degrees of freedom where <span class="math inline">\(p\)</span> = 4 predictor variables (3 SES levels + intercept), and <span class="math inline">\(r\)</span> = 3 levels of the dependent variable for 392 degrees of freedom. The deviance and Pearson tests for lack of fit calculate the probability of the test statistic. The null hypothesis is that the model is correct. Neither test rejects the null hypothesis.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deviance test for lack of fit</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>(N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cs2<span class="sc">$</span>dat))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 200</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(cs2<span class="sc">$</span>result)) <span class="sc">/</span> (r <span class="sc">-</span> <span class="dv">1</span>)) <span class="co"># coefficients for each level, so divide by # levels</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>(df <span class="ot">&lt;-</span> (N <span class="sc">-</span> p) <span class="sc">*</span> (r <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 392</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(g2, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.8755302</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(x2, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.3014625</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can do the same calculations for the intercept-only model.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>io <span class="ot">&lt;-</span> <span class="fu">multinom_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(prog <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs2<span class="sc">$</span>dat) <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(io)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 408.1933</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># degrees of freedom</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>((<span class="fu">nrow</span>(cs2<span class="sc">$</span>dat) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(io)) <span class="sc">/</span> (r <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> (r <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 398</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The log-likelihood measures the unexplained variability in the model. The <strong>likelihood ratio test</strong> compares the log likelihood of the fitted model to the intercept-only model. You can use <code>lmtest::lrtest()</code> to test. <code>anova()</code> does the same thing using the residual deviance, <span class="math inline">\(G2 = -2 \times \mathrm{log likelihood}\)</span>, although it does not seem to work with the <code>nnet</code> engine.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(io, cs2<span class="sc">$</span>result))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: prog ~ 1
Model 2: prog ~ ses + write
  #Df  LogLik Df Chisq Pr(&gt;Chisq)    
1   2 -204.10                        
2   8 -179.98  6 48.23  1.063e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (cs2$lrtest &lt;- anova(io, cs2$result, type = "I", test = "LR"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The difference in deviances is <span class="math inline">\(LR\)</span> = 48.23 with 6 degrees of freedom. This is distributed chi-squared, with <em>p</em>-value = 1.063e-08. The deviance test for lack of fit concludes that the model fits significantly better than an empty (intercept-only) model, <span class="math inline">\(\chi^2\)</span>(6) = 48.23, p &lt; .001.</p>
<p>You can use <code>lmtest::lrtest()</code> to perform likelihood ratio tests on the significance of the predictors too. The likelihood ratio test compares the log likelihood with and without the predictor. Unfortunately, this does not seem to work within the <code>parsnip</code> framework.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (cs2$lrtest_ses &lt;- lmtest::lrtest(cs2$result, "ses"))</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>no_ses <span class="ot">&lt;-</span> <span class="fu">multinom_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(prog <span class="sc">~</span> write, <span class="at">data =</span> cs2<span class="sc">$</span>dat) <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>()</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest_ses <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs2<span class="sc">$</span>result, no_ses))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Likelihood ratio test</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 1: prog ~ ses + write</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 2: prog ~ write</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  </span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   8 -179.98                       </span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2   4 -185.51 -4 11.058    0.02592 *</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (cs2$lrtest_write &lt;- lmtest::lrtest(cs2$fit_nnet, "write"))</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>no_write <span class="ot">&lt;-</span> <span class="fu">multinom_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">fit</span>(prog <span class="sc">~</span> ses, <span class="at">data =</span> cs2<span class="sc">$</span>dat) <span class="sc">%&gt;%</span> <span class="fu">extract_fit_engine</span>()</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest_write <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs2<span class="sc">$</span>result, no_write))</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Likelihood ratio test</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 1: prog ~ ses + write</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Model 2: prog ~ ses</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    </span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   8 -179.98                         </span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 2   6 -195.71 -2 31.447  1.484e-07 ***</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Both SES, <span class="math inline">\(X^2\)</span> = 11.058, <em>p</em> = 0.026, and writing score <span class="math inline">\(X^2\)</span> = 31.447, <em>p</em> = 1.484e-07, had significant effects on the program.</p>
<p>Logistic regression does not have a direct R-squared statistic like OLS does (the proportion of variance explained by the model). However, there are some analogs, called pseudo R-squared. You’ll encounter three pseudo R-squared measures: Cox and Snell, Nagelkerke, and McFadden. This one does not work for the <code>nnet</code> engine.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DescTools::PseudoR2(cs2$result, which = c("CoxSnell", "Nagelkerke", "McFadden"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better model fit diagnostic the the pseudo r-squares.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conf_mat requires truth to be first level of the factor variable.</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(across(c(prog, .pred_class), ~fct_relevel(., "academic"))) %&gt;%</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> prog, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction academic general vocation
  academic       92      27       23
  general         4       7        4
  vocation        9      11       23</code></pre>
</div>
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             multiclass     0.61 
 2 kap                  multiclass     0.299
 3 sens                 macro          0.497
 4 spec                 macro          0.763
 5 ppv                  macro          0.550
 6 npv                  macro          0.799
 7 mcc                  multiclass     0.320
 8 j_index              macro          0.260
 9 bal_accuracy         macro          0.630
10 detection_prevalence macro          0.333
11 precision            macro          0.550
12 recall               macro          0.497
13 f_meas               macro          0.491</code></pre>
</div>
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model accuracy, 61.0%, is the percent of observations correctly classified. The sensitivities are the accuracy with regard to predicting positive cases in each level of the dependent variable. The specificities are the accuracy with regard to predicting negative cases. The prevalences are the proportion of cases that were positive.</p>
<p>Finally, plot the <a href="https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference">gain curve or ROC curve</a>. In the <strong>gain curve</strong>, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The “wizard” curve is the gain curve when the data is sorted by the true outcome. If the model’s gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the “gain” over a random prediction.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(.pred_academic, .pred_general, .pred_vocation, </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">truth =</span> prog, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>105 of the 200 participants were in the academic program.</p>
<ul>
<li>The gain curve encountered 52 academic programs (50%) within the first 72 observations (36%). It encountered all 105 cases on the 189th observation.</li>
<li>The bottom of the grey area is the outcome of a random model. Only half the academic program cases would be observed within 50% of the observations.<br>
</li>
<li>The top of the grey area is the outcome of the perfect model, the “wizard curve”. Half the academic program cases would be observed in 52.5/200=26.25% of the observations.</li>
</ul>
<p>The <strong>ROC</strong> (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(.pred_academic, .pred_general, .pred_vocation, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">truth =</span> prog, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reporting-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reporting-1">Reporting</h3>
<blockquote class="blockquote">
<p>A multinomial logistic regression was performed to ascertain the effects of socioeconomic status (ses) and writing score on the likelihood that participants are enrolled in an academic, general, or vocation program. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when <em>p</em> &lt; 0.00625 (Tabachnick &amp; Fidell, 2014). Based on this assessment, the continuous <code>write</code> independent variable was found to be linearly related to the logit of the dependent variable levels. There were two standardized residuals with value of 2.20 and 2.59 standard deviations, which were kept in the analysis. The multinomial logistic regression model was statistically significant, <span class="math inline">\(\chi^2\)</span>(6) = 48.23, p &lt; .001. The model correctly classified 61% of cases. Sensitivity was 50%, specificity was 76%, positive predictive value was 55% and negative predictive value was 80%. The <code>write</code> predictor variable was statistically significant for both outcome levels and high SES was statistically significant for the general program (as shown in Table 1). A 1SD increase in the writing score was associated with a (1 - 0.58) decrease in the odds of choosing a general program instead of academic and a (1 - 0.34) decrease in the odds of choosing a vocation program over academic. A high SEC was associated with a (1 - 0.31) decrease in the odds of chooseing a general program over academic.</p>
</blockquote>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>result,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">as_flex_table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">theme_apa</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-61f69d18{}.cl-61e7cb3a{font-family:'Times New Roman';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-61e7cb44{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-61ed1a9a{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 2;background-color:transparent;}.cl-61ed1aa4{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 2;background-color:transparent;}.cl-61ed1aae{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:15pt;padding-right:5pt;line-height: 2;background-color:transparent;}.cl-61ed5046{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5050{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed505a{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5064{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed506e{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5096{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50a0{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50a1{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50aa{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50c8{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50d2{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50fa{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed50fb{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5104{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5105{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5106{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed510e{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed510f{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5118{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5119{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5122{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5140{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5141{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed514a{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed514b{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5154{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed515e{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed515f{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5168{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61ed5172{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-61f69d18"><thead><tr style="overflow-wrap:break-word;"><th class="cl-61ed5046"><p class="cl-61ed1a9a"><span class="cl-61e7cb3a">Outcome</span></p></th><th class="cl-61ed5050"><p class="cl-61ed1a9a"><span class="cl-61e7cb3a">Characteristic</span></p></th><th class="cl-61ed505a"><p class="cl-61ed1a9a"><span class="cl-61e7cb3a">OR</span></p></th><th class="cl-61ed5064"><p class="cl-61ed1a9a"><span class="cl-61e7cb3a">95% CI</span></p></th><th class="cl-61ed506e"><p class="cl-61ed1a9a"><span class="cl-61e7cb3a">p-value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-61ed5096"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">general</span></p></td><td class="cl-61ed50a0"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">ses</span></p></td><td class="cl-61ed50a1"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50aa"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50c8"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed50d2"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50fa"><p class="cl-61ed1aae"><span class="cl-61e7cb44">low</span></p></td><td class="cl-61ed50fb"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">—</span></p></td><td class="cl-61ed5104"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">—</span></p></td><td class="cl-61ed5105"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5106"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed510e"><p class="cl-61ed1aae"><span class="cl-61e7cb44">middle</span></p></td><td class="cl-61ed510f"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.59</span></p></td><td class="cl-61ed5118"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.25, 1.40</span></p></td><td class="cl-61ed5119"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.2</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5096"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50a0"><p class="cl-61ed1aae"><span class="cl-61e7cb44">high</span></p></td><td class="cl-61ed50a1"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.31</span></p></td><td class="cl-61ed50aa"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.11, 0.86</span></p></td><td class="cl-61ed50c8"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.024</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5106"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed510e"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">write</span></p></td><td class="cl-61ed510f"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.58</span></p></td><td class="cl-61ed5118"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.39, 0.86</span></p></td><td class="cl-61ed5119"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.007</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed50d2"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">vocation</span></p></td><td class="cl-61ed50fa"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">ses</span></p></td><td class="cl-61ed50fb"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed5104"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed5105"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed50d2"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50fa"><p class="cl-61ed1aae"><span class="cl-61e7cb44">low</span></p></td><td class="cl-61ed50fb"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">—</span></p></td><td class="cl-61ed5104"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">—</span></p></td><td class="cl-61ed5105"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5106"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed510e"><p class="cl-61ed1aae"><span class="cl-61e7cb44">middle</span></p></td><td class="cl-61ed510f"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">1.34</span></p></td><td class="cl-61ed5118"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.53, 3.40</span></p></td><td class="cl-61ed5119"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.5</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5096"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed50a0"><p class="cl-61ed1aae"><span class="cl-61e7cb44">high</span></p></td><td class="cl-61ed50a1"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.37</span></p></td><td class="cl-61ed50aa"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.12, 1.20</span></p></td><td class="cl-61ed50c8"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.10</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-61ed5122"><p class="cl-61ed1aa4"><span class="cl-61e7cb44"></span></p></td><td class="cl-61ed5140"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">write</span></p></td><td class="cl-61ed5141"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.34</span></p></td><td class="cl-61ed514a"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">0.23, 0.51</span></p></td><td class="cl-61ed514b"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">&lt;0.001</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="5" class="cl-61ed5154"><p class="cl-61ed1aa4"><span class="cl-61e7cb44">Abbreviations: CI = Confidence Interval, OR = Odds Ratio</span></p></td></tr></tfoot></table></div>
</div>
</div>
</section>
</section>
<section id="ordinallogistic" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="ordinallogistic"><span class="header-section-number">2.3</span> Ordinal Logistic Regression</h2>
<p>Ordinal logistic regression, also call cumulative link model (CLM), is a generalized linear model (GZLM), an extension of the general linear model (GLM) to non-continuous outcome variables. There are many approaches to ordinal logistic regression, including cumulative, adjacent, and continuation categories, but the most popular is the <strong>cumulative odds ordinal logistic regression with proportional odds</strong>.<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. The model for ordinal response random variable <span class="math inline">\(Y_i\)</span> with <span class="math inline">\(J\)</span> levels is</p>
<p><span class="math display">\[\gamma_{ij} = F(\eta_{ij}), \hspace{5 mm} \eta_{ij} = \theta_j - x_i^\mathrm{T}\beta, \hspace{5 mm} i = 1, \ldots, n, \hspace{5 mm} j = 1, \ldots, J-1\]</span></p>
<p>where <span class="math inline">\(\gamma_{ij} = P(Y_i \le j) = \pi_{i1} + \cdots + \pi_{ij}\)</span>. <span class="math inline">\(\eta_{ij}\)</span> is a linear predictor with <span class="math inline">\(J-1\)</span> intercepts. <span class="math inline">\(F\)</span> is the inverse link function. The regression models the logit link function of <span class="math inline">\(\gamma_{ij}\)</span>.</p>
<p><span class="math display">\[\mathrm{logit}(\gamma_{ij}) = \log \left[\frac{P(Y_i \le j)}{P(Y_i \gt j)} \right] = \theta_j - x_i^\mathrm{T}\beta\]</span> The cumulative logit is the log-odds of the cumulative probabilities that the response is in category <span class="math inline">\(\le j\)</span> versus <span class="math inline">\(\gt j\)</span>. <span class="math inline">\(\theta_j\)</span> is the log-odds when <span class="math inline">\(x_i^\mathrm{T}=0\)</span> and <span class="math inline">\(\beta\)</span> is the increase in the log odds attributed to a one unit increase in <span class="math inline">\(x_i^\mathrm{T}\)</span>. Notice <span class="math inline">\(\beta\)</span> is the same for all <span class="math inline">\(j\)</span>. The exponential of the predicted value is the odds. Solve this for the probability,</p>
<p><span class="math display">\[P(Y_i \gt j) = \frac{\mathrm{exp}(\hat{y}_i)}{1 + \mathrm{exp}(\hat{y}_i)}.\]</span></p>
<p>The exponential of <span class="math inline">\(\beta\)</span> is the odds ratio of <span class="math inline">\(x_1^\mathrm{T} - x_0^\mathrm{T}\)</span>. Solve this for the odds ratio</p>
<p><span class="math display">\[\mathrm{OR} = \frac{\mathrm{exp}(\theta_j - x_1^\mathrm{T}\beta)}{\mathrm{exp}(\theta_j - x_2^\mathrm{T}\beta)} = \mathrm{exp}(\beta(x_1^\mathrm{T} - x_0^\mathrm{T}))\]</span></p>
<p>If <span class="math inline">\(x\)</span> is a binary factor factor, then <span class="math inline">\(\exp(\beta)\)</span> is the odds ratio of <span class="math inline">\(x=1\)</span> vs <span class="math inline">\(x=0\)</span>. Thus the odds-ratio is <em>proportional</em> to the difference between values of <span class="math inline">\(x\)</span> and <span class="math inline">\(\beta\)</span> is the constant of proportionality.</p>
<p>The model is estimated with a regularized Newton-Raphson algorithm with step-halving (line search) using analytic expressions for the gradient and Hessian of the negative log-likelihood function. This is beyond me, but the upshot is that the estimation is an iterative maximization exercise, not a formulaic matrix algebra process. It is possible for the model estimation to fail to converge on a maximum.</p>
<p>You will sometimes encounter discussion about the <em>latent variable</em>. That is just the underlying quality you are trying to measure. If you rate something a 4 on a 5-level Likert scale, 4 is the expression of your valuation, the latent variable. Your precise valuation is somewhere between 3 and 5 on a continuous scale. The link function defines the distribution of the latent variable.</p>
<p>There are variations on the ordinal model. Structured thresholds impose restrictions on <span class="math inline">\(\theta_j\)</span>, for example requiring equal distances between levels. Partial proportional odds allow <span class="math inline">\(\theta_j\)</span> to vary with nominal predictors. You can also use link functions other than logit.</p>
<p>There are two assumptions underling ordinal logistic regression: (a) no multicollinearity, and (b) proportional odds.</p>
<section id="cs3" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="cs3">Case Study</h3>
<p>This case study uses the <a href="https://statistics.laerd.com/">Laerd Statistics</a> article on ordinal logistic regression <a href="https://statistics.laerd.com/premium/spss/spss-files/ordinal-logistic-regression.sav">data set</a>. A study investigates the relationship between attitude toward tax levels and participant values and background. 192 participants in a study responded to the statement “Taxes are too high” on a 4-level Likert scale (<code>tax_too_high</code>, <em>Strongly Disagree</em>, <em>Disagree</em>, <em>Agree</em>, <em>Strongly Agree</em>). Participant attributes include business owner (<em>Y</em>|<em>N</em>), age, and political affiliation (<em>Liberal</em>, <em>Conservative</em>, <em>Labor</em>).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>cs3 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.spss</span>(<span class="st">"./input/ordinal-logistic-regression.sav"</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_too_high =</span> <span class="fu">factor</span>(tax_too_high, <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">biz_owner =</span> <span class="fu">fct_relevel</span>(biz_owner, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">politics =</span> <span class="fu">fct_relevel</span>(politics, <span class="st">"Lab"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(biz_friends, uni_educated, income))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> politics, </span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean} ({sd})"</span>)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hcdtlvqjtk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hcdtlvqjtk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hcdtlvqjtk thead, #hcdtlvqjtk tbody, #hcdtlvqjtk tfoot, #hcdtlvqjtk tr, #hcdtlvqjtk td, #hcdtlvqjtk th {
  border-style: none;
}

#hcdtlvqjtk p {
  margin: 0;
  padding: 0;
}

#hcdtlvqjtk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hcdtlvqjtk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hcdtlvqjtk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hcdtlvqjtk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hcdtlvqjtk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcdtlvqjtk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcdtlvqjtk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcdtlvqjtk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hcdtlvqjtk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hcdtlvqjtk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hcdtlvqjtk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hcdtlvqjtk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hcdtlvqjtk .gt_spanner_row {
  border-bottom-style: hidden;
}

#hcdtlvqjtk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hcdtlvqjtk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hcdtlvqjtk .gt_from_md > :first-child {
  margin-top: 0;
}

#hcdtlvqjtk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hcdtlvqjtk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hcdtlvqjtk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hcdtlvqjtk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hcdtlvqjtk .gt_row_group_first td {
  border-top-width: 2px;
}

#hcdtlvqjtk .gt_row_group_first th {
  border-top-width: 2px;
}

#hcdtlvqjtk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcdtlvqjtk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hcdtlvqjtk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hcdtlvqjtk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcdtlvqjtk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcdtlvqjtk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hcdtlvqjtk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hcdtlvqjtk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hcdtlvqjtk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcdtlvqjtk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcdtlvqjtk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcdtlvqjtk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcdtlvqjtk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcdtlvqjtk .gt_left {
  text-align: left;
}

#hcdtlvqjtk .gt_center {
  text-align: center;
}

#hcdtlvqjtk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hcdtlvqjtk .gt_font_normal {
  font-weight: normal;
}

#hcdtlvqjtk .gt_font_bold {
  font-weight: bold;
}

#hcdtlvqjtk .gt_font_italic {
  font-style: italic;
}

#hcdtlvqjtk .gt_super {
  font-size: 65%;
}

#hcdtlvqjtk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hcdtlvqjtk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hcdtlvqjtk .gt_indent_1 {
  text-indent: 5px;
}

#hcdtlvqjtk .gt_indent_2 {
  text-indent: 10px;
}

#hcdtlvqjtk .gt_indent_3 {
  text-indent: 15px;
}

#hcdtlvqjtk .gt_indent_4 {
  text-indent: 20px;
}

#hcdtlvqjtk .gt_indent_5 {
  text-indent: 25px;
}

#hcdtlvqjtk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hcdtlvqjtk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Lab</strong><br>
N = 62<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Lib</strong><br>
N = 54<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Con</strong><br>
N = 76<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">biz_owner</td>
<td class="gt_row gt_center" headers="stat_1">36 (58%)</td>
<td class="gt_row gt_center" headers="stat_2">26 (48%)</td>
<td class="gt_row gt_center" headers="stat_3">47 (62%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">age</td>
<td class="gt_row gt_center" headers="stat_1">37.4 (5.6)</td>
<td class="gt_row gt_center" headers="stat_2">35.4 (5.8)</td>
<td class="gt_row gt_center" headers="stat_3">37.2 (4.8)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">tax_too_high</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Strongly Disagree</td>
<td class="gt_row gt_center" headers="stat_1">10 (16%)</td>
<td class="gt_row gt_center" headers="stat_2">10 (19%)</td>
<td class="gt_row gt_center" headers="stat_3">4 (5.3%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Disagree</td>
<td class="gt_row gt_center" headers="stat_1">13 (21%)</td>
<td class="gt_row gt_center" headers="stat_2">16 (30%)</td>
<td class="gt_row gt_center" headers="stat_3">9 (12%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Agree</td>
<td class="gt_row gt_center" headers="stat_1">28 (45%)</td>
<td class="gt_row gt_center" headers="stat_2">21 (39%)</td>
<td class="gt_row gt_center" headers="stat_3">42 (55%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Strongly Agree</td>
<td class="gt_row gt_center" headers="stat_1">11 (18%)</td>
<td class="gt_row gt_center" headers="stat_2">7 (13%)</td>
<td class="gt_row gt_center" headers="stat_3">21 (28%)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n (%); Mean (SD)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p><br></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="fu">quantile</span>(age, .<span class="dv">33</span>) <span class="sc">~</span> <span class="st">"young"</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                         age <span class="sc">&lt;</span> <span class="fu">quantile</span>(age, .<span class="dv">67</span>) <span class="sc">~</span> <span class="st">"middle"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"old"</span>),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"young"</span>, <span class="st">"middle"</span>, <span class="st">"old"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(tax_too_high, biz_owner, age, politics) <span class="sc">%&gt;%</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tax_too_high, <span class="at">y =</span> n, <span class="at">fill =</span> biz_owner)) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">"single"</span>)) <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(age), <span class="at">cols =</span> <span class="fu">vars</span>(politics), <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span> (x) <span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Taxes too high?"</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Reponse count by business owner, age, and politics."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-the-model-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="fit-the-model-2">Fit the Model</h3>
<p>Fit a cumulative link model for the cumulative probability of the <span class="math inline">\(i\)</span>th response falling in <span class="math inline">\(j\)</span>th category or below where <span class="math inline">\(i\)</span> indexes the (<span class="math inline">\(n = 192\)</span>) responses, <span class="math inline">\(j = 1, \ldots, J\)</span> indexes the (<span class="math inline">\(J = 4\)</span>) response categories, and <span class="math inline">\(\theta_j\)</span> is the threshold for the <span class="math inline">\(j\)</span>th cumulative logit.</p>
<p><span class="math display">\[\mathrm{logit}(P(Y_i \le j)) = \theta_j - \beta_1(\mathrm{politics}_i) - \beta_2(\mathrm{biz\_owner}_i) - \beta_3(\mathrm{age}_i)\]</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>fmla <span class="ot">&lt;-</span> <span class="fu">formula</span>(tax_too_high <span class="sc">~</span> biz_owner <span class="sc">+</span> age <span class="sc">+</span> politics)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>result <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(cs3<span class="sc">$</span>fmla, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>formula: tax_too_high ~ biz_owner + age + politics
data:    cs3$dat

 link  threshold nobs logLik  AIC    niter max.grad cond.H 
 logit flexible  192  -197.62 409.23 6(0)  3.14e-12 3.2e+05

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
biz_ownerYes  0.66462    0.28894   2.300 0.021435 *  
age           0.24189    0.03260   7.421 1.17e-13 ***
politicsLib   0.03695    0.36366   0.102 0.919072    
politicsCon   1.16142    0.34554   3.361 0.000776 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Threshold coefficients:
                           Estimate Std. Error z value
Strongly Disagree|Disagree    7.026      1.166   6.024
Disagree|Agree                8.766      1.231   7.119
Agree|Strongly Agree         11.653      1.357   8.590</code></pre>
</div>
</div>
<p>The summary object shows several fit statistics. More about these in the fit evaluation section below. The Coefficients table is the familiar parameter estimates. The coefficient estimate for <code>biz_ownerYes</code> is 0.665 with standard error 0.289, <span class="math inline">\(z = \hat{\beta} / se =\)</span> 2.300, and <span class="math inline">\(p = 2 \cdot P(Z&gt;z) =\)</span> 0.021. Some programs (e.g., SPSS) also show the Wald chi-squared statistic, <span class="math inline">\(z^2 =\)</span> 5.291. The square of a normal variable has a <span class="math inline">\(\chi^2\)</span> distribution, so the <em>p</em> value for the Wald chi-squared statistic is <code>pchisq(z^2, df = 1)</code> = 0.021.</p>
<p>The Threshold coefficients table are the intercepts, or cut-points. The first cut-point is the log-odds of response level <em>Strongly Disagree</em> (or less) vs greater than <em>Strongly Disagree</em> when all factor variables are at their reference level and the continuous vars are at 0.</p>
<p>There may be interaction effects between <code>biz_owner</code> and <code>politics</code>. You can check this by comparing the log likelihood to the saturated model with a likelihood ratio test.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>saturated <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(tax_too_high <span class="sc">~</span> biz_owner<span class="sc">*</span>politics <span class="sc">+</span> age, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>sat_anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, saturated))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio tests of cumulative link models:
 
           formula:                                  link: threshold:
cs3$result cs3$fmla                                  logit flexible  
saturated  tax_too_high ~ biz_owner * politics + age logit flexible  

           no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)
cs3$result      7 409.23 -197.62                      
saturated       9 411.75 -196.87  1.4805  2      0.477</code></pre>
</div>
</div>
<p>The likelihood ratio test indicates the main-effects model fits about the same as the saturated model, <span class="math inline">\(\chi^2\)</span>(2) = 1.48, <em>p</em> = 0.477)</p>
</section>
<section id="assumptions-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="assumptions-2">Assumptions</h3>
<p>Cumulative odds ordinal logistic regression with proportional odds models require a) no multicollinearity, and b) proportional odds.</p>
<p><strong>Multicollinearity</strong> occurs when two or more independent variables are <em>highly correlated</em> so that they do not provide unique or independent information in the regression model. Multicollinearity inflates the variances of the estimated coefficients, resulting in larger confidence intervals. The usual interpretation of a slope coefficient as the change in the mean response per unit increase in the predictor when all the other predictors are held constant breaks down because changing one predictor <em>necessarily</em> changes other predictors.</p>
<p>Test for multicollinearity with variance inflation factors (VIF). The VIF is the inflation percentage of the parameter variance due to multicollinearity. E.g., a VIF of 1.9 means the parameter variance is 90% larger than what it would be if it was not correlated with other predictors.</p>
<p>Predictor k’s variance, <span class="math inline">\(Var(\hat{\beta_k})\)</span>, is inflated by a factor of</p>
<p><span class="math display">\[\mathrm{VIF}_k = \frac{1}{1 - R_k^2}\]</span></p>
<p>due to collinearity with other predictors, where <span class="math inline">\(R_k^2\)</span> is the <span class="math inline">\(R^2\)</span> of a regression of the <span class="math inline">\(k^{th}\)</span> predictor on the remaining predictors. If predictor <span class="math inline">\(k\)</span> is unrelated to the other variables, <span class="math inline">\(R_k^2 = 0\)</span> and <span class="math inline">\(VIF = 1\)</span> (no variance inflation). If 100% of the variance in predictor <span class="math inline">\(k\)</span> is explained by the other predictors, then <span class="math inline">\(R_k^2 = 1\)</span> and <span class="math inline">\(VIF = \infty\)</span>. The rule of thumb is that <span class="math inline">\(VIF \le 5\)</span> is acceptable.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cannot use CLM model with vif(). Re-express as a linear model.</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">as.numeric</span>(tax_too_high) <span class="sc">~</span> politics <span class="sc">+</span> biz_owner <span class="sc">+</span> age, <span class="at">dat =</span> cs3<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">vif</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              GVIF Df GVIF^(1/(2*Df))
politics  1.035831  2        1.008840
biz_owner 1.023642  1        1.011752
age       1.036491  1        1.018082</code></pre>
</div>
</div>
<p>The VIFs in column GVIF are all below 5, so this model is not compromised by multicollinearity.</p>
<p>The <strong>proportional odds</strong> assumption means the independent variable effects are constant across each cumulative split of the ordinal dependent variable. Test for proportional odds using a full <a href="https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-are-the-likelihood-ratio-wald-and-lagrange-multiplier-score-tests-different-andor-similar/">likelihood ratio test</a> comparing the proportional odds model with a multinomial logit model, also called an unconstrained baseline logit model. This is also called the <em>test of parallel lines</em>. The multinomial logit model fits a slope to each of the <span class="math inline">\(J – 1\)</span> levels. The proportional odds model is nested within the multinomial model, so you can use a likelihood ratio test to see if the models are statistically different. Fit the proportional odds model and a multinomial model using <code>VGAM::vglm()</code> and capture the log likelihoods and degrees of freedom. Perform a likelihood ratio test on the differences in log likelihoods, <span class="math inline">\(D = -2 \mathrm{loglik}(\beta)\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>vglm_ordinal     <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">vglm</span>(cs3<span class="sc">$</span>fmla, VGAM<span class="sc">::</span>propodds,   <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>vglm_multinomial <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">vglm</span>(cs3<span class="sc">$</span>fmla, VGAM<span class="sc">::</span>cumulative, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>po_lrt <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">lrtest</span>(cs3<span class="sc">$</span>vglm_multinomial, cs3<span class="sc">$</span>vglm_ordinal))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: tax_too_high ~ biz_owner + age + politics
Model 2: tax_too_high ~ biz_owner + age + politics
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)
1 561 -193.31                     
2 569 -197.62  8 8.6197     0.3754</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters, <span class="math inline">\(\chi^2\)</span>(8) = 8.620, <em>p</em> = 0.375.</p>
</blockquote>
<p>Another option is the partial proportional odds test. This test locates specific variables causing the rejection of proportional odds.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>po_lrt2 <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(cs3<span class="sc">$</span>fmla, <span class="at">data =</span> cs3<span class="sc">$</span>dat) <span class="sc">%&gt;%</span> ordinal<span class="sc">::</span><span class="fu">nominal_test</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Tests of nominal effects

formula: tax_too_high ~ biz_owner + age + politics
          Df  logLik    AIC     LRT Pr(&gt;Chi)
&lt;none&gt;       -197.62 409.23                 
biz_owner  2 -197.34 412.67 0.55974   0.7559
age                                         
politics   4 -196.20 414.40 2.83415   0.5860</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters for business owner, <span class="math inline">\(\chi^2\)</span>(2) = 0.560, <em>p</em> = 0.756 and politics, <span class="math inline">\(\chi^2\)</span>(4) = 2.834, <em>p</em> = 0.586.</p>
</blockquote>
</section>
<section id="evaluate-the-fit-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="evaluate-the-fit-2">Evaluate the Fit</h3>
<p>There are three ways to assess overall model fit: The Deviance and Pearson goodness-of-fit tests of the overall model fit; the Cox and Snell, Nagelkerke, and McFadden pseudo R measures of explained variance; and the likelihood ratio test comparing the model fit to the intercept-only model. However, these tests rely on large frequencies in each <em>cell</em>, that is, each possible combination of predictor values. Overall goodness-of-fit statistics should be treated with suspicion when a continuous independent variable is present and/or there are a large number of cells with zero frequency.</p>
<p>The <strong>Pearson goodness-of-fit</strong> statistic is <span class="math inline">\(X^2 = \sum \frac{(O_{ij} - E_{ij})^2}{E_{ij}}\)</span> where <span class="math inline">\(i\)</span> is the observation number and <span class="math inline">\(j\)</span> is the response variable level. It is a summary of the Pearson residuals, the difference between the observed and expected cell counts, <span class="math inline">\(O_{ij} - E_{ij}\)</span>. The <strong>deviance goodness-of-fit</strong> statistic is the difference in fit between the model and a full model; a full model being a model that fits the data perfectly, <span class="math inline">\(G^2 = 2 \sum_{ij} O_{ij} \log \left( \frac{O_{ij}}{E_{ij}} \right)\)</span>. Neither of these tests are reliable if there are many cells with zero frequencies and/or small expected frequencies and are generally not recommended. Generally, the chi-squared test requires a frequency count of at least 5 per cell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed combinations of model vars</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>cell_patterns <span class="ot">&lt;-</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed combinations of predictor vars * levels of response var</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>covariate_patterns <span class="ot">&lt;-</span> </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>possible_cells <span class="ot">&lt;-</span> </span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>covariate_patterns <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">levels</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - ratio of observed to possible</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>pct_freq_zero <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> cs3<span class="sc">$</span>cell_patterns <span class="sc">/</span> cs3<span class="sc">$</span>possible_cells</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are 137 observed combinations of model variables (predictors), and 372 possible combinations (predictors * outcome levels), so 63.2% of cells have zero frequencies. Ideally, zero frequencies should be less than 20%, so if you were to use the deviance or Pearson tests, you would need to report this. The results below are contradictory and bogus. I think you’d only use this test if you didn’t have continuous predictor variables.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> tax_too_high, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"outcome"</span>, </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"observed"</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat, </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">newdata =</span> cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="st">"tax_too_high"</span>)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">"fit</span><span class="sc">\\</span><span class="st">."</span>), <span class="fu">starts_with</span>(<span class="st">"fit"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.by =</span> <span class="fu">c</span>(biz_owner, age, politics), </span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, sum)) <span class="sc">%&gt;%</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">"outcome"</span>, <span class="at">values_to =</span> <span class="st">"expected"</span>)</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>obs_exp <span class="ot">&lt;-</span> observed <span class="sc">%&gt;%</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(expected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"politics"</span>, <span class="st">"biz_owner"</span>, <span class="st">"age"</span>, <span class="st">"outcome"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epsilon_sq =</span> (observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">chi_sq =</span> epsilon_sq <span class="sc">/</span> expected,</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">g_sq =</span> <span class="dv">2</span> <span class="sc">*</span> observed <span class="sc">*</span> <span class="fu">log</span>((observed<span class="fl">+.0001</span>) <span class="sc">/</span> expected)</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>chi_sq)</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>g_sq)</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>df <span class="ot">=</span> cs3<span class="sc">$</span>covariate_patterns <span class="sc">*</span> (<span class="fu">length</span>(<span class="fu">levels</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">7</span></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2, <span class="at">df =</span> cs3<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2, <span class="at">df =</span> cs3<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>The Pearson goodness-of-fit test indicated that the model was <em>not</em> a good fit to the observed data, <span class="math inline">\(\chi^2\)</span>(272) = 745.4, <em>p</em> &lt; .001$. The deviance goodness-of-fit test indicated that the model was a good fit to the observed data, <span class="math inline">\(G^2\)</span>(272) = 232.6, <em>p</em> = 0.960.</p>
</blockquote>
<p>There are a number of measures in ordinal regression that attempt to provide a similar “variance explained” measure as that provided in ordinary least-squares linear regression. However, these measures do not have the direct interpretation that they do in ordinary linear regression and are often, therefore, referred to as <strong>“pseudo” R2 measures</strong>. The three most common measures (Cox and Snell, Nagelkerke, and McFadden) are not particularly good and not universally used. It is presented in the SPSS output, so you might encounter it in published work.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>nagelkerke <span class="ot">&lt;-</span> rcompanion<span class="sc">::</span><span class="fu">nagelkerke</span>(cs3<span class="sc">$</span>result)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>nagelkerke<span class="sc">$</span>Pseudo.R.squared.for.model.vs.null</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             Pseudo.R.squared
McFadden                             0.181957
Cox and Snell (ML)                   0.367369
Nagelkerke (Cragg and Uhler)         0.399641</code></pre>
</div>
</div>
<p>The best way to assess model fit is the <strong>likelihood ratio test</strong> comparing the model to an intercept-only model. The difference in the -2 log likelihood between the models has a <span class="math inline">\(\chi^2\)</span> distribution with degrees of freedom equal to the difference in the number of parameters.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(tax_too_high <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>lrt <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, intercept_only)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>lrt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio tests of cumulative link models:
 
               formula:         link: threshold:
intercept_only tax_too_high ~ 1 logit flexible  
cs3$result     cs3$fmla         logit flexible  

               no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)    
intercept_only      3 489.14 -241.57                          
cs3$result          7 409.23 -197.62  87.911  4  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The table shows the log likelihoods of the two models. LR.stat is the difference between 2 * the logLik values.</p>
<blockquote class="blockquote">
<p>The final model statistically significantly predicted the dependent variable over and above the intercept-only model, <span class="math inline">\(\chi^2(4)\)</span> = 87.9, <em>p</em> = 0.000.</p>
</blockquote>
</section>
<section id="interpret-results" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpret-results">Interpret Results</h3>
<p>Return to the model summary.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(cs3<span class="sc">$</span>clm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 0</code></pre>
</div>
</div>
<p>The coefficients for <code>biz_owner</code>, <code>age</code>, and politics are positive. Positive parameters <em>increase</em> the likelihood of stronger agreement with the statement. In this case, discontent with taxes are higher for business owners, increase with age, and are higher for Liberal Democrats and Conservatives relative to the Labor Party. The expected cumulative log-odds of declaring <span class="math inline">\(\le j\)</span> level of agreement with the statement for the baseline group (<code>biz_ownerNo</code>, <code>age = 0</code>, <code>politicsLib</code>) is for <span class="math inline">\(j = 1\)</span> (Strongly Disagree), for <span class="math inline">\(j = 2\)</span> (Disagree), and for <span class="math inline">\(j = 3\)</span> (Agree).</p>
<p>You could solve the logit equation for</p>
<p><span class="math display">\[\pi_j = \frac{\mathrm{exp}(Y_i)} {1 + \mathrm{exp}(Y_i)}\]</span> to get the cumulative probabilities for each level. That’s what <code>predict(type = "cum.prob")</code> does. But it might be more intuitive to work with individual probabilities, the lagged differences to get the individual probabilities for each <span class="math inline">\(j\)</span>. That’s what <code>predict(type = "prob")</code> does. I like to play with predicted values to get a sense of the outcome distributions. In this case, I’ll take the median <code>age</code>, and each combination of <code>biz_owner</code> and <code>politics</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">median</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>age)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(age, politics, biz_owner)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs3<span class="sc">$</span>result, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"prob"</span>)[[<span class="st">"fit"</span>]] <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(new_data, preds) <span class="sc">%&gt;%</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">levels</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high))) <span class="sc">%&gt;%</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> politics, <span class="at">x =</span> value, <span class="at">fill =</span> <span class="fu">fct_rev</span>(name))) <span class="sc">+</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>)), </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">paste</span>(<span class="st">"Bus Owner = "</span>, biz_owner)) <span class="sc">+</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Taxes too High for Conservative Business Owners?"</span>, </span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-generalized_linear_models_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>You will want to establish whether <code>politics</code> is statistically significant overall before exploring any specific contrasts. The ANOVA procedure with type I test reports an overall test of significance for each variable entered into the model.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>anovaI <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, <span class="at">type =</span> <span class="st">"I"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Type I Analysis of Deviance Table with Wald chi-square tests

          Df  Chisq Pr(&gt;Chisq)    
biz_owner  1 13.201  0.0002798 ***
age        1 57.413  3.533e-14 ***
politics   2 14.636  0.0006635 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald <span class="math inline">\(\chi^2\)</span>(2) = 14.6, <em>p</em> = 0.001.</p>
</blockquote>
<p>The best way to work with the data is with the <code>tidy(exponentiate = TRUE)</code> version.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>tidy <span class="ot">&lt;-</span> cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 8
  term        estimate std.error statistic  p.value conf.low conf.high coef.type
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
1 Strongly D…   1.13e3    1.17       6.02  1.70e- 9   NA         NA    intercept
2 Disagree|A…   6.41e3    1.23       7.12  1.08e-12   NA         NA    intercept
3 Agree|Stro…   1.15e5    1.36       8.59  8.72e-18   NA         NA    intercept
4 biz_ownerY…   1.94e0    0.289      2.30  2.14e- 2    1.11       3.44 location 
5 age           1.27e0    0.0326     7.42  1.17e-13    1.20       1.36 location 
6 politicsLib   1.04e0    0.364      0.102 9.19e- 1    0.508      2.12 location 
7 politicsCon   3.19e0    0.346      3.36  7.76e- 4    1.63       6.35 location </code></pre>
</div>
</div>
<p>Then you can summarize the table in words.</p>
<blockquote class="blockquote">
<p>The odds of business owners considering tax to be too high was 1.944 (95% CI, 1.107 to 3.443) times that of non-business owners, a statistically significant effect, <em>z</em> = 2.300, <em>p</em> = 0.021.</p>
</blockquote>
<blockquote class="blockquote">
<p>The odds of Conservative voters considering tax to be too high was 3.194 (95% CI, 1.635 to 6.351) times that of Labour voters, a statistically significant effect, <em>z</em> = 3.361, <em>p</em> = 0.001. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of 1.038 (95% CI, 0.508 to 2.121), <em>p</em> = 0.919.</p>
</blockquote>
<blockquote class="blockquote">
<p>An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of 1.274 (95% CI, 1.197 to 1.360), <em>z</em> = 7.421, <em>p</em> = 0.000.</p>
</blockquote>
</section>
<section id="reporting-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reporting-2">Reporting</h3>
<p>Here is the complete write-up.</p>
<blockquote class="blockquote">
<p>A cumulative odds ordinal logistic regression with proportional odds was run to determine the effect of business ownership, political party voted for, and age, on the belief that taxes are too high. There were proportional odds, as assessed by a full likelihood ratio test comparing the fitted model to a model with varying location parameters, <span class="math inline">\(\chi^2\)</span>(8) = 8.620, <em>p</em> = 0.375. The final model statistically significantly predicted the dependent variable over and above the intercept-only model, <span class="math inline">\(\chi^2(4)\)</span> = 87.9, <em>p</em> = 0.000. The odds of business owners considering tax to be too high was 1.944 (95% CI, 1.107 to 3.443) times that of non-business owners, a statistically significant effect, <em>z</em> = 2.300, <em>p</em> = 0.021. The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald <span class="math inline">\(\chi^2\)</span>(2) = 14.6, <em>p</em> = 0.001. The odds of Conservative voters considering tax to be too high was 3.194 (95% CI, 1.635 to 6.351) times that of Labour voters, a statistically significant effect, <em>z</em> = 3.361, <em>p</em> = 0.001. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of 1.038 (95% CI, 0.508 to 2.121), <em>p</em> = 0.919. An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of 1.274 (95% CI, 1.197 to 1.360), <em>z</em> = 7.421, <em>p</em> = 0.000.</p>
</blockquote>
<p>Package <strong>gtsummary</strong> shows a nice summary table.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(cs3<span class="sc">$</span>result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="qzuguzitfr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qzuguzitfr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qzuguzitfr thead, #qzuguzitfr tbody, #qzuguzitfr tfoot, #qzuguzitfr tr, #qzuguzitfr td, #qzuguzitfr th {
  border-style: none;
}

#qzuguzitfr p {
  margin: 0;
  padding: 0;
}

#qzuguzitfr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qzuguzitfr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qzuguzitfr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qzuguzitfr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qzuguzitfr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qzuguzitfr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzuguzitfr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qzuguzitfr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qzuguzitfr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qzuguzitfr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qzuguzitfr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qzuguzitfr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qzuguzitfr .gt_spanner_row {
  border-bottom-style: hidden;
}

#qzuguzitfr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qzuguzitfr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qzuguzitfr .gt_from_md > :first-child {
  margin-top: 0;
}

#qzuguzitfr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qzuguzitfr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qzuguzitfr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qzuguzitfr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qzuguzitfr .gt_row_group_first td {
  border-top-width: 2px;
}

#qzuguzitfr .gt_row_group_first th {
  border-top-width: 2px;
}

#qzuguzitfr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzuguzitfr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qzuguzitfr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qzuguzitfr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzuguzitfr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzuguzitfr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qzuguzitfr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qzuguzitfr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qzuguzitfr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qzuguzitfr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qzuguzitfr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzuguzitfr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qzuguzitfr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qzuguzitfr .gt_left {
  text-align: left;
}

#qzuguzitfr .gt_center {
  text-align: center;
}

#qzuguzitfr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qzuguzitfr .gt_font_normal {
  font-weight: normal;
}

#qzuguzitfr .gt_font_bold {
  font-weight: bold;
}

#qzuguzitfr .gt_font_italic {
  font-style: italic;
}

#qzuguzitfr .gt_super {
  font-size: 65%;
}

#qzuguzitfr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qzuguzitfr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qzuguzitfr .gt_indent_1 {
  text-indent: 5px;
}

#qzuguzitfr .gt_indent_2 {
  text-indent: 10px;
}

#qzuguzitfr .gt_indent_3 {
  text-indent: 15px;
}

#qzuguzitfr .gt_indent_4 {
  text-indent: 20px;
}

#qzuguzitfr .gt_indent_5 {
  text-indent: 25px;
}

#qzuguzitfr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qzuguzitfr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>log(OR)</strong></th>
<th id="conf.low" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">biz_owner</td>
<td class="gt_row gt_center" headers="estimate"><br>
</td>
<td class="gt_row gt_center" headers="conf.low"><br>
</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="estimate">—</td>
<td class="gt_row gt_center" headers="conf.low">—</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="estimate">0.66</td>
<td class="gt_row gt_center" headers="conf.low">0.10, 1.2</td>
<td class="gt_row gt_center" headers="p.value">0.021</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">age</td>
<td class="gt_row gt_center" headers="estimate">0.24</td>
<td class="gt_row gt_center" headers="conf.low">0.18, 0.31</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">politics</td>
<td class="gt_row gt_center" headers="estimate"><br>
</td>
<td class="gt_row gt_center" headers="conf.low"><br>
</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Lab</td>
<td class="gt_row gt_center" headers="estimate">—</td>
<td class="gt_row gt_center" headers="conf.low">—</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Lib</td>
<td class="gt_row gt_center" headers="estimate">0.04</td>
<td class="gt_row gt_center" headers="conf.low">-0.68, 0.75</td>
<td class="gt_row gt_center" headers="p.value">&gt;0.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Con</td>
<td class="gt_row gt_center" headers="estimate">1.2</td>
<td class="gt_row gt_center" headers="conf.low">0.49, 1.8</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="4" class="gt_sourcenote">Abbreviations: CI = Confidence Interval, OR = Odds Ratio</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</section>
</section>
<section id="poissonregression" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="poissonregression"><span class="header-section-number">2.4</span> Poisson Regression</h2>
<p>Poisson models count data, like “traffic tickets per day”, or “website hits per day”. The response is an expected <em>rate</em> or intensity. For count data, specify the generalized model, this time with <code>family = poisson</code> or <code>family = quasipoisson</code>.</p>
<p>Recall that the probability of achieving a count <span class="math inline">\(y\)</span> when the expected rate is <span class="math inline">\(\lambda\)</span> is distributed</p>
<p><span class="math display">\[P(Y = y|\lambda) = \frac{e^{-\lambda} \lambda^y}{y!}.\]</span></p>
<p>The poisson regression model is</p>
<p><span class="math display">\[\lambda = \exp(X \beta).\]</span></p>
<p>You can solve this for <span class="math inline">\(y\)</span> to get</p>
<p><span class="math display">\[y = X\beta = \ln(\lambda).\]</span></p>
<p>That is, the model predicts the log of the response rate. For a sample of size <em>n</em>, the likelihood function is</p>
<p><span class="math display">\[L(\beta; y, X) = \prod_{i=1}^n \frac{e^{-\exp({X_i\beta})}\exp({X_i\beta})^{y_i}}{y_i!}.\]</span></p>
<p>The log-likelihood is</p>
<p><span class="math display">\[l(\beta) = \sum_{i=1}^n (y_i X_i \beta - \sum_{i=1}^n\exp(X_i\beta) - \sum_{i=1}^n\log(y_i!).\]</span></p>
<p>Maximizing the log-likelihood has no closed-form solution, so the coefficient estimates are found through interatively reweighted least squares.</p>
<p>Poisson processes assume the variance of the response variable equals its mean. “Equals” means the mean and variance are of a similar order of magnitude. If that assumption does not hold, use the quasi-poisson. Use Poisson regression for large datasets. If the predicted counts are much greater than zero (&gt;30), the linear regression will work fine. Whereas RMSE is not useful for logistic models, it is a good metric in Poisson.</p>
<section id="cs4" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="cs4">Case Study 4</h3>
<p>Dataset <code>fire</code> contains response variable <code>injuries</code> counting the number of injuries during the month and one explanatory variable, the month <code>mo</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fire <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"C:/Users/mpfol/OneDrive/Documents/Data Science/Data/CivilInjury_0.csv"</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>fire <span class="ot">&lt;-</span> fire <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mo =</span> <span class="fu">as.POSIXlt</span>(<span class="st">`</span><span class="at">Injury Date</span><span class="st">`</span>)<span class="sc">$</span>mon <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dt =</span> <span class="st">`</span><span class="at">Injury Date</span><span class="st">`</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">injuries =</span> <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fire)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In a situation like this where there the relationship is bivariate, start with a visualization.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fire, <span class="fu">aes</span>(<span class="at">x =</span> mo, <span class="at">y =</span> injuries)) <span class="sc">+</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"poisson"</span>)) <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Injuries by Month"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fit a poisson regression in R using <code>glm(formula, data, family = poisson)</code>. But first, check whether the mean and variance of <code>injuries</code> are the same magnitude? If not, then use <code>family = quasipoisson</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fire<span class="sc">$</span>injuries)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(fire<span class="sc">$</span>injuries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>They are of the same magnitude, so fit the regression with <code>family = poisson</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(injuries <span class="sc">~</span> mo, <span class="at">family =</span> poisson, <span class="at">data =</span> fire)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <em>predicted</em> value <span class="math inline">\(\hat{y}\)</span> is the estimated <strong>log</strong> of the response variable,</p>
<p><span class="math display">\[\hat{y} = X \hat{\beta} = \ln (\lambda).\]</span></p>
<p>Suppose <code>mo</code> is January (mo = <code>), then the log of</code>injuries` is <span class="math inline">\(\hat{y} = 0.323787\)</span>. Or, more intuitively, the expected count of injuries is <span class="math inline">\(\exp(0.323787) = 1.38\)</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(m2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">mo=</span><span class="dv">1</span>))</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(m2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">mo=</span><span class="dv">1</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a plot of the predicted counts in red.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m2, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mo, <span class="at">y =</span> injuries)) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Injuries"</span>,</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Poisson Fitted Line Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Evaluate a logistic model fit with an analysis of deviance.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>(perf <span class="ot">&lt;-</span> <span class="fu">glance</span>(m2))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>(pseudoR2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> perf<span class="sc">$</span>deviance <span class="sc">/</span> perf<span class="sc">$</span>null.deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The deviance of the null model (no regressors) is 139.9. The deviance of the full model is 132.2. The psuedo-R2 is very low at .05. How about the RMSE?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE</span>(<span class="at">pred =</span> <span class="fu">predict</span>(m2, <span class="at">type =</span> <span class="st">"response"</span>), <span class="at">obs =</span> fire<span class="sc">$</span>injuries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The average prediction error is about 0.99. That’s almost as much as the variance of <code>injuries</code> - i.e., just predicting the mean of <code>injuries</code> would be almost as good! Use the <code>GainCurvePlot()</code> function to plot the gain curve.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m2, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> injuries, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual"</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted"</span>,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Poisson Fitted vs Actual"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m2) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GainCurvePlot</span>(<span class="at">xvar =</span> <span class="st">".fitted"</span>, <span class="at">truthVar =</span> <span class="st">"injuries"</span>, <span class="at">title =</span> <span class="st">"Poisson Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It seems that <code>mo</code> was a poor predictor of <code>injuries</code>.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Agresti2013" class="csl-entry" role="listitem">
Agresti, Alan. 2013. <em>Categorical Data Analysis</em>. 3rd ed. Wiley. <a href="https://www.amazon.com/Categorical-Analysis-Wiley-Probability-Statistics-ebook-dp-B00CAYUFM2/dp/B00CAYUFM2/ref=mt_kindle?_encoding=UTF8&amp;me=&amp;qid=">https://www.amazon.com/Categorical-Analysis-Wiley-Probability-Statistics-ebook-dp-B00CAYUFM2/dp/B00CAYUFM2/ref=mt_kindle?_encoding=UTF8&amp;me=&amp;qid=</a>.
</div>
<div id="ref-Molner2020" class="csl-entry" role="listitem">
Molnar, Christoph. 2020. <em>Interpretable Machine Learning</em>. <a href="https://christophm.github.io/interpretable-ml-book/">https://christophm.github.io/interpretable-ml-book/</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>These notes are primarily from PSU’s <a href="https://online.stat.psu.edu/stat504">Analysis of Discrete Data</a> which uses Alan Agresti’s <strong>Categorical Data Analysis</strong> <span class="citation" data-cites="Agresti2013">(<a href="10-references.html#ref-Agresti2013" role="doc-biblioref">Agresti 2013</a>)</span>. I also reviewed PSU’s <a href="https://newonlinecourses.science.psu.edu/stat501/lesson/15">Regression Methods</a>, DataCamp’s <a href="https://www.datacamp.com/courses/generalized-linear-models-in-r">Generalized Linear Models in R</a>, DataCamp’s <a href="https://www.datacamp.com/courses/multiple-and-logistic-regression">Multiple and Logistic Regression</a>, and <strong>Interpretable machine learning</strong> <span class="citation" data-cites="Molner2020">(<a href="10-references.html#ref-Molner2020" role="doc-biblioref">Molnar 2020</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The related probit regression link function is <span class="math inline">\(f(E(Y|X)) = \Phi^{-1}(E(Y|X)) = \Phi^{-1}(\pi)\)</span>. The difference between the logistic and probit link function is theoretical, and <a href="https://www.theanalysisfactor.com/the-difference-between-logistic-and-probit-regression/">the practical significance is slight</a>. You can safely ignore probit.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Notes from <a href="https://machinelearningmastery.com/logistic-regression-with-maximum-likelihood-estimation/">Machine Learning Mastery</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><a href="https://data.library.virginia.edu/understanding-deviance-residuals/">UVA</a> discusses the four types of residuals you can calculate from a binary logistic regression.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>See probability notes on the binomial distribution <a href="https://bookdown.org/mpfoley1973/probability/binomial.html">here</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><a href="https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290">This article</a> suggests using three standard deviations for an outliers threshold.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Nice explanation <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">here</a>. Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>These notes rely on the course notes from <a href="https://online.stat.psu.edu/stat504/">PSU STAT 504, Analysis of Discrete Data</a> and <a href="https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/">UCLA</a>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Cook’s distance measures how much predicted values change when observation <em>i</em> is removed from the data. <a href="https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290">This article</a> suggests using three standard deviations for an outliers threshold.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Nice write-up <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">here</a>. Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>These notes rely on <a href="https://data.library.virginia.edu/fitting-and-interpreting-a-proportional-odds-model/">UVA</a>, <a href="https://online.stat.psu.edu/stat504/">PSU</a>, <a href="https://statistics.laerd.com/spss-tutorials/ordinal-regression-using-spss-statistics.php">Laerd</a>, and the CLM package <a href="https://cran.r-project.org/web/packages/ordinal/vignettes/clm_article.pdf">article vignette</a><a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-linear_regression.html" class="pagination-link" aria-label="Ordinary Least Squares">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Ordinary Least Squares</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-linear_mixed_effects.html" class="pagination-link" aria-label="Mixed Effects Models">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Mixed Effects Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb119" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Generalized Linear Models (GLM)</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidymodels)</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="in">tidymodels_prefer()</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="in">theme_set(</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_light() +</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="in">      plot.caption = element_text(hjust = 0),</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="in">      strip.background = element_rect(fill="gray90", color="gray60"),</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="in">      strip.text = element_text(color = "gray20")</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>The linear regression model, $E(y|X) = X \beta$, structured as $y_i = X_i \beta + \epsilon_i$ where $X_i \beta = \mu_i$, assumes the response is a linear function of the predictors and the residuals are independent random variables normally distributed with zero mean and constant variance, $\epsilon \sim N \left(0, \sigma^2 \right)$. This implies that given a set of predictors, the response is normally distributed about its expected value, $y_i \sim N \left(\mu_i, \sigma^2 \right)$. However, there are many situations where this normality assumption does not hold. Generalized linear models (GLMs) are a generalization of the linear regression model that work with non-normal response distributions.^<span class="co">[</span><span class="ot">These notes are primarily from PSU's [Analysis of Discrete Data](https://online.stat.psu.edu/stat504) which uses Alan Agresti's **Categorical Data Analysis** [@Agresti2013]. I also reviewed PSU's [Regression Methods](https://newonlinecourses.science.psu.edu/stat501/lesson/15), DataCamp's [Generalized Linear Models in R](https://www.datacamp.com/courses/generalized-linear-models-in-r), DataCamp's [Multiple and Logistic Regression](https://www.datacamp.com/courses/multiple-and-logistic-regression), and **Interpretable machine learning** [@Molner2020].</span><span class="co">]</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>The response will not have a normal distribution if the underlying data-generating process is binomial (Section \@ref(binomiallogistic)) or multinomial (Section \@ref(multinomiallogistic)), ordinal (Section \@ref(ordinallogistic)), Poisson (counts, Section \@ref(poissonregression)), or exponential (time-to-event). In these situations the linear regression model can predict probabilities and proportions outside <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>, or negative counts or times. GLMs solve this problem by modeling a *function* of the expected value of $y$, $f(E(y|X)) = X \beta$. There are three components to a GLM: a *random component* specified by the response variable's probability distribution (normal, binomial, etc.); a *systematic component* in the form $X\beta$; and a *link function*, $\eta$, that specifies the link between the random and systematic components and converts the response to a range of $<span class="co">[</span><span class="ot">-\infty, +\infty</span><span class="co">]</span>$.  </span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>Linear regression is a special case of GLM where the link function is the identity function, $f(E(y|X)) = E(y|X)$. For binary logistic regression, the link function is the logit,</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>$$f(E(y|X)) = \log \left( \frac{E(y|X)}{1 - E(y|X)} \right) = \log \left( \frac{\pi}{1 - \pi} \right) = \mathrm{logit}(\pi)$$</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>where $\pi$ is the response probability.^<span class="co">[</span><span class="ot">The related probit regression link function is $f(E(Y|X)) = \Phi^{-1}(E(Y|X)) = \Phi^{-1}(\pi)$. The difference between the logistic and probit link function is theoretical, and [the practical significance is slight](https://www.theanalysisfactor.com/the-difference-between-logistic-and-probit-regression/). You can safely ignore probit.</span><span class="co">]</span> For multinomial logistic regression, the link function is the logit again, but with respect to the baseline level, and there is set of logits (one for each non-baseline level),</span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>$$f(E(y|X)) = \log \left( \frac{E(y_j|X)}{E(y_{j^*}|X)} \right) = \log \left( \frac{\pi_j}{\pi_{j^*}} \right) = \mathrm{logit}(\pi_j)$$</span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>Where $j$ is a level in the dependent variable and $j^*$ is the baseline level. For Poisson regression, the link function is</span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>$$f(E(y|X)) = \ln (E(y|X)) = \ln(\lambda)$$</span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>where $\lambda$ is the expected event rate. For exponential regression, the link function is </span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a>$$f(E(y|X) = -E(y|X) = -\lambda$$</span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a>where $\lambda$ is the expected time to event.</span>
<span id="cb119-39"><a href="#cb119-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-40"><a href="#cb119-40" aria-hidden="true" tabindex="-1"></a>GLM uses maximum likelihood estimation (MLE) rather than ordinary least squares (OLS) to estimate the parameters, and thus relies on large-sample approximations. </span>
<span id="cb119-41"><a href="#cb119-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-42"><a href="#cb119-42" aria-hidden="true" tabindex="-1"></a>Fit a GLM just like an linear model, but with the <span class="in">`glm()`</span> function, specifying the distribution with the <span class="in">`family = c("gaussian", "binomial", "poisson")`</span> parameter. Fit a mulinomial logistic regression model with <span class="in">`nnet::multinom()`</span>.</span>
<span id="cb119-43"><a href="#cb119-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-44"><a href="#cb119-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Binomial Logistic Regression {#binomiallogistic}</span></span>
<span id="cb119-45"><a href="#cb119-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-46"><a href="#cb119-46" aria-hidden="true" tabindex="-1"></a>Logistic regression estimates the probability that a categorical dependent variable is a particular level. The dependent variable levels can be binomial, multinomial, or ordinal. The *binary* logistic regression model is</span>
<span id="cb119-47"><a href="#cb119-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-48"><a href="#cb119-48" aria-hidden="true" tabindex="-1"></a>$$y_i = \mathrm{logit}(\pi_i) = \log \left( \frac{\pi_i}{1 - \pi_i} \right) = X_i \beta$$</span>
<span id="cb119-49"><a href="#cb119-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-50"><a href="#cb119-50" aria-hidden="true" tabindex="-1"></a>where $\pi_i$ is the response $i$'s binary level probability. The model predicts the *log odds* of the level. Why do this? The range of outcomes need to be between 0 and 1, and a sigmoid function, $f(y) = 1 / \left(1 + e^y \right)$, does that. If the _log odds_ of the level equals $X_i\beta$, then the _odds_ of the level equals $e^{X\beta}$. You can solve for $\pi_i$ to get $\pi = \mathrm{odds} / (\mathrm{odds} + 1)$. Substituting, </span>
<span id="cb119-51"><a href="#cb119-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-52"><a href="#cb119-52" aria-hidden="true" tabindex="-1"></a>$$\pi_i = \frac{\exp(y_i)}{1 + \exp(y_i)} = \frac{e^{X_i\beta}}{1 + e^{X_i\beta}}$$</span>
<span id="cb119-53"><a href="#cb119-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-54"><a href="#cb119-54" aria-hidden="true" tabindex="-1"></a>which you can simplify to $\pi_i = 1 / (1 + e^{-X_i\beta})$, a sigmoid function. The upshot is $X\beta$ is the functional relationship between the independent variables and _a function of the response_, not the response itself.</span>
<span id="cb119-55"><a href="#cb119-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-56"><a href="#cb119-56" aria-hidden="true" tabindex="-1"></a>The model parameters are estimated either by _iteratively reweighted least squares optimization_ or by _maximum likelihood estimation_ (MLE). MLE maximizes the probability produced by a set of parameters $\beta$ given a data set and probability distribution.^<span class="co">[</span><span class="ot">Notes from [Machine Learning Mastery](https://machinelearningmastery.com/logistic-regression-with-maximum-likelihood-estimation/).</span><span class="co">]</span> In logistic regression the probability distribution is the binomial and each observation is the outcome of a single Bernoulli trial. </span>
<span id="cb119-57"><a href="#cb119-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-58"><a href="#cb119-58" aria-hidden="true" tabindex="-1"></a>$$L(\beta; y, X) = \prod_{i=1}^n \pi_i^{y_i}(1 - \pi_i)^{(1-y_i)} = \prod_{i=1}^n\frac{\exp(y_i X_i \beta)}{1 + \exp(X_i \beta)}.$$</span>
<span id="cb119-59"><a href="#cb119-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-60"><a href="#cb119-60" aria-hidden="true" tabindex="-1"></a>In practice, multiplying many small probabilities can be unstable, so MLE optimizes the log likelihood instead. </span>
<span id="cb119-61"><a href="#cb119-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-62"><a href="#cb119-62" aria-hidden="true" tabindex="-1"></a>$$\begin{align}</span>
<span id="cb119-63"><a href="#cb119-63" aria-hidden="true" tabindex="-1"></a>l(\beta; y, X) &amp;= \sum_{i = 1}^n \left(y_i \log(\pi_i) + (1 - y_i) \log(1 - \pi_i) \right) <span class="sc">\\</span></span>
<span id="cb119-64"><a href="#cb119-64" aria-hidden="true" tabindex="-1"></a>               &amp;= \sum_{i = 1}^n \left(y_i X_i \beta - \log(1 + e^{X_i\beta}) \right)</span>
<span id="cb119-65"><a href="#cb119-65" aria-hidden="true" tabindex="-1"></a>\end{align}$$</span>
<span id="cb119-66"><a href="#cb119-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-67"><a href="#cb119-67" aria-hidden="true" tabindex="-1"></a>Sometimes you will see the _cost function_ optimized. The cost function is the negative of of the log likelihood function.</span>
<span id="cb119-68"><a href="#cb119-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-69"><a href="#cb119-69" aria-hidden="true" tabindex="-1"></a>**Assumptions**</span>
<span id="cb119-70"><a href="#cb119-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-71"><a href="#cb119-71" aria-hidden="true" tabindex="-1"></a>The binomial logistic regression model requires a dichotomous dependent variable and independent observations. The sample size should be large, at least 10 observations per dependent variable level and independent variable. There are three conditions related to the data distribution: i) the logit transformation must be linearly related to any continuous independent variables, ii) there must be no multicollinearity, and iii) there must be no influential outliers.</span>
<span id="cb119-72"><a href="#cb119-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-73"><a href="#cb119-73" aria-hidden="true" tabindex="-1"></a>Be aware of over-dispersion, a common issue with GLM. For a binomial logistic regression, the response variable should be distributed $y_i \sim \mathrm{Bin}(n_i, \pi_i)$ with $\mu_i = n_i \pi_i$ and $\sigma^2 = \pi (1 - \pi)$. Over-dispersion means the data shows evidence of variance greater than $\sigma^2$.</span>
<span id="cb119-74"><a href="#cb119-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-75"><a href="#cb119-75" aria-hidden="true" tabindex="-1"></a><span class="fu">### Case Study {.unnumbered #cs1}</span></span>
<span id="cb119-76"><a href="#cb119-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-77"><a href="#cb119-77" aria-hidden="true" tabindex="-1"></a>This case study uses the <span class="co">[</span><span class="ot">Laerd Statistics</span><span class="co">](https://statistics.laerd.com/)</span> article on binomial logistic regression <span class="co">[</span><span class="ot">data set</span><span class="co">](https://statistics.laerd.com/premium/spss/spss-files/logistic-regression.sav)</span>. A study investigates the relationship between the incidence of heart disease (Yes|No) and age, weight, gender, and maximal aerobic capacity using data from *n* = 100 participants.</span>
<span id="cb119-78"><a href="#cb119-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-81"><a href="#cb119-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-82"><a href="#cb119-82" aria-hidden="true" tabindex="-1"></a>cs1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-83"><a href="#cb119-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-84"><a href="#cb119-84" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.spss</span>(<span class="st">"./input/logistic-regression.sav"</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-85"><a href="#cb119-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-86"><a href="#cb119-86" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-87"><a href="#cb119-87" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb119-88"><a href="#cb119-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> heart_disease,</span>
<span id="cb119-89"><a href="#cb119-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">include =</span> <span class="sc">-</span>caseno,</span>
<span id="cb119-90"><a href="#cb119-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent =</span> <span class="st">"row"</span>,</span>
<span id="cb119-91"><a href="#cb119-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean}, {sd}"</span>)</span>
<span id="cb119-92"><a href="#cb119-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb119-93"><a href="#cb119-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-94"><a href="#cb119-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-95"><a href="#cb119-95" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb119-96"><a href="#cb119-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-97"><a href="#cb119-97" aria-hidden="true" tabindex="-1"></a>Overall, men are twice as likely to have heart disease. Male odds are .43/.57 = <span class="in">`r comma(.43/.57, .1)`</span> and female odds are .22/.78 = <span class="in">`r comma(.22/.78, .1)`</span>, an male-to-female odds ratio of <span class="in">`r comma((.43/.57) / (.22/.78), .1)`</span>.</span>
<span id="cb119-98"><a href="#cb119-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-101"><a href="#cb119-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-102"><a href="#cb119-102" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">row =</span> heart_disease, <span class="at">col =</span> gender, <span class="at">percent =</span> <span class="st">"column"</span>) </span>
<span id="cb119-103"><a href="#cb119-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-104"><a href="#cb119-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-105"><a href="#cb119-105" aria-hidden="true" tabindex="-1"></a>Age, weight, and poor max aerobic capacity are positively associated with heart disease.</span>
<span id="cb119-106"><a href="#cb119-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-109"><a href="#cb119-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-110"><a href="#cb119-110" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-111"><a href="#cb119-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb119-112"><a href="#cb119-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> heart_disease, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb119-113"><a href="#cb119-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb119-114"><a href="#cb119-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb119-115"><a href="#cb119-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">"free_y"</span>)</span>
<span id="cb119-116"><a href="#cb119-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-117"><a href="#cb119-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-118"><a href="#cb119-118" aria-hidden="true" tabindex="-1"></a>:::rmdnote</span>
<span id="cb119-119"><a href="#cb119-119" aria-hidden="true" tabindex="-1"></a>Consider centering the continuous variables around their means to facilitate model interpretation. The intercept term in the fitted model would represent a reasonable condition, not a zero-aged, zero-weighted person with no aerobic capacity. This is the way to go if you want to present your findings in the framework of a baseline probability (or odds) and the incremental effects of the independent variables. You might also standardize the continuous vars to get a more meaningful increment. On the other hand, if you want to use your model for predicting outcomes, you'll have to back out of the centering when you predict values.</span>
<span id="cb119-120"><a href="#cb119-120" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb119-121"><a href="#cb119-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-122"><a href="#cb119-122" aria-hidden="true" tabindex="-1"></a>If your model is predictive rather than inferential, split the data into training/testing data sets.</span>
<span id="cb119-123"><a href="#cb119-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-124"><a href="#cb119-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-125"><a href="#cb119-125" aria-hidden="true" tabindex="-1"></a><span class="in"># For reproducibility</span></span>
<span id="cb119-126"><a href="#cb119-126" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb119-127"><a href="#cb119-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-128"><a href="#cb119-128" aria-hidden="true" tabindex="-1"></a><span class="in">(x &lt;- initial_split(cs1$dat, prop = 0.7, strata = heart_disease))</span></span>
<span id="cb119-129"><a href="#cb119-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-130"><a href="#cb119-130" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$dat_training &lt;- training(x)</span></span>
<span id="cb119-131"><a href="#cb119-131" aria-hidden="true" tabindex="-1"></a><span class="in">dim(cs1$dat_training)</span></span>
<span id="cb119-132"><a href="#cb119-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-133"><a href="#cb119-133" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$dat_testing &lt;- testing(x)</span></span>
<span id="cb119-134"><a href="#cb119-134" aria-hidden="true" tabindex="-1"></a><span class="in">dim(cs1$dat_testing)</span></span>
<span id="cb119-135"><a href="#cb119-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-136"><a href="#cb119-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-137"><a href="#cb119-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit the Model {-}</span></span>
<span id="cb119-138"><a href="#cb119-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-139"><a href="#cb119-139" aria-hidden="true" tabindex="-1"></a>Fit the model using the tidymodels framework. If you want to continue using the classic methodology, the glm object is inside the tidymodels fit. The model fit returns a brief summary with the coefficients and model diagnostics. </span>
<span id="cb119-140"><a href="#cb119-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-143"><a href="#cb119-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-144"><a href="#cb119-144" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>model <span class="ot">&lt;-</span> </span>
<span id="cb119-145"><a href="#cb119-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb119-146"><a href="#cb119-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-147"><a href="#cb119-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) </span>
<span id="cb119-148"><a href="#cb119-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-149"><a href="#cb119-149" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="ot">&lt;-</span></span>
<span id="cb119-150"><a href="#cb119-150" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb119-151"><a href="#cb119-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat)</span>
<span id="cb119-152"><a href="#cb119-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-153"><a href="#cb119-153" aria-hidden="true" tabindex="-1"></a><span class="co"># The fit object returned by glm(). You'll need this for interpretation and </span></span>
<span id="cb119-154"><a href="#cb119-154" aria-hidden="true" tabindex="-1"></a><span class="co"># checking assumptions.</span></span>
<span id="cb119-155"><a href="#cb119-155" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="ot">&lt;-</span></span>
<span id="cb119-156"><a href="#cb119-156" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb119-157"><a href="#cb119-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span>
<span id="cb119-158"><a href="#cb119-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-159"><a href="#cb119-159" aria-hidden="true" tabindex="-1"></a><span class="co"># If you are fitting a predictive model, use the training set.</span></span>
<span id="cb119-160"><a href="#cb119-160" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit_training <span class="ot">&lt;-</span></span>
<span id="cb119-161"><a href="#cb119-161" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb119-162"><a href="#cb119-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat_training)</span>
<span id="cb119-163"><a href="#cb119-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-164"><a href="#cb119-164" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb119-165"><a href="#cb119-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-166"><a href="#cb119-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-167"><a href="#cb119-167" aria-hidden="true" tabindex="-1"></a>The null deviance, G^2, is the likelihood ratio of the intercept-only model with <span class="in">`r nrow(cs1$dat_training)`</span> rows - 1 parameter = <span class="in">`r cs1$result %&gt;% summary() %&gt;% .$df.null`</span> degrees of freedom. It is the sum of the squared deviance residuals. The residual deviance is the likelihood ratio of the full model with <span class="in">`r nrow(cs1$dat)`</span> - 5 parameters = <span class="in">`r cs1$result %&gt;% summary() %&gt;% .$df.residual`</span> degrees of freedom. </span>
<span id="cb119-168"><a href="#cb119-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-169"><a href="#cb119-169" aria-hidden="true" tabindex="-1"></a>The residual deviance is distributed chi-squared and can be used to test whether the model differs from the saturated model (model with as many coefficients as observations, G^2 = 0, *df* = 0) where $H_0$ = no difference. The deviance test for lack of fit fails to reject the null hypothesis.</span>
<span id="cb119-170"><a href="#cb119-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-171"><a href="#cb119-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-172"><a href="#cb119-172" aria-hidden="true" tabindex="-1"></a><span class="in"># G^2 calculations</span></span>
<span id="cb119-173"><a href="#cb119-173" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$result %&gt;% residuals(type = "deviance") %&gt;% .^2 %&gt;% sum()</span></span>
<span id="cb119-174"><a href="#cb119-174" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$result %&gt;% deviance()</span></span>
<span id="cb119-175"><a href="#cb119-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-176"><a href="#cb119-176" aria-hidden="true" tabindex="-1"></a><span class="in"># df</span></span>
<span id="cb119-177"><a href="#cb119-177" aria-hidden="true" tabindex="-1"></a><span class="in">df.residual(cs1$result)</span></span>
<span id="cb119-178"><a href="#cb119-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-179"><a href="#cb119-179" aria-hidden="true" tabindex="-1"></a><span class="in"># G^2 is distributed chi-squared with df degrees of freedom</span></span>
<span id="cb119-180"><a href="#cb119-180" aria-hidden="true" tabindex="-1"></a><span class="in">pchisq(deviance(cs1$result), df = df.residual(cs1$result), lower.tail = FALSE)</span></span>
<span id="cb119-181"><a href="#cb119-181" aria-hidden="true" tabindex="-1"></a><span class="in">vcdExtra::LRstats(cs1$result)</span></span>
<span id="cb119-182"><a href="#cb119-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-183"><a href="#cb119-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-184"><a href="#cb119-184" aria-hidden="true" tabindex="-1"></a>These two deviances, the null and residual, are shown in the ANOVA summary. An ANOVA table shows the change in deviance from successively adding each variable to the model.</span>
<span id="cb119-185"><a href="#cb119-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-188"><a href="#cb119-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-189"><a href="#cb119-189" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cs1<span class="sc">$</span>result)</span>
<span id="cb119-190"><a href="#cb119-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-191"><a href="#cb119-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-192"><a href="#cb119-192" aria-hidden="true" tabindex="-1"></a>Deviance residuals are one of four residuals you can calculate from a binary logistic regression.^[<span class="co">[</span><span class="ot">UVA</span><span class="co">](https://data.library.virginia.edu/understanding-deviance-residuals/)</span> discusses the four types of residuals you can calculate from a binary logistic regression.] One is the *raw residual*, $\epsilon_i = y_i - \hat{p}_i$, where $\hat{p}_i$ is the predicted probability. Another is the *Pearson residual*, $r_i = \frac{\epsilon_i}{\sqrt{\hat{p}_i(1 - \hat{p}_i)}}$, the raw residual rescaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial^[See probability notes on the binomial distribution [here](https://bookdown.org/mpfoley1973/probability/binomial.html)]. A third is the *standardized Pearson residual*, $rs_i = r_i / \sqrt{1 - \hat{h}_i}$, the Pearson residual adjusted for the leverage of the predictors using the hat-values. Hat-values measure the predictor distances from the mean. This residual is especially useful to evaluate model fit because if the model fits well, these residuals have a standard normal distribution. Finally, there are the *deviance residuals*, $d_i = \mathrm{sign}(\epsilon_i) \left<span class="co">[</span><span class="ot"> -2(y_i \log \hat{p}_i + (1 - y_i) \log (1 - \hat{p}_i)) \right</span><span class="co">]</span>^{.5}$. Deviance Residuals measure how much the estimated probabilities differ from the observed proportions of success. You want deviance residuals to be evenly distributed (in absolute values, 1Q $\approx$ 3Q, min $\approx$ max). You also want the min and max to be &lt;3 because deviance residuals are roughly approximated by a standard normal distribution.</span>
<span id="cb119-193"><a href="#cb119-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-196"><a href="#cb119-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-197"><a href="#cb119-197" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb119-198"><a href="#cb119-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">Raw =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb119-199"><a href="#cb119-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">Pearson =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"pearson"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb119-200"><a href="#cb119-200" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Standardized Pearson</span><span class="st">`</span> <span class="ot">=</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">rstandard</span>(<span class="at">type =</span> <span class="st">"pearson"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb119-201"><a href="#cb119-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deviance =</span> cs1<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">residuals</span>(<span class="at">type =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(),</span>
<span id="cb119-202"><a href="#cb119-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">"Residual"</span></span>
<span id="cb119-203"><a href="#cb119-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-204"><a href="#cb119-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-205"><a href="#cb119-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-206"><a href="#cb119-206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation {-}</span></span>
<span id="cb119-207"><a href="#cb119-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-208"><a href="#cb119-208" aria-hidden="true" tabindex="-1"></a>Before we look at the coefficient estimations, consider what it is they are predicting: the log odds of the binary response. To see what that means, plug in values for the explanatory variables to get predictions. $\hat{y}$ is the log odds of having heart disease. </span>
<span id="cb119-209"><a href="#cb119-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-210"><a href="#cb119-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-211"><a href="#cb119-211" aria-hidden="true" tabindex="-1"></a><span class="in">(mean_person &lt;- </span></span>
<span id="cb119-212"><a href="#cb119-212" aria-hidden="true" tabindex="-1"></a><span class="in">  cs1$dat %&gt;%</span></span>
<span id="cb119-213"><a href="#cb119-213" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-caseno) %&gt;%</span></span>
<span id="cb119-214"><a href="#cb119-214" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(.by = gender, across(where(is.numeric), mean)))</span></span>
<span id="cb119-215"><a href="#cb119-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-216"><a href="#cb119-216" aria-hidden="true" tabindex="-1"></a><span class="in">pred_log_odds &lt;- cs1$fit %&gt;% predict(new_data = mean_person, type = "raw")</span></span>
<span id="cb119-217"><a href="#cb119-217" aria-hidden="true" tabindex="-1"></a><span class="in">names(pred_log_odds) &lt;- mean_person$gender</span></span>
<span id="cb119-218"><a href="#cb119-218" aria-hidden="true" tabindex="-1"></a><span class="in">pred_log_odds</span></span>
<span id="cb119-219"><a href="#cb119-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-220"><a href="#cb119-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-221"><a href="#cb119-221" aria-hidden="true" tabindex="-1"></a>Exponentiate to get the **odds**, $\exp (\hat{y}) = \frac{\pi}{1 - \pi}$.</span>
<span id="cb119-222"><a href="#cb119-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-225"><a href="#cb119-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-226"><a href="#cb119-226" aria-hidden="true" tabindex="-1"></a>(pred_odds <span class="ot">&lt;-</span> <span class="fu">exp</span>(pred_log_odds))</span>
<span id="cb119-227"><a href="#cb119-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-228"><a href="#cb119-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-229"><a href="#cb119-229" aria-hidden="true" tabindex="-1"></a>Solve for $\pi = \frac{\exp (\hat{y})}{1 + \exp (\hat{y})}$ to get the **probability**. Do the math, or use <span class="in">`predict(type = "prob")`</span>.</span>
<span id="cb119-230"><a href="#cb119-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-231"><a href="#cb119-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-232"><a href="#cb119-232" aria-hidden="true" tabindex="-1"></a><span class="in">(pred_prob &lt;- pred_odds / (1 + pred_odds))</span></span>
<span id="cb119-233"><a href="#cb119-233" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$fit %&gt;% predict(new_data = mean_person, type = "prob")</span></span>
<span id="cb119-234"><a href="#cb119-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-235"><a href="#cb119-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-236"><a href="#cb119-236" aria-hidden="true" tabindex="-1"></a>Now let's interpret the coefficients.</span>
<span id="cb119-237"><a href="#cb119-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-240"><a href="#cb119-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-241"><a href="#cb119-241" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span>
<span id="cb119-242"><a href="#cb119-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-243"><a href="#cb119-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-244"><a href="#cb119-244" aria-hidden="true" tabindex="-1"></a>The intercept term is the log-odds of heart disease for the reference case. The reference case in the model is <span class="in">`gender`</span> = "Female", <span class="in">`age`</span> = 0, <span class="in">`weight`</span> = 0, and <span class="in">`VO2max`</span> = 0. If the data was centered, the reference case would actually meaningful.</span>
<span id="cb119-245"><a href="#cb119-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-248"><a href="#cb119-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-249"><a href="#cb119-249" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb119-250"><a href="#cb119-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">0</span>, <span class="at">weight =</span> <span class="dv">0</span>, <span class="at">VO2max =</span> <span class="dv">0</span>, <span class="at">gender =</span> <span class="st">"Female"</span>), </span>
<span id="cb119-251"><a href="#cb119-251" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb119-252"><a href="#cb119-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-253"><a href="#cb119-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-254"><a href="#cb119-254" aria-hidden="true" tabindex="-1"></a>Column "statistic" is the Wald $z$ statistic, $z = \hat{\beta} / SE(\hat{\beta})$. Its square is the Wald chi-squared statistic. The _p_-value is the area to the right of $z^2$ in the $\chi_1^2$ density curve:</span>
<span id="cb119-255"><a href="#cb119-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-258"><a href="#cb119-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-259"><a href="#cb119-259" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb119-260"><a href="#cb119-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-261"><a href="#cb119-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.chisq =</span> <span class="fu">map_dbl</span>(statistic, <span class="sc">~</span><span class="fu">pchisq</span>(.<span class="sc">^</span><span class="dv">2</span>, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb119-262"><a href="#cb119-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(p.chisq)</span>
<span id="cb119-263"><a href="#cb119-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-264"><a href="#cb119-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-265"><a href="#cb119-265" aria-hidden="true" tabindex="-1"></a>Interpret the coefficient estimates as the change in the log odds of $y$ due to a one unit change in $x$. If $\delta = x_a - x_b$, then a $\delta$ change in $x$ is associated with a $\delta \hat{\beta}$ change in the log odds of $y$. $\beta$ is the log odds ratio of $x_a$ vs $x_b$.</span>
<span id="cb119-266"><a href="#cb119-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-267"><a href="#cb119-267" aria-hidden="true" tabindex="-1"></a>$$\log \left(\pi / (1 - \pi) |_{x = x_a} \right) - \log \left(\pi / (1 - \pi) |_{x = x_b} \right) = \log \left( \frac{\pi / (1 - \pi) |_{x = x_a}}{\pi / (1 - \pi) |_{x = x_b}} \right) = \delta \hat{\beta}$$</span>
<span id="cb119-268"><a href="#cb119-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-269"><a href="#cb119-269" aria-hidden="true" tabindex="-1"></a>The *exponential* of the coefficient estimates is the change in the _odds_ of $y$ due to a $\delta$ change in $x$. $\exp \beta$ is the odds ratio of $x_a$ vs $x_b$.</span>
<span id="cb119-270"><a href="#cb119-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-271"><a href="#cb119-271" aria-hidden="true" tabindex="-1"></a>$$\mathrm{odds}(y) = e^{\delta \hat{\beta}}$$</span>
<span id="cb119-272"><a href="#cb119-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-275"><a href="#cb119-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-276"><a href="#cb119-276" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-277"><a href="#cb119-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-278"><a href="#cb119-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-279"><a href="#cb119-279" aria-hidden="true" tabindex="-1"></a>All covariates held equal, a male's log odds of heart disease are <span class="in">`r comma(coefficients(cs1$result)["genderMale"], .01)`</span> times that of a female's (log(OR)). A male's odds are <span class="in">`r comma(exp(coefficients(cs1$result)["genderMale"]), .01)`</span> times that of a female's (OR). Of course, all covariate's are _not_ equal - males are heavier and have higher VO2max. Let's run the calculations with the mean predictor values for male and female.</span>
<span id="cb119-280"><a href="#cb119-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-281"><a href="#cb119-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-282"><a href="#cb119-282" aria-hidden="true" tabindex="-1"></a><span class="in"># Log OR</span></span>
<span id="cb119-283"><a href="#cb119-283" aria-hidden="true" tabindex="-1"></a><span class="in">pred_log_odds["Male"] / pred_log_odds["Female"]</span></span>
<span id="cb119-284"><a href="#cb119-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-285"><a href="#cb119-285" aria-hidden="true" tabindex="-1"></a><span class="in"># OR</span></span>
<span id="cb119-286"><a href="#cb119-286" aria-hidden="true" tabindex="-1"></a><span class="in">pred_odds["Male"] / pred_odds["Female"]</span></span>
<span id="cb119-287"><a href="#cb119-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-288"><a href="#cb119-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-289"><a href="#cb119-289" aria-hidden="true" tabindex="-1"></a>A one-unit increase in any of the continuous independent variables is interpreted similarly. The reference level is unimportant since the change is constant across the range of values. A one year increase in age increases the log-odds of heart disease by a factor of <span class="in">`r comma(coefficients(cs1$result)["age"], .01)`</span>, and the odds by a factor of <span class="in">`r comma(exp(coefficients(cs1$result)["age"]), .01)`</span>. To calculate the effect of a *decade* increase in age, multiply $\beta$ by 10 before exponentiating, or raise the exponentiated coeficient by 10. The effect of a 10-year increase in age is to increase the odds of heart disease by <span class="in">`r comma(exp(coefficients(cs1$result)["age"] * 10), .01)`</span>. The odds double every ten years.</span>
<span id="cb119-290"><a href="#cb119-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-291"><a href="#cb119-291" aria-hidden="true" tabindex="-1"></a><span class="in">`oddsratio::or_glm()`</span> is a handy way to calculate odds ratios from arbitrary increments to the predictors. Here are the ORs of a 10-year age change, 10 kg weight change, and VO2max change of 5.</span>
<span id="cb119-292"><a href="#cb119-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-295"><a href="#cb119-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-296"><a href="#cb119-296" aria-hidden="true" tabindex="-1"></a>oddsratio<span class="sc">::</span><span class="fu">or_glm</span>(</span>
<span id="cb119-297"><a href="#cb119-297" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>dat, </span>
<span id="cb119-298"><a href="#cb119-298" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>result, </span>
<span id="cb119-299"><a href="#cb119-299" aria-hidden="true" tabindex="-1"></a>  <span class="at">incr =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">10</span>, <span class="at">weight =</span> <span class="dv">25</span>, <span class="at">VO2max =</span> <span class="sc">-</span><span class="dv">12</span>)</span>
<span id="cb119-300"><a href="#cb119-300" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-301"><a href="#cb119-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-302"><a href="#cb119-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-303"><a href="#cb119-303" aria-hidden="true" tabindex="-1"></a>Notice that the predicted probabilities have the sigmoidal shape of the binary relationship.</span>
<span id="cb119-304"><a href="#cb119-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-305"><a href="#cb119-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb119-306"><a href="#cb119-306" aria-hidden="true" tabindex="-1"></a><span class="in">augment(cs1$fit, new_data = cs1$dat, type = "raw") %&gt;%</span></span>
<span id="cb119-307"><a href="#cb119-307" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = age, color = gender)) +</span></span>
<span id="cb119-308"><a href="#cb119-308" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(y = as.numeric(heart_disease == "Yes"))) +</span></span>
<span id="cb119-309"><a href="#cb119-309" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(y = .pred_Yes), shape = 4) +</span></span>
<span id="cb119-310"><a href="#cb119-310" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(y = .pred_Yes), se = FALSE) +</span></span>
<span id="cb119-311"><a href="#cb119-311" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Age",</span></span>
<span id="cb119-312"><a href="#cb119-312" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL,</span></span>
<span id="cb119-313"><a href="#cb119-313" aria-hidden="true" tabindex="-1"></a><span class="in">       title = "Binary Fitted Line Plot") +</span></span>
<span id="cb119-314"><a href="#cb119-314" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(breaks = c(0,1), labels = c("Healthy", "Heart Disease")) +</span></span>
<span id="cb119-315"><a href="#cb119-315" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_light() +</span></span>
<span id="cb119-316"><a href="#cb119-316" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "right")</span></span>
<span id="cb119-317"><a href="#cb119-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-318"><a href="#cb119-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-319"><a href="#cb119-319" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assumptions {-}</span></span>
<span id="cb119-320"><a href="#cb119-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-321"><a href="#cb119-321" aria-hidden="true" tabindex="-1"></a>Four assumptions relate to the study design: (1) the dependent variable is dichotomous; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid here. Three more assumptions related to the data distribution: </span>
<span id="cb119-322"><a href="#cb119-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-323"><a href="#cb119-323" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</span>
<span id="cb119-324"><a href="#cb119-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-325"><a href="#cb119-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</span>
<span id="cb119-326"><a href="#cb119-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-327"><a href="#cb119-327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are no influential outliers. Test with Cook's distance. </span>
<span id="cb119-328"><a href="#cb119-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-329"><a href="#cb119-329" aria-hidden="true" tabindex="-1"></a>Test the linearity assumption first. There are two ways to do this (do both). First, fit your model, then plot the _fitted values_ against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the _logit_ transformation. These plotted relationships look pretty linear.</span>
<span id="cb119-330"><a href="#cb119-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-333"><a href="#cb119-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-334"><a href="#cb119-334" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb119-335"><a href="#cb119-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs1<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb119-336"><a href="#cb119-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb119-337"><a href="#cb119-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> .pred_Yes)) <span class="sc">+</span></span>
<span id="cb119-338"><a href="#cb119-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-339"><a href="#cb119-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb119-340"><a href="#cb119-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y~x"</span>) <span class="sc">+</span></span>
<span id="cb119-341"><a href="#cb119-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linearity Test: predicted vs continuous predictors"</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb119-342"><a href="#cb119-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-343"><a href="#cb119-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-344"><a href="#cb119-344" aria-hidden="true" tabindex="-1"></a>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, $x_{Tx} = x \log x$, then test their significance level in the fit.</span>
<span id="cb119-345"><a href="#cb119-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-348"><a href="#cb119-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-349"><a href="#cb119-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb119-350"><a href="#cb119-350" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> </span>
<span id="cb119-351"><a href="#cb119-351" aria-hidden="true" tabindex="-1"></a>  cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-352"><a href="#cb119-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-353"><a href="#cb119-353" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_tx =</span> <span class="fu">log</span>(age) <span class="sc">*</span> age,</span>
<span id="cb119-354"><a href="#cb119-354" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_tx =</span> <span class="fu">log</span>(weight) <span class="sc">*</span> weight,</span>
<span id="cb119-355"><a href="#cb119-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">VO2max_tx =</span> <span class="fu">log</span>(VO2max) <span class="sc">*</span> VO2max</span>
<span id="cb119-356"><a href="#cb119-356" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb119-357"><a href="#cb119-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-358"><a href="#cb119-358" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>boxtidwell_fit <span class="ot">&lt;-</span> </span>
<span id="cb119-359"><a href="#cb119-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-360"><a href="#cb119-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-361"><a href="#cb119-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-362"><a href="#cb119-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender <span class="sc">+</span> </span>
<span id="cb119-363"><a href="#cb119-363" aria-hidden="true" tabindex="-1"></a>        age_tx <span class="sc">+</span> weight_tx <span class="sc">+</span> VO2max_tx, </span>
<span id="cb119-364"><a href="#cb119-364" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> x)</span>
<span id="cb119-365"><a href="#cb119-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-366"><a href="#cb119-366" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>boxtidwell_fit <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span>
<span id="cb119-367"><a href="#cb119-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-368"><a href="#cb119-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-369"><a href="#cb119-369" aria-hidden="true" tabindex="-1"></a>Focus on the three transformed variables. <span class="in">`age_tx`</span> is the only one with a *p*-value nearly &lt;.05, but it is customary to apply a Bonferroni adjustment when testing for linearity. There are eight predictors in the model (including the intercept term), so the Bonferroni adjusted *p*-value for <span class="in">`age_tx`</span> is multiplied by 8. Do not reject the null hypothesis of linearity.</span>
<span id="cb119-370"><a href="#cb119-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-371"><a href="#cb119-371" aria-hidden="true" tabindex="-1"></a>If the relationship _was_ nonlinear, you could try transforming the variable by raising it to $\lambda = 1 + b / \gamma$ where $b$ is the estimated coefficient of the model without the interaction terms, and $\gamma$ is the estimated coefficient of the interaction term of the model with interactions. For <span class="in">`age`</span>, $b$ is <span class="in">`r comma(coefficients(cs1$result)["age"], .001)`</span> and $\gamma$ is <span class="in">`r comma(coefficients(cs1$boxtidwell_fit$fit)["age_tx"], .001)`</span>, so $\lambda$ = <span class="in">`r comma(1 + coefficients(cs1$fit$fit)["age"] / coefficients(cs1$boxtidwell_fit$fit)["age_tx"], .001)`</span>. This is approximately 1 (no transformation). It appears to be customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal.</span>
<span id="cb119-372"><a href="#cb119-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-373"><a href="#cb119-373" aria-hidden="true" tabindex="-1"></a>Now check for multicollinearity. Variance inflation factors (VIF) estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable $i$ is</span>
<span id="cb119-374"><a href="#cb119-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-375"><a href="#cb119-375" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb119-376"><a href="#cb119-376" aria-hidden="true" tabindex="-1"></a>\mathrm{VIF}_i = \frac{1}{1 - R_i^2}</span>
<span id="cb119-377"><a href="#cb119-377" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb119-378"><a href="#cb119-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-379"><a href="#cb119-379" aria-hidden="true" tabindex="-1"></a>where $R_i^2$ is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of $X_i$ against all of the other predictors, $X_i = X_{j \ne i} \beta + \epsilon$. If $X_i$ is totally unrelated to its covariates, then $R_i^2$ will be zero and $\mathrm{VIF}_i$ will be 1. If $R_i^2$ is .8, $\mathrm{VIF}_i$ will be 5. The rule of thumb is that $R_i^2 \le 5$ is tolerable, and $R_i^2 &gt; 5$ is "highly correlated" and you have to do something about it. These are excellent.</span>
<span id="cb119-380"><a href="#cb119-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-383"><a href="#cb119-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-384"><a href="#cb119-384" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(cs1<span class="sc">$</span>result)</span>
<span id="cb119-385"><a href="#cb119-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-386"><a href="#cb119-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-387"><a href="#cb119-387" aria-hidden="true" tabindex="-1"></a>Try calculating the $\mathrm{VIF}$ for <span class="in">`age`</span>.</span>
<span id="cb119-388"><a href="#cb119-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-389"><a href="#cb119-389" aria-hidden="true" tabindex="-1"></a>:::rmdnote</span>
<span id="cb119-390"><a href="#cb119-390" aria-hidden="true" tabindex="-1"></a>I don't know why this doesn't work. It _would_ work if the underlying model was OLS instead of GLM. The answer seems to be related to GVIF vs VIF, but I didn't figure it out.)</span>
<span id="cb119-391"><a href="#cb119-391" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb119-392"><a href="#cb119-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-393"><a href="#cb119-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-394"><a href="#cb119-394" aria-hidden="true" tabindex="-1"></a><span class="in">r2 &lt;- lm(age ~ weight + VO2max + gender, data = cs1$dat_training) %&gt;%</span></span>
<span id="cb119-395"><a href="#cb119-395" aria-hidden="true" tabindex="-1"></a><span class="in">  summary() %&gt;% pluck("r.squared")</span></span>
<span id="cb119-396"><a href="#cb119-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-397"><a href="#cb119-397" aria-hidden="true" tabindex="-1"></a><span class="in">(vif &lt;- 1 / (1 - r2))</span></span>
<span id="cb119-398"><a href="#cb119-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-399"><a href="#cb119-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-400"><a href="#cb119-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb119-401"><a href="#cb119-401" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$outliers &lt;- </span></span>
<span id="cb119-402"><a href="#cb119-402" aria-hidden="true" tabindex="-1"></a><span class="in">  cs1$result %&gt;% </span></span>
<span id="cb119-403"><a href="#cb119-403" aria-hidden="true" tabindex="-1"></a><span class="in">  augment(type.predict = "response") %&gt;% </span></span>
<span id="cb119-404"><a href="#cb119-404" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(abs(.std.resid) &gt;= 2) %&gt;% </span></span>
<span id="cb119-405"><a href="#cb119-405" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(.std.resid)</span></span>
<span id="cb119-406"><a href="#cb119-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-407"><a href="#cb119-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-408"><a href="#cb119-408" aria-hidden="true" tabindex="-1"></a>Now check for influential outliers. Predict the response probabilities and filter for the predictions more than two standard deviations from the actual value and a Cook's Distance greater than 4/N = <span class="in">`r 4 / nrow(cs1$dat)`</span>.^[<span class="co">[</span><span class="ot">This article</span><span class="co">](https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290)</span> suggests using three standard deviations for an outliers threshold.] Cook's distance measures how much predicted values change when observation *i* is removed from the data. Only two fitted values were both an outlier and influential, row ids 59 and 70. An index plot of Cook's Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of <span class="in">`r comma(cs1$outliers[1], .01)`</span> and <span class="in">`r comma(cs1$outliers[2], .01)`</span> standard deviations which were kept in the analysis. </span>
<span id="cb119-409"><a href="#cb119-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-410"><a href="#cb119-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb119-411"><a href="#cb119-411" aria-hidden="true" tabindex="-1"></a><span class="in">augment(cs1$result) %&gt;%</span></span>
<span id="cb119-412"><a href="#cb119-412" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb119-413"><a href="#cb119-413" aria-hidden="true" tabindex="-1"></a><span class="in">    id = row_number(),</span></span>
<span id="cb119-414"><a href="#cb119-414" aria-hidden="true" tabindex="-1"></a><span class="in">    outlier = if_else(abs(.std.resid) &gt;= 2, "Outlier", "Other"),</span></span>
<span id="cb119-415"><a href="#cb119-415" aria-hidden="true" tabindex="-1"></a><span class="in">    influential = if_else(.cooksd &gt; 4 / nrow(cs1$dat), "Influential", "Other"),</span></span>
<span id="cb119-416"><a href="#cb119-416" aria-hidden="true" tabindex="-1"></a><span class="in">    status = case_when(</span></span>
<span id="cb119-417"><a href="#cb119-417" aria-hidden="true" tabindex="-1"></a><span class="in">      outlier == "Outlier" &amp; influential == "Influential" ~ "Influential Outlier",</span></span>
<span id="cb119-418"><a href="#cb119-418" aria-hidden="true" tabindex="-1"></a><span class="in">      outlier == "Outlier" ~ "Outlier",</span></span>
<span id="cb119-419"><a href="#cb119-419" aria-hidden="true" tabindex="-1"></a><span class="in">      influential == "Influential" ~ "Influential",</span></span>
<span id="cb119-420"><a href="#cb119-420" aria-hidden="true" tabindex="-1"></a><span class="in">      TRUE ~ "Other"</span></span>
<span id="cb119-421"><a href="#cb119-421" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb119-422"><a href="#cb119-422" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb119-423"><a href="#cb119-423" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .fitted, y = .cooksd)) +</span></span>
<span id="cb119-424"><a href="#cb119-424" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(color = status)) +</span></span>
<span id="cb119-425"><a href="#cb119-425" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = if_else(influential == "Influential", id, NA_integer_)), </span></span>
<span id="cb119-426"><a href="#cb119-426" aria-hidden="true" tabindex="-1"></a><span class="in">            check_overlap = TRUE, size = 3, nudge_x = .025) +</span></span>
<span id="cb119-427"><a href="#cb119-427" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 4 / nrow(cs1$dat), linetype = 2, color = "goldenrod") + </span></span>
<span id="cb119-428"><a href="#cb119-428" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("Influential Outlier" = "firebrick", </span></span>
<span id="cb119-429"><a href="#cb119-429" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Influential" = "goldenrod",</span></span>
<span id="cb119-430"><a href="#cb119-430" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Outlier" = "slategray",</span></span>
<span id="cb119-431"><a href="#cb119-431" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Other" = "black")) +</span></span>
<span id="cb119-432"><a href="#cb119-432" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "right") +</span></span>
<span id="cb119-433"><a href="#cb119-433" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Index Plot of Cook's Distance.",</span></span>
<span id="cb119-434"><a href="#cb119-434" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Row id labeled for values &gt; 4 / N.")</span></span>
<span id="cb119-435"><a href="#cb119-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-436"><a href="#cb119-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-437"><a href="#cb119-437" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluate the Fit {-}</span></span>
<span id="cb119-438"><a href="#cb119-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-439"><a href="#cb119-439" aria-hidden="true" tabindex="-1"></a>There are several ways to evaluate the model fit. </span>
<span id="cb119-440"><a href="#cb119-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-441"><a href="#cb119-441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The likelihood ratio test</span>
<span id="cb119-442"><a href="#cb119-442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pseudo R-squared^<span class="co">[</span><span class="ot">Nice explanation [here](https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/). Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit</span><span class="co">]</span>.</span>
<span id="cb119-443"><a href="#cb119-443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Accuracy measures</span>
<span id="cb119-444"><a href="#cb119-444" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gain and ROC curves</span>
<span id="cb119-445"><a href="#cb119-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-446"><a href="#cb119-446" aria-hidden="true" tabindex="-1"></a>The **likelihood ratio test** compares the log likelihood of the fitted model to an intercept-only model.</span>
<span id="cb119-447"><a href="#cb119-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-450"><a href="#cb119-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-451"><a href="#cb119-451" aria-hidden="true" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span></span>
<span id="cb119-452"><a href="#cb119-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-453"><a href="#cb119-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-454"><a href="#cb119-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-455"><a href="#cb119-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(heart_disease <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs1<span class="sc">$</span>dat)</span>
<span id="cb119-456"><a href="#cb119-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-457"><a href="#cb119-457" aria-hidden="true" tabindex="-1"></a>(cs1<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs1<span class="sc">$</span>result, intercept_only<span class="sc">$</span>fit))</span>
<span id="cb119-458"><a href="#cb119-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-459"><a href="#cb119-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-460"><a href="#cb119-460" aria-hidden="true" tabindex="-1"></a>The fitted model is significant, $\chi^2$(<span class="in">`r abs(cs1$lrtest$Df[2])`</span>) = <span class="in">`r comma(cs1$lrtest$Chisq[2], .1)`</span>, *p* &lt; .001. Calculate the pseuedo-R2 with <span class="in">`DescTools::PseudoR2()`</span>.</span>
<span id="cb119-461"><a href="#cb119-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-462"><a href="#cb119-462" aria-hidden="true" tabindex="-1"></a>:::rmdnote</span>
<span id="cb119-463"><a href="#cb119-463" aria-hidden="true" tabindex="-1"></a>I Can't get this to work in the tidymodels framework. Using <span class="in">`glm()`</span> for now.</span>
<span id="cb119-464"><a href="#cb119-464" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb119-465"><a href="#cb119-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-468"><a href="#cb119-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-469"><a href="#cb119-469" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender, </span>
<span id="cb119-470"><a href="#cb119-470" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> cs1<span class="sc">$</span>dat,</span>
<span id="cb119-471"><a href="#cb119-471" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb119-472"><a href="#cb119-472" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>pseudo_r2 <span class="ot">&lt;-</span> DescTools<span class="sc">::</span><span class="fu">PseudoR2</span>(x, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">"CoxSnell"</span>, <span class="st">"Nagelkerke"</span>, <span class="st">"McFadden"</span>))</span>
<span id="cb119-473"><a href="#cb119-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-474"><a href="#cb119-474" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>pseudo_r2</span>
<span id="cb119-475"><a href="#cb119-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-476"><a href="#cb119-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-477"><a href="#cb119-477" aria-hidden="true" tabindex="-1"></a>Laerd interprets this as the model explained <span class="in">`r percent(cs1$pseudo_r2["Nagelkerke"], .1)`</span> (Nagelkerke R2) of the variance in heart disease. This is how your would interpret R2 in an OLS model. <span class="co">[</span><span class="ot">UCLA</span><span class="co">](https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/)</span> points out that the various pseudo R-squareds measure other aspects of the model and are unique to the measured quantity. A pseudo R-squared is not very informative on its own; it is useful for comparing models. Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better way to go.</span>
<span id="cb119-478"><a href="#cb119-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-479"><a href="#cb119-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-480"><a href="#cb119-480" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$conf_mat &lt;-</span></span>
<span id="cb119-481"><a href="#cb119-481" aria-hidden="true" tabindex="-1"></a><span class="in">  cs1$fit %&gt;% </span></span>
<span id="cb119-482"><a href="#cb119-482" aria-hidden="true" tabindex="-1"></a><span class="in">  augment(new_data = cs1$dat) %&gt;%</span></span>
<span id="cb119-483"><a href="#cb119-483" aria-hidden="true" tabindex="-1"></a><span class="in">  # conf_mat requires truth to be first level of the factor variable.</span></span>
<span id="cb119-484"><a href="#cb119-484" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(heart_disease, .pred_class), ~fct_relevel(., "Yes"))) %&gt;%</span></span>
<span id="cb119-485"><a href="#cb119-485" aria-hidden="true" tabindex="-1"></a><span class="in">  conf_mat(truth = heart_disease, estimate = .pred_class)</span></span>
<span id="cb119-486"><a href="#cb119-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-487"><a href="#cb119-487" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$conf_mat</span></span>
<span id="cb119-488"><a href="#cb119-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-489"><a href="#cb119-489" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$conf_mat %&gt;% summary()</span></span>
<span id="cb119-490"><a href="#cb119-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-491"><a href="#cb119-491" aria-hidden="true" tabindex="-1"></a><span class="in">cs1$conf_mat %&gt;% autoplot()</span></span>
<span id="cb119-492"><a href="#cb119-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-493"><a href="#cb119-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-494"><a href="#cb119-494" aria-hidden="true" tabindex="-1"></a>The model accuracy, <span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "accuracy") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span>, is the percent of observations correctly classified. The sensitivity, <span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "sens") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span>, is the accuracy with regard to predicting positive cases. The specificity, <span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "spec") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span>, is the accuracy with regard to predicting negative cases. If you are fitting a predictive model, use the testing data set for this.</span>
<span id="cb119-495"><a href="#cb119-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-498"><a href="#cb119-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-499"><a href="#cb119-499" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>fit_training <span class="sc">%&gt;%</span> </span>
<span id="cb119-500"><a href="#cb119-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing) <span class="sc">%&gt;%</span></span>
<span id="cb119-501"><a href="#cb119-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> heart_disease, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb119-502"><a href="#cb119-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-503"><a href="#cb119-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-504"><a href="#cb119-504" aria-hidden="true" tabindex="-1"></a>Finally, plot the <span class="co">[</span><span class="ot">gain curve or ROC curve</span><span class="co">](https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference)</span>. In the **gain curve**, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The "wizard" curve is the gain curve when the data is sorted by the true outcome.  If the model's gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the "gain" over a random prediction.</span>
<span id="cb119-505"><a href="#cb119-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-508"><a href="#cb119-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-509"><a href="#cb119-509" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_testing <span class="sc">%&gt;%</span></span>
<span id="cb119-510"><a href="#cb119-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-511"><a href="#cb119-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb119-512"><a href="#cb119-512" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(.pred_Yes, <span class="at">truth =</span> heart_disease, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-513"><a href="#cb119-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb119-514"><a href="#cb119-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span>
<span id="cb119-515"><a href="#cb119-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-516"><a href="#cb119-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-517"><a href="#cb119-517" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(cs1$dat_testing$heart_disease == "Yes")`</span> of the <span class="in">`r nrow(cs1$dat_testing)`</span> participants had heart disease in the test data set. </span>
<span id="cb119-518"><a href="#cb119-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-519"><a href="#cb119-519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The gain curve encountered 6 heart disease cases (50%) within the first 8 observations (55%). It encountered all 11 heart disease cases on the 18th observation.</span>
<span id="cb119-520"><a href="#cb119-520" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The bottom of the grey area is the outcome of a random model. Only half the heart disease cases would be observed within 50% of the observations.  </span>
<span id="cb119-521"><a href="#cb119-521" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The top of the grey area is the outcome of the perfect model, the "wizard curve". Half the heart disease cases would be observed in 6/30=20% of the observations.</span>
<span id="cb119-522"><a href="#cb119-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-523"><a href="#cb119-523" aria-hidden="true" tabindex="-1"></a>The **ROC** (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</span>
<span id="cb119-524"><a href="#cb119-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-527"><a href="#cb119-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-528"><a href="#cb119-528" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>dat_testing <span class="sc">%&gt;%</span></span>
<span id="cb119-529"><a href="#cb119-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">new_data =</span> cs1<span class="sc">$</span>dat_testing, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-530"><a href="#cb119-530" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb119-531"><a href="#cb119-531" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(.pred_Yes, <span class="at">truth =</span> heart_disease, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-532"><a href="#cb119-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb119-533"><a href="#cb119-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curve"</span>)</span>
<span id="cb119-534"><a href="#cb119-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-535"><a href="#cb119-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-536"><a href="#cb119-536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting {-}</span></span>
<span id="cb119-537"><a href="#cb119-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-538"><a href="#cb119-538" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; A binomial logistic regression was performed to ascertain the effects of age, weight, gender and VO2max on the likelihood that participants have heart disease. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when *p* &lt; </span><span class="in">`r comma(.05/8, .00001)`</span><span class="at"> (Tabachnick &amp; Fidell, 2014). Based on this assessment, all continuous independent variables were found to be linearly related to the logit of the dependent variable. There were two standardized residuals with value of </span><span class="in">`r comma(cs1$outliers[1], .01)`</span><span class="at"> and </span><span class="in">`r comma(cs1$outliers[2], .01)`</span><span class="at"> standard deviations, which were kept in the analysis. The logistic regression model was statistically significant, χ2(4) = 27.40, p &lt; .001. The model explained </span><span class="in">`r percent(cs1$pseudo_r2["Nagelkerke"], .1)`</span><span class="at"> (Nagelkerke R2) of the variance in heart disease and correctly classified </span><span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "accuracy") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span><span class="at"> of cases. Sensitivity was </span><span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "sens") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span><span class="at">, specificity was </span><span class="in">`r cs1$conf_mat %&gt;% summary() %&gt;% filter(.metric == "spec") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span><span class="at">, positive predictive value was </span><span class="in">`r percent(cs1$confusion_matrix$byClass["Pos Pred Value"], .1)`</span><span class="at"> and negative predictive value was </span><span class="in">`r percent(cs1$confusion_matrix$byClass["Neg Pred Value"], .1)`</span><span class="at">. Of the five predictor variables only three were statistically significant: age, gender and VO2max (as shown in Table 1). Females had </span><span class="in">`r exp(-coef(cs1$result)["genderMale"]) %&gt;% comma(.01)`</span><span class="at"> times lower odds to exhibit heart disease than males. Increasing age was associated with an increased likelihood of exhibiting heart disease, but increasing VO2max was associated with a reduction in the likelihood of exhibiting heart disease.</span></span>
<span id="cb119-539"><a href="#cb119-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-540"><a href="#cb119-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb119-541"><a href="#cb119-541" aria-hidden="true" tabindex="-1"></a><span class="in">gtsummary::tbl_regression(</span></span>
<span id="cb119-542"><a href="#cb119-542" aria-hidden="true" tabindex="-1"></a><span class="in">  cs1$fit,</span></span>
<span id="cb119-543"><a href="#cb119-543" aria-hidden="true" tabindex="-1"></a><span class="in">  exponentiate = TRUE</span></span>
<span id="cb119-544"><a href="#cb119-544" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb119-545"><a href="#cb119-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-546"><a href="#cb119-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-547"><a href="#cb119-547" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multinomial Logistic Regression {#multinomiallogistic}</span></span>
<span id="cb119-548"><a href="#cb119-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-549"><a href="#cb119-549" aria-hidden="true" tabindex="-1"></a>The _multinomial_ logistic regression model is $J - 1$ baseline logits,</span>
<span id="cb119-550"><a href="#cb119-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-551"><a href="#cb119-551" aria-hidden="true" tabindex="-1"></a>$$y_i = \log \left( \frac{\pi_{ij}}{\pi_{ij^*}} \right) = X_i \beta_j, \hspace{5mm} j \ne j^*$$</span>
<span id="cb119-552"><a href="#cb119-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-553"><a href="#cb119-553" aria-hidden="true" tabindex="-1"></a>where $j$ is a level of the multinomial response variable. Whereas binomial logistic regression models the *log odds* of the response level, multinomial logistic regression models the *log relative risk*, the probability relative to the baseline $j^*$ level.^<span class="co">[</span><span class="ot">These notes rely on the course notes from [PSU STAT 504, Analysis of Discrete Data](https://online.stat.psu.edu/stat504/) and [UCLA](https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/).</span><span class="co">]</span></span>
<span id="cb119-554"><a href="#cb119-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-555"><a href="#cb119-555" aria-hidden="true" tabindex="-1"></a>Interpret the $k^{th}$ element of $\beta_j$ as the increase in log  relative risk of $Y_i = j$ relative to $Y_i = j^*$ given a one-unit increase in the $k^{th}$ element of $X$, holding the other terms constant. The individual probabilities, $\pi_{ij}$, are</span>
<span id="cb119-556"><a href="#cb119-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-557"><a href="#cb119-557" aria-hidden="true" tabindex="-1"></a>$$\pi_{ij} = \frac{\exp(y_{ij})}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{e^{X_i\beta_j}}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}$$</span>
<span id="cb119-558"><a href="#cb119-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-559"><a href="#cb119-559" aria-hidden="true" tabindex="-1"></a>and for the baseline category, </span>
<span id="cb119-560"><a href="#cb119-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-561"><a href="#cb119-561" aria-hidden="true" tabindex="-1"></a>$$\pi_{ij^*} = \frac{1}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{1}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}$$</span>
<span id="cb119-562"><a href="#cb119-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-563"><a href="#cb119-563" aria-hidden="true" tabindex="-1"></a>**Assumptions**</span>
<span id="cb119-564"><a href="#cb119-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-565"><a href="#cb119-565" aria-hidden="true" tabindex="-1"></a>Multinomial logistic regression applies when the dependent variable is categorical. It presumes a linear relationship between the log relative risk of the dependent variable and $X$ with residuals $\epsilon$ that are independent. It also assumes there is no severe multicollinearity in the predictors, and there is independence of irrelevant alternatives (IIA). IIA means the relative likelihood of being in one category compared to the base category would not change if you added other categories. </span>
<span id="cb119-566"><a href="#cb119-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-567"><a href="#cb119-567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Case Study {.unnumbered #cs2}</span></span>
<span id="cb119-568"><a href="#cb119-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-569"><a href="#cb119-569" aria-hidden="true" tabindex="-1"></a>This case study uses the data set from <span class="co">[</span><span class="ot">this UCLA tutorial</span><span class="co">](https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/)</span>. A study measures the association between students' academic program (academic, general, and vocational) and their socioeconomic status (SES) (low, middle, high) and writing score.</span>
<span id="cb119-570"><a href="#cb119-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-571"><a href="#cb119-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-572"><a href="#cb119-572" aria-hidden="true" tabindex="-1"></a><span class="in">download.file(</span></span>
<span id="cb119-573"><a href="#cb119-573" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://stats.idre.ucla.edu/stat/data/hsbdemo.dta",</span></span>
<span id="cb119-574"><a href="#cb119-574" aria-hidden="true" tabindex="-1"></a><span class="in">  "./input/hsbdemo.dta",</span></span>
<span id="cb119-575"><a href="#cb119-575" aria-hidden="true" tabindex="-1"></a><span class="in">  mode = "wb"</span></span>
<span id="cb119-576"><a href="#cb119-576" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb119-577"><a href="#cb119-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-578"><a href="#cb119-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-581"><a href="#cb119-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-582"><a href="#cb119-582" aria-hidden="true" tabindex="-1"></a>cs2 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-583"><a href="#cb119-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-584"><a href="#cb119-584" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.dta</span>(<span class="st">"./input/hsbdemo.dta"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-585"><a href="#cb119-585" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just keep cols relevant to study</span></span>
<span id="cb119-586"><a href="#cb119-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, prog, ses, write) <span class="sc">%&gt;%</span></span>
<span id="cb119-587"><a href="#cb119-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_relevel</span>(prog, <span class="st">"academic"</span>, <span class="at">after =</span> <span class="dv">0</span>))</span>
<span id="cb119-588"><a href="#cb119-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-589"><a href="#cb119-589" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-590"><a href="#cb119-590" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb119-591"><a href="#cb119-591" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> prog,</span>
<span id="cb119-592"><a href="#cb119-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">include =</span> <span class="fu">c</span>(prog, ses, write),</span>
<span id="cb119-593"><a href="#cb119-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean}, {sd}"</span>)</span>
<span id="cb119-594"><a href="#cb119-594" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-595"><a href="#cb119-595" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">add_overall</span>()</span>
<span id="cb119-596"><a href="#cb119-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-597"><a href="#cb119-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-598"><a href="#cb119-598" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb119-599"><a href="#cb119-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-600"><a href="#cb119-600" aria-hidden="true" tabindex="-1"></a>Conduct a brief exploratory analysis to establish your expectations. Academic programs are associated with higher writing scores and SES. General and vocational programs are the opposite, although SES has opposing effects for general (increased probability) and vocational (decreased probability).</span>
<span id="cb119-601"><a href="#cb119-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-604"><a href="#cb119-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-605"><a href="#cb119-605" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-606"><a href="#cb119-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_bin =</span> <span class="fu">cut</span>(write, <span class="at">breaks =</span> <span class="dv">5</span>, <span class="at">dig.lab =</span> <span class="dv">1</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-607"><a href="#cb119-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(prog, ses, write_bin) <span class="sc">%&gt;%</span></span>
<span id="cb119-608"><a href="#cb119-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.by =</span> <span class="fu">c</span>(ses, write_bin), <span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb119-609"><a href="#cb119-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write_bin, <span class="at">y =</span> prob, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb119-610"><a href="#cb119-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-611"><a href="#cb119-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ses)) <span class="sc">+</span></span>
<span id="cb119-612"><a href="#cb119-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog)) <span class="sc">+</span></span>
<span id="cb119-613"><a href="#cb119-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb119-614"><a href="#cb119-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Program Proportions by SES"</span>)</span>
<span id="cb119-615"><a href="#cb119-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-616"><a href="#cb119-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-617"><a href="#cb119-617" aria-hidden="true" tabindex="-1"></a>If your model is predictive rather than inferential, split the data into training/testing data sets.</span>
<span id="cb119-618"><a href="#cb119-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-619"><a href="#cb119-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-620"><a href="#cb119-620" aria-hidden="true" tabindex="-1"></a><span class="in"># For reproducibility</span></span>
<span id="cb119-621"><a href="#cb119-621" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb119-622"><a href="#cb119-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-623"><a href="#cb119-623" aria-hidden="true" tabindex="-1"></a><span class="in">(x &lt;- initial_split(cs2$dat, prop = 0.7, strata = prog))</span></span>
<span id="cb119-624"><a href="#cb119-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-625"><a href="#cb119-625" aria-hidden="true" tabindex="-1"></a><span class="in">cs2$dat_training &lt;- training(x)</span></span>
<span id="cb119-626"><a href="#cb119-626" aria-hidden="true" tabindex="-1"></a><span class="in">dim(cs2$dat_training)</span></span>
<span id="cb119-627"><a href="#cb119-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-628"><a href="#cb119-628" aria-hidden="true" tabindex="-1"></a><span class="in">cs2$dat_testing &lt;- testing(x)</span></span>
<span id="cb119-629"><a href="#cb119-629" aria-hidden="true" tabindex="-1"></a><span class="in">dim(cs2$dat_testing)</span></span>
<span id="cb119-630"><a href="#cb119-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-631"><a href="#cb119-631" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit the Model {-}</span></span>
<span id="cb119-632"><a href="#cb119-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-633"><a href="#cb119-633" aria-hidden="true" tabindex="-1"></a>The multinomial logitistic regression model engines all seem to be related to neural networks and advise that predictors be set on a common scale by normalizing. I have only one predictor other than SES in this model, but I'll normalize it anyway.  Normalizing <span class="in">`write`</span> will also facilitate model interpretation. The intercept will represent a reasonable condition (average writing score) and a one-unit increase in <span class="in">`write`</span> will represent a 1 SD increase in writing. </span>
<span id="cb119-634"><a href="#cb119-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-635"><a href="#cb119-635" aria-hidden="true" tabindex="-1"></a>:::rmdnote</span>
<span id="cb119-636"><a href="#cb119-636" aria-hidden="true" tabindex="-1"></a>This case study will use both the <span class="in">`parsnip`</span> package to fit a model directly to a data set, and the <span class="in">`recipes`</span> package to preprocess the data. <span class="in">`parsnip`</span> is fine for most applications and it seems to be better supported by other functions, like <span class="in">`tidy()`</span>, so stick with it for inferential applications. <span class="in">`recipes`</span> has the advantage of being able to process data in a workflow, so you don't have to transform new data to make predictions. See more uses of <span class="in">`recipes`</span> on the <span class="co">[</span><span class="ot">tidy models documentation</span><span class="co">](https://www.tidymodels.org/start/recipes/)</span>.</span>
<span id="cb119-637"><a href="#cb119-637" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb119-638"><a href="#cb119-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-639"><a href="#cb119-639" aria-hidden="true" tabindex="-1"></a>Let's first use <span class="in">`parsnip`</span> to fit the full data set for an inferential application.</span>
<span id="cb119-640"><a href="#cb119-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-643"><a href="#cb119-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-644"><a href="#cb119-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model. This much is the same for parsnip or recipes.</span></span>
<span id="cb119-645"><a href="#cb119-645" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>model <span class="ot">&lt;-</span></span>
<span id="cb119-646"><a href="#cb119-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multinom_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-647"><a href="#cb119-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>)</span>
<span id="cb119-648"><a href="#cb119-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-649"><a href="#cb119-649" aria-hidden="true" tabindex="-1"></a><span class="co"># For parsnip, you need to normalize the data explicitly. nnet requires dummy</span></span>
<span id="cb119-650"><a href="#cb119-650" aria-hidden="true" tabindex="-1"></a><span class="co"># vars for factor predictors, but thankfully parsnip does that implicitly. </span></span>
<span id="cb119-651"><a href="#cb119-651" aria-hidden="true" tabindex="-1"></a><span class="co"># However, I want the outcome variable base level to be "academic" and while</span></span>
<span id="cb119-652"><a href="#cb119-652" aria-hidden="true" tabindex="-1"></a><span class="co"># recipes can do that in pre-processing, I have to do it manually for parsnip.</span></span>
<span id="cb119-653"><a href="#cb119-653" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="ot">&lt;-</span></span>
<span id="cb119-654"><a href="#cb119-654" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-655"><a href="#cb119-655" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cast to numeric, otherwise scale() returns an nmatrix. :(</span></span>
<span id="cb119-656"><a href="#cb119-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(write, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb119-657"><a href="#cb119-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-658"><a href="#cb119-658" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the whole data set for an explanatory model.</span></span>
<span id="cb119-659"><a href="#cb119-659" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit <span class="ot">&lt;-</span></span>
<span id="cb119-660"><a href="#cb119-660" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>model <span class="sc">%&gt;%</span></span>
<span id="cb119-661"><a href="#cb119-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write, <span class="at">data =</span> cs2<span class="sc">$</span>dat_normalized)</span>
<span id="cb119-662"><a href="#cb119-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-663"><a href="#cb119-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the fit object returned by the engine. Use for interpretation and </span></span>
<span id="cb119-664"><a href="#cb119-664" aria-hidden="true" tabindex="-1"></a><span class="co"># checking assumptions.</span></span>
<span id="cb119-665"><a href="#cb119-665" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="ot">&lt;-</span></span>
<span id="cb119-666"><a href="#cb119-666" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb119-667"><a href="#cb119-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span>
<span id="cb119-668"><a href="#cb119-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-669"><a href="#cb119-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-670"><a href="#cb119-670" aria-hidden="true" tabindex="-1"></a>In parallel, let's use <span class="in">`recipes`</span> to fit a predictive model to the training data. The model object is already created, so we just need to pair a recipe object with a workflow.</span>
<span id="cb119-671"><a href="#cb119-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-674"><a href="#cb119-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-675"><a href="#cb119-675" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>rec <span class="ot">&lt;-</span></span>
<span id="cb119-676"><a href="#cb119-676" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The `data` argument can be the base data, or training, or even testing. </span></span>
<span id="cb119-677"><a href="#cb119-677" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recipe() only uses it to catalog variable names and data types.</span></span>
<span id="cb119-678"><a href="#cb119-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write, <span class="at">data =</span> cs2<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb119-679"><a href="#cb119-679" aria-hidden="true" tabindex="-1"></a>  <span class="co"># You could have specified the formula as prog ~ ., then assigned roles. E.g.,</span></span>
<span id="cb119-680"><a href="#cb119-680" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep "id" in data set, but don't use it in the model like this:</span></span>
<span id="cb119-681"><a href="#cb119-681" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update_role(id, new_role = "ID") %&gt;%</span></span>
<span id="cb119-682"><a href="#cb119-682" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unlike parsnip, recipe does not automatically create dummy vars.</span></span>
<span id="cb119-683"><a href="#cb119-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb119-684"><a href="#cb119-684" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Not relevant here, but good practice: if a factor level has few values, it may</span></span>
<span id="cb119-685"><a href="#cb119-685" aria-hidden="true" tabindex="-1"></a>  <span class="co"># not appear in the training set. If so, its dummy will contain a single value</span></span>
<span id="cb119-686"><a href="#cb119-686" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (0). You can prevent that by dropping zero-value cols.</span></span>
<span id="cb119-687"><a href="#cb119-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb119-688"><a href="#cb119-688" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the reference level of the outcome here if you want.</span></span>
<span id="cb119-689"><a href="#cb119-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_relevel</span>(prog, <span class="at">ref_level =</span> <span class="st">"academic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-690"><a href="#cb119-690" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize write.</span></span>
<span id="cb119-691"><a href="#cb119-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(write)</span>
<span id="cb119-692"><a href="#cb119-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-693"><a href="#cb119-693" aria-hidden="true" tabindex="-1"></a><span class="co"># The workflow pairs the model and recipe.</span></span>
<span id="cb119-694"><a href="#cb119-694" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>wflow <span class="ot">&lt;-</span></span>
<span id="cb119-695"><a href="#cb119-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-696"><a href="#cb119-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(cs2<span class="sc">$</span>model) <span class="sc">%&gt;%</span></span>
<span id="cb119-697"><a href="#cb119-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(cs2<span class="sc">$</span>rec)</span>
<span id="cb119-698"><a href="#cb119-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-699"><a href="#cb119-699" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the training data set for a predictive model.</span></span>
<span id="cb119-700"><a href="#cb119-700" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit_training <span class="ot">&lt;-</span></span>
<span id="cb119-701"><a href="#cb119-701" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>wflow <span class="sc">%&gt;%</span></span>
<span id="cb119-702"><a href="#cb119-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> cs2<span class="sc">$</span>dat_training)</span>
<span id="cb119-703"><a href="#cb119-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-704"><a href="#cb119-704" aria-hidden="true" tabindex="-1"></a><span class="co"># You can't extract the engine fit and pipe into summary. Seems like a bug</span></span>
<span id="cb119-705"><a href="#cb119-705" aria-hidden="true" tabindex="-1"></a><span class="co"># cs2$result_training &lt;- cs2$fit_training %&gt;% extract_fit_engine()</span></span>
<span id="cb119-706"><a href="#cb119-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-707"><a href="#cb119-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-708"><a href="#cb119-708" aria-hidden="true" tabindex="-1"></a>Let's look at the explanatory model summary object. The model produces a set of coefficient estimates for each non-reference level of the dependent variable. The <span class="in">`nnet`</span> engine presents the coefficient estimates, then their standard errors as a second section, but does not present the *z*-statistic or *p*-values! </span>
<span id="cb119-709"><a href="#cb119-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-712"><a href="#cb119-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-713"><a href="#cb119-713" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb119-714"><a href="#cb119-714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-715"><a href="#cb119-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-716"><a href="#cb119-716" aria-hidden="true" tabindex="-1"></a>The residual deviance is $G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}$. Another model diagnostic is the log-likelihood, $-G^2 / 2$ (not shown) and AIC. More on these in the Model Fit section.</span>
<span id="cb119-717"><a href="#cb119-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-718"><a href="#cb119-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-719"><a href="#cb119-719" aria-hidden="true" tabindex="-1"></a><span class="in">deviance(cs2$result)</span></span>
<span id="cb119-720"><a href="#cb119-720" aria-hidden="true" tabindex="-1"></a><span class="in">logLik(cs2$result, sum = TRUE)</span></span>
<span id="cb119-721"><a href="#cb119-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-722"><a href="#cb119-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-723"><a href="#cb119-723" aria-hidden="true" tabindex="-1"></a>The Wald *z*-statistic is $z = \hat{\beta} / SE(\hat{\beta})$. Its square is the Wald chi-squared statistic. The _p_-value is the area to the right of $z^2$ in the $\chi_1^2$ density curve. Get these from <span class="in">`tidy()`</span>.</span>
<span id="cb119-724"><a href="#cb119-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-727"><a href="#cb119-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-728"><a href="#cb119-728" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()</span>
<span id="cb119-729"><a href="#cb119-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-730"><a href="#cb119-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-731"><a href="#cb119-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation {-}</span></span>
<span id="cb119-732"><a href="#cb119-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-733"><a href="#cb119-733" aria-hidden="true" tabindex="-1"></a>Start with interpreting the dependent variable. The model fits the **log relative risk** of belonging to program $j \in$ <span class="co">[</span><span class="ot">vocation, general</span><span class="co">]</span> vs. $j^*$ = academic. However, `predict()` returns either the risk (`type` = "probs") or outcome (`type` = "class), not the log relative risk. Plug in values for the predictor variables to get predictions. The relative risk is $RR = \exp (\hat{y}_j) = \pi_j / \pi_{j^*}$. We see here that a student of low SES and mean writing score is less likely to be in a general or vocation program than an academic program.</span>
<span id="cb119-734"><a href="#cb119-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-735"><a href="#cb119-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-736"><a href="#cb119-736" aria-hidden="true" tabindex="-1"></a><span class="in">(risk &lt;- predict(cs2$result, newdata = list(ses = "low", write = 0), type = "probs"))</span></span>
<span id="cb119-737"><a href="#cb119-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-738"><a href="#cb119-738" aria-hidden="true" tabindex="-1"></a><span class="in"># Relative risk.</span></span>
<span id="cb119-739"><a href="#cb119-739" aria-hidden="true" tabindex="-1"></a><span class="in">(rr &lt;- risk[-1] / risk[1])</span></span>
<span id="cb119-740"><a href="#cb119-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-741"><a href="#cb119-741" aria-hidden="true" tabindex="-1"></a><span class="in"># Log-relative risk (the modeled outcome)</span></span>
<span id="cb119-742"><a href="#cb119-742" aria-hidden="true" tabindex="-1"></a><span class="in">(log_rr &lt;- log(rr))</span></span>
<span id="cb119-743"><a href="#cb119-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-744"><a href="#cb119-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-745"><a href="#cb119-745" aria-hidden="true" tabindex="-1"></a>Move on to the coefficients. Interpret $\hat{\beta}$ as the change in the _log relative risk_ of $y_j$ relative to $y_{j^*}$ due to a $\delta$ = one unit change in $x$. A $\delta = x_a - x_b$ change in $x$ is associated with a $\delta \hat{\beta}$ change. $\delta\beta$ is the log relative risk ratio.</span>
<span id="cb119-746"><a href="#cb119-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-747"><a href="#cb119-747" aria-hidden="true" tabindex="-1"></a>$$\log \left(\pi_j / \pi_{j^*} |_{x = x_a} \right) - \log \left(\pi_j / \pi_{j^*} |_{x = x_b} \right) = \log \left( \frac{\pi_j / \pi_{j^*} |_{x = x_a}}{\pi_j / \pi_{j^*} |_{x = x_b}} \right) = \delta \hat{\beta}$$</span>
<span id="cb119-748"><a href="#cb119-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-749"><a href="#cb119-749" aria-hidden="true" tabindex="-1"></a>The exponential of $\hat{\beta}$ is the change in the _relative risk_ of $y_j$ relative to $y_{j^*}$ due to a $\delta$ = one unit change in $x$. $\exp \delta \beta$ is the relative risk ratio.</span>
<span id="cb119-750"><a href="#cb119-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-751"><a href="#cb119-751" aria-hidden="true" tabindex="-1"></a>$$\pi_j / \pi_{j^*} |_{x = x_a} = \exp{\delta \hat{\beta}}$$</span>
<span id="cb119-752"><a href="#cb119-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-753"><a href="#cb119-753" aria-hidden="true" tabindex="-1"></a>The intercept term is the log-relative risk of $y_j$ relative to $y_{j^*}$ for the reference case. The reference case in the model is <span class="in">`ses`</span> = "low" and <span class="in">`write`</span> centered at <span class="in">`r comma(mean(cs2$dat$write), .1)`</span>. Notice how the intercept matches the predicted values above.</span>
<span id="cb119-754"><a href="#cb119-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-755"><a href="#cb119-755" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-756"><a href="#cb119-756" aria-hidden="true" tabindex="-1"></a><span class="in">(ref_log_rr &lt;- coef(cs2$result)[,"(Intercept)"])</span></span>
<span id="cb119-757"><a href="#cb119-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-758"><a href="#cb119-758" aria-hidden="true" tabindex="-1"></a><span class="in"># From log-relative risk to relative risk.</span></span>
<span id="cb119-759"><a href="#cb119-759" aria-hidden="true" tabindex="-1"></a><span class="in">(ref_rr &lt;- exp(ref_log_rr))</span></span>
<span id="cb119-760"><a href="#cb119-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-761"><a href="#cb119-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-762"><a href="#cb119-762" aria-hidden="true" tabindex="-1"></a>The log relative risks of a low SES student with a <span class="in">`r comma(mean(cs2$dat$write), .1)`</span> writing score being in program general vs academic is $\hat{y} = \mathrm{Intercept}_1$ = <span class="in">`r comma(ref_log_rr[1], .001)`</span>, and $\hat{y} = \mathrm{Intercept}_2$ = <span class="in">`r comma(ref_log_rr[2], .001)`</span> for vocation vs academic. The corresponding relative risks are $\exp(\hat{y}_j)$ = <span class="in">`r comma(ref_rr[1], .001)`</span> and <span class="in">`r comma(ref_rr[2], .001)`</span>. The expected probabilities are <span class="in">`r percent(risk[1], .1)`</span>, <span class="in">`r percent(risk[2], .1)`</span>, and <span class="in">`r percent(risk[3], .1)`</span> for academic, general, and vocation respectively.</span>
<span id="cb119-763"><a href="#cb119-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-764"><a href="#cb119-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb119-765"><a href="#cb119-765" aria-hidden="true" tabindex="-1"></a><span class="in">ses_high &lt;- predict(cs2$result, newdata = list(ses = "high", write = 0), type = "probs")</span></span>
<span id="cb119-766"><a href="#cb119-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-767"><a href="#cb119-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-768"><a href="#cb119-768" aria-hidden="true" tabindex="-1"></a>If SES was high instead of low, the expected probabilities of being in program general vs academic would be <span class="in">`r percent(ses_high[1], .1)`</span>, <span class="in">`r percent(ses_high[2], .1)`</span>, and <span class="in">`r percent(ses_high[3], .1)`</span> for academic, general, and vocation respectively. </span>
<span id="cb119-769"><a href="#cb119-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-770"><a href="#cb119-770" aria-hidden="true" tabindex="-1"></a>What if the writing score increases by 1 SD (one unit)? The log RR of being in program general vs academic change by a factor of <span class="in">`coef(cs2$result)["general", "write"]`</span> = <span class="in">`r coef(cs2$result)["general", "write"] %&gt;% comma(.001)`</span>, RR = <span class="in">`r exp(coef(cs2$result)["general", "write"]) %&gt;% comma(.001)`</span>. For program vocation vs academic, it would change by a factor of <span class="in">`r coef(cs2$result)["vocation", "write"] %&gt;% comma(.001)`</span>, RR = <span class="in">`r exp(coef(cs2$result)["vocation", "write"]) %&gt;% comma(.001)`</span>. To get a 2 SD increase, multiply the coefficient by 2, then exponentiate. The two RRs would then be <span class="in">`r exp(coef(cs2$result)["general", "write"]*2) %&gt;% comma(.001)`</span> and <span class="in">`r exp(coef(cs2$result)["vocation", "write"]*2) %&gt;% comma(.001)`</span>.</span>
<span id="cb119-771"><a href="#cb119-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-772"><a href="#cb119-772" aria-hidden="true" tabindex="-1"></a>Visualize the parameter estimates by plotting the predicted values.</span>
<span id="cb119-773"><a href="#cb119-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-776"><a href="#cb119-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-777"><a href="#cb119-777" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb119-778"><a href="#cb119-778" aria-hidden="true" tabindex="-1"></a>  <span class="at">ses =</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>ses),</span>
<span id="cb119-779"><a href="#cb119-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">write =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">round</span>(<span class="fu">min</span>(cs2<span class="sc">$</span>dat_normalized<span class="sc">$</span>write)), </span>
<span id="cb119-780"><a href="#cb119-780" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">round</span>(<span class="fu">max</span>(cs2<span class="sc">$</span>dat_normalized<span class="sc">$</span>write)), </span>
<span id="cb119-781"><a href="#cb119-781" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb119-782"><a href="#cb119-782" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-783"><a href="#cb119-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-784"><a href="#cb119-784" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb119-785"><a href="#cb119-785" aria-hidden="true" tabindex="-1"></a>  new_data,</span>
<span id="cb119-786"><a href="#cb119-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> new_data, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb119-787"><a href="#cb119-787" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb119-788"><a href="#cb119-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(ses, write), <span class="at">names_to =</span> <span class="st">"prog"</span>, <span class="at">values_to =</span> <span class="st">"probability"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-789"><a href="#cb119-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write, <span class="at">y =</span> probability, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb119-790"><a href="#cb119-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb119-791"><a href="#cb119-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog))</span>
<span id="cb119-792"><a href="#cb119-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-793"><a href="#cb119-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-794"><a href="#cb119-794" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assumptions {-}</span></span>
<span id="cb119-795"><a href="#cb119-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-796"><a href="#cb119-796" aria-hidden="true" tabindex="-1"></a>Four assumptions relate to the study design: (1) the dependent variable is multinomial; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid. Three more assumptions related to the data distribution: </span>
<span id="cb119-797"><a href="#cb119-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-798"><a href="#cb119-798" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</span>
<span id="cb119-799"><a href="#cb119-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-800"><a href="#cb119-800" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</span>
<span id="cb119-801"><a href="#cb119-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-802"><a href="#cb119-802" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are no influential outliers. Test with Cook's distance. </span>
<span id="cb119-803"><a href="#cb119-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-804"><a href="#cb119-804" aria-hidden="true" tabindex="-1"></a>There are two ways to test for linearity (do both). First, plot the _fitted values_ against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the _logit_ transformation. These plotted relationships look good, except that in the <span class="in">`prog`</span> = general level, writing score appears to interact with SES.</span>
<span id="cb119-805"><a href="#cb119-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-808"><a href="#cb119-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-809"><a href="#cb119-809" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb119-810"><a href="#cb119-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb119-811"><a href="#cb119-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(.pred_academic<span class="sc">:</span>.pred_vocation), <span class="at">values_to =</span> <span class="st">".fitted"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-812"><a href="#cb119-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="fu">as.character</span>(prog))) <span class="sc">%&gt;%</span></span>
<span id="cb119-813"><a href="#cb119-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write, <span class="at">y =</span> .fitted, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb119-814"><a href="#cb119-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-815"><a href="#cb119-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog), <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb119-816"><a href="#cb119-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y~x"</span>) <span class="sc">+</span></span>
<span id="cb119-817"><a href="#cb119-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linearity Test: predicted vs continuous predictors"</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb119-818"><a href="#cb119-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-819"><a href="#cb119-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-820"><a href="#cb119-820" aria-hidden="true" tabindex="-1"></a>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, $x_{Tx} = x \log x$, then test their significance level in the fit. Focus on the transformed variable. <span class="in">`write_tx`</span> has a *p*-value &lt;.05 for general. It is customary to apply a Bonferroni adjustment when testing for linearity. There are ten predictors in the model (including the intercept terms), so the Bonferroni adjusted *p*-values for <span class="in">`write_tx`</span> are multiplied by 10. We should reject the null hypothesis of linearity because the adjusted p.value is still below .05.</span>
<span id="cb119-821"><a href="#cb119-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-824"><a href="#cb119-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-825"><a href="#cb119-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb119-826"><a href="#cb119-826" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>boxtidwell <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-827"><a href="#cb119-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_tx =</span> <span class="fu">log</span>(write) <span class="sc">*</span> write) <span class="sc">%&gt;%</span></span>
<span id="cb119-828"><a href="#cb119-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cs2<span class="sc">$</span>model, prog <span class="sc">~</span> ses <span class="sc">+</span> write <span class="sc">+</span> write_tx, <span class="at">data =</span> .)</span>
<span id="cb119-829"><a href="#cb119-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-830"><a href="#cb119-830" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(cs2<span class="sc">$</span>boxtidwell) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"write_tx"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">adj_p =</span> p.value <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb119-831"><a href="#cb119-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-832"><a href="#cb119-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-833"><a href="#cb119-833" aria-hidden="true" tabindex="-1"></a>If the relationship is nonlinear, you can try transforming the variable by raising it to $\lambda = 1 + b / \gamma$ where $b$ is the estimated coefficient of the model without the interaction terms, and $\gamma$ is the estimated coefficient of the interaction term of the model with interactions. For <span class="in">`write`</span>, $b$ is <span class="in">`r comma(coef(cs2$fit_nnet)[1, "write_c"], .001)`</span> for general and $\gamma$ is <span class="in">`r comma(coef(cs2$boxtidwell)[1, "write_tx"], .001)`</span>, so $\lambda$ = 1 + <span class="in">`r comma(coef(cs2$fit_nnet)[1, "write_c"], .001)`</span> / <span class="in">`r comma(coef(cs2$boxtidwell)[1, "write_tx"], .001)`</span> = <span class="in">`r comma(1 + coef(cs2$fit_nnet)[1, "write_c"] / coef(cs2$boxtidwell)[1, "write_tx"], .001)`</span>. It seems customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal, so maybe try raising <span class="in">`write_c`</span> to <span class="in">`r comma(1 + coef(cs2$fit_nnet)[1, "write_c"] / coef(cs2$boxtidwell)[1, "write_tx"], 1)`</span>. It seems in this case that the better solution is to add an interaction between <span class="in">`write_c`</span> and <span class="in">`ses`</span> to the model. I'm not going to pursue this further here.</span>
<span id="cb119-834"><a href="#cb119-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-835"><a href="#cb119-835" aria-hidden="true" tabindex="-1"></a>Check for multicollinearity using variance inflation factors (VIF). VIFs estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable $i$ is</span>
<span id="cb119-836"><a href="#cb119-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-837"><a href="#cb119-837" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb119-838"><a href="#cb119-838" aria-hidden="true" tabindex="-1"></a>\mathrm{VIF}_i = \frac{1}{1 - R_i^2}</span>
<span id="cb119-839"><a href="#cb119-839" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb119-840"><a href="#cb119-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-841"><a href="#cb119-841" aria-hidden="true" tabindex="-1"></a>where $R_i^2$ is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of $X_i$ against all of the other predictors, $X_i = X_{j \ne i} \beta + \epsilon$. If $X_i$ is totally unrelated to its covariates, then $R_i^2$ will be zero and $\mathrm{VIF}_i$ will be 1. If $R_i^2$ is .8, $\mathrm{VIF}_i$ will be 5. The rule of thumb is that $R_i^2 \le 5$ is tolerable, and $R_i^2 &gt; 5$ is "highly correlated" and you have to do something about it. <span class="in">`car::vif()`</span> doesn't work for multinomial logistic regression. The model type is not actually important here - we're concerned about the covariate relationships. Below, I successively collapse the dependent variable into two-levels, then fit a binomial logistic regression and pipe that into <span class="in">`car::vif()`</span>.</span>
<span id="cb119-842"><a href="#cb119-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-843"><a href="#cb119-843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-844"><a href="#cb119-844" aria-hidden="true" tabindex="-1"></a><span class="in">tmp_fit_general &lt;-</span></span>
<span id="cb119-845"><a href="#cb119-845" aria-hidden="true" tabindex="-1"></a><span class="in">  logistic_reg() %&gt;%</span></span>
<span id="cb119-846"><a href="#cb119-846" aria-hidden="true" tabindex="-1"></a><span class="in">  fit(</span></span>
<span id="cb119-847"><a href="#cb119-847" aria-hidden="true" tabindex="-1"></a><span class="in">    prog ~ ses + write, </span></span>
<span id="cb119-848"><a href="#cb119-848" aria-hidden="true" tabindex="-1"></a><span class="in">    data = cs2$dat_normalized %&gt;% mutate(prog = fct_collapse(prog, vocation = "academic"))</span></span>
<span id="cb119-849"><a href="#cb119-849" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb119-850"><a href="#cb119-850" aria-hidden="true" tabindex="-1"></a><span class="in">  extract_fit_engine() </span></span>
<span id="cb119-851"><a href="#cb119-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-852"><a href="#cb119-852" aria-hidden="true" tabindex="-1"></a><span class="in">tmp_fit_general %&gt;% car::vif()</span></span>
<span id="cb119-853"><a href="#cb119-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-854"><a href="#cb119-854" aria-hidden="true" tabindex="-1"></a><span class="in">tmp_fit_vocation &lt;- </span></span>
<span id="cb119-855"><a href="#cb119-855" aria-hidden="true" tabindex="-1"></a><span class="in">  logistic_reg() %&gt;%</span></span>
<span id="cb119-856"><a href="#cb119-856" aria-hidden="true" tabindex="-1"></a><span class="in">  fit(</span></span>
<span id="cb119-857"><a href="#cb119-857" aria-hidden="true" tabindex="-1"></a><span class="in">    prog ~ ses + write, </span></span>
<span id="cb119-858"><a href="#cb119-858" aria-hidden="true" tabindex="-1"></a><span class="in">    data = cs2$dat_normalized %&gt;% mutate(prog = fct_collapse(prog, general = "academic"))</span></span>
<span id="cb119-859"><a href="#cb119-859" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb119-860"><a href="#cb119-860" aria-hidden="true" tabindex="-1"></a><span class="in">  extract_fit_engine()</span></span>
<span id="cb119-861"><a href="#cb119-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-862"><a href="#cb119-862" aria-hidden="true" tabindex="-1"></a><span class="in">tmp_fit_vocation %&gt;% car::vif()</span></span>
<span id="cb119-863"><a href="#cb119-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-864"><a href="#cb119-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-865"><a href="#cb119-865" aria-hidden="true" tabindex="-1"></a>Check for influential outliers. Outliers are predicted values greater than two standard deviations from the actual value. Influential points have a Cook's Distance greater than 4/N (4 / <span class="in">`r nrow(cs2$dat)`</span> = <span class="in">`r 4 / nrow(cs2$dat)`</span>.^<span class="co">[</span><span class="ot">Cook's distance measures how much predicted values change when observation *i* is removed from the data. [This article](https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290) suggests using three standard deviations for an outliers threshold.</span><span class="co">]</span> Influential outliers are both. There is no simple way to do this for the multinomial regression because neither VGAM nor nnet support the <span class="in">`augment()`</span> generic. Instead, I will use the two *binomial logistic* regressions from the VIF diagnostic. </span>
<span id="cb119-866"><a href="#cb119-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-869"><a href="#cb119-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-870"><a href="#cb119-870" aria-hidden="true" tabindex="-1"></a>outlier_dat <span class="ot">&lt;-</span></span>
<span id="cb119-871"><a href="#cb119-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb119-872"><a href="#cb119-872" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="fu">augment</span>(tmp_fit_general, <span class="at">type.predict =</span> <span class="st">"response"</span>),</span>
<span id="cb119-873"><a href="#cb119-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">vocation =</span> <span class="fu">augment</span>(tmp_fit_vocation, <span class="at">type.predict =</span> <span class="st">"response"</span>),</span>
<span id="cb119-874"><a href="#cb119-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">"logit"</span></span>
<span id="cb119-875"><a href="#cb119-875" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-876"><a href="#cb119-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-877"><a href="#cb119-877" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb119-878"><a href="#cb119-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">if_else</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>, <span class="st">"Outlier"</span>, <span class="st">"Other"</span>),</span>
<span id="cb119-879"><a href="#cb119-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">influential =</span> <span class="fu">if_else</span>(.cooksd <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="st">"Influential"</span>, <span class="st">"Other"</span>),</span>
<span id="cb119-880"><a href="#cb119-880" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb119-881"><a href="#cb119-881" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">&amp;</span> influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential Outlier"</span>,</span>
<span id="cb119-882"><a href="#cb119-882" aria-hidden="true" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">"Outlier"</span> <span class="sc">~</span> <span class="st">"Outlier"</span>,</span>
<span id="cb119-883"><a href="#cb119-883" aria-hidden="true" tabindex="-1"></a>      influential <span class="sc">==</span> <span class="st">"Influential"</span> <span class="sc">~</span> <span class="st">"Influential"</span>,</span>
<span id="cb119-884"><a href="#cb119-884" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb119-885"><a href="#cb119-885" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb119-886"><a href="#cb119-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">factor</span>(status, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Influential"</span>, <span class="st">"Outlier"</span>, <span class="st">"Influential Outlier"</span>, <span class="st">"Other"</span>))</span>
<span id="cb119-887"><a href="#cb119-887" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb119-888"><a href="#cb119-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-889"><a href="#cb119-889" aria-hidden="true" tabindex="-1"></a>outlier_dat <span class="sc">%&gt;%</span></span>
<span id="cb119-890"><a href="#cb119-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb119-891"><a href="#cb119-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb119-892"><a href="#cb119-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">if_else</span>(influential <span class="sc">==</span> <span class="st">"Influential"</span>, id, <span class="cn">NA_integer_</span>)), </span>
<span id="cb119-893"><a href="#cb119-893" aria-hidden="true" tabindex="-1"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> .<span class="dv">025</span>) <span class="sc">+</span></span>
<span id="cb119-894"><a href="#cb119-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"goldenrod"</span>) <span class="sc">+</span> </span>
<span id="cb119-895"><a href="#cb119-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Influential Outlier"</span> <span class="ot">=</span> <span class="st">"firebrick"</span>, </span>
<span id="cb119-896"><a href="#cb119-896" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Influential"</span> <span class="ot">=</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb119-897"><a href="#cb119-897" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Outlier"</span> <span class="ot">=</span> <span class="st">"salmon"</span>,</span>
<span id="cb119-898"><a href="#cb119-898" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb119-899"><a href="#cb119-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb119-900"><a href="#cb119-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Index Plot of Cook's Distance."</span>,</span>
<span id="cb119-901"><a href="#cb119-901" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Row id labeled for influential points."</span>) <span class="sc">+</span></span>
<span id="cb119-902"><a href="#cb119-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(logit), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb119-903"><a href="#cb119-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-904"><a href="#cb119-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-905"><a href="#cb119-905" aria-hidden="true" tabindex="-1"></a>No fitted values were influential outliers in the first fit, and only two were influential outliers in the second fit. </span>
<span id="cb119-906"><a href="#cb119-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-909"><a href="#cb119-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-910"><a href="#cb119-910" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>outliers <span class="ot">&lt;-</span></span>
<span id="cb119-911"><a href="#cb119-911" aria-hidden="true" tabindex="-1"></a>  outlier_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(status <span class="sc">==</span> <span class="st">"Influential Outlier"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.std.resid))</span>
<span id="cb119-912"><a href="#cb119-912" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-913"><a href="#cb119-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-914"><a href="#cb119-914" aria-hidden="true" tabindex="-1"></a>An index plot of Cook's Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of <span class="in">`r comma(cs2$outliers[1], .01)`</span> and <span class="in">`r comma(cs2$outliers[2], .01)`</span> standard deviations which were kept in the analysis. </span>
<span id="cb119-915"><a href="#cb119-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-916"><a href="#cb119-916" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluate the Fit {-}</span></span>
<span id="cb119-917"><a href="#cb119-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-918"><a href="#cb119-918" aria-hidden="true" tabindex="-1"></a>There are several ways to evaluate the model fit. </span>
<span id="cb119-919"><a href="#cb119-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-920"><a href="#cb119-920" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Deviance and chi-squared tests for lack of fit</span>
<span id="cb119-921"><a href="#cb119-921" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The likelihood ratio test</span>
<span id="cb119-922"><a href="#cb119-922" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pseudo R-squared^<span class="co">[</span><span class="ot">Nice write-up [here](https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/). Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit</span><span class="co">]</span>.</span>
<span id="cb119-923"><a href="#cb119-923" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Accuracy measures</span>
<span id="cb119-924"><a href="#cb119-924" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gain and ROC curves</span>
<span id="cb119-925"><a href="#cb119-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-926"><a href="#cb119-926" aria-hidden="true" tabindex="-1"></a>The **deviance test** for lack of fit and the **likelihood ratio test** are residuals tests. The deviance residual is defined as $d_i = \mathrm{sign}(\epsilon_i) \left<span class="co">[</span><span class="ot"> -2(y_i \log \hat{\pi}_i + (1 - y_i) \log (1 - \hat{\pi}_i)) \right</span><span class="co">]</span>^{.5}$. The model deviance, $G^2$, is the sum of the squared deviance residuals. It also equals $G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}$. You can calculate them by hand.</span>
<span id="cb119-927"><a href="#cb119-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-928"><a href="#cb119-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE, warning=FALSE}</span></span>
<span id="cb119-929"><a href="#cb119-929" aria-hidden="true" tabindex="-1"></a><span class="in"># Actual values (1s and 0s for three response levels)</span></span>
<span id="cb119-930"><a href="#cb119-930" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- cs2$dat %&gt;% </span></span>
<span id="cb119-931"><a href="#cb119-931" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(val = 1) %&gt;% </span></span>
<span id="cb119-932"><a href="#cb119-932" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = prog, values_from = val, values_fill = 0) %&gt;%</span></span>
<span id="cb119-933"><a href="#cb119-933" aria-hidden="true" tabindex="-1"></a><span class="in">  select(levels(cs2$dat$prog)) %&gt;%</span></span>
<span id="cb119-934"><a href="#cb119-934" aria-hidden="true" tabindex="-1"></a><span class="in">  as.matrix()</span></span>
<span id="cb119-935"><a href="#cb119-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-936"><a href="#cb119-936" aria-hidden="true" tabindex="-1"></a><span class="in"># Predicted values (probabilities for three response levels)</span></span>
<span id="cb119-937"><a href="#cb119-937" aria-hidden="true" tabindex="-1"></a><span class="in">pi &lt;- predict(cs2$result, type = "prob") * 1</span></span>
<span id="cb119-938"><a href="#cb119-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-939"><a href="#cb119-939" aria-hidden="true" tabindex="-1"></a><span class="in"># Raw residuals, by hand or by formula</span></span>
<span id="cb119-940"><a href="#cb119-940" aria-hidden="true" tabindex="-1"></a><span class="in"># e &lt;- y - pi</span></span>
<span id="cb119-941"><a href="#cb119-941" aria-hidden="true" tabindex="-1"></a><span class="in">e &lt;- residuals(cs2$result, type = "response")</span></span>
<span id="cb119-942"><a href="#cb119-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-943"><a href="#cb119-943" aria-hidden="true" tabindex="-1"></a><span class="in"># Deviance residuals</span></span>
<span id="cb119-944"><a href="#cb119-944" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- sign(e) * sqrt(-2 * y * log(pi) + (1 - y) * log(1 - pi))</span></span>
<span id="cb119-945"><a href="#cb119-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-946"><a href="#cb119-946" aria-hidden="true" tabindex="-1"></a><span class="in">(g2 &lt;- sum(d^2, na.rm = TRUE))</span></span>
<span id="cb119-947"><a href="#cb119-947" aria-hidden="true" tabindex="-1"></a><span class="in">(g2 &lt;- 2 * sum(y * log(y / pi), na.rm = TRUE))</span></span>
<span id="cb119-948"><a href="#cb119-948" aria-hidden="true" tabindex="-1"></a><span class="in">(g2 &lt;- deviance(cs2$result))</span></span>
<span id="cb119-949"><a href="#cb119-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-950"><a href="#cb119-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-951"><a href="#cb119-951" aria-hidden="true" tabindex="-1"></a>The related Pearson statistic, $X$, is the sum of the squared *Pearson residuals*, $pr_i = \epsilon_i / \sqrt{\hat{\pi}_i}$, the raw residual scaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial. I don't see this calculated in the <span class="in">`residual()`</span> functions. You can do it yourself.</span>
<span id="cb119-952"><a href="#cb119-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-953"><a href="#cb119-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-954"><a href="#cb119-954" aria-hidden="true" tabindex="-1"></a><span class="in">(x2 &lt;- sum((e / sqrt(pi))^2))</span></span>
<span id="cb119-955"><a href="#cb119-955" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-956"><a href="#cb119-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-957"><a href="#cb119-957" aria-hidden="true" tabindex="-1"></a>The deviance and Pearson statistic are distributed chi-squared with $(N - p)(r - 1)$ degrees of freedom where $p$ = 4 predictor variables (3 SES levels + intercept), and $r$ = 3 levels of the dependent variable for <span class="in">`r (nrow(cs2$dat) - 4) * (3 - 1)`</span> degrees of freedom. The deviance and Pearson tests for lack of fit calculate the probability of the test statistic. The null hypothesis is that the model is correct. Neither test rejects the null hypothesis.</span>
<span id="cb119-958"><a href="#cb119-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-959"><a href="#cb119-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-960"><a href="#cb119-960" aria-hidden="true" tabindex="-1"></a><span class="in"># Deviance test for lack of fit</span></span>
<span id="cb119-961"><a href="#cb119-961" aria-hidden="true" tabindex="-1"></a><span class="in">(N &lt;- nrow(cs2$dat))</span></span>
<span id="cb119-962"><a href="#cb119-962" aria-hidden="true" tabindex="-1"></a><span class="in">(r &lt;- length(levels(cs2$dat$prog)))</span></span>
<span id="cb119-963"><a href="#cb119-963" aria-hidden="true" tabindex="-1"></a><span class="in">(p &lt;- length(coef(cs2$result)) / (r - 1)) # coefficients for each level, so divide by # levels</span></span>
<span id="cb119-964"><a href="#cb119-964" aria-hidden="true" tabindex="-1"></a><span class="in">(df &lt;- (N - p) * (r - 1))</span></span>
<span id="cb119-965"><a href="#cb119-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-966"><a href="#cb119-966" aria-hidden="true" tabindex="-1"></a><span class="in">pchisq(g2, df, lower.tail = FALSE)</span></span>
<span id="cb119-967"><a href="#cb119-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-968"><a href="#cb119-968" aria-hidden="true" tabindex="-1"></a><span class="in">pchisq(x2, df, lower.tail = FALSE)</span></span>
<span id="cb119-969"><a href="#cb119-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-970"><a href="#cb119-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-971"><a href="#cb119-971" aria-hidden="true" tabindex="-1"></a>You can do the same calculations for the intercept-only model.</span>
<span id="cb119-972"><a href="#cb119-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-973"><a href="#cb119-973" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE, warning=FALSE, message=FALSE}</span></span>
<span id="cb119-974"><a href="#cb119-974" aria-hidden="true" tabindex="-1"></a><span class="in">io &lt;- multinom_reg() %&gt;% fit(prog ~ 1, data = cs2$dat) %&gt;% extract_fit_engine()</span></span>
<span id="cb119-975"><a href="#cb119-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-976"><a href="#cb119-976" aria-hidden="true" tabindex="-1"></a><span class="in">deviance(io)</span></span>
<span id="cb119-977"><a href="#cb119-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-978"><a href="#cb119-978" aria-hidden="true" tabindex="-1"></a><span class="in"># degrees of freedom</span></span>
<span id="cb119-979"><a href="#cb119-979" aria-hidden="true" tabindex="-1"></a><span class="in">((nrow(cs2$dat) - length(coef(io)) / (r - 1)) * (r - 1))</span></span>
<span id="cb119-980"><a href="#cb119-980" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-981"><a href="#cb119-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-982"><a href="#cb119-982" aria-hidden="true" tabindex="-1"></a>The log-likelihood measures the unexplained variability in the model. The **likelihood ratio test** compares the log likelihood of the fitted model to the intercept-only model. You can use <span class="in">`lmtest::lrtest()`</span> to test. <span class="in">`anova()`</span> does the same thing using the residual deviance, $G2 = -2 \times \mathrm{log likelihood}$, although it does not seem to work with the <span class="in">`nnet`</span> engine.</span>
<span id="cb119-983"><a href="#cb119-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-986"><a href="#cb119-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-987"><a href="#cb119-987" aria-hidden="true" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(io, cs2<span class="sc">$</span>result))</span>
<span id="cb119-988"><a href="#cb119-988" aria-hidden="true" tabindex="-1"></a><span class="co"># (cs2$lrtest &lt;- anova(io, cs2$result, type = "I", test = "LR"))</span></span>
<span id="cb119-989"><a href="#cb119-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-990"><a href="#cb119-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-991"><a href="#cb119-991" aria-hidden="true" tabindex="-1"></a>The difference in deviances is $LR$ = <span class="in">`r comma(cs2$lrtest$Chisq[2], .01)`</span> with <span class="in">`r cs2$lrtest$Df[2]`</span> degrees of freedom. This is distributed chi-squared, with *p*-value = <span class="in">`r scientific(cs2$lrtest$"Pr(&gt;Chisq)"[2], 4)`</span>. The deviance test for lack of fit concludes that the model fits significantly better than an empty (intercept-only) model, $\chi^2$(<span class="in">`r cs2$lrtest$Df[2]`</span>) = <span class="in">`r comma(cs2$lrtest$Chisq[2], .01)`</span>, p &lt; .001.</span>
<span id="cb119-992"><a href="#cb119-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-993"><a href="#cb119-993" aria-hidden="true" tabindex="-1"></a>You can use <span class="in">`lmtest::lrtest()`</span> to perform likelihood ratio tests on the significance of the predictors too. The likelihood ratio test compares the log likelihood with and without the predictor. Unfortunately, this does not seem to work within the <span class="in">`parsnip`</span> framework.</span>
<span id="cb119-994"><a href="#cb119-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-995"><a href="#cb119-995" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse=TRUE}</span></span>
<span id="cb119-996"><a href="#cb119-996" aria-hidden="true" tabindex="-1"></a><span class="in"># (cs2$lrtest_ses &lt;- lmtest::lrtest(cs2$result, "ses"))</span></span>
<span id="cb119-997"><a href="#cb119-997" aria-hidden="true" tabindex="-1"></a><span class="in">no_ses &lt;- multinom_reg() %&gt;% fit(prog ~ write, data = cs2$dat) %&gt;% extract_fit_engine()</span></span>
<span id="cb119-998"><a href="#cb119-998" aria-hidden="true" tabindex="-1"></a><span class="in">(cs2$lrtest_ses &lt;- lmtest::lrtest(cs2$result, no_ses))</span></span>
<span id="cb119-999"><a href="#cb119-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1000"><a href="#cb119-1000" aria-hidden="true" tabindex="-1"></a><span class="in"># (cs2$lrtest_write &lt;- lmtest::lrtest(cs2$fit_nnet, "write"))</span></span>
<span id="cb119-1001"><a href="#cb119-1001" aria-hidden="true" tabindex="-1"></a><span class="in">no_write &lt;- multinom_reg() %&gt;% fit(prog ~ ses, data = cs2$dat) %&gt;% extract_fit_engine()</span></span>
<span id="cb119-1002"><a href="#cb119-1002" aria-hidden="true" tabindex="-1"></a><span class="in">(cs2$lrtest_write &lt;- lmtest::lrtest(cs2$result, no_write))</span></span>
<span id="cb119-1003"><a href="#cb119-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1004"><a href="#cb119-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1005"><a href="#cb119-1005" aria-hidden="true" tabindex="-1"></a>Both SES, $X^2$ = <span class="in">`r comma(cs2$lrtest_ses$Chisq[2], .001)`</span>, *p* = `r comma(cs2$lrtest_ses$"Pr(&gt;Chisq)"[2], .001)`, and writing score $X^2$ = `r comma(cs2$lrtest_write$Chisq[2], .001)`, *p* = <span class="in">`r scientific(cs2$lrtest_write$"Pr(&gt;Chisq)"[2], 4)`</span>, had significant effects on the program.</span>
<span id="cb119-1006"><a href="#cb119-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1007"><a href="#cb119-1007" aria-hidden="true" tabindex="-1"></a>Logistic regression does not have a direct R-squared statistic like OLS does (the proportion of variance explained by the model). However, there are some analogs, called pseudo R-squared. You'll encounter three pseudo R-squared measures: Cox and Snell, Nagelkerke, and McFadden. This one does not work for the <span class="in">`nnet`</span> engine.</span>
<span id="cb119-1008"><a href="#cb119-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1011"><a href="#cb119-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1012"><a href="#cb119-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># DescTools::PseudoR2(cs2$result, which = c("CoxSnell", "Nagelkerke", "McFadden"))</span></span>
<span id="cb119-1013"><a href="#cb119-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1014"><a href="#cb119-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1015"><a href="#cb119-1015" aria-hidden="true" tabindex="-1"></a>Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better model fit diagnostic the the pseudo r-squares.</span>
<span id="cb119-1016"><a href="#cb119-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1019"><a href="#cb119-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1020"><a href="#cb119-1020" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb119-1021"><a href="#cb119-1021" aria-hidden="true" tabindex="-1"></a>  cs2<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb119-1022"><a href="#cb119-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb119-1023"><a href="#cb119-1023" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conf_mat requires truth to be first level of the factor variable.</span></span>
<span id="cb119-1024"><a href="#cb119-1024" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(across(c(prog, .pred_class), ~fct_relevel(., "academic"))) %&gt;%</span></span>
<span id="cb119-1025"><a href="#cb119-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> prog, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb119-1026"><a href="#cb119-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1027"><a href="#cb119-1027" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat</span>
<span id="cb119-1028"><a href="#cb119-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1029"><a href="#cb119-1029" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb119-1030"><a href="#cb119-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1031"><a href="#cb119-1031" aria-hidden="true" tabindex="-1"></a>cs1<span class="sc">$</span>conf_mat <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span>
<span id="cb119-1032"><a href="#cb119-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1033"><a href="#cb119-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1034"><a href="#cb119-1034" aria-hidden="true" tabindex="-1"></a>The model accuracy, <span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "accuracy") %&gt;% pull(.estimate) %&gt;% percent(.1)`</span>, is the percent of observations correctly classified. The sensitivities are the accuracy with regard to predicting positive cases in each level of the dependent variable. The specificities are the accuracy with regard to predicting negative cases. The prevalences are the proportion of cases that were positive. </span>
<span id="cb119-1035"><a href="#cb119-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1036"><a href="#cb119-1036" aria-hidden="true" tabindex="-1"></a>Finally, plot the <span class="co">[</span><span class="ot">gain curve or ROC curve</span><span class="co">](https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference)</span>. In the **gain curve**, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The "wizard" curve is the gain curve when the data is sorted by the true outcome.  If the model's gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the "gain" over a random prediction.</span>
<span id="cb119-1037"><a href="#cb119-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1040"><a href="#cb119-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1041"><a href="#cb119-1041" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span></span>
<span id="cb119-1042"><a href="#cb119-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1043"><a href="#cb119-1043" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb119-1044"><a href="#cb119-1044" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(.pred_academic, .pred_general, .pred_vocation, </span>
<span id="cb119-1045"><a href="#cb119-1045" aria-hidden="true" tabindex="-1"></a>                        <span class="at">truth =</span> prog, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1046"><a href="#cb119-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb119-1047"><a href="#cb119-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span>
<span id="cb119-1048"><a href="#cb119-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1049"><a href="#cb119-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1050"><a href="#cb119-1050" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(cs2$dat$prog == "academic")`</span> of the <span class="in">`r nrow(cs2$dat)`</span> participants were in the academic program. </span>
<span id="cb119-1051"><a href="#cb119-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1052"><a href="#cb119-1052" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The gain curve encountered 52 academic programs (50%) within the first 72 observations (36%). It encountered all <span class="in">`r sum(cs2$dat$prog == "academic")`</span> cases on the 189th observation.</span>
<span id="cb119-1053"><a href="#cb119-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The bottom of the grey area is the outcome of a random model. Only half the academic program cases would be observed within 50% of the observations.  </span>
<span id="cb119-1054"><a href="#cb119-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The top of the grey area is the outcome of the perfect model, the "wizard curve". Half the academic program cases would be observed in <span class="in">`r sum(cs2$dat$prog == "academic")/2`</span>/<span class="in">`r nrow(cs2$dat)`</span>=<span class="in">`r percent(sum(cs2$dat$prog == "academic")/2 / nrow(cs2$dat), .01)`</span> of the observations.</span>
<span id="cb119-1055"><a href="#cb119-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1056"><a href="#cb119-1056" aria-hidden="true" tabindex="-1"></a>The **ROC** (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</span>
<span id="cb119-1057"><a href="#cb119-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1060"><a href="#cb119-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1061"><a href="#cb119-1061" aria-hidden="true" tabindex="-1"></a>cs2<span class="sc">$</span>dat_normalized <span class="sc">%&gt;%</span></span>
<span id="cb119-1062"><a href="#cb119-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(cs2<span class="sc">$</span>fit, <span class="at">new_data =</span> cs2<span class="sc">$</span>dat_normalized, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1063"><a href="#cb119-1063" aria-hidden="true" tabindex="-1"></a>  <span class="co"># event_level = "second" sets the second level as success</span></span>
<span id="cb119-1064"><a href="#cb119-1064" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(.pred_academic, .pred_general, .pred_vocation, </span>
<span id="cb119-1065"><a href="#cb119-1065" aria-hidden="true" tabindex="-1"></a>                        <span class="at">truth =</span> prog, <span class="at">event_level =</span> <span class="st">"second"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1066"><a href="#cb119-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb119-1067"><a href="#cb119-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gain Curve"</span>)</span>
<span id="cb119-1068"><a href="#cb119-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1069"><a href="#cb119-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1070"><a href="#cb119-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting {-}</span></span>
<span id="cb119-1071"><a href="#cb119-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1072"><a href="#cb119-1072" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; A multinomial logistic regression was performed to ascertain the effects of socioeconomic status (ses) and writing score on the likelihood that participants are enrolled in an academic, general, or vocation program. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when *p* &lt; </span><span class="in">`r comma(.05/8, .00001)`</span><span class="at"> (Tabachnick &amp; Fidell, 2014). Based on this assessment, the continuous </span><span class="in">`write`</span><span class="at"> independent variable was found to be linearly related to the logit of the dependent variable levels. There were two standardized residuals with value of </span><span class="in">`r comma(cs2$outliers[1], .01)`</span><span class="at"> and </span><span class="in">`r comma(cs2$outliers[2], .01)`</span><span class="at"> standard deviations, which were kept in the analysis. The multinomial logistic regression model was statistically significant, $\chi^2$(</span><span class="in">`r cs2$lrtest$Df[2]`</span><span class="at">) = </span><span class="in">`r comma(cs2$lrtest$Chisq[2], .01)`</span><span class="at">, p &lt; .001. The model correctly classified </span><span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "accuracy") %&gt;% pull(.estimate) %&gt;% percent(1)`</span><span class="at"> of cases. Sensitivity was </span><span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "sens") %&gt;% pull(.estimate) %&gt;% percent(1)`</span><span class="at">, specificity was </span><span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "spec") %&gt;% pull(.estimate) %&gt;% percent(1)`</span><span class="at">, positive predictive value was </span><span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "ppv") %&gt;% pull(.estimate) %&gt;% percent(1)`</span><span class="at"> and negative predictive value was </span><span class="in">`r cs2$conf_mat %&gt;% summary() %&gt;% filter(.metric == "npv") %&gt;% pull(.estimate) %&gt;% percent(1)`</span><span class="at">. The </span><span class="in">`write`</span><span class="at"> predictor variable was statistically significant for both outcome levels and high SES was statistically significant for the general program (as shown in Table 1). A 1SD increase in the writing score was associated with a (1 - </span><span class="in">`r cs2$result %&gt;% coef() %&gt;% .["general", "write"] %&gt;% exp() %&gt;% comma(.01)`</span><span class="at">) decrease in the odds of choosing a general program instead of academic and a (1 - </span><span class="in">`r cs2$result %&gt;% coef() %&gt;% .["vocation", "write"] %&gt;% exp() %&gt;% comma(.01)`</span><span class="at">) decrease in the odds of choosing a vocation program over academic. A high SEC was associated with a (1 - </span><span class="in">`r cs2$result %&gt;% coef() %&gt;% .["general", "seshigh"] %&gt;% exp() %&gt;% comma(.01)`</span><span class="at">) decrease in the odds of chooseing a general program over academic.</span></span>
<span id="cb119-1073"><a href="#cb119-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1074"><a href="#cb119-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb119-1075"><a href="#cb119-1075" aria-hidden="true" tabindex="-1"></a><span class="in">gtsummary::tbl_regression(</span></span>
<span id="cb119-1076"><a href="#cb119-1076" aria-hidden="true" tabindex="-1"></a><span class="in">  cs2$result,</span></span>
<span id="cb119-1077"><a href="#cb119-1077" aria-hidden="true" tabindex="-1"></a><span class="in">  exponentiate = TRUE</span></span>
<span id="cb119-1078"><a href="#cb119-1078" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb119-1079"><a href="#cb119-1079" aria-hidden="true" tabindex="-1"></a><span class="in">  gtsummary::as_flex_table() %&gt;%</span></span>
<span id="cb119-1080"><a href="#cb119-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  flextable::theme_apa()</span></span>
<span id="cb119-1081"><a href="#cb119-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1082"><a href="#cb119-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1083"><a href="#cb119-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ordinal Logistic Regression {#ordinallogistic}</span></span>
<span id="cb119-1084"><a href="#cb119-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1085"><a href="#cb119-1085" aria-hidden="true" tabindex="-1"></a>Ordinal logistic regression, also call cumulative link model (CLM), is a generalized linear model (GZLM), an extension of the general linear model (GLM) to non-continuous outcome variables. There are many approaches to ordinal logistic regression, including cumulative, adjacent, and continuation categories, but the most popular is the **cumulative odds ordinal logistic regression with proportional odds**.^<span class="co">[</span><span class="ot">These notes rely on [UVA](https://data.library.virginia.edu/fitting-and-interpreting-a-proportional-odds-model/), [PSU](https://online.stat.psu.edu/stat504/),  [Laerd](https://statistics.laerd.com/spss-tutorials/ordinal-regression-using-spss-statistics.php), and the CLM package [article vignette](https://cran.r-project.org/web/packages/ordinal/vignettes/clm_article.pdf)</span><span class="co">]</span>. The model for ordinal response random variable $Y_i$ with $J$ levels is</span>
<span id="cb119-1086"><a href="#cb119-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1087"><a href="#cb119-1087" aria-hidden="true" tabindex="-1"></a>$$\gamma_{ij} = F(\eta_{ij}), \hspace{5 mm} \eta_{ij} = \theta_j - x_i^\mathrm{T}\beta, \hspace{5 mm} i = 1, \ldots, n, \hspace{5 mm} j = 1, \ldots, J-1$$</span>
<span id="cb119-1088"><a href="#cb119-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1089"><a href="#cb119-1089" aria-hidden="true" tabindex="-1"></a>where $\gamma_{ij} = P(Y_i \le j) = \pi_{i1} + \cdots + \pi_{ij}$. $\eta_{ij}$ is a linear predictor with $J-1$ intercepts. $F$ is the inverse link function. The regression models the logit link function of $\gamma_{ij}$.</span>
<span id="cb119-1090"><a href="#cb119-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1091"><a href="#cb119-1091" aria-hidden="true" tabindex="-1"></a>$$\mathrm{logit}(\gamma_{ij}) = \log \left<span class="co">[</span><span class="ot">\frac{P(Y_i \le j)}{P(Y_i \gt j)} \right</span><span class="co">]</span> = \theta_j - x_i^\mathrm{T}\beta$$</span>
<span id="cb119-1092"><a href="#cb119-1092" aria-hidden="true" tabindex="-1"></a>The cumulative logit is the log-odds of the cumulative probabilities that the response is in category $\le j$ versus $\gt j$. $\theta_j$ is the log-odds when $x_i^\mathrm{T}=0$ and $\beta$ is the increase in the log odds attributed to a one unit increase in $x_i^\mathrm{T}$. Notice $\beta$ is the same for all $j$. The exponential of the predicted value is the odds. Solve this for the probability, </span>
<span id="cb119-1093"><a href="#cb119-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1094"><a href="#cb119-1094" aria-hidden="true" tabindex="-1"></a>$$P(Y_i \gt j) = \frac{\mathrm{exp}(\hat{y}_i)}{1 + \mathrm{exp}(\hat{y}_i)}.$$</span>
<span id="cb119-1095"><a href="#cb119-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1096"><a href="#cb119-1096" aria-hidden="true" tabindex="-1"></a>The exponential of $\beta$ is the odds ratio of $x_1^\mathrm{T} - x_0^\mathrm{T}$. Solve this for the odds ratio </span>
<span id="cb119-1097"><a href="#cb119-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1098"><a href="#cb119-1098" aria-hidden="true" tabindex="-1"></a>$$\mathrm{OR} = \frac{\mathrm{exp}(\theta_j - x_1^\mathrm{T}\beta)}{\mathrm{exp}(\theta_j - x_2^\mathrm{T}\beta)} = \mathrm{exp}(\beta(x_1^\mathrm{T} - x_0^\mathrm{T}))$$</span>
<span id="cb119-1099"><a href="#cb119-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1100"><a href="#cb119-1100" aria-hidden="true" tabindex="-1"></a>If $x$ is a binary factor factor, then $\exp(\beta)$ is the odds ratio of $x=1$ vs $x=0$. Thus the odds-ratio is *proportional* to the difference between values of $x$ and $\beta$ is the constant of proportionality.</span>
<span id="cb119-1101"><a href="#cb119-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1102"><a href="#cb119-1102" aria-hidden="true" tabindex="-1"></a>The model is estimated with a regularized Newton-Raphson algorithm with step-halving (line search) using analytic expressions for the gradient and Hessian of the negative log-likelihood function. This is beyond me, but the upshot is that the estimation is an iterative maximization exercise, not a formulaic matrix algebra process. It is possible for the model estimation to fail to converge on a maximum.</span>
<span id="cb119-1103"><a href="#cb119-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1104"><a href="#cb119-1104" aria-hidden="true" tabindex="-1"></a>You will sometimes encounter discussion about the *latent variable*. That is just the underlying quality you are trying to measure. If you rate something a 4 on a 5-level Likert scale, 4 is the expression of your valuation, the latent variable. Your precise valuation is somewhere between 3 and 5 on a continuous scale. The link function defines the distribution of the latent variable.</span>
<span id="cb119-1105"><a href="#cb119-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1106"><a href="#cb119-1106" aria-hidden="true" tabindex="-1"></a>There are variations on the ordinal model. Structured thresholds impose restrictions on $\theta_j$, for example requiring equal distances between levels. Partial proportional odds allow $\theta_j$ to vary with nominal predictors. You can also use link functions other than logit.</span>
<span id="cb119-1107"><a href="#cb119-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1108"><a href="#cb119-1108" aria-hidden="true" tabindex="-1"></a>There are two assumptions underling ordinal logistic regression: (a) no multicollinearity, and (b) proportional odds.</span>
<span id="cb119-1109"><a href="#cb119-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1110"><a href="#cb119-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">### Case Study {.unnumbered #cs3}</span></span>
<span id="cb119-1111"><a href="#cb119-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1112"><a href="#cb119-1112" aria-hidden="true" tabindex="-1"></a>This case study uses the <span class="co">[</span><span class="ot">Laerd Statistics</span><span class="co">](https://statistics.laerd.com/)</span> article on ordinal logistic regression <span class="co">[</span><span class="ot">data set</span><span class="co">](https://statistics.laerd.com/premium/spss/spss-files/ordinal-logistic-regression.sav)</span>. A study investigates the relationship between attitude toward tax levels and participant values and background. 192 participants in a study responded to the statement "Taxes are too high" on a 4-level Likert scale (<span class="in">`tax_too_high`</span>, *Strongly Disagree*, *Disagree*, *Agree*, *Strongly Agree*). Participant attributes include business owner (*Y*|*N*), age, and political affiliation (*Liberal*, *Conservative*, *Labor*). </span>
<span id="cb119-1113"><a href="#cb119-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1116"><a href="#cb119-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1117"><a href="#cb119-1117" aria-hidden="true" tabindex="-1"></a>cs3 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-1118"><a href="#cb119-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1119"><a href="#cb119-1119" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.spss</span>(<span class="st">"./input/ordinal-logistic-regression.sav"</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1120"><a href="#cb119-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_too_high =</span> <span class="fu">factor</span>(tax_too_high, <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb119-1121"><a href="#cb119-1121" aria-hidden="true" tabindex="-1"></a>         <span class="at">biz_owner =</span> <span class="fu">fct_relevel</span>(biz_owner, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb119-1122"><a href="#cb119-1122" aria-hidden="true" tabindex="-1"></a>         <span class="at">politics =</span> <span class="fu">fct_relevel</span>(politics, <span class="st">"Lab"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1123"><a href="#cb119-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(biz_friends, uni_educated, income))</span>
<span id="cb119-1124"><a href="#cb119-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1125"><a href="#cb119-1125" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb119-1126"><a href="#cb119-1126" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb119-1127"><a href="#cb119-1127" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> politics, </span>
<span id="cb119-1128"><a href="#cb119-1128" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean} ({sd})"</span>)</span>
<span id="cb119-1129"><a href="#cb119-1129" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-1130"><a href="#cb119-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1131"><a href="#cb119-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1132"><a href="#cb119-1132" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb119-1133"><a href="#cb119-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1136"><a href="#cb119-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1137"><a href="#cb119-1137" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb119-1138"><a href="#cb119-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">case_when</span>(age <span class="sc">&lt;</span> <span class="fu">quantile</span>(age, .<span class="dv">33</span>) <span class="sc">~</span> <span class="st">"young"</span>,</span>
<span id="cb119-1139"><a href="#cb119-1139" aria-hidden="true" tabindex="-1"></a>                         age <span class="sc">&lt;</span> <span class="fu">quantile</span>(age, .<span class="dv">67</span>) <span class="sc">~</span> <span class="st">"middle"</span>,</span>
<span id="cb119-1140"><a href="#cb119-1140" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"old"</span>),</span>
<span id="cb119-1141"><a href="#cb119-1141" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"young"</span>, <span class="st">"middle"</span>, <span class="st">"old"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb119-1142"><a href="#cb119-1142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(tax_too_high, biz_owner, age, politics) <span class="sc">%&gt;%</span></span>
<span id="cb119-1143"><a href="#cb119-1143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tax_too_high, <span class="at">y =</span> n, <span class="at">fill =</span> biz_owner)) <span class="sc">+</span></span>
<span id="cb119-1144"><a href="#cb119-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">"single"</span>)) <span class="sc">+</span></span>
<span id="cb119-1145"><a href="#cb119-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(age), <span class="at">cols =</span> <span class="fu">vars</span>(politics), <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb119-1146"><a href="#cb119-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span> (x) <span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb119-1147"><a href="#cb119-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb119-1148"><a href="#cb119-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb119-1149"><a href="#cb119-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Taxes too high?"</span>,</span>
<span id="cb119-1150"><a href="#cb119-1150" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Reponse count by business owner, age, and politics."</span>)</span>
<span id="cb119-1151"><a href="#cb119-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1152"><a href="#cb119-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1153"><a href="#cb119-1153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit the Model {-}</span></span>
<span id="cb119-1154"><a href="#cb119-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1155"><a href="#cb119-1155" aria-hidden="true" tabindex="-1"></a>Fit a cumulative link model for the cumulative probability of the $i$th response falling in $j$th category or below where $i$ indexes the ($n = 192$) responses, $j = 1, \ldots, J$ indexes the ($J = 4$) response categories, and $\theta_j$ is the threshold for the $j$th cumulative logit.</span>
<span id="cb119-1156"><a href="#cb119-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1157"><a href="#cb119-1157" aria-hidden="true" tabindex="-1"></a>$$\mathrm{logit}(P(Y_i \le j)) = \theta_j - \beta_1(\mathrm{politics}_i) - \beta_2(\mathrm{biz<span class="sc">\_</span>owner}_i) - \beta_3(\mathrm{age}_i)$$</span>
<span id="cb119-1158"><a href="#cb119-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1161"><a href="#cb119-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1162"><a href="#cb119-1162" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>fmla <span class="ot">&lt;-</span> <span class="fu">formula</span>(tax_too_high <span class="sc">~</span> biz_owner <span class="sc">+</span> age <span class="sc">+</span> politics)</span>
<span id="cb119-1163"><a href="#cb119-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1164"><a href="#cb119-1164" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>result <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(cs3<span class="sc">$</span>fmla, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb119-1165"><a href="#cb119-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1166"><a href="#cb119-1166" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb119-1167"><a href="#cb119-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1168"><a href="#cb119-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1169"><a href="#cb119-1169" aria-hidden="true" tabindex="-1"></a>The summary object shows several fit statistics. More about these in the fit evaluation section below. The Coefficients table is the familiar parameter estimates. The coefficient estimate for <span class="in">`biz_ownerYes`</span> is <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "Estimate"] %&gt;% comma(.001)`</span> with standard error <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "Std. Error"] %&gt;% comma(.001)`</span>, $z = \hat{\beta} / se =$ <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "z value"] %&gt;% comma(.001)`</span>, and $p = 2 \cdot P(Z&gt;z) =$ <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "Pr(&gt;|z|)"] %&gt;% comma(.001)`</span>. Some programs (e.g., SPSS) also show the Wald chi-squared statistic, $z^2 =$ <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "z value"]^2 %&gt;% comma(.001)`</span>. The square of a normal variable has a $\chi^2$ distribution, so the *p* value for the Wald chi-squared statistic is <span class="in">`pchisq(z^2, df = 1)`</span> = <span class="in">`r coef(summary(cs3$result))["biz_ownerYes", "z value"]^2 %&gt;% pchisq(df = 1, lower.tail = FALSE) %&gt;% comma(.001)`</span>.</span>
<span id="cb119-1170"><a href="#cb119-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1171"><a href="#cb119-1171" aria-hidden="true" tabindex="-1"></a>The Threshold coefficients table are the intercepts, or cut-points. The first cut-point is the log-odds of response level *Strongly Disagree* (or less) vs greater than *Strongly Disagree* when all factor variables are at their reference level and the continuous vars are at 0.</span>
<span id="cb119-1172"><a href="#cb119-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1173"><a href="#cb119-1173" aria-hidden="true" tabindex="-1"></a>There may be interaction effects between <span class="in">`biz_owner`</span> and <span class="in">`politics`</span>. You can check this by comparing the log likelihood to the saturated model with a likelihood ratio test.</span>
<span id="cb119-1174"><a href="#cb119-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1177"><a href="#cb119-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1178"><a href="#cb119-1178" aria-hidden="true" tabindex="-1"></a>saturated <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(tax_too_high <span class="sc">~</span> biz_owner<span class="sc">*</span>politics <span class="sc">+</span> age, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb119-1179"><a href="#cb119-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1180"><a href="#cb119-1180" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>sat_anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, saturated))</span>
<span id="cb119-1181"><a href="#cb119-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1182"><a href="#cb119-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1183"><a href="#cb119-1183" aria-hidden="true" tabindex="-1"></a>The likelihood ratio test indicates the main-effects model fits about the same as the saturated model, $\chi^2$(<span class="in">`r cs3$sat_anova["saturated", "df"]`</span>) = <span class="in">`r cs3$sat_anova["saturated", "LR.stat"] %&gt;% comma(.01)`</span>, *p* = <span class="in">`r cs3$sat_anova["saturated", "Pr(&gt;Chisq)"] %&gt;% comma(.001)`</span>)</span>
<span id="cb119-1184"><a href="#cb119-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1185"><a href="#cb119-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assumptions {-}</span></span>
<span id="cb119-1186"><a href="#cb119-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1187"><a href="#cb119-1187" aria-hidden="true" tabindex="-1"></a>Cumulative odds ordinal logistic regression with proportional odds models require a) no multicollinearity, and b) proportional odds.</span>
<span id="cb119-1188"><a href="#cb119-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1189"><a href="#cb119-1189" aria-hidden="true" tabindex="-1"></a>**Multicollinearity** occurs when two or more independent variables are *highly correlated* so that they do not provide unique or independent information in the regression model. Multicollinearity inflates the variances of the estimated coefficients, resulting in larger confidence intervals. The usual interpretation of a slope coefficient as the change in the mean response per unit increase in the predictor when all the other predictors are held constant breaks down because changing one predictor *necessarily* changes other predictors.</span>
<span id="cb119-1190"><a href="#cb119-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1191"><a href="#cb119-1191" aria-hidden="true" tabindex="-1"></a>Test for multicollinearity with variance inflation factors (VIF). The VIF is the inflation percentage of the parameter variance due to multicollinearity. E.g., a VIF of 1.9 means the parameter variance is 90% larger than what it would be if it was not correlated with other predictors.</span>
<span id="cb119-1192"><a href="#cb119-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1193"><a href="#cb119-1193" aria-hidden="true" tabindex="-1"></a>Predictor k's variance, $Var(\hat{\beta_k})$, is inflated by a factor of</span>
<span id="cb119-1194"><a href="#cb119-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1195"><a href="#cb119-1195" aria-hidden="true" tabindex="-1"></a>$$\mathrm{VIF}_k = \frac{1}{1 - R_k^2}$$</span>
<span id="cb119-1196"><a href="#cb119-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1197"><a href="#cb119-1197" aria-hidden="true" tabindex="-1"></a>due to collinearity with other predictors, where $R_k^2$ is the $R^2$ of a regression of the $k^{th}$ predictor on the remaining predictors. If predictor $k$ is unrelated to the other variables, $R_k^2 = 0$ and $VIF = 1$ (no variance inflation). If 100% of the variance in predictor $k$ is explained by the other predictors, then $R_k^2 = 1$ and $VIF = \infty$. The rule of thumb is that $VIF \le 5$ is acceptable.</span>
<span id="cb119-1198"><a href="#cb119-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1201"><a href="#cb119-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1202"><a href="#cb119-1202" aria-hidden="true" tabindex="-1"></a><span class="co"># Cannot use CLM model with vif(). Re-express as a linear model.</span></span>
<span id="cb119-1203"><a href="#cb119-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">as.numeric</span>(tax_too_high) <span class="sc">~</span> politics <span class="sc">+</span> biz_owner <span class="sc">+</span> age, <span class="at">dat =</span> cs3<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb119-1204"><a href="#cb119-1204" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">vif</span>()</span>
<span id="cb119-1205"><a href="#cb119-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1206"><a href="#cb119-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1207"><a href="#cb119-1207" aria-hidden="true" tabindex="-1"></a>The VIFs in column GVIF are all below 5, so this model is not compromised by multicollinearity.</span>
<span id="cb119-1208"><a href="#cb119-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1209"><a href="#cb119-1209" aria-hidden="true" tabindex="-1"></a>The **proportional odds** assumption means the independent variable effects are constant across each cumulative split of the ordinal dependent variable. Test for proportional odds using a full <span class="co">[</span><span class="ot">likelihood ratio test</span><span class="co">](https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-are-the-likelihood-ratio-wald-and-lagrange-multiplier-score-tests-different-andor-similar/)</span> comparing the proportional odds model with a multinomial logit model, also called an unconstrained baseline logit model. This is also called the *test of parallel lines*. The multinomial logit model fits a slope to each of the $J – 1$ levels. The proportional odds model is nested within the multinomial model, so you can use a likelihood ratio test to see if the models are statistically different. Fit the proportional odds model and a multinomial model using <span class="in">`VGAM::vglm()`</span> and capture the log likelihoods and degrees of freedom. Perform a likelihood ratio test on the differences in log likelihoods, $D = -2 \mathrm{loglik}(\beta)$.</span>
<span id="cb119-1210"><a href="#cb119-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1213"><a href="#cb119-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1214"><a href="#cb119-1214" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>vglm_ordinal     <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">vglm</span>(cs3<span class="sc">$</span>fmla, VGAM<span class="sc">::</span>propodds,   <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb119-1215"><a href="#cb119-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1216"><a href="#cb119-1216" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>vglm_multinomial <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">vglm</span>(cs3<span class="sc">$</span>fmla, VGAM<span class="sc">::</span>cumulative, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb119-1217"><a href="#cb119-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1218"><a href="#cb119-1218" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>po_lrt <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">lrtest</span>(cs3<span class="sc">$</span>vglm_multinomial, cs3<span class="sc">$</span>vglm_ordinal))</span>
<span id="cb119-1219"><a href="#cb119-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1220"><a href="#cb119-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1221"><a href="#cb119-1221" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters, $\chi^2$(8) = </span><span class="in">`r cs3$po_lrt %&gt;% slot("Body") %&gt;% tail(1) %&gt;% pull(Chisq) %&gt;% scales::number(accuracy = .001)`</span><span class="at">, *p* = </span><span class="in">`r cs3$po_lrt %&gt;% slot("Body") %&gt;% tail(1) %&gt;% pull("Pr(&gt;Chisq)") %&gt;% scales::number(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1222"><a href="#cb119-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1223"><a href="#cb119-1223" aria-hidden="true" tabindex="-1"></a>Another option is the partial proportional odds test. This test locates specific variables causing the rejection of proportional odds.</span>
<span id="cb119-1224"><a href="#cb119-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1227"><a href="#cb119-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1228"><a href="#cb119-1228" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>po_lrt2 <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(cs3<span class="sc">$</span>fmla, <span class="at">data =</span> cs3<span class="sc">$</span>dat) <span class="sc">%&gt;%</span> ordinal<span class="sc">::</span><span class="fu">nominal_test</span>())</span>
<span id="cb119-1229"><a href="#cb119-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1230"><a href="#cb119-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1231"><a href="#cb119-1231" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters for business owner, $\chi^2$(</span><span class="in">`r cs3$po_lrt2["biz_owner", "Df"]`</span><span class="at">) = </span><span class="in">`r cs3$po_lrt2["biz_owner", "LRT"] %&gt;% comma(.001)`</span><span class="at">, *p* = `r cs3$po_lrt2["biz_owner", "Pr(&gt;Chi)"] %&gt;% comma(.001)` and politics, $\chi^2$(`r cs3$po_lrt2["politics", "Df"]`) = `r cs3$po_lrt2["politics", "LRT"] %&gt;% comma(.001)`, *p* = </span><span class="in">`r cs3$po_lrt2["politics", "Pr(&gt;Chi)"] %&gt;% comma(.001)`</span><span class="at">.</span></span>
<span id="cb119-1232"><a href="#cb119-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1233"><a href="#cb119-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluate the Fit {-}</span></span>
<span id="cb119-1234"><a href="#cb119-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1235"><a href="#cb119-1235" aria-hidden="true" tabindex="-1"></a>There are three ways to assess overall model fit: The Deviance and Pearson goodness-of-fit tests of the overall model fit; the Cox and Snell, Nagelkerke, and McFadden pseudo R measures of explained variance; and the likelihood ratio test comparing the model fit to the intercept-only model. However, these tests rely on large frequencies in each *cell*, that is, each possible combination of predictor values. Overall goodness-of-fit statistics should be treated with suspicion when a continuous independent variable is present and/or there are a large number of cells with zero frequency.</span>
<span id="cb119-1236"><a href="#cb119-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1237"><a href="#cb119-1237" aria-hidden="true" tabindex="-1"></a>The **Pearson goodness-of-fit** statistic is $X^2 = \sum \frac{(O_{ij} - E_{ij})^2}{E_{ij}}$ where $i$ is the observation number and $j$ is the response variable level. It is a summary of the Pearson residuals, the difference between the observed and expected cell counts, $O_{ij} - E_{ij}$. The **deviance goodness-of-fit** statistic is the difference in fit between the model and a full model; a full model being a model that fits the data perfectly, $G^2 = 2 \sum_{ij} O_{ij} \log \left( \frac{O_{ij}}{E_{ij}} \right)$. Neither of these tests are reliable if there are many cells with zero frequencies and/or small expected frequencies and are generally not recommended. Generally, the chi-squared test requires a frequency count of at least 5 per cell. </span>
<span id="cb119-1238"><a href="#cb119-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1241"><a href="#cb119-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1242"><a href="#cb119-1242" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed combinations of model vars</span></span>
<span id="cb119-1243"><a href="#cb119-1243" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>cell_patterns <span class="ot">&lt;-</span> </span>
<span id="cb119-1244"><a href="#cb119-1244" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb119-1245"><a href="#cb119-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1246"><a href="#cb119-1246" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed combinations of predictor vars * levels of response var</span></span>
<span id="cb119-1247"><a href="#cb119-1247" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>covariate_patterns <span class="ot">&lt;-</span> </span>
<span id="cb119-1248"><a href="#cb119-1248" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb119-1249"><a href="#cb119-1249" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>possible_cells <span class="ot">&lt;-</span> </span>
<span id="cb119-1250"><a href="#cb119-1250" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>covariate_patterns <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">levels</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high))</span>
<span id="cb119-1251"><a href="#cb119-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1252"><a href="#cb119-1252" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - ratio of observed to possible</span></span>
<span id="cb119-1253"><a href="#cb119-1253" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>pct_freq_zero <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> cs3<span class="sc">$</span>cell_patterns <span class="sc">/</span> cs3<span class="sc">$</span>possible_cells</span>
<span id="cb119-1254"><a href="#cb119-1254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1255"><a href="#cb119-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1256"><a href="#cb119-1256" aria-hidden="true" tabindex="-1"></a>There are <span class="in">`r cs3$cell_patterns`</span> observed combinations of model variables (predictors), and <span class="in">`r cs3$possible_cells`</span> possible combinations (predictors * outcome levels), so <span class="in">`r cs3$pct_freq_zero %&gt;% scales::percent(accuracy = .1)`</span> of cells have zero frequencies. Ideally, zero frequencies should be less than 20%, so if you were to use the deviance or Pearson tests, you would need to report this. The results below are contradictory and bogus. I think you'd only use this test if you didn't have continuous predictor variables.</span>
<span id="cb119-1257"><a href="#cb119-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1260"><a href="#cb119-1260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1261"><a href="#cb119-1261" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb119-1262"><a href="#cb119-1262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span></span>
<span id="cb119-1263"><a href="#cb119-1263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> tax_too_high, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1264"><a href="#cb119-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb119-1265"><a href="#cb119-1265" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, </span>
<span id="cb119-1266"><a href="#cb119-1266" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"outcome"</span>, </span>
<span id="cb119-1267"><a href="#cb119-1267" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"observed"</span></span>
<span id="cb119-1268"><a href="#cb119-1268" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb119-1269"><a href="#cb119-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1270"><a href="#cb119-1270" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb119-1271"><a href="#cb119-1271" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>dat, </span>
<span id="cb119-1272"><a href="#cb119-1272" aria-hidden="true" tabindex="-1"></a>  cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">newdata =</span> cs3<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="st">"tax_too_high"</span>)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb119-1273"><a href="#cb119-1273" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1274"><a href="#cb119-1274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">"fit</span><span class="sc">\\</span><span class="st">."</span>), <span class="fu">starts_with</span>(<span class="st">"fit"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1275"><a href="#cb119-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1276"><a href="#cb119-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.by =</span> <span class="fu">c</span>(biz_owner, age, politics), </span>
<span id="cb119-1277"><a href="#cb119-1277" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, sum)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1278"><a href="#cb119-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">"outcome"</span>, <span class="at">values_to =</span> <span class="st">"expected"</span>)</span>
<span id="cb119-1279"><a href="#cb119-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1280"><a href="#cb119-1280" aria-hidden="true" tabindex="-1"></a>obs_exp <span class="ot">&lt;-</span> observed <span class="sc">%&gt;%</span></span>
<span id="cb119-1281"><a href="#cb119-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(expected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"politics"</span>, <span class="st">"biz_owner"</span>, <span class="st">"age"</span>, <span class="st">"outcome"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1282"><a href="#cb119-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epsilon_sq =</span> (observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb119-1283"><a href="#cb119-1283" aria-hidden="true" tabindex="-1"></a>         <span class="at">chi_sq =</span> epsilon_sq <span class="sc">/</span> expected,</span>
<span id="cb119-1284"><a href="#cb119-1284" aria-hidden="true" tabindex="-1"></a>         <span class="at">g_sq =</span> <span class="dv">2</span> <span class="sc">*</span> observed <span class="sc">*</span> <span class="fu">log</span>((observed<span class="fl">+.0001</span>) <span class="sc">/</span> expected)</span>
<span id="cb119-1285"><a href="#cb119-1285" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb119-1286"><a href="#cb119-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1287"><a href="#cb119-1287" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-1288"><a href="#cb119-1288" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>chi_sq)</span>
<span id="cb119-1289"><a href="#cb119-1289" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>g_sq)</span>
<span id="cb119-1290"><a href="#cb119-1290" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>df <span class="ot">=</span> cs3<span class="sc">$</span>covariate_patterns <span class="sc">*</span> (<span class="fu">length</span>(<span class="fu">levels</span>(cs3<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">7</span></span>
<span id="cb119-1291"><a href="#cb119-1291" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(cs3<span class="sc">$</span>chisq<span class="sc">$</span>X2, <span class="at">df =</span> cs3<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-1292"><a href="#cb119-1292" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(cs3<span class="sc">$</span>chisq<span class="sc">$</span>G2, <span class="at">df =</span> cs3<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-1293"><a href="#cb119-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1294"><a href="#cb119-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1295"><a href="#cb119-1295" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The Pearson goodness-of-fit test indicated that the model was *not* a good fit to the observed data, $\chi^2$(`r cs3$chisq$df`) = `r cs3$chisq$X2 %&gt;% scales::comma(accuracy = 0.1)`, *p* &lt; .001$. The deviance goodness-of-fit test indicated that the model was a good fit to the observed data, $G^2$(`r cs3$chisq$df`) = `r cs3$chisq$G2 %&gt;% scales::comma(accuracy = 0.1)`, *p* = </span><span class="in">`r cs3$chisq$G2_p.value %&gt;% scales::comma(accuracy = 0.001)`</span><span class="at">. </span></span>
<span id="cb119-1296"><a href="#cb119-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1297"><a href="#cb119-1297" aria-hidden="true" tabindex="-1"></a>There are a number of measures in ordinal regression that attempt to provide a similar "variance explained" measure as that provided in ordinary least-squares linear regression. However, these measures do not have the direct interpretation that they do in ordinary linear regression and are often, therefore, referred to as **"pseudo" R2 measures**. The three most common measures (Cox and Snell, Nagelkerke, and McFadden) are not particularly good and not universally used. It is presented in the SPSS output, so you might encounter it in published work.</span>
<span id="cb119-1298"><a href="#cb119-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1301"><a href="#cb119-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1302"><a href="#cb119-1302" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>nagelkerke <span class="ot">&lt;-</span> rcompanion<span class="sc">::</span><span class="fu">nagelkerke</span>(cs3<span class="sc">$</span>result)</span>
<span id="cb119-1303"><a href="#cb119-1303" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>nagelkerke<span class="sc">$</span>Pseudo.R.squared.for.model.vs.null</span>
<span id="cb119-1304"><a href="#cb119-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1305"><a href="#cb119-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1306"><a href="#cb119-1306" aria-hidden="true" tabindex="-1"></a>The best way to assess model fit is the **likelihood ratio test** comparing the model to an intercept-only model. The difference in the -2 log likelihood between the models has a $\chi^2$ distribution with degrees of freedom equal to the difference in the number of parameters.</span>
<span id="cb119-1307"><a href="#cb119-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1310"><a href="#cb119-1310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1311"><a href="#cb119-1311" aria-hidden="true" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span> ordinal<span class="sc">::</span><span class="fu">clm</span>(tax_too_high <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs3<span class="sc">$</span>dat)</span>
<span id="cb119-1312"><a href="#cb119-1312" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>lrt <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, intercept_only)</span>
<span id="cb119-1313"><a href="#cb119-1313" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>lrt</span>
<span id="cb119-1314"><a href="#cb119-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1315"><a href="#cb119-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1316"><a href="#cb119-1316" aria-hidden="true" tabindex="-1"></a>The table shows the log likelihoods of the two models. LR.stat is the difference between 2 * the logLik values.</span>
<span id="cb119-1317"><a href="#cb119-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1318"><a href="#cb119-1318" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The final model statistically significantly predicted the dependent variable over and above the intercept-only model, $\chi^2(4)$ = </span><span class="in">`r cs3$lrt$LR.stat[2] %&gt;% comma(.1)`</span><span class="at">, *p* = </span><span class="in">`r cs3$lrt[[6]][2] %&gt;% comma(.001)`</span><span class="at">.</span></span>
<span id="cb119-1319"><a href="#cb119-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1320"><a href="#cb119-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpret Results {-}</span></span>
<span id="cb119-1321"><a href="#cb119-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1322"><a href="#cb119-1322" aria-hidden="true" tabindex="-1"></a>Return to the model summary. </span>
<span id="cb119-1323"><a href="#cb119-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1326"><a href="#cb119-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1327"><a href="#cb119-1327" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(cs3<span class="sc">$</span>clm)</span>
<span id="cb119-1328"><a href="#cb119-1328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1329"><a href="#cb119-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1330"><a href="#cb119-1330" aria-hidden="true" tabindex="-1"></a>The coefficients for <span class="in">`biz_owner`</span>, <span class="in">`age`</span>, and politics are positive. Positive parameters *increase* the likelihood of stronger agreement with the statement. In this case, discontent with taxes are higher for business owners, increase with age, and are higher for Liberal Democrats and Conservatives relative to the Labor Party. The expected cumulative log-odds of declaring $\le j$ level of agreement with the statement for the baseline group (<span class="in">`biz_ownerNo`</span>, <span class="in">`age = 0`</span>, <span class="in">`politicsLib`</span>) is <span class="in">`r cs3$clm$coefficients["Strongly Disagree|Disagree"] %&gt;% scales::comma(accuracy = .001)`</span> for $j = 1$ (Strongly Disagree), <span class="in">`r cs3$clm$coefficients["Disagree|Agree"] %&gt;% scales::comma(accuracy = .001)`</span> for $j = 2$ (Disagree), and <span class="in">`r cs3$clm$coefficients["Agree|Strongly Agree"] %&gt;% scales::comma(accuracy = .001)`</span> for $j = 3$ (Agree). </span>
<span id="cb119-1331"><a href="#cb119-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1332"><a href="#cb119-1332" aria-hidden="true" tabindex="-1"></a>You could solve the logit equation for </span>
<span id="cb119-1333"><a href="#cb119-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1334"><a href="#cb119-1334" aria-hidden="true" tabindex="-1"></a>$$\pi_j = \frac{\mathrm{exp}(Y_i)} {1 + \mathrm{exp}(Y_i)}$$</span>
<span id="cb119-1335"><a href="#cb119-1335" aria-hidden="true" tabindex="-1"></a>to get the cumulative probabilities for each level. That's what <span class="in">`predict(type = "cum.prob")`</span> does. But it might be more intuitive to work with individual probabilities, the lagged differences to get the individual probabilities for each $j$. That's what <span class="in">`predict(type = "prob")`</span> does. I like to play with predicted values to get a sense of the outcome distributions. In this case, I'll take the median <span class="in">`age`</span>, and each combination of <span class="in">`biz_owner`</span> and <span class="in">`politics`</span>.</span>
<span id="cb119-1336"><a href="#cb119-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1337"><a href="#cb119-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height=2.5, fig.width=6.5}</span></span>
<span id="cb119-1338"><a href="#cb119-1338" aria-hidden="true" tabindex="-1"></a><span class="in">new_data &lt;- cs3$dat %&gt;% </span></span>
<span id="cb119-1339"><a href="#cb119-1339" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(age = median(cs3$dat$age)) %&gt;% </span></span>
<span id="cb119-1340"><a href="#cb119-1340" aria-hidden="true" tabindex="-1"></a><span class="in">  expand(age, politics, biz_owner)</span></span>
<span id="cb119-1341"><a href="#cb119-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1342"><a href="#cb119-1342" aria-hidden="true" tabindex="-1"></a><span class="in">preds &lt;- predict(cs3$result, newdata = new_data, type = "prob")[["fit"]] %&gt;% as.data.frame()</span></span>
<span id="cb119-1343"><a href="#cb119-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1344"><a href="#cb119-1344" aria-hidden="true" tabindex="-1"></a><span class="in">bind_cols(new_data, preds) %&gt;%</span></span>
<span id="cb119-1345"><a href="#cb119-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = `Strongly Disagree`:`Strongly Agree`) %&gt;% </span></span>
<span id="cb119-1346"><a href="#cb119-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = factor(name, levels = levels(cs3$dat$tax_too_high))) %&gt;%</span></span>
<span id="cb119-1347"><a href="#cb119-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = politics, x = value, fill = fct_rev(name))) +</span></span>
<span id="cb119-1348"><a href="#cb119-1348" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col() +</span></span>
<span id="cb119-1349"><a href="#cb119-1349" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = scales::percent(value, accuracy = 1)), </span></span>
<span id="cb119-1350"><a href="#cb119-1350" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 3, position = position_stack(vjust=0.5)) +</span></span>
<span id="cb119-1351"><a href="#cb119-1351" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~paste("Bus Owner = ", biz_owner)) +</span></span>
<span id="cb119-1352"><a href="#cb119-1352" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_grey(start = 0.5, end = 0.8) +</span></span>
<span id="cb119-1353"><a href="#cb119-1353" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + </span></span>
<span id="cb119-1354"><a href="#cb119-1354" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top",</span></span>
<span id="cb119-1355"><a href="#cb119-1355" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_blank(),</span></span>
<span id="cb119-1356"><a href="#cb119-1356" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank()) +</span></span>
<span id="cb119-1357"><a href="#cb119-1357" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_legend(reverse = TRUE)) +</span></span>
<span id="cb119-1358"><a href="#cb119-1358" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Taxes too High for Conservative Business Owners?", </span></span>
<span id="cb119-1359"><a href="#cb119-1359" aria-hidden="true" tabindex="-1"></a><span class="in">       x = NULL, fill = NULL)</span></span>
<span id="cb119-1360"><a href="#cb119-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1361"><a href="#cb119-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1362"><a href="#cb119-1362" aria-hidden="true" tabindex="-1"></a>You will want to establish whether <span class="in">`politics`</span> is statistically significant overall before exploring any specific contrasts. The ANOVA procedure with type I test reports an overall test of significance for each variable entered into the model.</span>
<span id="cb119-1363"><a href="#cb119-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1366"><a href="#cb119-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1367"><a href="#cb119-1367" aria-hidden="true" tabindex="-1"></a>(cs3<span class="sc">$</span>anovaI <span class="ot">&lt;-</span> <span class="fu">anova</span>(cs3<span class="sc">$</span>result, <span class="at">type =</span> <span class="st">"I"</span>))</span>
<span id="cb119-1368"><a href="#cb119-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1369"><a href="#cb119-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1370"><a href="#cb119-1370" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald $\chi^2$(</span><span class="in">`r cs3$anovaI$Df[3]`</span><span class="at">) = </span><span class="in">`r cs3$anovaI$Chisq[3] %&gt;% scales::comma(accuracy = .1)`</span><span class="at">, *p* = </span><span class="in">`r cs3$anovaI[[3]][3] %&gt;% scales::comma(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1371"><a href="#cb119-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1372"><a href="#cb119-1372" aria-hidden="true" tabindex="-1"></a>The best way to work with the data is with the <span class="in">`tidy(exponentiate = TRUE)`</span> version. </span>
<span id="cb119-1373"><a href="#cb119-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1376"><a href="#cb119-1376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1377"><a href="#cb119-1377" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>tidy <span class="ot">&lt;-</span> cs3<span class="sc">$</span>result <span class="sc">%&gt;%</span> <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-1378"><a href="#cb119-1378" aria-hidden="true" tabindex="-1"></a>cs3<span class="sc">$</span>tidy</span>
<span id="cb119-1379"><a href="#cb119-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1380"><a href="#cb119-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1381"><a href="#cb119-1381" aria-hidden="true" tabindex="-1"></a>Then you can summarize the table in words.</span>
<span id="cb119-1382"><a href="#cb119-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1383"><a href="#cb119-1383" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The odds of business owners considering tax to be too high was </span><span class="in">`r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> (95% CI, </span><span class="in">`r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> to </span><span class="in">`r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">) times that of non-business owners, a statistically significant effect, *z* = `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = </span><span class="in">`r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1384"><a href="#cb119-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1385"><a href="#cb119-1385" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The odds of Conservative voters considering tax to be too high was </span><span class="in">`r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> (95% CI, </span><span class="in">`r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> to </span><span class="in">`r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">) times that of Labour voters, a statistically significant effect, *z* = `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)` (95% CI, `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)` to `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`), *p* = </span><span class="in">`r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1386"><a href="#cb119-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1387"><a href="#cb119-1387" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of </span><span class="in">`r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> (95% CI, </span><span class="in">`r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)`</span><span class="at"> to </span><span class="in">`r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">), *z* = `r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = </span><span class="in">`r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1388"><a href="#cb119-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1389"><a href="#cb119-1389" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting {-}</span></span>
<span id="cb119-1390"><a href="#cb119-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1391"><a href="#cb119-1391" aria-hidden="true" tabindex="-1"></a>Here is the complete write-up.</span>
<span id="cb119-1392"><a href="#cb119-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1393"><a href="#cb119-1393" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; A cumulative odds ordinal logistic regression with proportional odds was run to determine the effect of business ownership, political party voted for, and age, on the belief that taxes are too high. There were proportional odds, as assessed by a full likelihood ratio test comparing the fitted model to a model with varying location parameters, $\chi^2$(8) = </span><span class="in">`r cs3$po_lrt %&gt;% slot("Body") %&gt;% tail(1) %&gt;% pull(Chisq) %&gt;% scales::number(accuracy = .001)`</span><span class="at">, *p* = `r cs3$po_lrt %&gt;% slot("Body") %&gt;% tail(1) %&gt;% pull("Pr(&gt;Chisq)") %&gt;% scales::number(accuracy = .001)`. The final model statistically significantly predicted the dependent variable over and above the intercept-only model, $\chi^2(4)$ = `r cs3$lrt$LR.stat[2] %&gt;% scales::comma(accuracy = .1)`, *p* = `r cs3$lrt[[6]][2] %&gt;% scales::comma(accuracy = .001)`. The odds of business owners considering tax to be too high was `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)` (95% CI, `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)` to `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`) times that of non-business owners, a statistically significant effect, *z* = `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = `r cs3$tidy %&gt;% filter(term == "biz_ownerYes") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`. The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald $\chi^2$(`r cs3$anovaI$Df[3]`) = `r cs3$anovaI$Chisq[3] %&gt;% scales::comma(accuracy = .1)`, *p* = `r cs3$anovaI[[3]][3] %&gt;% scales::comma(accuracy = .001)`. The odds of Conservative voters considering tax to be too high was `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)` (95% CI, `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)` to `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`) times that of Labour voters, a statistically significant effect, *z* = `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = `r cs3$tidy %&gt;% filter(term == "politicsCon") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)` (95% CI, `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)` to `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`), *p* = `r cs3$tidy %&gt;% filter(term == "politicsLib") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`. An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of `r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(estimate) %&gt;% scales::comma(accuracy = .001)` (95% CI, `r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(conf.low) %&gt;% scales::comma(accuracy = .001)` to `r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(conf.high) %&gt;% scales::comma(accuracy = .001)`), *z* = `r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(statistic) %&gt;% scales::comma(accuracy = .001)`, *p* = </span><span class="in">`r cs3$tidy %&gt;% filter(term == "age") %&gt;% pull(p.value) %&gt;% scales::comma(accuracy = .001)`</span><span class="at">.</span></span>
<span id="cb119-1394"><a href="#cb119-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1395"><a href="#cb119-1395" aria-hidden="true" tabindex="-1"></a>Package **gtsummary** shows a nice summary table.</span>
<span id="cb119-1396"><a href="#cb119-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1399"><a href="#cb119-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb119-1400"><a href="#cb119-1400" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(cs3<span class="sc">$</span>result)</span>
<span id="cb119-1401"><a href="#cb119-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1402"><a href="#cb119-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1403"><a href="#cb119-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poisson Regression {#poissonregression}</span></span>
<span id="cb119-1404"><a href="#cb119-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1405"><a href="#cb119-1405" aria-hidden="true" tabindex="-1"></a>Poisson models count data, like "traffic tickets per day", or "website hits per day".  The response is an expected *rate* or intensity.  For count data, specify the generalized model, this time with <span class="in">`family = poisson`</span> or <span class="in">`family = quasipoisson`</span>. </span>
<span id="cb119-1406"><a href="#cb119-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1407"><a href="#cb119-1407" aria-hidden="true" tabindex="-1"></a>Recall that the probability of achieving a count $y$ when the expected rate is $\lambda$ is distributed </span>
<span id="cb119-1408"><a href="#cb119-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1409"><a href="#cb119-1409" aria-hidden="true" tabindex="-1"></a>$$P(Y = y|\lambda) = \frac{e^{-\lambda} \lambda^y}{y!}.$$</span>
<span id="cb119-1410"><a href="#cb119-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1411"><a href="#cb119-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1412"><a href="#cb119-1412" aria-hidden="true" tabindex="-1"></a>The poisson regression model is</span>
<span id="cb119-1413"><a href="#cb119-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1414"><a href="#cb119-1414" aria-hidden="true" tabindex="-1"></a>$$\lambda = \exp(X \beta).$$ </span>
<span id="cb119-1415"><a href="#cb119-1415" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb119-1416"><a href="#cb119-1416" aria-hidden="true" tabindex="-1"></a>You can solve this for $y$ to get</span>
<span id="cb119-1417"><a href="#cb119-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1418"><a href="#cb119-1418" aria-hidden="true" tabindex="-1"></a>$$y = X\beta = \ln(\lambda).$$</span>
<span id="cb119-1419"><a href="#cb119-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1420"><a href="#cb119-1420" aria-hidden="true" tabindex="-1"></a>That is, the model predicts the log of the response rate.  For a sample of size *n*, the likelihood function is</span>
<span id="cb119-1421"><a href="#cb119-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1422"><a href="#cb119-1422" aria-hidden="true" tabindex="-1"></a>$$L(\beta; y, X) = \prod_{i=1}^n \frac{e^{-\exp({X_i\beta})}\exp({X_i\beta})^{y_i}}{y_i!}.$$</span>
<span id="cb119-1423"><a href="#cb119-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1424"><a href="#cb119-1424" aria-hidden="true" tabindex="-1"></a>The log-likelihood is</span>
<span id="cb119-1425"><a href="#cb119-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1426"><a href="#cb119-1426" aria-hidden="true" tabindex="-1"></a>$$l(\beta) = \sum_{i=1}^n (y_i X_i \beta - \sum_{i=1}^n\exp(X_i\beta) - \sum_{i=1}^n\log(y_i!).$$</span>
<span id="cb119-1427"><a href="#cb119-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1428"><a href="#cb119-1428" aria-hidden="true" tabindex="-1"></a>Maximizing the log-likelihood has no closed-form solution, so the coefficient estimates are found through interatively reweighted least squares.  </span>
<span id="cb119-1429"><a href="#cb119-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1430"><a href="#cb119-1430" aria-hidden="true" tabindex="-1"></a>Poisson processes assume the variance of the response variable equals its mean.  "Equals" means the mean and variance are of a similar order of magnitude.  If that assumption does not hold, use the quasi-poisson.  Use Poisson regression for large datasets.  If the predicted counts are much greater than zero (&gt;30), the linear regression will work fine.  Whereas RMSE is not useful for logistic models, it is a good metric in Poisson.</span>
<span id="cb119-1431"><a href="#cb119-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1432"><a href="#cb119-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">### Case Study 4 {.unnumbered #cs4}</span></span>
<span id="cb119-1433"><a href="#cb119-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1434"><a href="#cb119-1434" aria-hidden="true" tabindex="-1"></a>Dataset <span class="in">`fire`</span> contains response variable <span class="in">`injuries`</span> counting the number of injuries during the month and one explanatory variable, the month <span class="in">`mo`</span>.</span>
<span id="cb119-1435"><a href="#cb119-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1436"><a href="#cb119-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1437"><a href="#cb119-1437" aria-hidden="true" tabindex="-1"></a><span class="in">fire &lt;- read_csv(file = "C:/Users/mpfol/OneDrive/Documents/Data Science/Data/CivilInjury_0.csv")</span></span>
<span id="cb119-1438"><a href="#cb119-1438" aria-hidden="true" tabindex="-1"></a><span class="in">fire &lt;- fire %&gt;% </span></span>
<span id="cb119-1439"><a href="#cb119-1439" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(mo = as.POSIXlt(`Injury Date`)$mon + 1) %&gt;%</span></span>
<span id="cb119-1440"><a href="#cb119-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(dt = `Injury Date`,</span></span>
<span id="cb119-1441"><a href="#cb119-1441" aria-hidden="true" tabindex="-1"></a><span class="in">         injuries = `Total Injuries`)</span></span>
<span id="cb119-1442"><a href="#cb119-1442" aria-hidden="true" tabindex="-1"></a><span class="in">str(fire)</span></span>
<span id="cb119-1443"><a href="#cb119-1443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1444"><a href="#cb119-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1445"><a href="#cb119-1445" aria-hidden="true" tabindex="-1"></a>In a situation like this where there the relationship is bivariate, start with a visualization.</span>
<span id="cb119-1446"><a href="#cb119-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1447"><a href="#cb119-1447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1448"><a href="#cb119-1448" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(fire, aes(x = mo, y = injuries)) +</span></span>
<span id="cb119-1449"><a href="#cb119-1449" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_jitter() +</span></span>
<span id="cb119-1450"><a href="#cb119-1450" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "glm", method.args = list(family = "poisson")) +</span></span>
<span id="cb119-1451"><a href="#cb119-1451" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Injuries by Month")</span></span>
<span id="cb119-1452"><a href="#cb119-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1453"><a href="#cb119-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1454"><a href="#cb119-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1455"><a href="#cb119-1455" aria-hidden="true" tabindex="-1"></a>Fit a poisson regression in R using <span class="in">`glm(formula, data, family = poisson)`</span>.  But first, check whether the mean and variance of <span class="in">`injuries`</span> are the same magnitude?  If not, then use <span class="in">`family = quasipoisson`</span>.</span>
<span id="cb119-1456"><a href="#cb119-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1457"><a href="#cb119-1457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1458"><a href="#cb119-1458" aria-hidden="true" tabindex="-1"></a><span class="in">mean(fire$injuries)</span></span>
<span id="cb119-1459"><a href="#cb119-1459" aria-hidden="true" tabindex="-1"></a><span class="in">var(fire$injuries)</span></span>
<span id="cb119-1460"><a href="#cb119-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1461"><a href="#cb119-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1462"><a href="#cb119-1462" aria-hidden="true" tabindex="-1"></a>They are of the same magnitude, so fit the regression with <span class="in">`family = poisson`</span>.</span>
<span id="cb119-1463"><a href="#cb119-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1464"><a href="#cb119-1464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1465"><a href="#cb119-1465" aria-hidden="true" tabindex="-1"></a><span class="in">m2 &lt;- glm(injuries ~ mo, family = poisson, data = fire)</span></span>
<span id="cb119-1466"><a href="#cb119-1466" aria-hidden="true" tabindex="-1"></a><span class="in">summary(m2)</span></span>
<span id="cb119-1467"><a href="#cb119-1467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1468"><a href="#cb119-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1469"><a href="#cb119-1469" aria-hidden="true" tabindex="-1"></a>The *predicted* value $\hat{y}$ is the estimated **log** of the response variable, </span>
<span id="cb119-1470"><a href="#cb119-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1471"><a href="#cb119-1471" aria-hidden="true" tabindex="-1"></a>$$\hat{y} = X \hat{\beta} = \ln (\lambda).$$</span>
<span id="cb119-1472"><a href="#cb119-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1473"><a href="#cb119-1473" aria-hidden="true" tabindex="-1"></a>Suppose <span class="in">`mo`</span> is January (mo = <span class="in">`), then the log of `</span>injuries` is $\hat{y} = 0.323787$. Or, more intuitively, the expected count of injuries is $\exp(0.323787) = 1.38$  </span>
<span id="cb119-1474"><a href="#cb119-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1475"><a href="#cb119-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1476"><a href="#cb119-1476" aria-hidden="true" tabindex="-1"></a><span class="in">predict(m2, newdata = data.frame(mo=1))</span></span>
<span id="cb119-1477"><a href="#cb119-1477" aria-hidden="true" tabindex="-1"></a><span class="in">predict(m2, newdata = data.frame(mo=1), type = "response")</span></span>
<span id="cb119-1478"><a href="#cb119-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1479"><a href="#cb119-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1480"><a href="#cb119-1480" aria-hidden="true" tabindex="-1"></a>Here is a plot of the predicted counts in red.</span>
<span id="cb119-1481"><a href="#cb119-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1482"><a href="#cb119-1482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1483"><a href="#cb119-1483" aria-hidden="true" tabindex="-1"></a><span class="in">augment(m2, type.predict = "response") %&gt;%</span></span>
<span id="cb119-1484"><a href="#cb119-1484" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = mo, y = injuries)) +</span></span>
<span id="cb119-1485"><a href="#cb119-1485" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb119-1486"><a href="#cb119-1486" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(y = .fitted), color = "red") + </span></span>
<span id="cb119-1487"><a href="#cb119-1487" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, NA)) +</span></span>
<span id="cb119-1488"><a href="#cb119-1488" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Month",</span></span>
<span id="cb119-1489"><a href="#cb119-1489" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Injuries",</span></span>
<span id="cb119-1490"><a href="#cb119-1490" aria-hidden="true" tabindex="-1"></a><span class="in">       title = "Poisson Fitted Line Plot")</span></span>
<span id="cb119-1491"><a href="#cb119-1491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1492"><a href="#cb119-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1493"><a href="#cb119-1493" aria-hidden="true" tabindex="-1"></a>Evaluate a logistic model fit with an analysis of deviance.  </span>
<span id="cb119-1494"><a href="#cb119-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1495"><a href="#cb119-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1496"><a href="#cb119-1496" aria-hidden="true" tabindex="-1"></a><span class="in">(perf &lt;- glance(m2))</span></span>
<span id="cb119-1497"><a href="#cb119-1497" aria-hidden="true" tabindex="-1"></a><span class="in">(pseudoR2 &lt;- 1 - perf$deviance / perf$null.deviance)</span></span>
<span id="cb119-1498"><a href="#cb119-1498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1499"><a href="#cb119-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1500"><a href="#cb119-1500" aria-hidden="true" tabindex="-1"></a>The deviance of the null model (no regressors) is 139.9.  The deviance of the full model is 132.2.  The psuedo-R2 is very low at .05.  How about the RMSE?</span>
<span id="cb119-1501"><a href="#cb119-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1502"><a href="#cb119-1502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1503"><a href="#cb119-1503" aria-hidden="true" tabindex="-1"></a><span class="in">RMSE(pred = predict(m2, type = "response"), obs = fire$injuries)</span></span>
<span id="cb119-1504"><a href="#cb119-1504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1505"><a href="#cb119-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1506"><a href="#cb119-1506" aria-hidden="true" tabindex="-1"></a>The average prediction error is about 0.99.  That's almost as much as the variance of <span class="in">`injuries`</span> - i.e., just predicting the mean of <span class="in">`injuries`</span> would be almost as good!  Use the <span class="in">`GainCurvePlot()`</span> function to plot the gain curve.</span>
<span id="cb119-1507"><a href="#cb119-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1508"><a href="#cb119-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1509"><a href="#cb119-1509" aria-hidden="true" tabindex="-1"></a><span class="in">augment(m2, type.predict = "response") %&gt;%</span></span>
<span id="cb119-1510"><a href="#cb119-1510" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = injuries, y = .fitted)) +</span></span>
<span id="cb119-1511"><a href="#cb119-1511" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb119-1512"><a href="#cb119-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method ="lm") +</span></span>
<span id="cb119-1513"><a href="#cb119-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Actual",</span></span>
<span id="cb119-1514"><a href="#cb119-1514" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Predicted",</span></span>
<span id="cb119-1515"><a href="#cb119-1515" aria-hidden="true" tabindex="-1"></a><span class="in">       title = "Poisson Fitted vs Actual")</span></span>
<span id="cb119-1516"><a href="#cb119-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1517"><a href="#cb119-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1518"><a href="#cb119-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1519"><a href="#cb119-1519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb119-1520"><a href="#cb119-1520" aria-hidden="true" tabindex="-1"></a><span class="in">augment(m2) %&gt;% data.frame() %&gt;% </span></span>
<span id="cb119-1521"><a href="#cb119-1521" aria-hidden="true" tabindex="-1"></a><span class="in">  GainCurvePlot(xvar = ".fitted", truthVar = "injuries", title = "Poisson Model")</span></span>
<span id="cb119-1522"><a href="#cb119-1522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb119-1523"><a href="#cb119-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-1524"><a href="#cb119-1524" aria-hidden="true" tabindex="-1"></a>It seems that <span class="in">`mo`</span> was a poor predictor of <span class="in">`injuries`</span>.  </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>