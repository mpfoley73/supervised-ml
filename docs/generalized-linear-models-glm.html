<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Generalized Linear Models (GLM) | Supervised Machine Learning</title>
  <meta name="description" content="These are my personal notes related to supervised machine learning techniques." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Generalized Linear Models (GLM) | Supervised Machine Learning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are my personal notes related to supervised machine learning techniques." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Generalized Linear Models (GLM) | Supervised Machine Learning" />
  
  <meta name="twitter:description" content="These are my personal notes related to supervised machine learning techniques." />
  

<meta name="author" content="Michael Foley" />


<meta name="date" content="2023-07-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ordinary-least-squares.html"/>
<link rel="next" href="regularization.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Supervised Machine Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html"><i class="fa fa-check"></i><b>1</b> Ordinary Least Squares</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#linear-regression-model"><i class="fa fa-check"></i><b>1.1</b> Linear Regression Model</a></li>
<li class="chapter" data-level="1.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#parameter-estimation"><i class="fa fa-check"></i><b>1.2</b> Parameter Estimation</a></li>
<li class="chapter" data-level="1.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#model-assumptions"><i class="fa fa-check"></i><b>1.3</b> Model Assumptions</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#linearity"><i class="fa fa-check"></i><b>1.3.1</b> Linearity</a></li>
<li class="chapter" data-level="1.3.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#multicollinearity"><i class="fa fa-check"></i><b>1.3.2</b> Multicollinearity</a></li>
<li class="chapter" data-level="1.3.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#normality"><i class="fa fa-check"></i><b>1.3.3</b> Normality</a></li>
<li class="chapter" data-level="1.3.4" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#equal-variances"><i class="fa fa-check"></i><b>1.3.4</b> Equal Variances</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#prediction"><i class="fa fa-check"></i><b>1.4</b> Prediction</a></li>
<li class="chapter" data-level="1.5" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#inference"><i class="fa fa-check"></i><b>1.5</b> Inference</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#t-test"><i class="fa fa-check"></i><b>1.5.1</b> <em>t</em>-Test</a></li>
<li class="chapter" data-level="1.5.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#f-test"><i class="fa fa-check"></i><b>1.5.2</b> <em>F</em>-Test</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#interpretation"><i class="fa fa-check"></i><b>1.6</b> Interpretation</a></li>
<li class="chapter" data-level="1.7" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#model-validation"><i class="fa fa-check"></i><b>1.7</b> Model Validation</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#accuracy-metrics"><i class="fa fa-check"></i><b>1.7.1</b> Accuracy Metrics</a></li>
<li class="chapter" data-level="1.7.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#cross-validation"><i class="fa fa-check"></i><b>1.7.2</b> Cross-Validation</a></li>
<li class="chapter" data-level="1.7.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#gain-curve"><i class="fa fa-check"></i><b>1.7.3</b> Gain Curve</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#ols-reference"><i class="fa fa-check"></i><b>1.8</b> OLS Reference</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html"><i class="fa fa-check"></i><b>2</b> Generalized Linear Models (GLM)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#binomiallogistic"><i class="fa fa-check"></i><b>2.1</b> Binomial Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#cs1"><i class="fa fa-check"></i>Case Study 1</a>
<ul>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#the-model"><i class="fa fa-check"></i>The Model</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#interpretation-1"><i class="fa fa-check"></i>Interpretation</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#assumptions"><i class="fa fa-check"></i>Assumptions</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#model-fit"><i class="fa fa-check"></i>Model Fit</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#reporting"><i class="fa fa-check"></i>Reporting</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#multinomiallogistic"><i class="fa fa-check"></i><b>2.2</b> Multinomial Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#cs2"><i class="fa fa-check"></i>Case Study 2</a>
<ul>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#the-model-1"><i class="fa fa-check"></i>The Model</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#interpretation-2"><i class="fa fa-check"></i>Interpretation</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#assumptions-1"><i class="fa fa-check"></i>Assumptions</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#model-fit-1"><i class="fa fa-check"></i>Model Fit</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#reporting-1"><i class="fa fa-check"></i>Reporting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#ordinallogistic"><i class="fa fa-check"></i><b>2.3</b> Ordinal Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#cs3"><i class="fa fa-check"></i>Case Study 3</a>
<ul>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#fit-the-model"><i class="fa fa-check"></i>Fit the Model</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#verify-assumptions"><i class="fa fa-check"></i>Verify Assumptions</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#assess-the-model-fit"><i class="fa fa-check"></i>Assess the Model Fit</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#interpret-results"><i class="fa fa-check"></i>Interpret Results</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#reporting-2"><i class="fa fa-check"></i>Reporting</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#poissonregression"><i class="fa fa-check"></i><b>2.4</b> Poisson Regression</a></li>
<li class="chapter" data-level="" data-path="generalized-linear-models-glm.html"><a href="generalized-linear-models-glm.html#cs4"><i class="fa fa-check"></i>Case Study 4</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regularization.html"><a href="regularization.html"><i class="fa fa-check"></i><b>3</b> Regularization</a>
<ul>
<li class="chapter" data-level="3.1" data-path="regularization.html"><a href="regularization.html#ridge"><i class="fa fa-check"></i><b>3.1</b> Ridge</a></li>
<li class="chapter" data-level="3.2" data-path="regularization.html"><a href="regularization.html#lasso"><i class="fa fa-check"></i><b>3.2</b> Lasso</a></li>
<li class="chapter" data-level="3.3" data-path="regularization.html"><a href="regularization.html#elastic-net"><i class="fa fa-check"></i><b>3.3</b> Elastic Net</a></li>
<li class="chapter" data-level="" data-path="regularization.html"><a href="regularization.html#model-summary"><i class="fa fa-check"></i>Model Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>4</b> Decision Trees</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decision-trees.html"><a href="decision-trees.html#classification-tree"><i class="fa fa-check"></i><b>4.1</b> Classification Tree</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="decision-trees.html"><a href="decision-trees.html#measuring-performance"><i class="fa fa-check"></i><b>4.1.1</b> Measuring Performance</a></li>
<li class="chapter" data-level="4.1.2" data-path="decision-trees.html"><a href="decision-trees.html#training-with-caret"><i class="fa fa-check"></i><b>4.1.2</b> Training with Caret</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="decision-trees.html"><a href="decision-trees.html#regression-tree"><i class="fa fa-check"></i><b>4.2</b> Regression Tree</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="decision-trees.html"><a href="decision-trees.html#training-with-caret-1"><i class="fa fa-check"></i><b>4.2.1</b> Training with Caret</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="decision-trees.html"><a href="decision-trees.html#bagged-trees"><i class="fa fa-check"></i><b>4.3</b> Bagged Trees</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="decision-trees.html"><a href="decision-trees.html#bagged-classification-tree"><i class="fa fa-check"></i><b>4.3.1</b> Bagged Classification Tree</a></li>
<li class="chapter" data-level="4.3.2" data-path="decision-trees.html"><a href="decision-trees.html#bagging-regression-tree"><i class="fa fa-check"></i><b>4.3.2</b> Bagging Regression Tree</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="decision-trees.html"><a href="decision-trees.html#random-forests"><i class="fa fa-check"></i><b>4.4</b> Random Forests</a></li>
<li class="chapter" data-level="4.5" data-path="decision-trees.html"><a href="decision-trees.html#gradient-boosting"><i class="fa fa-check"></i><b>4.5</b> Gradient Boosting</a></li>
<li class="chapter" data-level="4.6" data-path="decision-trees.html"><a href="decision-trees.html#summary"><i class="fa fa-check"></i><b>4.6</b> Summary</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="decision-trees.html"><a href="decision-trees.html#classification-trees"><i class="fa fa-check"></i><b>4.6.1</b> Classification Trees</a></li>
<li class="chapter" data-level="4.6.2" data-path="decision-trees.html"><a href="decision-trees.html#regression-trees"><i class="fa fa-check"></i><b>4.6.2</b> Regression Trees</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="non-linear-models.html"><a href="non-linear-models.html"><i class="fa fa-check"></i><b>5</b> Non-linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="non-linear-models.html"><a href="non-linear-models.html#splines"><i class="fa fa-check"></i><b>5.1</b> Splines</a></li>
<li class="chapter" data-level="5.2" data-path="non-linear-models.html"><a href="non-linear-models.html#mars"><i class="fa fa-check"></i><b>5.2</b> MARS</a></li>
<li class="chapter" data-level="5.3" data-path="non-linear-models.html"><a href="non-linear-models.html#gam"><i class="fa fa-check"></i><b>5.3</b> GAM</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>6</b> Support Vector Machines</a>
<ul>
<li class="chapter" data-level="6.1" data-path="support-vector-machines.html"><a href="support-vector-machines.html#maximal-margin-classifier"><i class="fa fa-check"></i><b>6.1</b> Maximal Margin Classifier</a></li>
<li class="chapter" data-level="6.2" data-path="support-vector-machines.html"><a href="support-vector-machines.html#support-vector-classifier"><i class="fa fa-check"></i><b>6.2</b> Support Vector Classifier</a></li>
<li class="chapter" data-level="6.3" data-path="support-vector-machines.html"><a href="support-vector-machines.html#support-vector-machines-1"><i class="fa fa-check"></i><b>6.3</b> Support Vector Machines</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="EMMs.html"><a href="EMMs.html"><i class="fa fa-check"></i><b>7</b> Topics: EMMs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="EMMs.html"><a href="EMMs.html#references"><i class="fa fa-check"></i><b>7.1</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="BayesRegression.html"><a href="BayesRegression.html"><i class="fa fa-check"></i><b>8</b> Bayesian Regression</a>
<ul>
<li class="chapter" data-level="8.1" data-path="BayesRegression.html"><a href="BayesRegression.html#compared-to-frequentist-regression"><i class="fa fa-check"></i><b>8.1</b> Compared to Frequentist Regression</a></li>
<li class="chapter" data-level="8.2" data-path="BayesRegression.html"><a href="BayesRegression.html#model-evaluation"><i class="fa fa-check"></i><b>8.2</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="BayesRegression.html"><a href="BayesRegression.html#model-comparison"><i class="fa fa-check"></i><b>8.2.1</b> Model Comparison</a></li>
<li class="chapter" data-level="8.2.2" data-path="BayesRegression.html"><a href="BayesRegression.html#visualization"><i class="fa fa-check"></i><b>8.2.2</b> Visualization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supervised Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-linear-models-glm" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Generalized Linear Models (GLM)<a href="generalized-linear-models-glm.html#generalized-linear-models-glm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The linear regression model, <span class="math inline">\(E(y|X) = X \beta\)</span>, structured as <span class="math inline">\(y_i = X_i \beta + \epsilon_i\)</span> where <span class="math inline">\(X_i \beta = \mu_i\)</span>, assumes the response is a linear function of the predictors and the residuals are independent random variables normally distributed with zero mean and constant variance, <span class="math inline">\(\epsilon \sim N \left(0, \sigma^2 \right)\)</span>. This implies that given a set of predictors, the response is normally distributed about its expected value, <span class="math inline">\(y_i \sim N \left(\mu_i, \sigma^2 \right)\)</span>. However, there are many situations where this normality assumption does not hold. Generalized linear models (GLMs) are a generalization of the linear regression model that work with non-normal response distributions.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The response will not have a normal distribution if the underlying data-generating process is binomial (Section <a href="generalized-linear-models-glm.html#binomiallogistic">2.1</a>) or multinomial (Section <a href="generalized-linear-models-glm.html#multinomiallogistic">2.2</a>), ordinal (Section <a href="generalized-linear-models-glm.html#ordinallogistic">2.3</a>), Poisson (counts, Section <a href="generalized-linear-models-glm.html#poissonregression">2.4</a>), or exponential (time-to-event). In these situations the linear regression model can predict probabilities and proportions outside [0, 1], or negative counts or times. GLMs solve this problem by modeling a <em>function</em> of the expected value of <span class="math inline">\(y\)</span>, <span class="math inline">\(f(E(y|X)) = X \beta\)</span>. There are three components to a GLM: a <em>random component</em> specified by the response variable’s probability distribution (normal, binomial, etc.); a <em>systematic component</em> in the form <span class="math inline">\(X\beta\)</span>; and a <em>link function</em>, <span class="math inline">\(\eta\)</span>, that specifies the link between the random and systematic components and converts the response to a range of <span class="math inline">\([-\infty, +\infty]\)</span>.</p>
<p>Linear regression is a special case of GLM where the link function is the identity function, <span class="math inline">\(f(E(y|X)) = E(y|X)\)</span>. For binary logistic regression, the link function is the logit,</p>
<p><span class="math display">\[f(E(y|X)) = \log \left( \frac{E(y|X)}{1 - E(y|X)} \right) = \log \left( \frac{\pi}{1 - \pi} \right) = \mathrm{logit}(\pi)\]</span></p>
<p>where <span class="math inline">\(\pi\)</span> is the response probability.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> For multinomial logistic regression, the link function is the logit again, but with respect to the baseline level, and there is set of logits (one for each non-baseline level),</p>
<p><span class="math display">\[f(E(y|X)) = \log \left( \frac{E(y_j|X)}{E(y_{j^*}|X)} \right) = \log \left( \frac{\pi_j}{\pi_{j^*}} \right) = \mathrm{logit}(\pi_j)\]</span></p>
<p>Where <span class="math inline">\(j\)</span> is a level in the dependent variable and <span class="math inline">\(j^*\)</span> is the baseline level. For Poisson regression, the link function is</p>
<p><span class="math display">\[f(E(y|X)) = \ln (E(y|X)) = \ln(\lambda)\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the expected event rate. For exponential regression, the link function is</p>
<p><span class="math display">\[f(E(y|X) = -E(y|X) = -\lambda\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the expected time to event.</p>
<p>GLM uses maximum likelihood estimation (MLE) rather than ordinary least squares (OLS) to estimate the parameters, and thus relies on large-sample approximations.</p>
<p>Fit a GLM just like an linear model, but with the <code>glm()</code> function, specifying the distribution with the <code>family = c("gaussian", "binomial", "poisson")</code> parameter. Fit a mulinomial logistic regression model with <code>nnet::multinom()</code>.</p>
<div id="binomiallogistic" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Binomial Logistic Regression<a href="generalized-linear-models-glm.html#binomiallogistic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Logistic regression estimates the probability that a categorical dependent variable is a particular level. The dependent variable levels can be binomial, multinomial, or ordinal. The <em>binary</em> logistic regression model is</p>
<p><span class="math display">\[y_i = \mathrm{logit}(\pi_i) = \log \left( \frac{\pi_i}{1 - \pi_i} \right) = X_i \beta\]</span></p>
<p>where <span class="math inline">\(\pi_i\)</span> is the response <span class="math inline">\(i\)</span>’s binary level probability. The model predicts the <em>log odds</em> of the level. Why do this? The range of outcomes need to be between 0 and 1, and a sigmoid function, <span class="math inline">\(f(y) = 1 / \left(1 + e^y \right)\)</span>, does that. If the <em>log odds</em> of the level equals <span class="math inline">\(X_i\beta\)</span>, then the <em>odds</em> of the level equals <span class="math inline">\(e^{X\beta}\)</span>. You can solve for <span class="math inline">\(\pi_i\)</span> to get <span class="math inline">\(\pi = \mathrm{odds} / (\mathrm{odds} + 1)\)</span>. Substituting,</p>
<p><span class="math display">\[\pi_i = \frac{\exp(y_i)}{1 + \exp(y_i)} = \frac{e^{X_i\beta}}{1 + e^{X_i\beta}}\]</span></p>
<p>which you can simplify to <span class="math inline">\(\pi_i = 1 / (1 + e^{-X_i\beta})\)</span>, a sigmoid function. The upshot is <span class="math inline">\(X\beta\)</span> is the functional relationship between the independent variables and <em>a function of the response</em>, not the response itself.</p>
<p>The model parameters are estimated either by <em>iteratively reweighted least squares optimization</em> or by <em>maximum likelihood estimation</em> (MLE). MLE maximizes the probability produced by a set of parameters <span class="math inline">\(\beta\)</span> given a data set and probability distribution.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> In logistic regression the probability distribution is the binomial and each observation is the outcome of a single Bernoulli trial.</p>
<p><span class="math display">\[L(\beta; y, X) = \prod_{i=1}^n \pi_i^{y_i}(1 - \pi_i)^{(1-y_i)} = \prod_{i=1}^n\frac{\exp(y_i X_i \beta)}{1 + \exp(X_i \beta)}.\]</span></p>
<p>In practice, multiplying many small probabilities can be unstable, so MLE optimizes the log likelihood instead.</p>
<p><span class="math display">\[\begin{align}
l(\beta; y, X) &amp;= \sum_{i = 1}^n \left(y_i \log(\pi_i) + (1 - y_i) \log(1 - \pi_i) \right) \\
               &amp;= \sum_{i = 1}^n \left(y_i X_i \beta - \log(1 + e^{X_i\beta}) \right)
\end{align}\]</span></p>
<p>Sometimes you will see the <em>cost function</em> optimized. The cost function is the negative of of the log likelihood function.</p>
<p><strong>Assumptions</strong></p>
<p>The binomial logistic regression model requires a dichotomous dependent variable and independent observations. The sample size should be large, at least 10 observations per dependent variable level and independent variable. There are three conditions related to the data distribution: i) the logit transformation must be linearly related to any continuous independent variables, ii) there must be no multicollinearity, and iii) there must be no influential outliers.</p>
</div>
<div id="cs1" class="section level2 unnumbered hasAnchor">
<h2>Case Study 1<a href="generalized-linear-models-glm.html#cs1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This case study uses the <a href="https://statistics.laerd.com/">Laerd Statistics</a> article on binomial logistic regression <a href="https://statistics.laerd.com/premium/spss/spss-files/logistic-regression.sav">data set</a>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="generalized-linear-models-glm.html#cb164-1" tabindex="-1"></a>cs1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb164-2"><a href="generalized-linear-models-glm.html#cb164-2" tabindex="-1"></a></span>
<span id="cb164-3"><a href="generalized-linear-models-glm.html#cb164-3" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="ot">&lt;-</span> <span class="fu">read.spss</span>(<span class="st">&quot;./input/logistic-regression.sav&quot;</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>An analysis investigates the relationship between the incidence of heart disease (Yes|No) and age, weight, gender, and maximal aerobic capacity (maxVO2) using data from <span class="math inline">\(n\)</span> = 100 participants.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="generalized-linear-models-glm.html#cb165-1" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="generalized-linear-models-glm.html#cb165-2" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb165-3"><a href="generalized-linear-models-glm.html#cb165-3" tabindex="-1"></a>    <span class="at">by =</span> heart_disease,</span>
<span id="cb165-4"><a href="generalized-linear-models-glm.html#cb165-4" tabindex="-1"></a>    <span class="at">include =</span> <span class="sc">-</span>caseno,</span>
<span id="cb165-5"><a href="generalized-linear-models-glm.html#cb165-5" tabindex="-1"></a>    <span class="at">percent =</span> <span class="st">&quot;row&quot;</span>,</span>
<span id="cb165-6"><a href="generalized-linear-models-glm.html#cb165-6" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;{mean}, {sd}&quot;</span>)</span>
<span id="cb165-7"><a href="generalized-linear-models-glm.html#cb165-7" tabindex="-1"></a>  )</span></code></pre></div>
<div id="ubrqnaoijg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ubrqnaoijg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ubrqnaoijg thead, #ubrqnaoijg tbody, #ubrqnaoijg tfoot, #ubrqnaoijg tr, #ubrqnaoijg td, #ubrqnaoijg th {
  border-style: none;
}

#ubrqnaoijg p {
  margin: 0;
  padding: 0;
}

#ubrqnaoijg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ubrqnaoijg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ubrqnaoijg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ubrqnaoijg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ubrqnaoijg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ubrqnaoijg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ubrqnaoijg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ubrqnaoijg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ubrqnaoijg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ubrqnaoijg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ubrqnaoijg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ubrqnaoijg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ubrqnaoijg .gt_spanner_row {
  border-bottom-style: hidden;
}

#ubrqnaoijg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ubrqnaoijg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ubrqnaoijg .gt_from_md > :first-child {
  margin-top: 0;
}

#ubrqnaoijg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ubrqnaoijg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ubrqnaoijg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ubrqnaoijg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ubrqnaoijg .gt_row_group_first td {
  border-top-width: 2px;
}

#ubrqnaoijg .gt_row_group_first th {
  border-top-width: 2px;
}

#ubrqnaoijg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ubrqnaoijg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ubrqnaoijg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ubrqnaoijg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ubrqnaoijg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ubrqnaoijg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ubrqnaoijg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ubrqnaoijg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ubrqnaoijg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ubrqnaoijg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ubrqnaoijg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ubrqnaoijg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ubrqnaoijg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ubrqnaoijg .gt_left {
  text-align: left;
}

#ubrqnaoijg .gt_center {
  text-align: center;
}

#ubrqnaoijg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ubrqnaoijg .gt_font_normal {
  font-weight: normal;
}

#ubrqnaoijg .gt_font_bold {
  font-weight: bold;
}

#ubrqnaoijg .gt_font_italic {
  font-style: italic;
}

#ubrqnaoijg .gt_super {
  font-size: 65%;
}

#ubrqnaoijg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ubrqnaoijg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ubrqnaoijg .gt_indent_1 {
  text-indent: 5px;
}

#ubrqnaoijg .gt_indent_2 {
  text-indent: 10px;
}

#ubrqnaoijg .gt_indent_3 {
  text-indent: 15px;
}

#ubrqnaoijg .gt_indent_4 {
  text-indent: 20px;
}

#ubrqnaoijg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;No&lt;/strong&gt;, N = 65&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>No</strong>, N = 65<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Yes&lt;/strong&gt;, N = 35&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Yes</strong>, N = 35<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="stat_1" class="gt_row gt_center">39, 8</td>
<td headers="stat_2" class="gt_row gt_center">45, 9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">weight</td>
<td headers="stat_1" class="gt_row gt_center">77, 14</td>
<td headers="stat_2" class="gt_row gt_center">85, 15</td></tr>
    <tr><td headers="label" class="gt_row gt_left">gender</td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Female</td>
<td headers="stat_1" class="gt_row gt_center">29 (78%)</td>
<td headers="stat_2" class="gt_row gt_center">8 (22%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Male</td>
<td headers="stat_1" class="gt_row gt_center">36 (57%)</td>
<td headers="stat_2" class="gt_row gt_center">27 (43%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">VO2max</td>
<td headers="stat_1" class="gt_row gt_center">45, 9</td>
<td headers="stat_2" class="gt_row gt_center">41, 6</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="3"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> Mean, SD; n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<p><br></p>
<p>A brief exploratory analysis helps set your expectations. Men are twice as likely to have heart disease. The odds ratio is (.43/.57) / (.22/.78) = 2.7.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="generalized-linear-models-glm.html#cb166-1" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="generalized-linear-models-glm.html#cb166-2" tabindex="-1"></a>  <span class="fu">tbl_cross</span>(<span class="at">row =</span> heart_disease, <span class="at">col =</span> gender, <span class="at">percent =</span> <span class="st">&quot;col&quot;</span>) </span></code></pre></div>
<div id="oyyjzosuql" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oyyjzosuql table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oyyjzosuql thead, #oyyjzosuql tbody, #oyyjzosuql tfoot, #oyyjzosuql tr, #oyyjzosuql td, #oyyjzosuql th {
  border-style: none;
}

#oyyjzosuql p {
  margin: 0;
  padding: 0;
}

#oyyjzosuql .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oyyjzosuql .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oyyjzosuql .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oyyjzosuql .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oyyjzosuql .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oyyjzosuql .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oyyjzosuql .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oyyjzosuql .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oyyjzosuql .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oyyjzosuql .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oyyjzosuql .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oyyjzosuql .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oyyjzosuql .gt_spanner_row {
  border-bottom-style: hidden;
}

#oyyjzosuql .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oyyjzosuql .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oyyjzosuql .gt_from_md > :first-child {
  margin-top: 0;
}

#oyyjzosuql .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oyyjzosuql .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oyyjzosuql .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oyyjzosuql .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oyyjzosuql .gt_row_group_first td {
  border-top-width: 2px;
}

#oyyjzosuql .gt_row_group_first th {
  border-top-width: 2px;
}

#oyyjzosuql .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oyyjzosuql .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oyyjzosuql .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oyyjzosuql .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oyyjzosuql .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oyyjzosuql .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oyyjzosuql .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oyyjzosuql .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oyyjzosuql .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oyyjzosuql .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oyyjzosuql .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oyyjzosuql .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oyyjzosuql .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oyyjzosuql .gt_left {
  text-align: left;
}

#oyyjzosuql .gt_center {
  text-align: center;
}

#oyyjzosuql .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oyyjzosuql .gt_font_normal {
  font-weight: normal;
}

#oyyjzosuql .gt_font_bold {
  font-weight: bold;
}

#oyyjzosuql .gt_font_italic {
  font-style: italic;
}

#oyyjzosuql .gt_super {
  font-size: 65%;
}

#oyyjzosuql .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oyyjzosuql .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oyyjzosuql .gt_indent_1 {
  text-indent: 5px;
}

#oyyjzosuql .gt_indent_2 {
  text-indent: 10px;
}

#oyyjzosuql .gt_indent_3 {
  text-indent: 15px;
}

#oyyjzosuql .gt_indent_4 {
  text-indent: 20px;
}

#oyyjzosuql .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings gt_spanner_row">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id=""></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="gender">
        <span class="gt_column_spanner">gender</span>
      </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="2" colspan="1" scope="col" id="Total">Total</th>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Female">Female</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Male">Male</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">heart_disease</td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    No</td>
<td headers="stat_1" class="gt_row gt_center">29 (78%)</td>
<td headers="stat_2" class="gt_row gt_center">36 (57%)</td>
<td headers="stat_0" class="gt_row gt_center">65 (65%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Yes</td>
<td headers="stat_1" class="gt_row gt_center">8 (22%)</td>
<td headers="stat_2" class="gt_row gt_center">27 (43%)</td>
<td headers="stat_0" class="gt_row gt_center">35 (35%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Total</td>
<td headers="stat_1" class="gt_row gt_center">37 (100%)</td>
<td headers="stat_2" class="gt_row gt_center">63 (100%)</td>
<td headers="stat_0" class="gt_row gt_center">100 (100%)</td></tr>
  </tbody>
  
  
</table>
</div>
<p>Age, weight, and poor max aerobic capacity are positively associated with hear disease.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="generalized-linear-models-glm.html#cb167-1" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="generalized-linear-models-glm.html#cb167-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="generalized-linear-models-glm.html#cb167-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> heart_disease, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb167-4"><a href="generalized-linear-models-glm.html#cb167-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb167-5"><a href="generalized-linear-models-glm.html#cb167-5" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb167-6"><a href="generalized-linear-models-glm.html#cb167-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<p>To facilitate model interpretation, I’ll center the continuous variables around their means. Then the intercept term in the fitted model will represent a reasonable condition, not a zero-aged, zero-weighted person with no aerobic capacity. If you want to present your findings in the framework of a baseline probability (or odds) and the incremental effects of the independent variable, this is the way to go. You might even standardize the continuous vars to get a more meaningful increment. On the other hand, if you want to use your model for predicting outcomes, you’ll have to back out of the centering when you predict values.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="generalized-linear-models-glm.html#cb168-1" tabindex="-1"></a>cs1<span class="sc">$</span>dat <span class="ot">&lt;-</span> cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="generalized-linear-models-glm.html#cb168-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb168-3"><a href="generalized-linear-models-glm.html#cb168-3" tabindex="-1"></a>    <span class="at">age_c =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(age, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb168-4"><a href="generalized-linear-models-glm.html#cb168-4" tabindex="-1"></a>    <span class="at">weight_c =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(weight, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb168-5"><a href="generalized-linear-models-glm.html#cb168-5" tabindex="-1"></a>    <span class="at">VO2max_c =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(VO2max, <span class="at">scale =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb168-6"><a href="generalized-linear-models-glm.html#cb168-6" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">factor</span>(gender, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb168-7"><a href="generalized-linear-models-glm.html#cb168-7" tabindex="-1"></a>  )</span>
<span id="cb168-8"><a href="generalized-linear-models-glm.html#cb168-8" tabindex="-1"></a>cs1<span class="sc">$</span>centers <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">mean</span>(cs1<span class="sc">$</span>dat<span class="sc">$</span>age),</span>
<span id="cb168-9"><a href="generalized-linear-models-glm.html#cb168-9" tabindex="-1"></a>                    <span class="at">weight =</span> <span class="fu">mean</span>(cs1<span class="sc">$</span>dat<span class="sc">$</span>weight),</span>
<span id="cb168-10"><a href="generalized-linear-models-glm.html#cb168-10" tabindex="-1"></a>                    <span class="at">VO2max =</span> <span class="fu">mean</span>(cs1<span class="sc">$</span>dat<span class="sc">$</span>VO2max))</span></code></pre></div>
<div id="the-model" class="section level3 unnumbered hasAnchor">
<h3>The Model<a href="generalized-linear-models-glm.html#the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Jump in and fit the model.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="generalized-linear-models-glm.html#cb169-1" tabindex="-1"></a>cs1<span class="sc">$</span>fmla <span class="ot">&lt;-</span> <span class="fu">formula</span>(heart_disease <span class="sc">~</span> age_c <span class="sc">+</span> weight_c <span class="sc">+</span> VO2max_c <span class="sc">+</span> gender)</span>
<span id="cb169-2"><a href="generalized-linear-models-glm.html#cb169-2" tabindex="-1"></a></span>
<span id="cb169-3"><a href="generalized-linear-models-glm.html#cb169-3" tabindex="-1"></a>cs1<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(cs1<span class="sc">$</span>fmla, <span class="at">data =</span> cs1<span class="sc">$</span>dat, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb169-4"><a href="generalized-linear-models-glm.html#cb169-4" tabindex="-1"></a></span>
<span id="cb169-5"><a href="generalized-linear-models-glm.html#cb169-5" tabindex="-1"></a><span class="fu">summary</span>(cs1<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cs1$fmla, family = &quot;binomial&quot;, data = cs1$dat)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -0.093483   0.356753  -0.262  0.79329   
## age_c         0.085098   0.028160   3.022  0.00251 **
## weight_c      0.005727   0.022442   0.255  0.79858   
## VO2max_c     -0.099024   0.047944  -2.065  0.03889 * 
## genderFemale -1.949639   0.842413  -2.314  0.02065 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 129.49  on 99  degrees of freedom
## Residual deviance: 102.09  on 95  degrees of freedom
## AIC: 112.09
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Let’s take a tour of the summary object. The top section presents the deviance residuals.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> Deviance residuals are one of several residuals you can calculate from a binary logistic regression. One is the <em>raw residual</em>, <span class="math inline">\(\epsilon_i = y_i - \hat{p}_i\)</span>, where <span class="math inline">\(\hat{p}_i\)</span> is the predicted probability. Another is the <em>Pearson residual</em>, <span class="math inline">\(r_i = \frac{\epsilon_i}{\sqrt{\hat{p}_i(1 - \hat{p}_i)}}\)</span>, the raw residual rescaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>. A third is the <em>standardized Pearson residual</em>, <span class="math inline">\(rs_i = r_i / \sqrt{1 - \hat{h}_i}\)</span>, the Pearson residual adjusted for the leverage of the predictors using the hat-values. Hat-values measure the predictor distances from the mean. This residual is especially useful to evaluate model fit because if the model fits well, these residuals have a standard normal distribution. Finally, there are the <em>deviance residuals</em>, <span class="math inline">\(d_i = \mathrm{sign}(\epsilon_i) \left[ -2(y_i \log \hat{p}_i + (1 - y_i) \log (1 - \hat{p}_i)) \right]^{.5}\)</span>. Deviance Residuals measure how much the estimated probabilities differ from the observed proportions of success. You want deviance residuals to be evenly distributed (in absolute values, 1Q <span class="math inline">\(\approx\)</span> 3Q, min <span class="math inline">\(\approx\)</span> max). You also want the min and max to be &lt;3 because deviance residuals are roughly approximated by a standard normal distribution.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="generalized-linear-models-glm.html#cb171-1" tabindex="-1"></a><span class="co"># Raw</span></span>
<span id="cb171-2"><a href="generalized-linear-models-glm.html#cb171-2" tabindex="-1"></a><span class="fu">residuals</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb171-3"><a href="generalized-linear-models-glm.html#cb171-3" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb171-4"><a href="generalized-linear-models-glm.html#cb171-4" tabindex="-1"></a><span class="do">## -0.7955 -0.2500 -0.1062  0.0000  0.3533  0.9181</span></span>
<span id="cb171-5"><a href="generalized-linear-models-glm.html#cb171-5" tabindex="-1"></a></span>
<span id="cb171-6"><a href="generalized-linear-models-glm.html#cb171-6" tabindex="-1"></a><span class="co"># Pearson</span></span>
<span id="cb171-7"><a href="generalized-linear-models-glm.html#cb171-7" tabindex="-1"></a><span class="fu">residuals</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb171-8"><a href="generalized-linear-models-glm.html#cb171-8" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb171-9"><a href="generalized-linear-models-glm.html#cb171-9" tabindex="-1"></a><span class="do">## -1.9721 -0.5774 -0.3447 -0.0187  0.7392  3.3486</span></span>
<span id="cb171-10"><a href="generalized-linear-models-glm.html#cb171-10" tabindex="-1"></a></span>
<span id="cb171-11"><a href="generalized-linear-models-glm.html#cb171-11" tabindex="-1"></a><span class="co"># Standardized Pearson</span></span>
<span id="cb171-12"><a href="generalized-linear-models-glm.html#cb171-12" tabindex="-1"></a><span class="fu">rstandard</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb171-13"><a href="generalized-linear-models-glm.html#cb171-13" tabindex="-1"></a><span class="do">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb171-14"><a href="generalized-linear-models-glm.html#cb171-14" tabindex="-1"></a><span class="do">## -2.17942 -0.59189 -0.35211 -0.02113  0.75930  3.39975</span></span>
<span id="cb171-15"><a href="generalized-linear-models-glm.html#cb171-15" tabindex="-1"></a></span>
<span id="cb171-16"><a href="generalized-linear-models-glm.html#cb171-16" tabindex="-1"></a><span class="co"># Deviance</span></span>
<span id="cb171-17"><a href="generalized-linear-models-glm.html#cb171-17" tabindex="-1"></a><span class="fu">residuals</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb171-18"><a href="generalized-linear-models-glm.html#cb171-18" tabindex="-1"></a><span class="do">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb171-19"><a href="generalized-linear-models-glm.html#cb171-19" tabindex="-1"></a><span class="do">## -1.78156 -0.75854 -0.47381 -0.08019  0.93363  2.23719</span></span></code></pre></div>
<p>The next section is the coefficients table.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="generalized-linear-models-glm.html#cb172-1" tabindex="-1"></a><span class="fu">summary</span>(cs1<span class="sc">$</span>fit)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                  Estimate Std. Error    z value    Pr(&gt;|z|)
## (Intercept)  -0.093483020 0.35675295 -0.2620385 0.793291735
## age_c         0.085098077 0.02816013  3.0219351 0.002511644
## weight_c      0.005726835 0.02244169  0.2551874 0.798578389
## VO2max_c     -0.099023726 0.04794428 -2.0653917 0.038885956
## genderFemale -1.949638795 0.84241271 -2.3143511 0.020648470</code></pre>
<p>The “z value” is the Wald <span class="math inline">\(z\)</span> statistic, <span class="math inline">\(z = \hat{\beta} / SE(\hat{\beta})\)</span>. Its square is the Wald chi-squared statistic. The <em>p</em>-value is the area to the right of <span class="math inline">\(z^2\)</span> in the <span class="math inline">\(\chi_1^2\)</span> density curve:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="generalized-linear-models-glm.html#cb174-1" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fu">summary</span>(cs1<span class="sc">$</span>fit)<span class="sc">$</span>coefficients[, <span class="st">&quot;z value&quot;</span>]<span class="sc">^</span><span class="dv">2</span>, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##  (Intercept)        age_c     weight_c     VO2max_c genderFemale 
##  0.793291735  0.002511644  0.798578389  0.038885956  0.020648470</code></pre>
<p>Below the coefficients table, the “dispersion parameter” line refers to over-dispersion, a common issue with GLM. For a logistic regression, the response variable should be distributed <span class="math inline">\(y_i \sim \mathrm{Bin}(n_i, \pi_i)\)</span> with <span class="math inline">\(\mu_i = n_i \pi_i\)</span> and <span class="math inline">\(\sigma^2 = \pi (1 - \pi)\)</span>. Over-dispersion means the data shows evidence of variance greater than <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Skipping to the last line, Fisher scoring is a method for ML estimation. Logistic regression uses interatively reweighted least squares to fit the model, so this line indicates whether the algorithm converged.</p>
<p>Above Fisher, the null deviance is the likelihood ratio of the intercept-only model, <span class="math inline">\(G^2\)</span> = 129.49. The residual deviance is the likelihood ratio after including the model covariates, <span class="math inline">\(G^2\)</span> = 102.09. It is the sum of the squared deviance residuals discussed above. The residual deviance is distributed chi-squared and can be used to test whether the model differs from the saturated model (model with as many coefficients as observations, <span class="math inline">\(G^2\)</span> = 0, <em>df</em> = 0) where <span class="math inline">\(H_0\)</span> = no difference. The deviance test for lack of fit fails to reject the null hypothesis.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="generalized-linear-models-glm.html#cb176-1" tabindex="-1"></a><span class="co"># G^2 calculations</span></span>
<span id="cb176-2"><a href="generalized-linear-models-glm.html#cb176-2" tabindex="-1"></a><span class="fu">residuals</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">%&gt;%</span> .<span class="sc">^</span><span class="dv">2</span> <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb176-3"><a href="generalized-linear-models-glm.html#cb176-3" tabindex="-1"></a><span class="do">## [1] 102.0878</span></span>
<span id="cb176-4"><a href="generalized-linear-models-glm.html#cb176-4" tabindex="-1"></a><span class="fu">deviance</span>(cs1<span class="sc">$</span>fit)</span>
<span id="cb176-5"><a href="generalized-linear-models-glm.html#cb176-5" tabindex="-1"></a><span class="do">## [1] 102.0878</span></span>
<span id="cb176-6"><a href="generalized-linear-models-glm.html#cb176-6" tabindex="-1"></a></span>
<span id="cb176-7"><a href="generalized-linear-models-glm.html#cb176-7" tabindex="-1"></a><span class="co"># df</span></span>
<span id="cb176-8"><a href="generalized-linear-models-glm.html#cb176-8" tabindex="-1"></a><span class="fu">df.residual</span>(cs1<span class="sc">$</span>fit)</span>
<span id="cb176-9"><a href="generalized-linear-models-glm.html#cb176-9" tabindex="-1"></a><span class="do">## [1] 95</span></span>
<span id="cb176-10"><a href="generalized-linear-models-glm.html#cb176-10" tabindex="-1"></a></span>
<span id="cb176-11"><a href="generalized-linear-models-glm.html#cb176-11" tabindex="-1"></a><span class="co"># G^2 is distributed chi-squared with df degrees of freedom</span></span>
<span id="cb176-12"><a href="generalized-linear-models-glm.html#cb176-12" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fu">deviance</span>(cs1<span class="sc">$</span>fit), <span class="at">df =</span> <span class="fu">df.residual</span>(cs1<span class="sc">$</span>fit), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb176-13"><a href="generalized-linear-models-glm.html#cb176-13" tabindex="-1"></a><span class="do">## [1] 0.2911469</span></span>
<span id="cb176-14"><a href="generalized-linear-models-glm.html#cb176-14" tabindex="-1"></a>vcdExtra<span class="sc">::</span><span class="fu">LRstats</span>(cs1<span class="sc">$</span>fit)</span>
<span id="cb176-15"><a href="generalized-linear-models-glm.html#cb176-15" tabindex="-1"></a><span class="do">## Likelihood summary table:</span></span>
<span id="cb176-16"><a href="generalized-linear-models-glm.html#cb176-16" tabindex="-1"></a><span class="do">##            AIC    BIC LR Chisq Df Pr(&gt;Chisq)</span></span>
<span id="cb176-17"><a href="generalized-linear-models-glm.html#cb176-17" tabindex="-1"></a><span class="do">## cs1$fit 112.09 125.11   102.09 95     0.2911</span></span></code></pre></div>
<p>These two deviances (null, residual) are shown in the ANOVA summary. An ANOVA table shows the change in deviance from successively adding each variable to the model.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="generalized-linear-models-glm.html#cb177-1" tabindex="-1"></a><span class="fu">anova</span>(cs1<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: heart_disease
## 
## Terms added sequentially (first to last)
## 
## 
##          Df Deviance Resid. Df Resid. Dev
## NULL                        99     129.49
## age_c     1  11.9074        98     117.58
## weight_c  1   9.1820        97     108.40
## VO2max_c  1   0.5045        96     107.89
## gender    1   5.8076        95     102.09</code></pre>
</div>
<div id="interpretation-1" class="section level3 unnumbered hasAnchor">
<h3>Interpretation<a href="generalized-linear-models-glm.html#interpretation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start with the dependent variable. Plug in values for the predictor variables to get predictions. <span class="math inline">\(\hat{y}\)</span> is the log odds of a man of average age, height, and aerobic capacity having heart disease.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="generalized-linear-models-glm.html#cb179-1" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">age_c =</span> <span class="dv">0</span>, <span class="at">weight_c =</span> <span class="dv">0</span>, <span class="at">VO2max_c =</span> <span class="dv">0</span>, <span class="at">gender =</span> <span class="st">&quot;Male&quot;</span>)</span>
<span id="cb179-2"><a href="generalized-linear-models-glm.html#cb179-2" tabindex="-1"></a>(my_log_odds <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">newdata =</span> newdata) )</span></code></pre></div>
<pre><code>##           1 
## -0.09348302</code></pre>
<p>Exponentiate to get the <strong>odds</strong>, <span class="math inline">\(\exp (\hat{y}) = \frac{\pi}{1 - \pi}\)</span>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="generalized-linear-models-glm.html#cb181-1" tabindex="-1"></a>(my_odds <span class="ot">&lt;-</span> <span class="fu">exp</span>(my_log_odds))</span></code></pre></div>
<pre><code>##         1 
## 0.9107535</code></pre>
<p>Solve for <span class="math inline">\(\pi = \frac{\exp (\hat{y})}{1 + \exp (\hat{y})}\)</span> to get the <strong>probability</strong>. Do the math, or use <code>predict(type = "response")</code>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="generalized-linear-models-glm.html#cb183-1" tabindex="-1"></a>(my_prob <span class="ot">&lt;-</span> my_odds <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> my_odds))</span>
<span id="cb183-2"><a href="generalized-linear-models-glm.html#cb183-2" tabindex="-1"></a><span class="do">##         1 </span></span>
<span id="cb183-3"><a href="generalized-linear-models-glm.html#cb183-3" tabindex="-1"></a><span class="do">## 0.4766462</span></span>
<span id="cb183-4"><a href="generalized-linear-models-glm.html#cb183-4" tabindex="-1"></a><span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb183-5"><a href="generalized-linear-models-glm.html#cb183-5" tabindex="-1"></a><span class="do">##         1 </span></span>
<span id="cb183-6"><a href="generalized-linear-models-glm.html#cb183-6" tabindex="-1"></a><span class="do">## 0.4766462</span></span></code></pre></div>
<p>I may already be dead. Move on to the coefficients. Interpret the coefficient estimates as the change in the log odds of <span class="math inline">\(y\)</span> due to a one unit change in <span class="math inline">\(x\)</span>. If <span class="math inline">\(\delta = x_a - x_b\)</span>, then a <span class="math inline">\(\delta\)</span> change in <span class="math inline">\(x\)</span> is associated with a <span class="math inline">\(\delta \hat{\beta}\)</span> change in the log odds of <span class="math inline">\(y\)</span>. <span class="math inline">\(\beta\)</span> is the log odds ratio of <span class="math inline">\(x_a\)</span> vs <span class="math inline">\(x_b\)</span>.</p>
<p><span class="math display">\[\log \left(\pi / (1 - \pi) |_{x = x_a} \right) - \log \left(\pi / (1 - \pi) |_{x = x_b} \right) = \log \left( \frac{\pi / (1 - \pi) |_{x = x_a}}{\pi / (1 - \pi) |_{x = x_b}} \right) = \delta \hat{\beta}\]</span></p>
<p>The <em>exponential</em> of the coefficient estimates is the change in the <em>odds</em> of <span class="math inline">\(y\)</span> due to a <span class="math inline">\(\delta\)</span> change in <span class="math inline">\(x\)</span>. <span class="math inline">\(\exp \beta\)</span> is the odds ratio of <span class="math inline">\(x_a\)</span> vs <span class="math inline">\(x_b\)</span>.</p>
<p><span class="math display">\[\mathrm{odds}(y) = e^{\delta \hat{\beta}}\]</span></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="generalized-linear-models-glm.html#cb184-1" tabindex="-1"></a><span class="fu">coef</span>(cs1<span class="sc">$</span>fit)</span>
<span id="cb184-2"><a href="generalized-linear-models-glm.html#cb184-2" tabindex="-1"></a><span class="do">##  (Intercept)        age_c     weight_c     VO2max_c genderFemale </span></span>
<span id="cb184-3"><a href="generalized-linear-models-glm.html#cb184-3" tabindex="-1"></a><span class="do">## -0.093483020  0.085098077  0.005726835 -0.099023726 -1.949638795</span></span>
<span id="cb184-4"><a href="generalized-linear-models-glm.html#cb184-4" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(cs1<span class="sc">$</span>fit))</span>
<span id="cb184-5"><a href="generalized-linear-models-glm.html#cb184-5" tabindex="-1"></a><span class="do">##  (Intercept)        age_c     weight_c     VO2max_c genderFemale </span></span>
<span id="cb184-6"><a href="generalized-linear-models-glm.html#cb184-6" tabindex="-1"></a><span class="do">##    0.9107535    1.0888239    1.0057433    0.9057212    0.1423255</span></span></code></pre></div>
<p>The reference case in the model is <code>gender</code> = “Male”, <code>age</code> centered at 41.1 (<code>age_c</code> = 0), <code>weight</code> centered at 79.7 (<code>weight_c</code> = 0), and <code>VO2max</code> centered at 43.6 (<code>VO2max_c</code> = 0). The intercept term is the log-odds of heart disease at the reference case. Because the data is centered, the reference case is actually meaningful (i.e., not age 0, weight 0, and VO2max 0).</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="generalized-linear-models-glm.html#cb185-1" tabindex="-1"></a><span class="co"># The intercept equals the predicted value of the reference case.</span></span>
<span id="cb185-2"><a href="generalized-linear-models-glm.html#cb185-2" tabindex="-1"></a>(my_log_odds <span class="ot">&lt;-</span> <span class="fu">coef</span>(cs1<span class="sc">$</span>fit)[<span class="st">&quot;(Intercept)&quot;</span>])</span>
<span id="cb185-3"><a href="generalized-linear-models-glm.html#cb185-3" tabindex="-1"></a><span class="do">## (Intercept) </span></span>
<span id="cb185-4"><a href="generalized-linear-models-glm.html#cb185-4" tabindex="-1"></a><span class="do">## -0.09348302</span></span>
<span id="cb185-5"><a href="generalized-linear-models-glm.html#cb185-5" tabindex="-1"></a><span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb185-6"><a href="generalized-linear-models-glm.html#cb185-6" tabindex="-1"></a><span class="do">##           1 </span></span>
<span id="cb185-7"><a href="generalized-linear-models-glm.html#cb185-7" tabindex="-1"></a><span class="do">## -0.09348302</span></span>
<span id="cb185-8"><a href="generalized-linear-models-glm.html#cb185-8" tabindex="-1"></a></span>
<span id="cb185-9"><a href="generalized-linear-models-glm.html#cb185-9" tabindex="-1"></a><span class="co"># From log-odds to odds.</span></span>
<span id="cb185-10"><a href="generalized-linear-models-glm.html#cb185-10" tabindex="-1"></a>(my_odds <span class="ot">&lt;-</span> <span class="fu">exp</span>(my_log_odds))</span>
<span id="cb185-11"><a href="generalized-linear-models-glm.html#cb185-11" tabindex="-1"></a><span class="do">## (Intercept) </span></span>
<span id="cb185-12"><a href="generalized-linear-models-glm.html#cb185-12" tabindex="-1"></a><span class="do">##   0.9107535</span></span>
<span id="cb185-13"><a href="generalized-linear-models-glm.html#cb185-13" tabindex="-1"></a></span>
<span id="cb185-14"><a href="generalized-linear-models-glm.html#cb185-14" tabindex="-1"></a><span class="co"># Probability.</span></span>
<span id="cb185-15"><a href="generalized-linear-models-glm.html#cb185-15" tabindex="-1"></a>(my_prob <span class="ot">&lt;-</span> my_odds <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> my_odds))</span>
<span id="cb185-16"><a href="generalized-linear-models-glm.html#cb185-16" tabindex="-1"></a><span class="do">## (Intercept) </span></span>
<span id="cb185-17"><a href="generalized-linear-models-glm.html#cb185-17" tabindex="-1"></a><span class="do">##   0.4766462</span></span>
<span id="cb185-18"><a href="generalized-linear-models-glm.html#cb185-18" tabindex="-1"></a><span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb185-19"><a href="generalized-linear-models-glm.html#cb185-19" tabindex="-1"></a><span class="do">##         1 </span></span>
<span id="cb185-20"><a href="generalized-linear-models-glm.html#cb185-20" tabindex="-1"></a><span class="do">## 0.4766462</span></span></code></pre></div>
<p>The log odds of heart disease for a 41.1 year old male weighing 79.7 kg and with 43.6 VO2max are <span class="math inline">\(\hat{y} = \mathrm{Intercept}\)</span> = -0.09. The odds are <span class="math inline">\(\exp(\hat{y})\)</span> = 0.91. The expected probability is <span class="math inline">\(\frac{\exp(\hat{y})}{1 + \exp(\hat{y})}\)</span> = 47.7%.</p>
<p>What about females? A female’s log odds of heart disease are <code>coef(cs1$fit)["genderFemale"]</code> = -1.95 times that of a male’s (log(OR) = -1.95). A female’s odds are <code>exp(coef(cs1$fit)["genderFemale"])</code> = 0.14 times that of a male’s (OR = 0.14). A female’s expected probability is <code>predict(cs1$fit, newdata = list(age_c = 0, weight_c = 0, VO2max_c = 0, gender = "Female"), type = "response")</code> = 11.5%.</p>
<p>A one-unit increase in any of the continuous independent variables is interpreted similarly. The reference level is unimportant since the change is constant across the range of values. A one year increase in age increases the log-odds of heart disease by a factor of 0.085, and the odds by a factor of exp(0.085) = 1.089. To calculate the effect of a <em>decade</em> increase in age, multiply <span class="math inline">\(\beta\)</span> by 10 before exponentiating, or raise the exponentiated coeficient by 10. The effect of a 10-year increase in age is to increase the odds of heart disease by <code>exp(coef(cs1$fit)["age_c"] * 10)</code> = 2.342. The odds more than double every ten years.</p>
<p><code>oddsratio::or_glm()</code> is a handy way to calculate odds ratios from arbitrary increments to the predictors. Here are the ORs of a 10-year age change, 10 kg weight change, and VO2max change of 5.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="generalized-linear-models-glm.html#cb186-1" tabindex="-1"></a>oddsratio<span class="sc">::</span><span class="fu">or_glm</span>(cs1<span class="sc">$</span>dat, cs1<span class="sc">$</span>fit, <span class="at">incr =</span> <span class="fu">list</span>(<span class="at">age_c =</span> <span class="dv">10</span>, <span class="at">weight_c =</span> <span class="dv">10</span>, <span class="at">VO2max_c =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##      predictor oddsratio ci_low (2.5) ci_high (97.5)          increment
## 1        age_c     2.342        1.391          4.270                 10
## 2     weight_c     1.059        0.680          1.664                 10
## 3     VO2max_c     0.609        0.368          0.952                  5
## 4 genderFemale     0.142        0.025          0.700 Indicator variable</code></pre>
<p>Notice how the predicted probabilities have the sigmoidal shape of the binary relationship.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="generalized-linear-models-glm.html#cb188-1" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>fit, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb188-2"><a href="generalized-linear-models-glm.html#cb188-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_c, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb188-3"><a href="generalized-linear-models-glm.html#cb188-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(heart_disease <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>))) <span class="sc">+</span></span>
<span id="cb188-4"><a href="generalized-linear-models-glm.html#cb188-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb188-5"><a href="generalized-linear-models-glm.html#cb188-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb188-6"><a href="generalized-linear-models-glm.html#cb188-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb188-7"><a href="generalized-linear-models-glm.html#cb188-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb188-8"><a href="generalized-linear-models-glm.html#cb188-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Binary Fitted Line Plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-9"><a href="generalized-linear-models-glm.html#cb188-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Heart Disease&quot;</span>, <span class="st">&quot;Healthy&quot;</span>)) <span class="sc">+</span></span>
<span id="cb188-10"><a href="generalized-linear-models-glm.html#cb188-10" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb188-11"><a href="generalized-linear-models-glm.html#cb188-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="assumptions" class="section level3 unnumbered hasAnchor">
<h3>Assumptions<a href="generalized-linear-models-glm.html#assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Four assumptions relate to the study design: (1) the dependent variable is dichotomous; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid. Three more assumptions related to the data distribution:</p>
<ul>
<li><p>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</p></li>
<li><p>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</p></li>
<li><p>There are no influential outliers. Test with Cook’s distance.</p></li>
</ul>
<p>Test the linearity assumption first. There are two ways to do this (do both). First, fit your model, then plot the <em>fitted values</em> against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the <em>logit</em> transformation. These plotted relationships look pretty linear.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="generalized-linear-models-glm.html#cb189-1" tabindex="-1"></a><span class="fu">glm</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max, <span class="at">data =</span> cs1<span class="sc">$</span>dat, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb189-2"><a href="generalized-linear-models-glm.html#cb189-2" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb189-3"><a href="generalized-linear-models-glm.html#cb189-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(age, weight, VO2max)) <span class="sc">%&gt;%</span></span>
<span id="cb189-4"><a href="generalized-linear-models-glm.html#cb189-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb189-5"><a href="generalized-linear-models-glm.html#cb189-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb189-6"><a href="generalized-linear-models-glm.html#cb189-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-7"><a href="generalized-linear-models-glm.html#cb189-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> <span class="st">&quot;y~x&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-8"><a href="generalized-linear-models-glm.html#cb189-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Linearity Test: predicted vs continuous predictors&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, <span class="math inline">\(x_{Tx} = x \log x\)</span>, then test their significance level in the fit.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="generalized-linear-models-glm.html#cb190-1" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb190-2"><a href="generalized-linear-models-glm.html#cb190-2" tabindex="-1"></a>cs1<span class="sc">$</span>boxtidwell <span class="ot">&lt;-</span> cs1<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb190-3"><a href="generalized-linear-models-glm.html#cb190-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb190-4"><a href="generalized-linear-models-glm.html#cb190-4" tabindex="-1"></a>    <span class="at">age_tx =</span> <span class="fu">log</span>(age) <span class="sc">*</span> age,</span>
<span id="cb190-5"><a href="generalized-linear-models-glm.html#cb190-5" tabindex="-1"></a>    <span class="at">weight_tx =</span> <span class="fu">log</span>(weight) <span class="sc">*</span> weight,</span>
<span id="cb190-6"><a href="generalized-linear-models-glm.html#cb190-6" tabindex="-1"></a>    <span class="at">VO2max_tx =</span> <span class="fu">log</span>(VO2max) <span class="sc">*</span> VO2max</span>
<span id="cb190-7"><a href="generalized-linear-models-glm.html#cb190-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb190-8"><a href="generalized-linear-models-glm.html#cb190-8" tabindex="-1"></a>  <span class="fu">glm</span>(heart_disease <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> VO2max <span class="sc">+</span> gender <span class="sc">+</span> age_tx <span class="sc">+</span> weight_tx <span class="sc">+</span> VO2max_tx, </span>
<span id="cb190-9"><a href="generalized-linear-models-glm.html#cb190-9" tabindex="-1"></a>      <span class="at">data =</span> ., <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb190-10"><a href="generalized-linear-models-glm.html#cb190-10" tabindex="-1"></a></span>
<span id="cb190-11"><a href="generalized-linear-models-glm.html#cb190-11" tabindex="-1"></a><span class="fu">tidy</span>(cs1<span class="sc">$</span>boxtidwell)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 5
##   term         estimate std.error statistic p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)  -38.7       21.8      -1.78   0.0756
## 2 age            2.73       1.10      2.47   0.0135
## 3 weight         0.144      0.783     0.184  0.854 
## 4 VO2max         1.32       1.82      0.724  0.469 
## 5 genderFemale  -1.85       0.922    -2.01   0.0443
## 6 age_tx        -0.543      0.227    -2.40   0.0164
## 7 weight_tx     -0.0266     0.146    -0.182  0.855 
## 8 VO2max_tx     -0.301      0.382    -0.788  0.431</code></pre>
<p>Focus on the three transformed variables. <code>age_tx</code> is the only one with a <em>p</em>-value &lt;.05, but it is customary to apply a Bonferroni adjustment when testing for linearity. There are eight predictors in the model (including the intercept term), so the Bonferroni adjusted <em>p</em>-value for <code>age_tx</code> is 0.0164 x 8 = 0.132, so do not reject the null hypothesis of linearity.</p>
<p>If the relationship <em>was</em> nonlinear, you could try transforming the variable by raising it to <span class="math inline">\(\lambda = 1 + b / \gamma\)</span> where <span class="math inline">\(b\)</span> is the estimated coefficient of the model without the interaction terms, and <span class="math inline">\(\gamma\)</span> is the estimated coefficient of the interaction term of the model with interactions. In the case of <code>age</code>, <span class="math inline">\(b\)</span> is 0.085 and <span class="math inline">\(\gamma\)</span> is -0.543, so <span class="math inline">\(\lambda\)</span> = 1 + 0.085 / -0.543 = 0.843. This is approximately 1 (no transformation). It seems customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal.</p>
<p>Now check for multicollinearity. Variance inflation factors (VIF) estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[
\mathrm{VIF}_i = \frac{1}{1 - R_i^2}
\]</span></p>
<p>where <span class="math inline">\(R_i^2\)</span> is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of <span class="math inline">\(X_i\)</span> against all of the other predictors, <span class="math inline">\(X_i = X_{j \ne i} \beta + \epsilon\)</span>. If <span class="math inline">\(X_i\)</span> is totally unrelated to its covariates, then <span class="math inline">\(R_i^2\)</span> will be zero and <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 1. If <span class="math inline">\(R_i^2\)</span> is .8, <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 5. The rule of thumb is that <span class="math inline">\(R_i^2 \le 5\)</span> is tolerable, and <span class="math inline">\(R_i^2 &gt; 5\)</span> is “highly correlated” and you have to do something about it. These are excellent.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="generalized-linear-models-glm.html#cb192-1" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(cs1<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##    age_c weight_c VO2max_c   gender 
## 1.035274 1.900575 2.167067 2.502538</code></pre>
<p>Try calculating the <span class="math inline">\(\mathrm{VIF}\)</span> for <code>age_c</code>.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="generalized-linear-models-glm.html#cb194-1" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(age_c <span class="sc">~</span> weight_c <span class="sc">+</span> VO2max_c <span class="sc">+</span> gender, <span class="at">data =</span> cs1<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb194-2"><a href="generalized-linear-models-glm.html#cb194-2" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">&quot;r.squared&quot;</span>)</span>
<span id="cb194-3"><a href="generalized-linear-models-glm.html#cb194-3" tabindex="-1"></a></span>
<span id="cb194-4"><a href="generalized-linear-models-glm.html#cb194-4" tabindex="-1"></a>(vif <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> r2))</span>
<span id="cb194-5"><a href="generalized-linear-models-glm.html#cb194-5" tabindex="-1"></a><span class="do">## [1] 1.05715</span></span></code></pre></div>
<p>(I don’t know why this doesn’t work. It <em>would</em> work if the underlying model was OLS instead of GLM. The answer seems to be related to GVIF vs VIF, but I didn’t figure it out.)</p>
<p>Now check for influential outliers. Predict the response probabilities and filter for the predictions more than two standard deviations from the actual value and a Cook’s Distance greater than 4/N = 0.04.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> Cook’s distance measures how much predicted values change when observation <em>i</em> is removed from the data. Only two fitted values were both an outlier and influential, row ids 59 and 70. An index plot of Cook’s Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of 2.01 and 2.27 standard deviations which were kept in the analysis.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="generalized-linear-models-glm.html#cb195-1" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>fit, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="generalized-linear-models-glm.html#cb195-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb195-3"><a href="generalized-linear-models-glm.html#cb195-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb195-4"><a href="generalized-linear-models-glm.html#cb195-4" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">if_else</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>, <span class="st">&quot;Outlier&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb195-5"><a href="generalized-linear-models-glm.html#cb195-5" tabindex="-1"></a>    <span class="at">influential =</span> <span class="fu">if_else</span>(.cooksd <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="st">&quot;Influential&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb195-6"><a href="generalized-linear-models-glm.html#cb195-6" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb195-7"><a href="generalized-linear-models-glm.html#cb195-7" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">&quot;Outlier&quot;</span> <span class="sc">&amp;</span> influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span> <span class="sc">~</span> <span class="st">&quot;Influential Outlier&quot;</span>,</span>
<span id="cb195-8"><a href="generalized-linear-models-glm.html#cb195-8" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">&quot;Outlier&quot;</span> <span class="sc">~</span> <span class="st">&quot;Outlier&quot;</span>,</span>
<span id="cb195-9"><a href="generalized-linear-models-glm.html#cb195-9" tabindex="-1"></a>      influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span> <span class="sc">~</span> <span class="st">&quot;Influential&quot;</span>,</span>
<span id="cb195-10"><a href="generalized-linear-models-glm.html#cb195-10" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span></span>
<span id="cb195-11"><a href="generalized-linear-models-glm.html#cb195-11" tabindex="-1"></a>    )</span>
<span id="cb195-12"><a href="generalized-linear-models-glm.html#cb195-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-13"><a href="generalized-linear-models-glm.html#cb195-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb195-14"><a href="generalized-linear-models-glm.html#cb195-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb195-15"><a href="generalized-linear-models-glm.html#cb195-15" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">if_else</span>(influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span>, id, <span class="cn">NA_integer_</span>)), </span>
<span id="cb195-16"><a href="generalized-linear-models-glm.html#cb195-16" tabindex="-1"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> .<span class="dv">025</span>) <span class="sc">+</span></span>
<span id="cb195-17"><a href="generalized-linear-models-glm.html#cb195-17" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb195-18"><a href="generalized-linear-models-glm.html#cb195-18" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Influential Outlier&quot;</span> <span class="ot">=</span> <span class="st">&quot;firebrick&quot;</span>, </span>
<span id="cb195-19"><a href="generalized-linear-models-glm.html#cb195-19" tabindex="-1"></a>                                <span class="st">&quot;Influential&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod&quot;</span>,</span>
<span id="cb195-20"><a href="generalized-linear-models-glm.html#cb195-20" tabindex="-1"></a>                                <span class="st">&quot;Outlier&quot;</span> <span class="ot">=</span> <span class="st">&quot;slategray&quot;</span>,</span>
<span id="cb195-21"><a href="generalized-linear-models-glm.html#cb195-21" tabindex="-1"></a>                                <span class="st">&quot;Other&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb195-22"><a href="generalized-linear-models-glm.html#cb195-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-23"><a href="generalized-linear-models-glm.html#cb195-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Index Plot of Cook&#39;s Distance.&quot;</span>,</span>
<span id="cb195-24"><a href="generalized-linear-models-glm.html#cb195-24" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Row id labeled for values &gt; 4 / N.&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
<div id="model-fit" class="section level3 unnumbered hasAnchor">
<h3>Model Fit<a href="generalized-linear-models-glm.html#model-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are several ways to evaluate the model fit.</p>
<ul>
<li>The likelihood ratio test</li>
<li>Pseudo R-squared<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</li>
<li>Accuracy measures</li>
<li>Gain and ROC curves</li>
</ul>
<p>The <strong>likelihood ratio test</strong> compares the log likelihood of the fitted model to an intercept-only model.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="generalized-linear-models-glm.html#cb196-1" tabindex="-1"></a>(cs1<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs1<span class="sc">$</span>fit))</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: heart_disease ~ age_c + weight_c + VO2max_c + gender
## Model 2: heart_disease ~ 1
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   5 -51.044                         
## 2   1 -64.745 -4 27.402  1.649e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The fitted model is significant, <span class="math inline">\(\chi^2\)</span>(4) = 27.4, <em>p</em> &lt; .001. Calculate the pseuedo R2 with <code>DescTools::PseudoR2()</code>.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="generalized-linear-models-glm.html#cb198-1" tabindex="-1"></a>(cs1<span class="sc">$</span>pseudo_r2 <span class="ot">&lt;-</span> DescTools<span class="sc">::</span><span class="fu">PseudoR2</span>(cs1<span class="sc">$</span>fit, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">&quot;CoxSnell&quot;</span>, <span class="st">&quot;Nagelkerke&quot;</span>, <span class="st">&quot;McFadden&quot;</span>)))</span></code></pre></div>
<pre><code>##   CoxSnell Nagelkerke   McFadden 
##  0.2396799  0.3301044  0.2116126</code></pre>
<p>Laerd interprets this as the model explained 33.0% (Nagelkerke R2) of the variance in heart disease. This is how your would interpret R2 in an OLS model. <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">UCLA</a> points out that the various pseudo R-squareds measure other aspects of the model and are unique to the measured quantity. A pseudo R-squared is not very informative on its own; it is useful for comparing models. Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better way to go.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="generalized-linear-models-glm.html#cb200-1" tabindex="-1"></a>(cs1<span class="sc">$</span>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(</span>
<span id="cb200-2"><a href="generalized-linear-models-glm.html#cb200-2" tabindex="-1"></a>  <span class="at">pred =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(<span class="fu">predict</span>(cs1<span class="sc">$</span>fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)),</span>
<span id="cb200-3"><a href="generalized-linear-models-glm.html#cb200-3" tabindex="-1"></a>  <span class="at">truth =</span> <span class="fu">factor</span>(cs1<span class="sc">$</span>dat<span class="sc">$</span>heart_disease, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>))</span>
<span id="cb200-4"><a href="generalized-linear-models-glm.html#cb200-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb200-5"><a href="generalized-linear-models-glm.html#cb200-5" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>())</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##      truth
## pred  Yes No
##   Yes  16 10
##   No   19 55
##                                           
##                Accuracy : 0.71            
##                  95% CI : (0.6107, 0.7964)
##     No Information Rate : 0.65            
##     P-Value [Acc &gt; NIR] : 0.1236          
##                                           
##                   Kappa : 0.3224          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.1374          
##                                           
##             Sensitivity : 0.4571          
##             Specificity : 0.8462          
##          Pos Pred Value : 0.6154          
##          Neg Pred Value : 0.7432          
##              Prevalence : 0.3500          
##          Detection Rate : 0.1600          
##    Detection Prevalence : 0.2600          
##       Balanced Accuracy : 0.6516          
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
<p>The model accuracy, 71.0%, is the percent of observations correctly classified. The sensitivity, 45.7%, is the accuracy with regard to predicting positive cases. The specificity, 84.6%, is the accuracy with regard to predicting negative cases. The prevalence, 35.0% is the proportion of cases that were positive.</p>
<p>Finally, plot the <a href="https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference">gain curve or ROC curve</a>. In the <strong>gain curve</strong>, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The “wizard” curve is the gain curve when the data is sorted by the true outcome. If the model’s gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the “gain” over a random prediction.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="generalized-linear-models-glm.html#cb202-1" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>fit, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="generalized-linear-models-glm.html#cb202-2" tabindex="-1"></a>  <span class="co"># event_level = &quot;second&quot; sets the second level as success</span></span>
<span id="cb202-3"><a href="generalized-linear-models-glm.html#cb202-3" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(heart_disease, .fitted, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-4"><a href="generalized-linear-models-glm.html#cb202-4" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb202-5"><a href="generalized-linear-models-glm.html#cb202-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Gain Curve&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>35 of the 100 participants had heart disease.</p>
<ul>
<li>The gain curve encountered 18 heart disease cases (51%) within the first 28 observations (28%). It encountered all 35 heart disease cases on the 89th observation.</li>
<li>The bottom of the grey area is the outcome of a random model. Only half the heart disease cases would be observed within 50% of the observations.<br />
</li>
<li>The top of the grey area is the outcome of the perfect model, the “wizard curve”. Half the heart disease cases would be observed in 18/100=18% of the observations.</li>
</ul>
<p>The <strong>ROC</strong> (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="generalized-linear-models-glm.html#cb203-1" tabindex="-1"></a><span class="fu">augment</span>(cs1<span class="sc">$</span>fit, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb203-2"><a href="generalized-linear-models-glm.html#cb203-2" tabindex="-1"></a>  <span class="co"># event_level = &quot;second&quot; sets the second level as success</span></span>
<span id="cb203-3"><a href="generalized-linear-models-glm.html#cb203-3" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(heart_disease, .fitted, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb203-4"><a href="generalized-linear-models-glm.html#cb203-4" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb203-5"><a href="generalized-linear-models-glm.html#cb203-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ROC Curve&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
</div>
<div id="reporting" class="section level3 unnumbered hasAnchor">
<h3>Reporting<a href="generalized-linear-models-glm.html#reporting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>A binomial logistic regression was performed to ascertain the effects of age, weight, gender and VO2max on the likelihood that participants have heart disease. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when <em>p</em> &lt; 0.00625 (Tabachnick &amp; Fidell, 2014). Based on this assessment, all continuous independent variables were found to be linearly related to the logit of the dependent variable. There were two standardized residuals with value of 2.01 and 2.27 standard deviations, which were kept in the analysis. The logistic regression model was statistically significant, χ2(4) = 27.40, p &lt; .001. The model explained 33.0% (Nagelkerke R2) of the variance in heart disease and correctly classified 71.0% of cases. Sensitivity was 45.7%, specificity was 84.6%, positive predictive value was 61.5% and negative predictive value was 74.3%. Of the five predictor variables only three were statistically significant: age, gender and VO2max (as shown in Table 1). Females had 0.14 times lower odds to exhibit heart disease than males. Increasing age was associated with an increased likelihood of exhibiting heart disease, but increasing VO2max was associated with a reduction in the likelihood of exhibiting heart disease.</p>
</blockquote>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="generalized-linear-models-glm.html#cb204-1" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(</span>
<span id="cb204-2"><a href="generalized-linear-models-glm.html#cb204-2" tabindex="-1"></a>  cs1<span class="sc">$</span>fit,</span>
<span id="cb204-3"><a href="generalized-linear-models-glm.html#cb204-3" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb204-4"><a href="generalized-linear-models-glm.html#cb204-4" tabindex="-1"></a>)</span></code></pre></div>
<div id="rjgfxbpqve" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rjgfxbpqve table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rjgfxbpqve thead, #rjgfxbpqve tbody, #rjgfxbpqve tfoot, #rjgfxbpqve tr, #rjgfxbpqve td, #rjgfxbpqve th {
  border-style: none;
}

#rjgfxbpqve p {
  margin: 0;
  padding: 0;
}

#rjgfxbpqve .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rjgfxbpqve .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rjgfxbpqve .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rjgfxbpqve .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rjgfxbpqve .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjgfxbpqve .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjgfxbpqve .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjgfxbpqve .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rjgfxbpqve .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rjgfxbpqve .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rjgfxbpqve .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rjgfxbpqve .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rjgfxbpqve .gt_spanner_row {
  border-bottom-style: hidden;
}

#rjgfxbpqve .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rjgfxbpqve .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rjgfxbpqve .gt_from_md > :first-child {
  margin-top: 0;
}

#rjgfxbpqve .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rjgfxbpqve .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rjgfxbpqve .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rjgfxbpqve .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rjgfxbpqve .gt_row_group_first td {
  border-top-width: 2px;
}

#rjgfxbpqve .gt_row_group_first th {
  border-top-width: 2px;
}

#rjgfxbpqve .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjgfxbpqve .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rjgfxbpqve .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rjgfxbpqve .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjgfxbpqve .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjgfxbpqve .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rjgfxbpqve .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rjgfxbpqve .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rjgfxbpqve .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjgfxbpqve .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjgfxbpqve .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjgfxbpqve .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjgfxbpqve .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjgfxbpqve .gt_left {
  text-align: left;
}

#rjgfxbpqve .gt_center {
  text-align: center;
}

#rjgfxbpqve .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rjgfxbpqve .gt_font_normal {
  font-weight: normal;
}

#rjgfxbpqve .gt_font_bold {
  font-weight: bold;
}

#rjgfxbpqve .gt_font_italic {
  font-style: italic;
}

#rjgfxbpqve .gt_super {
  font-size: 65%;
}

#rjgfxbpqve .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rjgfxbpqve .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rjgfxbpqve .gt_indent_1 {
  text-indent: 5px;
}

#rjgfxbpqve .gt_indent_2 {
  text-indent: 10px;
}

#rjgfxbpqve .gt_indent_3 {
  text-indent: 15px;
}

#rjgfxbpqve .gt_indent_4 {
  text-indent: 20px;
}

#rjgfxbpqve .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;OR&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">age_c</td>
<td headers="estimate" class="gt_row gt_center">1.09</td>
<td headers="ci" class="gt_row gt_center">1.03, 1.16</td>
<td headers="p.value" class="gt_row gt_center">0.003</td></tr>
    <tr><td headers="label" class="gt_row gt_left">weight_c</td>
<td headers="estimate" class="gt_row gt_center">1.01</td>
<td headers="ci" class="gt_row gt_center">0.96, 1.05</td>
<td headers="p.value" class="gt_row gt_center">0.8</td></tr>
    <tr><td headers="label" class="gt_row gt_left">VO2max_c</td>
<td headers="estimate" class="gt_row gt_center">0.91</td>
<td headers="ci" class="gt_row gt_center">0.82, 0.99</td>
<td headers="p.value" class="gt_row gt_center">0.039</td></tr>
    <tr><td headers="label" class="gt_row gt_left">gender</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Male</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Female</td>
<td headers="estimate" class="gt_row gt_center">0.14</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.70</td>
<td headers="p.value" class="gt_row gt_center">0.021</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<div id="multinomiallogistic" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Multinomial Logistic Regression<a href="generalized-linear-models-glm.html#multinomiallogistic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <em>multinomial</em> logistic regression model is <span class="math inline">\(J - 1\)</span> baseline logits,</p>
<p><span class="math display">\[y_i = \log \left( \frac{\pi_{ij}}{\pi_{ij^*}} \right) = X_i \beta_j, \hspace{5mm} j \ne j^*\]</span></p>
<p>where <span class="math inline">\(j\)</span> is a level of the multinomial response variable. Whereas binomial logistic regression models the <em>log odds</em> of the response level, multinomial logistic regression models the <em>log relative risk</em>, the probability relative to the baseline <span class="math inline">\(j^*\)</span> level.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
<p>As with binary logistic regression, interpret the <span class="math inline">\(k^{th}\)</span> element of <span class="math inline">\(\beta_j\)</span> as the increase in log odds (log relative risk) of <span class="math inline">\(Y_i = j\)</span> relative to <span class="math inline">\(Y_i = j^*\)</span> given a one-unit increase in the <span class="math inline">\(k^{th}\)</span> element of <span class="math inline">\(X\)</span>, holding the other terms constant. The individual probabilities, <span class="math inline">\(\pi_{ij}\)</span>, are</p>
<p><span class="math display">\[\pi_{ij} = \frac{\exp(y_{ij})}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{e^{X_i\beta_j}}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}\]</span></p>
<p>and for the baseline category,</p>
<p><span class="math display">\[\pi_{ij^*} = \frac{1}{1 + \sum_{j \ne j^*} \exp(y_{ij})} = \frac{1}{1 + \sum_{j \ne j^*} e^{X_i\beta_j}}\]</span></p>
<p><strong>Assumptions</strong></p>
<p>Multinomial logistic regression applies when the dependent variable is categorical. It presumes a linear relationship between the log odds of the dependent variable and <span class="math inline">\(X\)</span> with residuals <span class="math inline">\(\epsilon\)</span> that are independent. It also assumes there is no severe multicollinearity in the predictors, and there is independence of irrelevant alternatives (IIA). IIA means the relative likelihood of being in one category compared to the base category would not change if you added other categories.</p>
</div>
<div id="cs2" class="section level2 unnumbered hasAnchor">
<h2>Case Study 2<a href="generalized-linear-models-glm.html#cs2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This case study uses the data set from <a href="https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/">this UCLA tutorial</a>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="generalized-linear-models-glm.html#cb205-1" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb205-2"><a href="generalized-linear-models-glm.html#cb205-2" tabindex="-1"></a>  <span class="st">&quot;https://stats.idre.ucla.edu/stat/data/hsbdemo.dta&quot;</span>,</span>
<span id="cb205-3"><a href="generalized-linear-models-glm.html#cb205-3" tabindex="-1"></a>  <span class="st">&quot;./input/hsbdemo.dta&quot;</span>,</span>
<span id="cb205-4"><a href="generalized-linear-models-glm.html#cb205-4" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span></span>
<span id="cb205-5"><a href="generalized-linear-models-glm.html#cb205-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="generalized-linear-models-glm.html#cb206-1" tabindex="-1"></a>cs2 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb206-2"><a href="generalized-linear-models-glm.html#cb206-2" tabindex="-1"></a></span>
<span id="cb206-3"><a href="generalized-linear-models-glm.html#cb206-3" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.dta</span>(<span class="st">&quot;./input/hsbdemo.dta&quot;</span>)</span></code></pre></div>
<p>A study measures the association between students’ academic program (academic, general, and vocational) and their socioeconomic status (SES) (low, middle, high) and writing score.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="generalized-linear-models-glm.html#cb207-1" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb207-2"><a href="generalized-linear-models-glm.html#cb207-2" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb207-3"><a href="generalized-linear-models-glm.html#cb207-3" tabindex="-1"></a>    <span class="at">by =</span> prog,</span>
<span id="cb207-4"><a href="generalized-linear-models-glm.html#cb207-4" tabindex="-1"></a>    <span class="at">include =</span> <span class="fu">c</span>(prog, ses, write),</span>
<span id="cb207-5"><a href="generalized-linear-models-glm.html#cb207-5" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;{mean}, {sd}&quot;</span>)</span>
<span id="cb207-6"><a href="generalized-linear-models-glm.html#cb207-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb207-7"><a href="generalized-linear-models-glm.html#cb207-7" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">add_overall</span>()</span></code></pre></div>
<div id="itcrxqkwxa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#itcrxqkwxa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#itcrxqkwxa thead, #itcrxqkwxa tbody, #itcrxqkwxa tfoot, #itcrxqkwxa tr, #itcrxqkwxa td, #itcrxqkwxa th {
  border-style: none;
}

#itcrxqkwxa p {
  margin: 0;
  padding: 0;
}

#itcrxqkwxa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#itcrxqkwxa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#itcrxqkwxa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#itcrxqkwxa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#itcrxqkwxa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#itcrxqkwxa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#itcrxqkwxa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#itcrxqkwxa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#itcrxqkwxa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#itcrxqkwxa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#itcrxqkwxa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#itcrxqkwxa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#itcrxqkwxa .gt_spanner_row {
  border-bottom-style: hidden;
}

#itcrxqkwxa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#itcrxqkwxa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#itcrxqkwxa .gt_from_md > :first-child {
  margin-top: 0;
}

#itcrxqkwxa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#itcrxqkwxa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#itcrxqkwxa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#itcrxqkwxa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#itcrxqkwxa .gt_row_group_first td {
  border-top-width: 2px;
}

#itcrxqkwxa .gt_row_group_first th {
  border-top-width: 2px;
}

#itcrxqkwxa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#itcrxqkwxa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#itcrxqkwxa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#itcrxqkwxa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#itcrxqkwxa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#itcrxqkwxa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#itcrxqkwxa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#itcrxqkwxa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#itcrxqkwxa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#itcrxqkwxa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#itcrxqkwxa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#itcrxqkwxa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#itcrxqkwxa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#itcrxqkwxa .gt_left {
  text-align: left;
}

#itcrxqkwxa .gt_center {
  text-align: center;
}

#itcrxqkwxa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#itcrxqkwxa .gt_font_normal {
  font-weight: normal;
}

#itcrxqkwxa .gt_font_bold {
  font-weight: bold;
}

#itcrxqkwxa .gt_font_italic {
  font-style: italic;
}

#itcrxqkwxa .gt_super {
  font-size: 65%;
}

#itcrxqkwxa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#itcrxqkwxa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#itcrxqkwxa .gt_indent_1 {
  text-indent: 5px;
}

#itcrxqkwxa .gt_indent_2 {
  text-indent: 10px;
}

#itcrxqkwxa .gt_indent_3 {
  text-indent: 15px;
}

#itcrxqkwxa .gt_indent_4 {
  text-indent: 20px;
}

#itcrxqkwxa .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Overall&lt;/strong&gt;, N = 200&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Overall</strong>, N = 200<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;general&lt;/strong&gt;, N = 45&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>general</strong>, N = 45<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;academic&lt;/strong&gt;, N = 105&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>academic</strong>, N = 105<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;vocation&lt;/strong&gt;, N = 50&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>vocation</strong>, N = 50<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">ses</td>
<td headers="stat_0" class="gt_row gt_center"></td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td>
<td headers="stat_3" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    low</td>
<td headers="stat_0" class="gt_row gt_center">47 (24%)</td>
<td headers="stat_1" class="gt_row gt_center">16 (36%)</td>
<td headers="stat_2" class="gt_row gt_center">19 (18%)</td>
<td headers="stat_3" class="gt_row gt_center">12 (24%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    middle</td>
<td headers="stat_0" class="gt_row gt_center">95 (48%)</td>
<td headers="stat_1" class="gt_row gt_center">20 (44%)</td>
<td headers="stat_2" class="gt_row gt_center">44 (42%)</td>
<td headers="stat_3" class="gt_row gt_center">31 (62%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    high</td>
<td headers="stat_0" class="gt_row gt_center">58 (29%)</td>
<td headers="stat_1" class="gt_row gt_center">9 (20%)</td>
<td headers="stat_2" class="gt_row gt_center">42 (40%)</td>
<td headers="stat_3" class="gt_row gt_center">7 (14%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">write</td>
<td headers="stat_0" class="gt_row gt_center">53, 9</td>
<td headers="stat_1" class="gt_row gt_center">51, 9</td>
<td headers="stat_2" class="gt_row gt_center">56, 8</td>
<td headers="stat_3" class="gt_row gt_center">47, 9</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="5"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%); Mean, SD</td>
    </tr>
  </tfoot>
</table>
</div>
<p><br></p>
<p>Establish your expectations with a brief exploratory analysis. Academic programs are associated with higher writing scores and SES. General and vocational programs are the opposite, although SES has opposing effects for general (increased probability) and vocational (decreased probability).</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="generalized-linear-models-glm.html#cb208-1" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="generalized-linear-models-glm.html#cb208-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_bin =</span> <span class="fu">cut</span>(write, <span class="at">breaks =</span> <span class="dv">5</span>, <span class="at">dig.lab =</span> <span class="dv">1</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="generalized-linear-models-glm.html#cb208-3" tabindex="-1"></a>  <span class="fu">count</span>(prog, ses, write_bin) <span class="sc">%&gt;%</span></span>
<span id="cb208-4"><a href="generalized-linear-models-glm.html#cb208-4" tabindex="-1"></a>  <span class="fu">group_by</span>(ses, write_bin) <span class="sc">%&gt;%</span></span>
<span id="cb208-5"><a href="generalized-linear-models-glm.html#cb208-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb208-6"><a href="generalized-linear-models-glm.html#cb208-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb208-7"><a href="generalized-linear-models-glm.html#cb208-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write_bin, <span class="at">y =</span> prob, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb208-8"><a href="generalized-linear-models-glm.html#cb208-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb208-9"><a href="generalized-linear-models-glm.html#cb208-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ses)) <span class="sc">+</span></span>
<span id="cb208-10"><a href="generalized-linear-models-glm.html#cb208-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog)) <span class="sc">+</span></span>
<span id="cb208-11"><a href="generalized-linear-models-glm.html#cb208-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-12"><a href="generalized-linear-models-glm.html#cb208-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Program Proportions by SES&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>Standardize <code>write</code> to facilitate model interpretation. The intercept will represent a reasonable condition (average writing score) and a one-unit incrase in <code>write_c</code> will represent a 1SD increase in writing. Set <em>academic</em> as the reference level for the dependent variable.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="generalized-linear-models-glm.html#cb209-1" tabindex="-1"></a>cs2<span class="sc">$</span>dat <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="generalized-linear-models-glm.html#cb209-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb209-3"><a href="generalized-linear-models-glm.html#cb209-3" tabindex="-1"></a>    <span class="at">write_c =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(write, <span class="at">scale =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb209-4"><a href="generalized-linear-models-glm.html#cb209-4" tabindex="-1"></a>    <span class="at">prog =</span> <span class="fu">fct_relevel</span>(prog, <span class="st">&quot;academic&quot;</span>, <span class="at">after =</span> <span class="dv">0</span>)</span>
<span id="cb209-5"><a href="generalized-linear-models-glm.html#cb209-5" tabindex="-1"></a>  )</span></code></pre></div>
<div id="the-model-1" class="section level3 unnumbered hasAnchor">
<h3>The Model<a href="generalized-linear-models-glm.html#the-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start by fitting the model with <code>nnet::multinom()</code> or <code>VGAM::vglm()</code>. <code>nnet::multinom()</code> seems to be more popular, but it doesn’t work with some diagnostic functions. <code>VGAM::vglm()</code> also doesn’t work with all diagnostic functions, including <code>tidy()</code> and <code>augment()</code>. I haven’t decided which is preferable. I’ll fit both and move back and forth as convenient.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="generalized-linear-models-glm.html#cb210-1" tabindex="-1"></a>cs2<span class="sc">$</span>fmla <span class="ot">&lt;-</span> <span class="fu">formula</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write_c)</span>
<span id="cb210-2"><a href="generalized-linear-models-glm.html#cb210-2" tabindex="-1"></a></span>
<span id="cb210-3"><a href="generalized-linear-models-glm.html#cb210-3" tabindex="-1"></a>cs2<span class="sc">$</span>fit_VGAM <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb210-4"><a href="generalized-linear-models-glm.html#cb210-4" tabindex="-1"></a>  <span class="co"># `vglm()` uses the _last_ level of the dependent var for the reference.</span></span>
<span id="cb210-5"><a href="generalized-linear-models-glm.html#cb210-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_relevel</span>(prog, <span class="st">&quot;academic&quot;</span>, <span class="at">after =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb210-6"><a href="generalized-linear-models-glm.html#cb210-6" tabindex="-1"></a>  <span class="co"># `model = TRUE` enables pseudo-r2 calculation.</span></span>
<span id="cb210-7"><a href="generalized-linear-models-glm.html#cb210-7" tabindex="-1"></a>  <span class="fu">vglm</span>(cs2<span class="sc">$</span>fmla, <span class="at">data =</span> ., <span class="at">family =</span> <span class="st">&quot;multinomial&quot;</span>, <span class="at">model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb210-8"><a href="generalized-linear-models-glm.html#cb210-8" tabindex="-1"></a></span>
<span id="cb210-9"><a href="generalized-linear-models-glm.html#cb210-9" tabindex="-1"></a>cs2<span class="sc">$</span>fit_nnet <span class="ot">&lt;-</span> <span class="fu">multinom</span>(cs2<span class="sc">$</span>fmla, <span class="at">data =</span> cs2<span class="sc">$</span>dat)</span></code></pre></div>
<p>The models produce a set of coefficient estimates for each non-reference level of the dependent variable. The summary objects differ in how the present the coefficients. <code>VGAM::vglm()</code> produces the familiar coefficient table, but it labels the levels with integers. <em>Good luck if you forget that <code>VGAM::vglm()</code> use the last level as the reference!</em>. <code>nnet::multinom()</code> identifies the levels by name, but it presents the coefficient estimates as columns, their standard errors as a second section, and does not present the <em>z</em>-statistic or <em>p</em>-values! That may be foregiveable because you can still get these values from <code>tidy()</code> and <code>gtsummary::tbl_regression()</code> (VGAM is incompatible with both!).</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="generalized-linear-models-glm.html#cb211-1" tabindex="-1"></a><span class="fu">summary</span>(cs2<span class="sc">$</span>fit_VGAM)</span></code></pre></div>
<pre><code>## 
## Call:
## vglm(formula = cs2$fmla, family = &quot;multinomial&quot;, data = ., model = TRUE)
## 
## Coefficients: 
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept):1  -0.2050     0.3491  -0.587  0.55711    
## (Intercept):2  -0.7772     0.4111  -1.890  0.05869 .  
## sesmiddle:1    -0.5333     0.4437  -1.202  0.22943    
## sesmiddle:2     0.2914     0.4764   0.612  0.54074    
## seshigh:1      -1.1628     0.5142  -2.261  0.02374 *  
## seshigh:2      -0.9827     0.5955  -1.650  0.09893 .  
## write_c:1      -0.5491     0.2029  -2.706  0.00682 ** 
## write_c:2      -1.0768     0.2106  -5.113 3.17e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Names of linear predictors: log(mu[,1]/mu[,3]), log(mu[,2]/mu[,3])
## 
## Residual deviance: 359.9635 on 392 degrees of freedom
## 
## Log-likelihood: -179.9817 on 392 degrees of freedom
## 
## Number of Fisher scoring iterations: 4 
## 
## No Hauck-Donner effect found in any of the estimates
## 
## 
## Reference group is level  3  of the response</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="generalized-linear-models-glm.html#cb213-1" tabindex="-1"></a><span class="fu">summary</span>(cs2<span class="sc">$</span>fit_nnet)</span></code></pre></div>
<pre><code>## Call:
## multinom(formula = cs2$fmla, data = cs2$dat)
## 
## Coefficients:
##          (Intercept)  sesmiddle    seshigh    write_c
## general   -0.2049851 -0.5332857 -1.1628363 -0.5490814
## vocation  -0.7771705  0.2913906 -0.9826773 -1.0767939
## 
## Std. Errors:
##          (Intercept) sesmiddle   seshigh   write_c
## general    0.3491296 0.4437324 0.5142201 0.2029457
## vocation   0.4111072 0.4763734 0.5955665 0.2106132
## 
## Residual Deviance: 359.9635 
## AIC: 375.9635</code></pre>
<p>The Wald <em>z</em>-statistic is <span class="math inline">\(z = \hat{\beta} / SE(\hat{\beta})\)</span>. Its square is the Wald chi-squared statistic. The <em>p</em>-value is the area to the right of <span class="math inline">\(z^2\)</span> in the <span class="math inline">\(\chi_1^2\)</span> density curve. The residual deviance, <span class="math inline">\(G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}\)</span>, and log-likelihood, <span class="math inline">\(-G^2 / 2\)</span> are model diagnostics. More on these in the Model Fit section.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="generalized-linear-models-glm.html#cb215-1" tabindex="-1"></a><span class="fu">deviance</span>(cs2<span class="sc">$</span>fit_VGAM)</span>
<span id="cb215-2"><a href="generalized-linear-models-glm.html#cb215-2" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb215-3"><a href="generalized-linear-models-glm.html#cb215-3" tabindex="-1"></a><span class="fu">df.residual</span>(cs2<span class="sc">$</span>fit_VGAM)</span>
<span id="cb215-4"><a href="generalized-linear-models-glm.html#cb215-4" tabindex="-1"></a><span class="do">## [1] 392</span></span>
<span id="cb215-5"><a href="generalized-linear-models-glm.html#cb215-5" tabindex="-1"></a><span class="fu">logLik</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">sum =</span> <span class="cn">TRUE</span>)</span>
<span id="cb215-6"><a href="generalized-linear-models-glm.html#cb215-6" tabindex="-1"></a><span class="do">## [1] -179.9817</span></span></code></pre></div>
<p>Fisher scoring is the method used for the ML estimation.</p>
</div>
<div id="interpretation-2" class="section level3 unnumbered hasAnchor">
<h3>Interpretation<a href="generalized-linear-models-glm.html#interpretation-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start with interpreting the dependent variable. The model predicts the <strong>log relative risk</strong> of belonging to a program <span class="math inline">\(j \in\)</span> [vocation, general] vs. <span class="math inline">\(j^*\)</span> = academic. Plug in values for the predictor variables to get predictions. Below <code>newdata</code> is set to the reference level of <code>ses</code> and the centered value of <code>write</code>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="generalized-linear-models-glm.html#cb216-1" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ses =</span> <span class="st">&quot;low&quot;</span>, <span class="at">write_c =</span> <span class="dv">0</span>)</span>
<span id="cb216-2"><a href="generalized-linear-models-glm.html#cb216-2" tabindex="-1"></a></span>
<span id="cb216-3"><a href="generalized-linear-models-glm.html#cb216-3" tabindex="-1"></a><span class="co"># VGAM predicts risk (`response`) or log RR (`link`).</span></span>
<span id="cb216-4"><a href="generalized-linear-models-glm.html#cb216-4" tabindex="-1"></a>my_log_rr <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>) <span class="sc">%&gt;%</span> .[<span class="dv">1</span>, ]</span>
<span id="cb216-5"><a href="generalized-linear-models-glm.html#cb216-5" tabindex="-1"></a><span class="fu">names</span>(my_log_rr) <span class="ot">&lt;-</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb216-6"><a href="generalized-linear-models-glm.html#cb216-6" tabindex="-1"></a>my_log_rr</span>
<span id="cb216-7"><a href="generalized-linear-models-glm.html#cb216-7" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb216-8"><a href="generalized-linear-models-glm.html#cb216-8" tabindex="-1"></a><span class="do">## -0.2049856 -0.7771791</span></span>
<span id="cb216-9"><a href="generalized-linear-models-glm.html#cb216-9" tabindex="-1"></a></span>
<span id="cb216-10"><a href="generalized-linear-models-glm.html#cb216-10" tabindex="-1"></a><span class="co"># nnet predicts risk (`probs`) or class (class), but not log RR.</span></span>
<span id="cb216-11"><a href="generalized-linear-models-glm.html#cb216-11" tabindex="-1"></a>my_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_nnet, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;probs&quot;</span>)</span>
<span id="cb216-12"><a href="generalized-linear-models-glm.html#cb216-12" tabindex="-1"></a><span class="fu">log</span>(my_probs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">/</span> my_probs[<span class="dv">1</span>])</span>
<span id="cb216-13"><a href="generalized-linear-models-glm.html#cb216-13" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb216-14"><a href="generalized-linear-models-glm.html#cb216-14" tabindex="-1"></a><span class="do">## -0.2049851 -0.7771705</span></span></code></pre></div>
<p>Exponentiate to get the <strong>relative risk</strong>, <span class="math inline">\(RR = \exp (\hat{y}_j) = \pi_j / \pi_{j^*}\)</span>. A student of low SES and mean writing score is less likely to be in a general or vocation program than an academic program.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="generalized-linear-models-glm.html#cb217-1" tabindex="-1"></a>(my_rr <span class="ot">&lt;-</span> <span class="fu">exp</span>(my_log_rr))</span></code></pre></div>
<pre><code>##   general  vocation 
## 0.8146591 0.4597009</code></pre>
<p>Use <code>predict()</code> to get the individual risks.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="generalized-linear-models-glm.html#cb219-1" tabindex="-1"></a><span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="generalized-linear-models-glm.html#cb219-2" tabindex="-1"></a>  .[<span class="dv">1</span>, <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)]</span>
<span id="cb219-3"><a href="generalized-linear-models-glm.html#cb219-3" tabindex="-1"></a><span class="do">##  academic   general  vocation </span></span>
<span id="cb219-4"><a href="generalized-linear-models-glm.html#cb219-4" tabindex="-1"></a><span class="do">## 0.4396841 0.3581927 0.2021232</span></span>
<span id="cb219-5"><a href="generalized-linear-models-glm.html#cb219-5" tabindex="-1"></a>(my_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_nnet, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;probs&quot;</span>))</span>
<span id="cb219-6"><a href="generalized-linear-models-glm.html#cb219-6" tabindex="-1"></a><span class="do">##  academic   general  vocation </span></span>
<span id="cb219-7"><a href="generalized-linear-models-glm.html#cb219-7" tabindex="-1"></a><span class="do">## 0.4396833 0.3581922 0.2021246</span></span></code></pre></div>
<p>Move on to the coefficients. Interpret <span class="math inline">\(\hat{\beta}\)</span> as the change in the <em>log relative risk</em> of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> due to a <span class="math inline">\(\delta\)</span> = one unit change in <span class="math inline">\(x\)</span>. A <span class="math inline">\(\delta = x_a - x_b\)</span> change in <span class="math inline">\(x\)</span> is associated with a <span class="math inline">\(\delta \hat{\beta}\)</span> change. <span class="math inline">\(\delta\beta\)</span> is the log relative risk ratio.</p>
<p><span class="math display">\[\log \left(\pi_j / \pi_{j^*} |_{x = x_a} \right) - \log \left(\pi_j / \pi_{j^*} |_{x = x_b} \right) = \log \left( \frac{\pi_j / \pi_{j^*} |_{x = x_a}}{\pi_j / \pi_{j^*} |_{x = x_b}} \right) = \delta \hat{\beta}\]</span></p>
<p>The exponential of <span class="math inline">\(\hat{\beta}\)</span> is the change in the <em>relative risk</em> of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> due to a <span class="math inline">\(\delta\)</span> = one unit change in <span class="math inline">\(x\)</span>. <span class="math inline">\(\exp \delta \beta\)</span> is the relative risk ratio.</p>
<p><span class="math display">\[\pi_j / \pi_{j^*} |_{x = x_a} = \exp{\delta \hat{\beta}}\]</span></p>
<p>The reference case in the model is <code>ses</code> = “low” and <code>write</code> centered at 52.8 (<code>write_c</code> = 0). The intercept term is the log-relative risk of <span class="math inline">\(y_j\)</span> relative to <span class="math inline">\(y_{j^*}\)</span> for the reference case. Notice how the intercept matches the predicted values above.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="generalized-linear-models-glm.html#cb220-1" tabindex="-1"></a><span class="co"># Using VGAM.</span></span>
<span id="cb220-2"><a href="generalized-linear-models-glm.html#cb220-2" tabindex="-1"></a>ref_log_rr <span class="ot">&lt;-</span> <span class="fu">coef</span>(cs2<span class="sc">$</span>fit_VGAM)[<span class="fu">c</span>(<span class="st">&quot;(Intercept):1&quot;</span>, <span class="st">&quot;(Intercept):2&quot;</span>)]</span>
<span id="cb220-3"><a href="generalized-linear-models-glm.html#cb220-3" tabindex="-1"></a><span class="fu">names</span>(ref_log_rr) <span class="ot">&lt;-</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb220-4"><a href="generalized-linear-models-glm.html#cb220-4" tabindex="-1"></a>ref_log_rr</span>
<span id="cb220-5"><a href="generalized-linear-models-glm.html#cb220-5" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb220-6"><a href="generalized-linear-models-glm.html#cb220-6" tabindex="-1"></a><span class="do">## -0.2049856 -0.7771791</span></span>
<span id="cb220-7"><a href="generalized-linear-models-glm.html#cb220-7" tabindex="-1"></a></span>
<span id="cb220-8"><a href="generalized-linear-models-glm.html#cb220-8" tabindex="-1"></a><span class="co"># Using nnet.</span></span>
<span id="cb220-9"><a href="generalized-linear-models-glm.html#cb220-9" tabindex="-1"></a><span class="fu">coef</span>(cs2<span class="sc">$</span>fit_nnet)[,<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb220-10"><a href="generalized-linear-models-glm.html#cb220-10" tabindex="-1"></a><span class="do">##    general   vocation </span></span>
<span id="cb220-11"><a href="generalized-linear-models-glm.html#cb220-11" tabindex="-1"></a><span class="do">## -0.2049851 -0.7771705</span></span>
<span id="cb220-12"><a href="generalized-linear-models-glm.html#cb220-12" tabindex="-1"></a></span>
<span id="cb220-13"><a href="generalized-linear-models-glm.html#cb220-13" tabindex="-1"></a><span class="co"># From log-relative risk to relative risk.</span></span>
<span id="cb220-14"><a href="generalized-linear-models-glm.html#cb220-14" tabindex="-1"></a>(ref_rr <span class="ot">&lt;-</span> <span class="fu">exp</span>(ref_log_rr))</span>
<span id="cb220-15"><a href="generalized-linear-models-glm.html#cb220-15" tabindex="-1"></a><span class="do">##   general  vocation </span></span>
<span id="cb220-16"><a href="generalized-linear-models-glm.html#cb220-16" tabindex="-1"></a><span class="do">## 0.8146591 0.4597009</span></span>
<span id="cb220-17"><a href="generalized-linear-models-glm.html#cb220-17" tabindex="-1"></a></span>
<span id="cb220-18"><a href="generalized-linear-models-glm.html#cb220-18" tabindex="-1"></a><span class="co"># Derived from predicted values</span></span>
<span id="cb220-19"><a href="generalized-linear-models-glm.html#cb220-19" tabindex="-1"></a>my_pred[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">/</span> my_pred[<span class="dv">1</span>]</span>
<span id="cb220-20"><a href="generalized-linear-models-glm.html#cb220-20" tabindex="-1"></a><span class="do">##   general  vocation </span></span>
<span id="cb220-21"><a href="generalized-linear-models-glm.html#cb220-21" tabindex="-1"></a><span class="do">## 0.8146595 0.4597049</span></span></code></pre></div>
<p>The log relative risks of a low SES student with a 52.8 writing score being in program general vs academic are <span class="math inline">\(\hat{y} = \mathrm{Intercept}_1\)</span> = -0.205 and <span class="math inline">\(\hat{y} = \mathrm{Intercept}_2\)</span> = -0.777 for vocation vs academic. The corresponding relative risks are <span class="math inline">\(\exp(\hat{y}_j)\)</span> = 0.815 and 0.460. The expected probabilities are 44.0%, 35.8%, and 20.2% for academic, general, and vocation respectively.</p>
<p>What if SES is high instead of low? The log RR of a high SES student being in program general vs academic are <code>coef(cs2$fit_VGAM)["seshigh:1"]</code> = -1.16 times that of a low SES student. For program vocation vs academic, it is <code>coef(cs2$fit_VGAM)["seshigh:2"]</code> = -0.98. The RRs are 0.31 and 0.37. The expected probabilities are 17.8%, 12.1%, and 70.1% for academic, general, and vocation respectively.</p>
<p>What if the writing score increases by 1 SD (one unit)? The log RR of being in program general vs academic change by a factor of <code>coef(cs2$fit_VGAM)["write_c:1"]</code> = -0.549, RR = 0.577. A 2 SD increase is associated with a log RR = -1.098, RR = 0.333.</p>
<p>One way to visualize the parameter estimates is to plot the predicted values.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="generalized-linear-models-glm.html#cb221-1" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb221-2"><a href="generalized-linear-models-glm.html#cb221-2" tabindex="-1"></a>  <span class="at">ses =</span> cs2<span class="sc">$</span>dat<span class="sc">$</span>ses,</span>
<span id="cb221-3"><a href="generalized-linear-models-glm.html#cb221-3" tabindex="-1"></a>  <span class="at">write_c =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">round</span>(<span class="fu">min</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>write_c)), <span class="at">to =</span> <span class="fu">round</span>(<span class="fu">max</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>write_c)), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb221-4"><a href="generalized-linear-models-glm.html#cb221-4" tabindex="-1"></a>)</span>
<span id="cb221-5"><a href="generalized-linear-models-glm.html#cb221-5" tabindex="-1"></a></span>
<span id="cb221-6"><a href="generalized-linear-models-glm.html#cb221-6" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb221-7"><a href="generalized-linear-models-glm.html#cb221-7" tabindex="-1"></a>  newdata,</span>
<span id="cb221-8"><a href="generalized-linear-models-glm.html#cb221-8" tabindex="-1"></a>  <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb221-9"><a href="generalized-linear-models-glm.html#cb221-9" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb221-10"><a href="generalized-linear-models-glm.html#cb221-10" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(ses, write_c), <span class="at">names_to =</span> <span class="st">&quot;prog&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;probability&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-11"><a href="generalized-linear-models-glm.html#cb221-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write_c, <span class="at">y =</span> probability, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb221-12"><a href="generalized-linear-models-glm.html#cb221-12" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb221-13"><a href="generalized-linear-models-glm.html#cb221-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(prog))</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
</div>
<div id="assumptions-1" class="section level3 unnumbered hasAnchor">
<h3>Assumptions<a href="generalized-linear-models-glm.html#assumptions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Four assumptions relate to the study design: (1) the dependent variable is multinomial; (2) the observations are independent; (3) the categories of all nominal variables are mutually exclusive and exhaustive; and (4) there are at least 10 observations per dependent variable level and independent variable. These assumptions are all valid. Three more assumptions related to the data distribution:</p>
<ul>
<li><p>There is a linear relationship between the logit transformation and the continuous independent variables. Test with a plot and with Box-Tidwell.</p></li>
<li><p>There is no independent variable multicollinearity. Test with correlation coefficients and variance inflation factors (VIF).</p></li>
<li><p>There are no influential outliers. Test with Cook’s distance.</p></li>
</ul>
<p>There are two ways to test for linearity (do both). First, plot the <em>fitted values</em> against the continuous predictors. This is the GLM analog to OLS bivariate analysis, except now the dependent variable is the <em>logit</em> transformation. These plotted relationships look good, except that in the <code>prog</code> = general level, writing score appears to interact with SES.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="generalized-linear-models-glm.html#cb222-1" tabindex="-1"></a>.fitted <span class="ot">=</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb222-2"><a href="generalized-linear-models-glm.html#cb222-2" tabindex="-1"></a><span class="fu">bind_cols</span>(cs2<span class="sc">$</span>dat, .fitted) <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="generalized-linear-models-glm.html#cb222-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(general<span class="sc">:</span>academic), <span class="at">values_to =</span> <span class="st">&quot;.fitted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-4"><a href="generalized-linear-models-glm.html#cb222-4" tabindex="-1"></a>  <span class="fu">filter</span>(prog <span class="sc">==</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb222-5"><a href="generalized-linear-models-glm.html#cb222-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> write_c, <span class="at">y =</span> .fitted, <span class="at">color =</span> ses)) <span class="sc">+</span></span>
<span id="cb222-6"><a href="generalized-linear-models-glm.html#cb222-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb222-7"><a href="generalized-linear-models-glm.html#cb222-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb222-8"><a href="generalized-linear-models-glm.html#cb222-8" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> <span class="st">&quot;y~x&quot;</span>) <span class="sc">+</span></span>
<span id="cb222-9"><a href="generalized-linear-models-glm.html#cb222-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Linearity Test: predicted vs continuous predictors&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>The second test for linearity is the Box-Tidwell approach. Add transformations of the continuous independent variables to the model, <span class="math inline">\(x_{Tx} = x \log x\)</span>, then test their significance level in the fit.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="generalized-linear-models-glm.html#cb223-1" tabindex="-1"></a><span class="co"># Using non-centered vars to avoid log(0) errors.</span></span>
<span id="cb223-2"><a href="generalized-linear-models-glm.html#cb223-2" tabindex="-1"></a>cs2<span class="sc">$</span>boxtidwell <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb223-3"><a href="generalized-linear-models-glm.html#cb223-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">write_tx =</span> <span class="fu">log</span>(write) <span class="sc">*</span> write) <span class="sc">%&gt;%</span></span>
<span id="cb223-4"><a href="generalized-linear-models-glm.html#cb223-4" tabindex="-1"></a>  <span class="fu">multinom</span>(prog <span class="sc">~</span> ses <span class="sc">+</span> write <span class="sc">+</span> write_tx, <span class="at">data =</span> .)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="generalized-linear-models-glm.html#cb224-1" tabindex="-1"></a><span class="fu">tidy</span>(cs2<span class="sc">$</span>boxtidwell)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    y.level  term        estimate std.error statistic   p.value
##    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 general  (Intercept)   6.38     0.00980   651.    0        
##  2 general  sesmiddle    -0.529    0.444      -1.19  0.233    
##  3 general  seshigh      -1.18     0.513      -2.30  0.0215   
##  4 general  write        -0.409    0.0936     -4.37  0.0000126
##  5 general  write_tx      0.0713   0.0231      3.09  0.00198  
##  6 vocation (Intercept)   5.91     0.0102    580.    0        
##  7 vocation sesmiddle     0.296    0.476       0.621 0.534    
##  8 vocation seshigh      -0.983    0.594      -1.65  0.0981   
##  9 vocation write        -0.176    0.0963     -1.83  0.0668   
## 10 vocation write_tx      0.0125   0.0239      0.522 0.601</code></pre>
<p>Focus on the transformed variable. <code>write_tx</code> has a <em>p</em>-value &lt;.05 for <code>prog</code> = general. It is customary to apply a Bonferroni adjustment when testing for linearity. There are ten predictors in the model (including the intercept terms), so the Bonferroni adjusted <em>p</em>-values for <code>write_tx</code> are multiplied by 10. We should reject the null hypothesis of linearity.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="generalized-linear-models-glm.html#cb226-1" tabindex="-1"></a><span class="fu">tidy</span>(cs2<span class="sc">$</span>boxtidwell) <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="generalized-linear-models-glm.html#cb226-2" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;write_tx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb226-3"><a href="generalized-linear-models-glm.html#cb226-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adj_p =</span> p.value <span class="sc">*</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 7
##   y.level  term     estimate std.error statistic p.value  adj_p
##   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 general  write_tx   0.0713    0.0231     3.09  0.00198 0.0198
## 2 vocation write_tx   0.0125    0.0239     0.522 0.601   6.01</code></pre>
<p>If the relationship is nonlinear, you can try transforming the variable by raising it to <span class="math inline">\(\lambda = 1 + b / \gamma\)</span> where <span class="math inline">\(b\)</span> is the estimated coefficient of the model without the interaction terms, and <span class="math inline">\(\gamma\)</span> is the estimated coefficient of the interaction term of the model with interactions. For <code>write</code>, <span class="math inline">\(b\)</span> is -0.549 for general and <span class="math inline">\(\gamma\)</span> is 0.071, so <span class="math inline">\(\lambda\)</span> = 1 + -0.549 / 0.071 = -6.696. It seems customary to apply general transformations like .5 (square root), 1/3 (cube root), ln, and the reciprocal, so maybe try raising <code>write_c</code> to -7. It seems in this case that the better solution is to add an interaction between <code>write_c</code> and <code>ses</code> to the model. I’m not going to pursue this further here.</p>
<p>Check for multicollinearity using variance inflation factors (VIF). VIFs estimate how much the variance of a regression coefficient is inflated due to multicollinearity. When independent variables are correlated, it is difficult to say which variable really influences the dependent variable. The VIF for variable <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[
\mathrm{VIF}_i = \frac{1}{1 - R_i^2}
\]</span></p>
<p>where <span class="math inline">\(R_i^2\)</span> is the coefficient of determination (i.e., the proportion of dependent variance explained by the model) of a regression of <span class="math inline">\(X_i\)</span> against all of the other predictors, <span class="math inline">\(X_i = X_{j \ne i} \beta + \epsilon\)</span>. If <span class="math inline">\(X_i\)</span> is totally unrelated to its covariates, then <span class="math inline">\(R_i^2\)</span> will be zero and <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 1. If <span class="math inline">\(R_i^2\)</span> is .8, <span class="math inline">\(\mathrm{VIF}_i\)</span> will be 5. The rule of thumb is that <span class="math inline">\(R_i^2 \le 5\)</span> is tolerable, and <span class="math inline">\(R_i^2 &gt; 5\)</span> is “highly correlated” and you have to do something about it. <code>car::vif()</code> doesn’t seem to work for multinomial logistic regression. The model type is not actually important here - we’re concerned about the covariate relationships. Below, I successively collapse the dependent variable into two-levels, then fit a binomial logistic regression and pipe that into <code>car::vif()</code>.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="generalized-linear-models-glm.html#cb228-1" tabindex="-1"></a>tmp_fit_general <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb228-2"><a href="generalized-linear-models-glm.html#cb228-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_collapse</span>(prog, <span class="at">vocation =</span> <span class="st">&quot;academic&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb228-3"><a href="generalized-linear-models-glm.html#cb228-3" tabindex="-1"></a>  <span class="fu">glm</span>(cs2<span class="sc">$</span>fmla, <span class="at">data =</span> ., <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb228-4"><a href="generalized-linear-models-glm.html#cb228-4" tabindex="-1"></a></span>
<span id="cb228-5"><a href="generalized-linear-models-glm.html#cb228-5" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(tmp_fit_general)</span></code></pre></div>
<pre><code>##             GVIF Df GVIF^(1/(2*Df))
## ses     1.037207  2        1.009175
## write_c 1.037207  1        1.018433</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="generalized-linear-models-glm.html#cb230-1" tabindex="-1"></a>tmp_fit_vocation <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb230-2"><a href="generalized-linear-models-glm.html#cb230-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prog =</span> <span class="fu">fct_collapse</span>(prog, <span class="at">general =</span> <span class="st">&quot;academic&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb230-3"><a href="generalized-linear-models-glm.html#cb230-3" tabindex="-1"></a>  <span class="fu">glm</span>(cs2<span class="sc">$</span>fmla, <span class="at">data =</span> ., <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb230-4"><a href="generalized-linear-models-glm.html#cb230-4" tabindex="-1"></a></span>
<span id="cb230-5"><a href="generalized-linear-models-glm.html#cb230-5" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(tmp_fit_vocation)</span></code></pre></div>
<pre><code>##             GVIF Df GVIF^(1/(2*Df))
## ses     1.020017  2        1.004967
## write_c 1.020017  1        1.009959</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="generalized-linear-models-glm.html#cb232-1" tabindex="-1"></a>cs2<span class="sc">$</span>outliers_general <span class="ot">&lt;-</span> <span class="fu">augment</span>(tmp_fit_general, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="generalized-linear-models-glm.html#cb232-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="generalized-linear-models-glm.html#cb232-3" tabindex="-1"></a>  <span class="fu">pull</span>(.std.resid)</span>
<span id="cb232-4"><a href="generalized-linear-models-glm.html#cb232-4" tabindex="-1"></a></span>
<span id="cb232-5"><a href="generalized-linear-models-glm.html#cb232-5" tabindex="-1"></a>cs2<span class="sc">$</span>outliers_vocation <span class="ot">&lt;-</span> <span class="fu">augment</span>(tmp_fit_vocation, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-6"><a href="generalized-linear-models-glm.html#cb232-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-7"><a href="generalized-linear-models-glm.html#cb232-7" tabindex="-1"></a>  <span class="fu">pull</span>(.std.resid)</span></code></pre></div>
<p>Check for influential outliers. Predict the response probabilities and filter for the predictions more than two standard deviations from the actual value and a Cook’s Distance greater than 4/N = 0.02.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> Cook’s distance measures how much predicted values change when observation <em>i</em> is removed from the data. There is no simple way to do this for the multinomial regression because neither VGAM nor nnet support the <code>augment()</code> generic. Instead, I will calculate the influential outliers for the two <em>binomial logistic</em> regressions I used for the VIF diagnostic. No fitted values were influential outliers in the first fit, and only two were influential outliers in the second fit, row ids 259 and 374. An index plot of Cook’s Distance shows the two points at the far left. You might examine the observations for validity. Otherwise, proceed and explain that there were two standardized residuals with value of 2.20 and 2.59 standard deviations which were kept in the analysis.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="generalized-linear-models-glm.html#cb233-1" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb233-2"><a href="generalized-linear-models-glm.html#cb233-2" tabindex="-1"></a>  <span class="at">general =</span> <span class="fu">augment</span>(tmp_fit_general, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb233-3"><a href="generalized-linear-models-glm.html#cb233-3" tabindex="-1"></a>  <span class="at">vocation =</span> <span class="fu">augment</span>(tmp_fit_vocation, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb233-4"><a href="generalized-linear-models-glm.html#cb233-4" tabindex="-1"></a>  <span class="at">.id =</span> <span class="st">&quot;logit&quot;</span></span>
<span id="cb233-5"><a href="generalized-linear-models-glm.html#cb233-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb233-6"><a href="generalized-linear-models-glm.html#cb233-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb233-7"><a href="generalized-linear-models-glm.html#cb233-7" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb233-8"><a href="generalized-linear-models-glm.html#cb233-8" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">if_else</span>(<span class="fu">abs</span>(.std.resid) <span class="sc">&gt;=</span> <span class="dv">2</span>, <span class="st">&quot;Outlier&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb233-9"><a href="generalized-linear-models-glm.html#cb233-9" tabindex="-1"></a>    <span class="at">influential =</span> <span class="fu">if_else</span>(.cooksd <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="st">&quot;Influential&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb233-10"><a href="generalized-linear-models-glm.html#cb233-10" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">case_when</span>(</span>
<span id="cb233-11"><a href="generalized-linear-models-glm.html#cb233-11" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">&quot;Outlier&quot;</span> <span class="sc">&amp;</span> influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span> <span class="sc">~</span> <span class="st">&quot;Influential Outlier&quot;</span>,</span>
<span id="cb233-12"><a href="generalized-linear-models-glm.html#cb233-12" tabindex="-1"></a>      outlier <span class="sc">==</span> <span class="st">&quot;Outlier&quot;</span> <span class="sc">~</span> <span class="st">&quot;Outlier&quot;</span>,</span>
<span id="cb233-13"><a href="generalized-linear-models-glm.html#cb233-13" tabindex="-1"></a>      influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span> <span class="sc">~</span> <span class="st">&quot;Influential&quot;</span>,</span>
<span id="cb233-14"><a href="generalized-linear-models-glm.html#cb233-14" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span></span>
<span id="cb233-15"><a href="generalized-linear-models-glm.html#cb233-15" tabindex="-1"></a>    )</span>
<span id="cb233-16"><a href="generalized-linear-models-glm.html#cb233-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb233-17"><a href="generalized-linear-models-glm.html#cb233-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb233-18"><a href="generalized-linear-models-glm.html#cb233-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb233-19"><a href="generalized-linear-models-glm.html#cb233-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">if_else</span>(influential <span class="sc">==</span> <span class="st">&quot;Influential&quot;</span>, id, <span class="cn">NA_integer_</span>)), </span>
<span id="cb233-20"><a href="generalized-linear-models-glm.html#cb233-20" tabindex="-1"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_x =</span> .<span class="dv">025</span>) <span class="sc">+</span></span>
<span id="cb233-21"><a href="generalized-linear-models-glm.html#cb233-21" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(cs1<span class="sc">$</span>dat), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb233-22"><a href="generalized-linear-models-glm.html#cb233-22" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Influential Outlier&quot;</span> <span class="ot">=</span> <span class="st">&quot;firebrick&quot;</span>, </span>
<span id="cb233-23"><a href="generalized-linear-models-glm.html#cb233-23" tabindex="-1"></a>                                <span class="st">&quot;Influential&quot;</span> <span class="ot">=</span> <span class="st">&quot;goldenrod&quot;</span>,</span>
<span id="cb233-24"><a href="generalized-linear-models-glm.html#cb233-24" tabindex="-1"></a>                                <span class="st">&quot;Outlier&quot;</span> <span class="ot">=</span> <span class="st">&quot;slategray&quot;</span>,</span>
<span id="cb233-25"><a href="generalized-linear-models-glm.html#cb233-25" tabindex="-1"></a>                                <span class="st">&quot;Other&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb233-26"><a href="generalized-linear-models-glm.html#cb233-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-27"><a href="generalized-linear-models-glm.html#cb233-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Index Plot of Cook&#39;s Distance.&quot;</span>,</span>
<span id="cb233-28"><a href="generalized-linear-models-glm.html#cb233-28" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Row id labeled for values &gt; 4 / N.&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-29"><a href="generalized-linear-models-glm.html#cb233-29" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(logit), <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
</div>
<div id="model-fit-1" class="section level3 unnumbered hasAnchor">
<h3>Model Fit<a href="generalized-linear-models-glm.html#model-fit-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are several ways to evaluate the model fit.</p>
<ul>
<li>Deviance and chi-squared tests for lack of fit</li>
<li>The likelihood ratio test</li>
<li>Pseudo R-squared<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>.</li>
<li>Accuracy measures</li>
<li>Gain and ROC curves</li>
</ul>
<div id="lack-of-fit" class="section level4 unnumbered hasAnchor">
<h4>Lack of Fit<a href="generalized-linear-models-glm.html#lack-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The deviance test for lack of fit and the likelihood ratio test are residuals tests. The deviance residual is defined as <span class="math inline">\(d_i = \mathrm{sign}(\epsilon_i) \left[ -2(y_i \log \hat{\pi}_i + (1 - y_i) \log (1 - \hat{\pi}_i)) \right]^{.5}\)</span>. You can calculate them by hand.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="generalized-linear-models-glm.html#cb234-1" tabindex="-1"></a><span class="co"># Actual values (1s and 0s for three response levels)</span></span>
<span id="cb234-2"><a href="generalized-linear-models-glm.html#cb234-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> cs2<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb234-3"><a href="generalized-linear-models-glm.html#cb234-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb234-4"><a href="generalized-linear-models-glm.html#cb234-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> prog, <span class="at">values_from =</span> val, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-5"><a href="generalized-linear-models-glm.html#cb234-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)) <span class="sc">%&gt;%</span></span>
<span id="cb234-6"><a href="generalized-linear-models-glm.html#cb234-6" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb234-7"><a href="generalized-linear-models-glm.html#cb234-7" tabindex="-1"></a></span>
<span id="cb234-8"><a href="generalized-linear-models-glm.html#cb234-8" tabindex="-1"></a><span class="co"># Predicted values (probabilities for three response levels)</span></span>
<span id="cb234-9"><a href="generalized-linear-models-glm.html#cb234-9" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_nnet, <span class="at">type =</span> <span class="st">&quot;probs&quot;</span>) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb234-10"><a href="generalized-linear-models-glm.html#cb234-10" tabindex="-1"></a></span>
<span id="cb234-11"><a href="generalized-linear-models-glm.html#cb234-11" tabindex="-1"></a><span class="co"># Raw residuals, by hand or by formula</span></span>
<span id="cb234-12"><a href="generalized-linear-models-glm.html#cb234-12" tabindex="-1"></a>e <span class="ot">&lt;-</span> y <span class="sc">-</span> pi</span>
<span id="cb234-13"><a href="generalized-linear-models-glm.html#cb234-13" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="co"># be careful about column order!</span></span>
<span id="cb234-14"><a href="generalized-linear-models-glm.html#cb234-14" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(cs2<span class="sc">$</span>fit_nnet, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb234-15"><a href="generalized-linear-models-glm.html#cb234-15" tabindex="-1"></a></span>
<span id="cb234-16"><a href="generalized-linear-models-glm.html#cb234-16" tabindex="-1"></a><span class="co"># Deviance residuals</span></span>
<span id="cb234-17"><a href="generalized-linear-models-glm.html#cb234-17" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">sign</span>(e) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> y <span class="sc">*</span> <span class="fu">log</span>(pi) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> y) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> pi))</span></code></pre></div>
<p>The model deviance, <span class="math inline">\(G^2\)</span>, is the sum of the squared deviance residuals. It also equals <span class="math inline">\(G^2 = 2 \sum_{i,j}y_{ij} \log \frac{y_{ij}}{\hat{\pi}_{ij}}\)</span>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="generalized-linear-models-glm.html#cb235-1" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(d<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb235-2"><a href="generalized-linear-models-glm.html#cb235-2" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb235-3"><a href="generalized-linear-models-glm.html#cb235-3" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(y <span class="sc">*</span> <span class="fu">log</span>(y <span class="sc">/</span> pi), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb235-4"><a href="generalized-linear-models-glm.html#cb235-4" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb235-5"><a href="generalized-linear-models-glm.html#cb235-5" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(cs2<span class="sc">$</span>fit_VGAM))</span>
<span id="cb235-6"><a href="generalized-linear-models-glm.html#cb235-6" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span>
<span id="cb235-7"><a href="generalized-linear-models-glm.html#cb235-7" tabindex="-1"></a>(g2 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(cs2<span class="sc">$</span>fit_nnet))</span>
<span id="cb235-8"><a href="generalized-linear-models-glm.html#cb235-8" tabindex="-1"></a><span class="do">## [1] 359.9635</span></span></code></pre></div>
<p>The related Pearson statistic, <span class="math inline">\(X\)</span>, is the sum of the squared <em>Pearson residuals</em>, <span class="math inline">\(pr_i = \epsilon_i / \sqrt{\hat{\pi}_i}\)</span>, the raw residual scaled by dividing by the estimated standard deviation of a binomial distribution with 1 trial. I don’t see this calculated in the <code>residual()</code> functions. You can do it yourself.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="generalized-linear-models-glm.html#cb236-1" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((e <span class="sc">/</span> <span class="fu">sqrt</span>(pi))<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 406.0656</code></pre>
<p>The deviance and Pearson statistic are distributed chi-squared with <span class="math inline">\((N - p)(r - 1)\)</span> degrees of freedom where <span class="math inline">\(p\)</span> = 4 predictor variables, and <span class="math inline">\(r\)</span> = 3 levels of the dependent variable for 392 degrees of freedom. The deviance and Pearson tests for lack of fit calculate the probability of the test statistic. The null hypothesis is that the model is correct. Neither test rejects the null hypothesis.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="generalized-linear-models-glm.html#cb238-1" tabindex="-1"></a><span class="co"># Deviance test for lack of fit</span></span>
<span id="cb238-2"><a href="generalized-linear-models-glm.html#cb238-2" tabindex="-1"></a>(N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cs2<span class="sc">$</span>dat))</span>
<span id="cb238-3"><a href="generalized-linear-models-glm.html#cb238-3" tabindex="-1"></a><span class="do">## [1] 200</span></span>
<span id="cb238-4"><a href="generalized-linear-models-glm.html#cb238-4" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)))</span>
<span id="cb238-5"><a href="generalized-linear-models-glm.html#cb238-5" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb238-6"><a href="generalized-linear-models-glm.html#cb238-6" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(cs2<span class="sc">$</span>fit_VGAM)) <span class="sc">/</span> (r <span class="sc">-</span> <span class="dv">1</span>)) <span class="co"># coefficients for each level, so divide by # levels</span></span>
<span id="cb238-7"><a href="generalized-linear-models-glm.html#cb238-7" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb238-8"><a href="generalized-linear-models-glm.html#cb238-8" tabindex="-1"></a>(df <span class="ot">&lt;-</span> (N <span class="sc">-</span> p) <span class="sc">*</span> (r <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb238-9"><a href="generalized-linear-models-glm.html#cb238-9" tabindex="-1"></a><span class="do">## [1] 392</span></span>
<span id="cb238-10"><a href="generalized-linear-models-glm.html#cb238-10" tabindex="-1"></a><span class="co"># Or just use the function</span></span>
<span id="cb238-11"><a href="generalized-linear-models-glm.html#cb238-11" tabindex="-1"></a>(df <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(cs2<span class="sc">$</span>fit_VGAM))</span>
<span id="cb238-12"><a href="generalized-linear-models-glm.html#cb238-12" tabindex="-1"></a><span class="do">## [1] 392</span></span>
<span id="cb238-13"><a href="generalized-linear-models-glm.html#cb238-13" tabindex="-1"></a></span>
<span id="cb238-14"><a href="generalized-linear-models-glm.html#cb238-14" tabindex="-1"></a><span class="fu">pchisq</span>(g2, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb238-15"><a href="generalized-linear-models-glm.html#cb238-15" tabindex="-1"></a><span class="do">## [1] 0.8755302</span></span>
<span id="cb238-16"><a href="generalized-linear-models-glm.html#cb238-16" tabindex="-1"></a></span>
<span id="cb238-17"><a href="generalized-linear-models-glm.html#cb238-17" tabindex="-1"></a><span class="fu">pchisq</span>(x2, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb238-18"><a href="generalized-linear-models-glm.html#cb238-18" tabindex="-1"></a><span class="do">## [1] 0.3014625</span></span></code></pre></div>
<p>You can do the same calculations for the intercept-only model.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="generalized-linear-models-glm.html#cb239-1" tabindex="-1"></a>io_nnet <span class="ot">&lt;-</span> <span class="fu">multinom</span>(prog <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs2<span class="sc">$</span>dat)</span>
<span id="cb239-2"><a href="generalized-linear-models-glm.html#cb239-2" tabindex="-1"></a><span class="do">## # weights:  6 (2 variable)</span></span>
<span id="cb239-3"><a href="generalized-linear-models-glm.html#cb239-3" tabindex="-1"></a><span class="do">## initial  value 219.722458 </span></span>
<span id="cb239-4"><a href="generalized-linear-models-glm.html#cb239-4" tabindex="-1"></a><span class="do">## final  value 204.096674 </span></span>
<span id="cb239-5"><a href="generalized-linear-models-glm.html#cb239-5" tabindex="-1"></a><span class="do">## converged</span></span>
<span id="cb239-6"><a href="generalized-linear-models-glm.html#cb239-6" tabindex="-1"></a>io_VGAM <span class="ot">&lt;-</span> <span class="fu">vglm</span>(prog <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cs2<span class="sc">$</span>dat, <span class="at">family =</span> <span class="st">&quot;multinomial&quot;</span>)</span>
<span id="cb239-7"><a href="generalized-linear-models-glm.html#cb239-7" tabindex="-1"></a></span>
<span id="cb239-8"><a href="generalized-linear-models-glm.html#cb239-8" tabindex="-1"></a>(io_g2 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(io_nnet))</span>
<span id="cb239-9"><a href="generalized-linear-models-glm.html#cb239-9" tabindex="-1"></a><span class="do">## [1] 408.1933</span></span>
<span id="cb239-10"><a href="generalized-linear-models-glm.html#cb239-10" tabindex="-1"></a>(io_g2 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(io_VGAM))</span>
<span id="cb239-11"><a href="generalized-linear-models-glm.html#cb239-11" tabindex="-1"></a><span class="do">## [1] 408.1933</span></span>
<span id="cb239-12"><a href="generalized-linear-models-glm.html#cb239-12" tabindex="-1"></a></span>
<span id="cb239-13"><a href="generalized-linear-models-glm.html#cb239-13" tabindex="-1"></a>(io_df <span class="ot">&lt;-</span> ((<span class="fu">nrow</span>(cs2<span class="sc">$</span>dat) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(io_nnet)) <span class="sc">/</span> (r <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> (r <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb239-14"><a href="generalized-linear-models-glm.html#cb239-14" tabindex="-1"></a><span class="do">## [1] 398</span></span>
<span id="cb239-15"><a href="generalized-linear-models-glm.html#cb239-15" tabindex="-1"></a>(io_df <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(io_VGAM))</span>
<span id="cb239-16"><a href="generalized-linear-models-glm.html#cb239-16" tabindex="-1"></a><span class="do">## [1] 398</span></span></code></pre></div>
</div>
<div id="likelihood-ratio-test" class="section level4 unnumbered hasAnchor">
<h4>Likelihood Ratio Test<a href="generalized-linear-models-glm.html#likelihood-ratio-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The log-likelihood measures the unexplained variability in the model. The <strong>likelihood ratio test</strong> compares the log likelihood of the fitted model to the intercept-only model. You can use <code>lmtest::lrtest()</code> to test. <code>anova()</code> does the same thing using the residual deviance, <span class="math inline">\(G2 = -2 \times \mathrm{log likelihood}\)</span>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="generalized-linear-models-glm.html#cb240-1" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(io_nnet, cs2<span class="sc">$</span>fit_nnet))</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: prog ~ 1
## Model 2: prog ~ ses + write_c
##   #Df  LogLik Df Chisq Pr(&gt;Chisq)    
## 1   2 -204.10                        
## 2   8 -179.98  6 48.23  1.063e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="generalized-linear-models-glm.html#cb242-1" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest <span class="ot">&lt;-</span> <span class="fu">anova</span>(io_VGAM, cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;I&quot;</span>, <span class="at">test =</span> <span class="st">&quot;LR&quot;</span>))</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: prog ~ 1
## Model 2: prog ~ ses + write_c
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1       398     408.19                          
## 2       392     359.96  6    48.23 1.063e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The difference in deviances is <span class="math inline">\(LR\)</span> = 48.23 with 6 degrees of freedom. This is distributed chi-squared, with <em>p</em>-value = 1.063e-08. The deviance test for lack of fit concludes that the model fits significantly better than an empty (intercept-only) model.</p>
<p>You can use <code>lmtest::lrtest()</code> to perform likelihood ratio tests on the significance of the predictors too. The likelihood ratio test compares the log likelihood with and without the predictor.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="generalized-linear-models-glm.html#cb244-1" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest_ses <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs2<span class="sc">$</span>fit_nnet, <span class="st">&quot;ses&quot;</span>))</span></code></pre></div>
<pre><code>## # weights:  9 (4 variable)
## initial  value 219.722458 
## final  value 185.510837 
## converged</code></pre>
<pre><code>## Likelihood ratio test
## 
## Model 1: prog ~ ses + write_c
## Model 2: prog ~ write_c
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
## 1   8 -179.98                       
## 2   4 -185.51 -4 11.058    0.02592 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="generalized-linear-models-glm.html#cb247-1" tabindex="-1"></a>(cs2<span class="sc">$</span>lrtest_write <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">lrtest</span>(cs2<span class="sc">$</span>fit_nnet, <span class="st">&quot;write_c&quot;</span>))</span></code></pre></div>
<pre><code>## # weights:  12 (6 variable)
## initial  value 219.722458 
## iter  10 value 195.705189
## iter  10 value 195.705188
## iter  10 value 195.705188
## final  value 195.705188 
## converged</code></pre>
<pre><code>## Likelihood ratio test
## 
## Model 1: prog ~ ses + write_c
## Model 2: prog ~ ses
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   8 -179.98                         
## 2   6 -195.71 -2 31.447  1.484e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Both SES, <span class="math inline">\(X^2\)</span> = 11.058, <em>p</em> = 0.026, and writing score <span class="math inline">\(X^2\)</span> = 31.447, <em>p</em> = 1.484e-07, had significant effects on the program.</p>
<p>Logistic regression does not have a direct R-squared statistic like OLS does (the proportion of variance explained by the model). However, there are some analogs, called pseudo R-squared. You’ll encounter three pseudo R-squared measures: Cox and Snell, Nagelkerke, and McFadden.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="generalized-linear-models-glm.html#cb250-1" tabindex="-1"></a>DescTools<span class="sc">::</span><span class="fu">PseudoR2</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">&quot;CoxSnell&quot;</span>, <span class="st">&quot;Nagelkerke&quot;</span>, <span class="st">&quot;McFadden&quot;</span>))</span></code></pre></div>
<pre><code>##   CoxSnell Nagelkerke   McFadden 
##  0.2142758  0.2462666  0.1181545</code></pre>
<p>Accuracy measures formed by the cross-tabulation of observed and predicted classes is the better model fit diagnostic the the pseudo r-squareds.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="generalized-linear-models-glm.html#cb252-1" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-2"><a href="generalized-linear-models-glm.html#cb252-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-3"><a href="generalized-linear-models-glm.html#cb252-3" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-4"><a href="generalized-linear-models-glm.html#cb252-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb252-5"><a href="generalized-linear-models-glm.html#cb252-5" tabindex="-1"></a>    <span class="at">p_max =</span> <span class="fu">max</span>(<span class="fu">c</span>(general, vocation, academic)),</span>
<span id="cb252-6"><a href="generalized-linear-models-glm.html#cb252-6" tabindex="-1"></a>    <span class="at">pred_idx =</span> <span class="fu">match</span>(p_max, <span class="fu">c</span>(general, vocation, academic)),</span>
<span id="cb252-7"><a href="generalized-linear-models-glm.html#cb252-7" tabindex="-1"></a>    <span class="at">pred =</span> <span class="fu">c</span>(<span class="st">&quot;general&quot;</span>, <span class="st">&quot;vocation&quot;</span>, <span class="st">&quot;academic&quot;</span>)[pred_idx]</span>
<span id="cb252-8"><a href="generalized-linear-models-glm.html#cb252-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb252-9"><a href="generalized-linear-models-glm.html#cb252-9" tabindex="-1"></a>  <span class="fu">pull</span>(pred)</span>
<span id="cb252-10"><a href="generalized-linear-models-glm.html#cb252-10" tabindex="-1"></a></span>
<span id="cb252-11"><a href="generalized-linear-models-glm.html#cb252-11" tabindex="-1"></a>(cs2<span class="sc">$</span>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(</span>
<span id="cb252-12"><a href="generalized-linear-models-glm.html#cb252-12" tabindex="-1"></a>  <span class="at">pred =</span> <span class="fu">factor</span>(pred, <span class="at">levels =</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog)),</span>
<span id="cb252-13"><a href="generalized-linear-models-glm.html#cb252-13" tabindex="-1"></a>  <span class="at">truth =</span> <span class="fu">factor</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog, <span class="at">levels =</span> <span class="fu">levels</span>(cs2<span class="sc">$</span>dat<span class="sc">$</span>prog))</span>
<span id="cb252-14"><a href="generalized-linear-models-glm.html#cb252-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb252-15"><a href="generalized-linear-models-glm.html#cb252-15" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>())</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           truth
## pred       academic general vocation
##   academic       92      27       23
##   general         4       7        4
##   vocation        9      11       23
## 
## Overall Statistics
##                                          
##                Accuracy : 0.61           
##                  95% CI : (0.5387, 0.678)
##     No Information Rate : 0.525          
##     P-Value [Acc &gt; NIR] : 0.009485       
##                                          
##                   Kappa : 0.2993         
##                                          
##  Mcnemar&#39;s Test P-Value : 7.654e-06      
## 
## Statistics by Class:
## 
##                      Class: academic Class: general Class: vocation
## Sensitivity                   0.8762         0.1556          0.4600
## Specificity                   0.4737         0.9484          0.8667
## Pos Pred Value                0.6479         0.4667          0.5349
## Neg Pred Value                0.7759         0.7946          0.8280
## Prevalence                    0.5250         0.2250          0.2500
## Detection Rate                0.4600         0.0350          0.1150
## Detection Prevalence          0.7100         0.0750          0.2150
## Balanced Accuracy             0.6749         0.5520          0.6633</code></pre>
<p>The model accuracy, 61.0%, is the percent of observations correctly classified. The sensitivities are the accuracy with regard to predicting positive cases in each level of the dependent variable. The specificities are the accuracy with regard to predicting negative cases. The prevalences are the proportion of cases that were positive.</p>
<p>Finally, plot the <a href="https://community.tibco.com/wiki/gains-vs-roc-curves-do-you-understand-difference">gain curve or ROC curve</a>. In the <strong>gain curve</strong>, the x-axis is the fraction of items seen when sorted by the predicted value, and the y-axis is the cumulatively summed true outcome. The “wizard” curve is the gain curve when the data is sorted by the true outcome. If the model’s gain curve is close to the wizard curve, then the model predicts the response well. The gray area is the “gain” over a random prediction.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="generalized-linear-models-glm.html#cb254-1" tabindex="-1"></a><span class="fu">bind_cols</span>(cs2<span class="sc">$</span>dat, <span class="at">.fitted =</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb254-2"><a href="generalized-linear-models-glm.html#cb254-2" tabindex="-1"></a>  <span class="co"># event_level = &quot;second&quot; sets the second level as success</span></span>
<span id="cb254-3"><a href="generalized-linear-models-glm.html#cb254-3" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">gain_curve</span>(prog, .fitted, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-4"><a href="generalized-linear-models-glm.html#cb254-4" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb254-5"><a href="generalized-linear-models-glm.html#cb254-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Gain Curve&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p>105 of the 200 participants were in the academic program.</p>
<ul>
<li>The gain curve encountered 52 academic programs (50%) within the first 72 observations (36%). It encountered all 105 cases on the 189th observation.</li>
<li>The bottom of the grey area is the outcome of a random model. Only half the academic program cases would be observed within 50% of the observations.<br />
</li>
<li>The top of the grey area is the outcome of the perfect model, the “wizard curve”. Half the academic program cases would be observed in 52.5/200=26.25% of the observations.</li>
</ul>
<p>The <strong>ROC</strong> (Receiver Operating Characteristics) curve plots sensitivity vs specificity at varying cut-off values for the probability ranging from 0 to 1. Ideally, you want very little trade-off between sensitivity and specificity, with a curve hugging the left and top axes.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="generalized-linear-models-glm.html#cb255-1" tabindex="-1"></a><span class="fu">bind_cols</span>(cs2<span class="sc">$</span>dat, <span class="at">.fitted =</span> <span class="fu">predict</span>(cs2<span class="sc">$</span>fit_VGAM, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb255-2"><a href="generalized-linear-models-glm.html#cb255-2" tabindex="-1"></a>  <span class="co"># event_level = &quot;second&quot; sets the second level as success</span></span>
<span id="cb255-3"><a href="generalized-linear-models-glm.html#cb255-3" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(prog, .fitted, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb255-4"><a href="generalized-linear-models-glm.html#cb255-4" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb255-5"><a href="generalized-linear-models-glm.html#cb255-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ROC Curve&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
</div>
</div>
<div id="reporting-1" class="section level3 unnumbered hasAnchor">
<h3>Reporting<a href="generalized-linear-models-glm.html#reporting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>A multinomial logistic regression was performed to ascertain the effects of socioeconomic status (ses) and writing score on the likelihood that participants are enrolled in an academic, general, or vocation program. Linearity of the continuous variables with respect to the logit of the dependent variable was assessed via the Box-Tidwell (1962) procedure. A Bonferroni correction was applied using all eight terms in the model resulting in statistical significance being accepted when <em>p</em> &lt; 0.00625 (Tabachnick &amp; Fidell, 2014). Based on this assessment, all continuous independent variables were found to be linearly related to the logit of the dependent variable. There were two standardized residuals with value of 2.01 and 2.27 standard deviations, which were kept in the analysis. The logistic regression model was statistically significant, χ2(4) = 27.40, p &lt; .001. The model explained 33.0% (Nagelkerke R2) of the variance in heart disease and correctly classified 71.0% of cases. Sensitivity was 45.7%, specificity was 84.6%, positive predictive value was 61.5% and negative predictive value was 74.3%. Of the five predictor variables only three were statistically significant: age, gender and VO2max (as shown in Table 1). Females had 0.14 times lower odds to exhibit heart disease than males. Increasing age was associated with an increased likelihood of exhibiting heart disease, but increasing VO2max was associated with a reduction in the likelihood of exhibiting heart disease.</p>
</blockquote>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="generalized-linear-models-glm.html#cb256-1" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>(</span>
<span id="cb256-2"><a href="generalized-linear-models-glm.html#cb256-2" tabindex="-1"></a>  cs2<span class="sc">$</span>fit_nnet,</span>
<span id="cb256-3"><a href="generalized-linear-models-glm.html#cb256-3" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb256-4"><a href="generalized-linear-models-glm.html#cb256-4" tabindex="-1"></a>)</span></code></pre></div>
<div id="muwimfsbvd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#muwimfsbvd table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#muwimfsbvd thead, #muwimfsbvd tbody, #muwimfsbvd tfoot, #muwimfsbvd tr, #muwimfsbvd td, #muwimfsbvd th {
  border-style: none;
}

#muwimfsbvd p {
  margin: 0;
  padding: 0;
}

#muwimfsbvd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#muwimfsbvd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#muwimfsbvd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#muwimfsbvd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#muwimfsbvd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#muwimfsbvd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#muwimfsbvd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#muwimfsbvd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#muwimfsbvd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#muwimfsbvd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#muwimfsbvd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#muwimfsbvd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#muwimfsbvd .gt_spanner_row {
  border-bottom-style: hidden;
}

#muwimfsbvd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#muwimfsbvd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#muwimfsbvd .gt_from_md > :first-child {
  margin-top: 0;
}

#muwimfsbvd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#muwimfsbvd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#muwimfsbvd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#muwimfsbvd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#muwimfsbvd .gt_row_group_first td {
  border-top-width: 2px;
}

#muwimfsbvd .gt_row_group_first th {
  border-top-width: 2px;
}

#muwimfsbvd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#muwimfsbvd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#muwimfsbvd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#muwimfsbvd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#muwimfsbvd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#muwimfsbvd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#muwimfsbvd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#muwimfsbvd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#muwimfsbvd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#muwimfsbvd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#muwimfsbvd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#muwimfsbvd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#muwimfsbvd .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#muwimfsbvd .gt_left {
  text-align: left;
}

#muwimfsbvd .gt_center {
  text-align: center;
}

#muwimfsbvd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#muwimfsbvd .gt_font_normal {
  font-weight: normal;
}

#muwimfsbvd .gt_font_bold {
  font-weight: bold;
}

#muwimfsbvd .gt_font_italic {
  font-style: italic;
}

#muwimfsbvd .gt_super {
  font-size: 65%;
}

#muwimfsbvd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#muwimfsbvd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#muwimfsbvd .gt_indent_1 {
  text-indent: 5px;
}

#muwimfsbvd .gt_indent_2 {
  text-indent: 10px;
}

#muwimfsbvd .gt_indent_3 {
  text-indent: 15px;
}

#muwimfsbvd .gt_indent_4 {
  text-indent: 20px;
}

#muwimfsbvd .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;OR&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <th colspan="4" class="gt_group_heading" scope="colgroup" id="general">general</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="general  label" class="gt_row gt_left">ses</td>
<td headers="general  estimate" class="gt_row gt_center"></td>
<td headers="general  ci" class="gt_row gt_center"></td>
<td headers="general  p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="general  label" class="gt_row gt_left">    low</td>
<td headers="general  estimate" class="gt_row gt_center">—</td>
<td headers="general  ci" class="gt_row gt_center">—</td>
<td headers="general  p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="general  label" class="gt_row gt_left">    middle</td>
<td headers="general  estimate" class="gt_row gt_center">0.59</td>
<td headers="general  ci" class="gt_row gt_center">0.25, 1.40</td>
<td headers="general  p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="general  label" class="gt_row gt_left">    high</td>
<td headers="general  estimate" class="gt_row gt_center">0.31</td>
<td headers="general  ci" class="gt_row gt_center">0.11, 0.86</td>
<td headers="general  p.value" class="gt_row gt_center">0.024</td></tr>
    <tr><td headers="general  label" class="gt_row gt_left">write_c</td>
<td headers="general  estimate" class="gt_row gt_center">0.58</td>
<td headers="general  ci" class="gt_row gt_center">0.39, 0.86</td>
<td headers="general  p.value" class="gt_row gt_center">0.007</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="4" class="gt_group_heading" scope="colgroup" id="vocation">vocation</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="vocation  label" class="gt_row gt_left">ses</td>
<td headers="vocation  estimate" class="gt_row gt_center"></td>
<td headers="vocation  ci" class="gt_row gt_center"></td>
<td headers="vocation  p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="vocation  label" class="gt_row gt_left">    low</td>
<td headers="vocation  estimate" class="gt_row gt_center">—</td>
<td headers="vocation  ci" class="gt_row gt_center">—</td>
<td headers="vocation  p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="vocation  label" class="gt_row gt_left">    middle</td>
<td headers="vocation  estimate" class="gt_row gt_center">1.34</td>
<td headers="vocation  ci" class="gt_row gt_center">0.53, 3.40</td>
<td headers="vocation  p.value" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="vocation  label" class="gt_row gt_left">    high</td>
<td headers="vocation  estimate" class="gt_row gt_center">0.37</td>
<td headers="vocation  ci" class="gt_row gt_center">0.12, 1.20</td>
<td headers="vocation  p.value" class="gt_row gt_center">0.10</td></tr>
    <tr><td headers="vocation  label" class="gt_row gt_left">write_c</td>
<td headers="vocation  estimate" class="gt_row gt_center">0.34</td>
<td headers="vocation  ci" class="gt_row gt_center">0.23, 0.51</td>
<td headers="vocation  p.value" class="gt_row gt_center"><0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<div id="ordinallogistic" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Ordinal Logistic Regression<a href="generalized-linear-models-glm.html#ordinallogistic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ordinal logistic regression, also call cumulative link model (CLM), is a generalized linear model (GZLM), an extension of the general linear model (GLM) to non-continuous outcome variables. There are many approaches to ordinal logistic regression, including cumulative, adjacent, and continuation categories, but the most popular is the <strong>cumulative odds ordinal logistic regression with proportional odds</strong>. These notes rely on <a href="https://data.library.virginia.edu/fitting-and-interpreting-a-proportional-odds-model/">UVA</a>, <a href="https://online.stat.psu.edu/stat504/">PSU</a>, <a href="https://statistics.laerd.com/spss-tutorials/ordinal-regression-using-spss-statistics.php">Laerd</a>, and the CLM package <a href="https://cran.r-project.org/web/packages/ordinal/vignettes/clm_article.pdf">article vignette</a>.</p>
<p>The model for ordinal response random variable <span class="math inline">\(Y_i\)</span> with <span class="math inline">\(J\)</span> levels is</p>
<p><span class="math display">\[\gamma_{ij} = F(\eta_{ij}), \hspace{5 mm} \eta_{ij} = \theta_j - x_i^\mathrm{T}\beta, \hspace{5 mm} i = 1, \ldots, n, \hspace{5 mm} j = 1, \ldots, J-1\]</span></p>
<p>where <span class="math inline">\(\gamma_{ij} = P(Y_i \le j) = \pi_{i1} + \cdots + \pi_{ij}\)</span>. <span class="math inline">\(\eta_{ij}\)</span> is a linear predictor with <span class="math inline">\(J-1\)</span> intercepts. <span class="math inline">\(F\)</span> is the inverse link function. The regression models the logit link function of <span class="math inline">\(\gamma_{ij}\)</span>.</p>
<p><span class="math display">\[\mathrm{logit}(\gamma_{ij}) = \log \left[\frac{P(Y_i \le j)}{P(Y_i \gt j)} \right] = \theta_j - x_i^\mathrm{T}\beta\]</span>
The cumulative logit is the log-odds of the cumulative probabilities that the response is in category <span class="math inline">\(\le j\)</span> versus <span class="math inline">\(\gt j\)</span>. <span class="math inline">\(\theta_j\)</span> is the log-odds when <span class="math inline">\(x_i^\mathrm{T}=0\)</span> and <span class="math inline">\(\beta\)</span> is the increase in the log odds attributed to a one unit increase in <span class="math inline">\(x_i^\mathrm{T}\)</span>. Notice <span class="math inline">\(\beta\)</span> is the same for all <span class="math inline">\(j\)</span>.</p>
<p>Once you fit the model, you will either generate predicted values or evaluate the coefficient estimators. The predicted value is a log-odds by default (useless), so you will at least take exponential to get the odds. From there you can solve for the probability,</p>
<p><span class="math display">\[P(Y_i \gt j) = \frac{\mathrm{exp}(\hat{y}_i)}{1 + \mathrm{exp}(\hat{y}_i)}.\]</span></p>
<p>The exponential of <span class="math inline">\(\beta\)</span> is the odds ratio of <span class="math inline">\(x_1^\mathrm{T} - x_0^\mathrm{T}\)</span>. You can solve for the odds ratio</p>
<p><span class="math display">\[\mathrm{OR} = \frac{\mathrm{exp}(\theta_j - x_1^\mathrm{T}\beta)}{\mathrm{exp}(\theta_j - x_2^\mathrm{T}\beta)} = \mathrm{exp}(\beta(x_1^\mathrm{T} - x_0^\mathrm{T}))\]</span></p>
<p>If <span class="math inline">\(x\)</span> is a binary factor factor, then <span class="math inline">\(exp(\beta)\)</span> is the odds ratio of <span class="math inline">\(x=1\)</span> vs <span class="math inline">\(x=0\)</span>. Thus the odds-ratio is <em>proportional</em> to the difference between values of <span class="math inline">\(x\)</span> and <span class="math inline">\(\beta\)</span> is the constant of proportionality.</p>
<p>The model is estimated with a regularized Newton-Raphson algorithm with step-halving (line search) using analytic expressions for the gradient and Hessian of the negative log-likelihood function. What this means is beyond me right now, but the upshot is that the estimation is an iterative maximization exercise, not a formulaic matrix algebra process. It is possible for the model estimation to fail to converge on a maximum.</p>
<p>You will sometimes encounter discussion about the <em>latent variable</em>. That is just the underlying quality you are trying to measure. If you rate something a 4 on a 5-level likert scale, 4 is the expression of your valuation, the latent variable. Your precise valuation is somewhere between 3 and 5 on a continuous scale. The link function defines the distribution of the latent variable.</p>
<p>There are variations on the ordinal model. Structured thresholds impose restrictions on <span class="math inline">\(\theta_j\)</span>, for example requiring equal distances between levels. Partial proportional odds allow <span class="math inline">\(\theta_j\)</span> to vary with nominal predictors. You can also use link functions other than logit.</p>
<p>There are two conditions to ordinal logistic regression: (a) no multicollinearity, and (b) proportional odds.</p>
</div>
<div id="cs3" class="section level2 unnumbered hasAnchor">
<h2>Case Study 3<a href="generalized-linear-models-glm.html#cs3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>192 participants in a study respond to the statement “Taxes are too high” on a 4-level likert scale (<code>tax_too_high</code>, <em>Strongly Disagree</em>, <em>Disagree</em>, <em>Agree</em>, <em>Strongly Agree</em>). Participant attributes include business owner (<code>biz_owner</code>, <em>Y</em>|<em>N</em>), age (<code>age</code>), and political affiliation (<code>politics</code>, <em>Liberal</em>, <em>Conservative</em>, <em>Labor</em>).</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="generalized-linear-models-glm.html#cb257-1" tabindex="-1"></a>tax<span class="sc">$</span>gt <span class="ot">&lt;-</span> <span class="fu">tbl_summary</span>(</span>
<span id="cb257-2"><a href="generalized-linear-models-glm.html#cb257-2" tabindex="-1"></a>  tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>age), </span>
<span id="cb257-3"><a href="generalized-linear-models-glm.html#cb257-3" tabindex="-1"></a>  <span class="at">by =</span> politics, </span>
<span id="cb257-4"><a href="generalized-linear-models-glm.html#cb257-4" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;{mean} ({sd})&quot;</span>)</span>
<span id="cb257-5"><a href="generalized-linear-models-glm.html#cb257-5" tabindex="-1"></a>)</span>
<span id="cb257-6"><a href="generalized-linear-models-glm.html#cb257-6" tabindex="-1"></a>tax<span class="sc">$</span>gt</span></code></pre></div>
<div id="lzjzpoqsnm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lzjzpoqsnm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lzjzpoqsnm thead, #lzjzpoqsnm tbody, #lzjzpoqsnm tfoot, #lzjzpoqsnm tr, #lzjzpoqsnm td, #lzjzpoqsnm th {
  border-style: none;
}

#lzjzpoqsnm p {
  margin: 0;
  padding: 0;
}

#lzjzpoqsnm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lzjzpoqsnm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lzjzpoqsnm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lzjzpoqsnm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lzjzpoqsnm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lzjzpoqsnm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjzpoqsnm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lzjzpoqsnm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lzjzpoqsnm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lzjzpoqsnm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lzjzpoqsnm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lzjzpoqsnm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lzjzpoqsnm .gt_spanner_row {
  border-bottom-style: hidden;
}

#lzjzpoqsnm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lzjzpoqsnm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lzjzpoqsnm .gt_from_md > :first-child {
  margin-top: 0;
}

#lzjzpoqsnm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lzjzpoqsnm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lzjzpoqsnm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjzpoqsnm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lzjzpoqsnm .gt_row_group_first td {
  border-top-width: 2px;
}

#lzjzpoqsnm .gt_row_group_first th {
  border-top-width: 2px;
}

#lzjzpoqsnm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjzpoqsnm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lzjzpoqsnm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lzjzpoqsnm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjzpoqsnm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjzpoqsnm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lzjzpoqsnm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lzjzpoqsnm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lzjzpoqsnm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjzpoqsnm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lzjzpoqsnm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjzpoqsnm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lzjzpoqsnm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjzpoqsnm .gt_left {
  text-align: left;
}

#lzjzpoqsnm .gt_center {
  text-align: center;
}

#lzjzpoqsnm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lzjzpoqsnm .gt_font_normal {
  font-weight: normal;
}

#lzjzpoqsnm .gt_font_bold {
  font-weight: bold;
}

#lzjzpoqsnm .gt_font_italic {
  font-style: italic;
}

#lzjzpoqsnm .gt_super {
  font-size: 65%;
}

#lzjzpoqsnm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lzjzpoqsnm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lzjzpoqsnm .gt_indent_1 {
  text-indent: 5px;
}

#lzjzpoqsnm .gt_indent_2 {
  text-indent: 10px;
}

#lzjzpoqsnm .gt_indent_3 {
  text-indent: 15px;
}

#lzjzpoqsnm .gt_indent_4 {
  text-indent: 20px;
}

#lzjzpoqsnm .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Lab&lt;/strong&gt;, N = 62&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Lab</strong>, N = 62<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Lib&lt;/strong&gt;, N = 54&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Lib</strong>, N = 54<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Con&lt;/strong&gt;, N = 76&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Con</strong>, N = 76<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">biz_owner</td>
<td headers="stat_1" class="gt_row gt_center">36 (58%)</td>
<td headers="stat_2" class="gt_row gt_center">26 (48%)</td>
<td headers="stat_3" class="gt_row gt_center">47 (62%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">income</td>
<td headers="stat_1" class="gt_row gt_center">36 (8)</td>
<td headers="stat_2" class="gt_row gt_center">35 (6)</td>
<td headers="stat_3" class="gt_row gt_center">37 (7)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">tax_too_high</td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td>
<td headers="stat_3" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Strongly Disagree</td>
<td headers="stat_1" class="gt_row gt_center">10 (16%)</td>
<td headers="stat_2" class="gt_row gt_center">10 (19%)</td>
<td headers="stat_3" class="gt_row gt_center">4 (5.3%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Disagree</td>
<td headers="stat_1" class="gt_row gt_center">13 (21%)</td>
<td headers="stat_2" class="gt_row gt_center">16 (30%)</td>
<td headers="stat_3" class="gt_row gt_center">9 (12%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Agree</td>
<td headers="stat_1" class="gt_row gt_center">28 (45%)</td>
<td headers="stat_2" class="gt_row gt_center">21 (39%)</td>
<td headers="stat_3" class="gt_row gt_center">42 (55%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Strongly Agree</td>
<td headers="stat_1" class="gt_row gt_center">11 (18%)</td>
<td headers="stat_2" class="gt_row gt_center">7 (13%)</td>
<td headers="stat_3" class="gt_row gt_center">21 (28%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%); Mean (SD)</td>
    </tr>
  </tfoot>
</table>
</div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="generalized-linear-models-glm.html#cb258-1" tabindex="-1"></a>tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="generalized-linear-models-glm.html#cb258-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">case_when</span>(income <span class="sc">&lt;</span> <span class="fu">quantile</span>(income, .<span class="dv">25</span>) <span class="sc">~</span> <span class="st">&quot;low income&quot;</span>,</span>
<span id="cb258-3"><a href="generalized-linear-models-glm.html#cb258-3" tabindex="-1"></a>                            income <span class="sc">&lt;</span> <span class="fu">quantile</span>(income, .<span class="dv">75</span>) <span class="sc">~</span> <span class="st">&quot;med income&quot;</span>,</span>
<span id="cb258-4"><a href="generalized-linear-models-glm.html#cb258-4" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;high income&quot;</span>),</span>
<span id="cb258-5"><a href="generalized-linear-models-glm.html#cb258-5" tabindex="-1"></a>         <span class="at">income =</span> <span class="fu">factor</span>(income, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;low income&quot;</span>, <span class="st">&quot;med income&quot;</span>, <span class="st">&quot;high income&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb258-6"><a href="generalized-linear-models-glm.html#cb258-6" tabindex="-1"></a>  <span class="fu">count</span>(tax_too_high, biz_owner, politics, income) <span class="sc">%&gt;%</span></span>
<span id="cb258-7"><a href="generalized-linear-models-glm.html#cb258-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tax_too_high, <span class="at">y =</span> n, <span class="at">fill =</span> biz_owner)) <span class="sc">+</span></span>
<span id="cb258-8"><a href="generalized-linear-models-glm.html#cb258-8" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb258-9"><a href="generalized-linear-models-glm.html#cb258-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(income), <span class="at">cols =</span> <span class="fu">vars</span>(politics), <span class="at">space =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-10"><a href="generalized-linear-models-glm.html#cb258-10" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span> (x) <span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb258-11"><a href="generalized-linear-models-glm.html#cb258-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb258-12"><a href="generalized-linear-models-glm.html#cb258-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-13"><a href="generalized-linear-models-glm.html#cb258-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Taxes too high?&quot;</span>,</span>
<span id="cb258-14"><a href="generalized-linear-models-glm.html#cb258-14" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Reponse count by business owner, income level, and party.&quot;</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<p>Fit a cumulative link model for the cumulative probability of the <span class="math inline">\(i\)</span>th response falling in <span class="math inline">\(j\)</span>th category or below where <span class="math inline">\(i\)</span> indexes the (<span class="math inline">\(n = 192\)</span>) responses, <span class="math inline">\(j = 1, \ldots, J\)</span> indexes the (<span class="math inline">\(J = 4\)</span>) response categories, and <span class="math inline">\(\theta_j\)</span> is the threshold for the <span class="math inline">\(j\)</span>th cumulative logit.</p>
<p><span class="math display">\[\mathrm{logit}(P(Y_i \le j)) = \theta_j - \beta_1(\mathrm{politics}_i) - \beta_2(\mathrm{biz\_owner}_i) - \beta_3(\mathrm{age}_i)\]</span></p>
<div id="fit-the-model" class="section level3 unnumbered hasAnchor">
<h3>Fit the Model<a href="generalized-linear-models-glm.html#fit-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="generalized-linear-models-glm.html#cb259-1" tabindex="-1"></a>tax<span class="sc">$</span>fmla <span class="ot">&lt;-</span> <span class="fu">formula</span>(tax_too_high <span class="sc">~</span> biz_owner <span class="sc">+</span> age <span class="sc">+</span> politics)</span>
<span id="cb259-2"><a href="generalized-linear-models-glm.html#cb259-2" tabindex="-1"></a>tax<span class="sc">$</span>clm <span class="ot">&lt;-</span> <span class="fu">clm</span>(tax<span class="sc">$</span>fmla, <span class="at">data =</span> tax<span class="sc">$</span>dat)</span>
<span id="cb259-3"><a href="generalized-linear-models-glm.html#cb259-3" tabindex="-1"></a><span class="fu">summary</span>(tax<span class="sc">$</span>clm)</span></code></pre></div>
<pre><code>## formula: tax_too_high ~ biz_owner + age + politics
## data:    tax$dat
## 
##  link  threshold nobs logLik  AIC    niter max.grad cond.H 
##  logit flexible  192  -197.62 409.23 6(0)  3.14e-12 3.2e+05
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## biz_ownerYes  0.66462    0.28894   2.300 0.021435 *  
## age           0.24189    0.03260   7.421 1.17e-13 ***
## politicsLib   0.03695    0.36366   0.102 0.919072    
## politicsCon   1.16142    0.34554   3.361 0.000776 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Threshold coefficients:
##                            Estimate Std. Error z value
## Strongly Disagree|Disagree    7.026      1.166   6.024
## Disagree|Agree                8.766      1.231   7.119
## Agree|Strongly Agree         11.653      1.357   8.590</code></pre>
<p>The summary table shows two fit statistics at the top: the log-likelihood and the AIC. The log-likelihood is the sum of the likelihoods for each observation that the predicted value correctly predicts the observed value. Its value ranges from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(+\infty\)</span>. It’s value increases with observations, additional variables, and fit quality. I think you just use it to compare alternative model formulations. Akaike Information Criterion (AIC) is a measure of the relative quality of a statistical model. Again, I think the value is only useful as a comparison benchmark between alternative model fits. You’d want the model with the lowest AIC.</p>
<p>The Coefficients table is the familiar parameter estimates. E.g., for <code>biz_ownerYes</code>, the coefficient estimate is 0.665 with standard error 0.289. The <em>z</em>-value is the ratio <span class="math inline">\(z = \hat{\beta} / se =\)</span> 2.300 with <em>p</em>-value equal to <span class="math inline">\(2 \cdot P(Z&gt;z) =\)</span> 0.021. Some programs (e.g., SPSS) also show the Wald chi-squared statistic, the square of the <em>z</em> statistic, <span class="math inline">\(z^2 =\)</span>, 5.291. The square of a normal variable has a chi-square distribution, so the <em>p</em> value for the Wald chi-squared statistic is the <code>pchisq(z^2, df = 1)</code> <span class="math inline">\(=\)</span> 0.021.</p>
<p>The Threshold coefficients table are the intercepts, or cut-points. The first cut-point is log-odds of a response level <em>Strongly Disagree</em> (or less) vs greater than <em>Strongly Disagree</em> when all factor variables are at their reference level and the continuous vars are at 0.</p>
<p>There may be interaction effects between <code>biz_owner</code> and <code>politics</code>. Fit a saturate model, then compare their log likelihoods with a likelihood ratio test.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="generalized-linear-models-glm.html#cb261-1" tabindex="-1"></a>tax<span class="sc">$</span>fmla_sat <span class="ot">&lt;-</span> <span class="fu">formula</span>(tax_too_high <span class="sc">~</span> biz_owner<span class="sc">*</span>politics <span class="sc">+</span> age)</span>
<span id="cb261-2"><a href="generalized-linear-models-glm.html#cb261-2" tabindex="-1"></a>tax<span class="sc">$</span>clm_sat <span class="ot">&lt;-</span> <span class="fu">clm</span>(tax<span class="sc">$</span>fmla_sat, <span class="at">data =</span> tax<span class="sc">$</span>dat)</span>
<span id="cb261-3"><a href="generalized-linear-models-glm.html#cb261-3" tabindex="-1"></a>tax<span class="sc">$</span>sat_anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(tax<span class="sc">$</span>clm, tax<span class="sc">$</span>clm_sat)</span>
<span id="cb261-4"><a href="generalized-linear-models-glm.html#cb261-4" tabindex="-1"></a>tax<span class="sc">$</span>sat_anova</span></code></pre></div>
<pre><code>## Likelihood ratio tests of cumulative link models:
##  
##             formula:     link: threshold:
## tax$clm     tax$fmla     logit flexible  
## tax$clm_sat tax$fmla_sat logit flexible  
## 
##             no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)
## tax$clm          7 409.23 -197.62                      
## tax$clm_sat      9 411.75 -196.87  1.4805  2      0.477</code></pre>
<p>The likelihood ratio test indicates the main-effects model fits about the same in comparison to the saturated model (<span class="math inline">\(\chi^2(\)</span> 2 $) = $ <em>LR</em> = 1.48, <em>p</em> = 0.477)</p>
</div>
<div id="verify-assumptions" class="section level3 unnumbered hasAnchor">
<h3>Verify Assumptions<a href="generalized-linear-models-glm.html#verify-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cumulative odds ordinal logistic regression with proportional odds models require a) no multicollinearity, and b) proportional odds.</p>
<div id="multicollinearity-1" class="section level4 unnumbered hasAnchor">
<h4>Multicollinearity<a href="generalized-linear-models-glm.html#multicollinearity-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Multicollinearity occurs when two or more independent variables are <em>highly correlated</em> so that they do not provide unique or independent information in the regression model. Multicollinearity inflates the variances of the estimated coefficients, resulting in larger confidence intervals. The usual interpretation of a slope coefficient as the change in the mean response per unit increase in the predictor when all the other predictors are held constant breaks down because changing one predictor <em>necessarily</em> changes other predictors.</p>
<p>Test for multicollinearity with variance inflation factors (VIF). The VIF is the inflation percentage of the parameter variance due to multicollinearity. E.g., a VIF of 1.9 means the parameter variance is 90% larger than what it would be if it was not correlated with other predictors.</p>
<p>Predictor <span class="math inline">\(K\)</span>’s variance, <span class="math inline">\(Var(\hat{\beta_k})\)</span>, is inflated by a factor of</p>
<p><span class="math display">\[VIF_k = \frac{1}{1 - R_k^2}\]</span></p>
<p>due to collinearity with other predictors, where <span class="math inline">\(R_k^2\)</span> is the <span class="math inline">\(R^2\)</span> of a regression of the <span class="math inline">\(k^{th}\)</span> predictor on the remaining predictors. If there is zero relationship between predictor <span class="math inline">\(k\)</span> and the other variables, <span class="math inline">\(R_k^2 = 0\)</span> and <span class="math inline">\(VIF = 1\)</span> (no variance inflation). If 100% of the variance in predictor <span class="math inline">\(k\)</span> is explained by the other predictors, then <span class="math inline">\(R_k^2 = 1\)</span> and <span class="math inline">\(VIF = \infty\)</span>. A good rule of thumb is that <span class="math inline">\(VIF \le 5\)</span> is acceptable.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="generalized-linear-models-glm.html#cb263-1" tabindex="-1"></a><span class="co"># Cannot use CLM model with vif(). Re-express as a linear model.</span></span>
<span id="cb263-2"><a href="generalized-linear-models-glm.html#cb263-2" tabindex="-1"></a>tax<span class="sc">$</span>vif <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.numeric</span>(tax_too_high) <span class="sc">~</span> politics <span class="sc">+</span> biz_owner <span class="sc">+</span> age, <span class="at">dat =</span> tax<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb263-3"><a href="generalized-linear-models-glm.html#cb263-3" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">vif</span>()</span>
<span id="cb263-4"><a href="generalized-linear-models-glm.html#cb263-4" tabindex="-1"></a>tax<span class="sc">$</span>vif</span></code></pre></div>
<pre><code>##               GVIF Df GVIF^(1/(2*Df))
## politics  1.035831  2        1.008840
## biz_owner 1.023642  1        1.011752
## age       1.036491  1        1.018082</code></pre>
<p>The VIFs in column GVIF are all below 5, so this model is not compromised by multicollinearity.</p>
</div>
<div id="proportional-odds" class="section level4 unnumbered hasAnchor">
<h4>Proportional Odds<a href="generalized-linear-models-glm.html#proportional-odds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The assumption of proportional odds means the independent variable effects are constant across each cumulative split of the ordinal dependent variable. Test for proportional odds using a full <a href="https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-are-the-likelihood-ratio-wald-and-lagrange-multiplier-score-tests-different-andor-similar/">likelihood ratio test</a> comparing the proportional odds model with a multinomial logit model, also called an unconstrained baseline logit model. This is also called the <em>test of parallel lines</em>. The multinomial logit model fits a slope to each of the <span class="math inline">\(J – 1\)</span> levels. The proportional odds model is nested within the multinomial model, so you can use a likelihood ratio test to see if the models are statistically different. Fit the proportional odds model and a multinomial model using <code>VGAM::vglm()</code> and capture the log likelihoods and degrees of freedom. Perform a likelihood ratio test on the differences in log likelihoods, <span class="math inline">\(D = -2 \mathrm{loglik}(\beta)\)</span>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="generalized-linear-models-glm.html#cb265-1" tabindex="-1"></a>tax<span class="sc">$</span>vglm_ordinal     <span class="ot">&lt;-</span> <span class="fu">vglm</span>(tax<span class="sc">$</span>fmla, propodds,   <span class="at">data =</span> tax<span class="sc">$</span>dat)</span>
<span id="cb265-2"><a href="generalized-linear-models-glm.html#cb265-2" tabindex="-1"></a>tax<span class="sc">$</span>vglm_multinomial <span class="ot">&lt;-</span> <span class="fu">vglm</span>(tax<span class="sc">$</span>fmla, cumulative, <span class="at">data =</span> tax<span class="sc">$</span>dat)</span>
<span id="cb265-3"><a href="generalized-linear-models-glm.html#cb265-3" tabindex="-1"></a>tax<span class="sc">$</span>po_lrt <span class="ot">&lt;-</span> VGAM<span class="sc">::</span><span class="fu">lrtest</span>(tax<span class="sc">$</span>vglm_multinomial, tax<span class="sc">$</span>vglm_ordinal)</span>
<span id="cb265-4"><a href="generalized-linear-models-glm.html#cb265-4" tabindex="-1"></a>tax<span class="sc">$</span>po_lrt</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: tax_too_high ~ biz_owner + age + politics
## Model 2: tax_too_high ~ biz_owner + age + politics
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)
## 1 561 -193.31                     
## 2 569 -197.62  8 8.6197     0.3754</code></pre>
<blockquote>
<p>The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters, <span class="math inline">\(\chi^2\)</span>(8) = 8.620, <em>p</em> = 0.375.</p>
</blockquote>
<p>Another option is the partial proportional odds test. This test locates specific variables causing the rejection of proportional odds.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="generalized-linear-models-glm.html#cb267-1" tabindex="-1"></a>tax<span class="sc">$</span>po_lrt2 <span class="ot">&lt;-</span> <span class="fu">clm</span>(tax<span class="sc">$</span>fmla, <span class="at">data =</span> tax<span class="sc">$</span>dat) <span class="sc">%&gt;%</span></span>
<span id="cb267-2"><a href="generalized-linear-models-glm.html#cb267-2" tabindex="-1"></a>  <span class="fu">nominal_test</span>()</span>
<span id="cb267-3"><a href="generalized-linear-models-glm.html#cb267-3" tabindex="-1"></a>tax<span class="sc">$</span>po_lrt2</span></code></pre></div>
<pre><code>## Tests of nominal effects
## 
## formula: tax_too_high ~ biz_owner + age + politics
##           Df  logLik    AIC     LRT Pr(&gt;Chi)
## &lt;none&gt;       -197.62 409.23                 
## biz_owner  2 -197.34 412.67 0.55974   0.7559
## age                                         
## politics   4 -196.20 414.40 2.83415   0.5860</code></pre>
<blockquote>
<p>The assumption of proportional odds was met, as assessed by a full likelihood ratio test comparing the fit of the proportional odds model to a model with varying location parameters for business owner, <span class="math inline">\(\chi^2\)</span>(2) = 0.560, <em>p</em> = 0.756 and politics, <span class="math inline">\(\chi^2\)</span>(4) = 2.834, <em>p</em> = 0.586.</p>
</blockquote>
</div>
</div>
<div id="assess-the-model-fit" class="section level3 unnumbered hasAnchor">
<h3>Assess the Model Fit<a href="generalized-linear-models-glm.html#assess-the-model-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are three ways to assess overall model fit: The Deviance and Pearson goodness-of-fit tests of the overall model fit; the Cox and Snell, Nagelkerke, and McFadden pseudo R measures of explained variance; and the likelihood ratio test comparing the model fit to the intercept-only model.</p>
<div id="deviance-and-pearson" class="section level4 unnumbered hasAnchor">
<h4>Deviance and Pearson<a href="generalized-linear-models-glm.html#deviance-and-pearson" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>However, these tests rely on large frequencies in each <em>cell</em>, that is, each possible combination of predictor values. Overall goodness-of-fit statistics should be treated with suspicion when a continuous independent variable is present and/or there are a large number of cells with zero frequency.The Pearson goodness-of-fit statistic is <span class="math inline">\(X^2 = \sum \frac{(O_{ij} - E_{ij})^2}{E_{ij}}\)</span> where <span class="math inline">\(i\)</span> is the observation number and <span class="math inline">\(j\)</span> is the response variable level. It is a summary of the Pearson residuals, the difference between the observed and expected cell counts, <span class="math inline">\(O_{ij} - E_{ij}\)</span>. The deviance goodness-of-fit statistic is the difference in fit between the model and a full model; a full model being a model that fits the data perfectly, <span class="math inline">\(G^2 = 2 \sum_{ij} O_{ij} \log \left( \frac{O_{ij}}{E_{ij}} \right)\)</span>. Neither of these tests are reliable if there are many cells with zero frequencies and/or small expected frequencies and are generally not recommended. Generally, the chi-squared test requires a frequency count of at least 5 per cell.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="generalized-linear-models-glm.html#cb269-1" tabindex="-1"></a><span class="co"># Observed combinations of model vars</span></span>
<span id="cb269-2"><a href="generalized-linear-models-glm.html#cb269-2" tabindex="-1"></a>tax<span class="sc">$</span>cell_patterns <span class="ot">&lt;-</span> tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb269-3"><a href="generalized-linear-models-glm.html#cb269-3" tabindex="-1"></a></span>
<span id="cb269-4"><a href="generalized-linear-models-glm.html#cb269-4" tabindex="-1"></a><span class="co"># Observed combinations of predictor vars * levels of response var</span></span>
<span id="cb269-5"><a href="generalized-linear-models-glm.html#cb269-5" tabindex="-1"></a>tax<span class="sc">$</span>covariate_patterns <span class="ot">&lt;-</span> tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span> <span class="fu">count</span>(biz_owner, age, politics) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb269-6"><a href="generalized-linear-models-glm.html#cb269-6" tabindex="-1"></a>tax<span class="sc">$</span>possible_cells <span class="ot">&lt;-</span> tax<span class="sc">$</span>covariate_patterns <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">levels</span>(tax<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high))</span>
<span id="cb269-7"><a href="generalized-linear-models-glm.html#cb269-7" tabindex="-1"></a></span>
<span id="cb269-8"><a href="generalized-linear-models-glm.html#cb269-8" tabindex="-1"></a><span class="co"># 1 - ratio of observed to possible</span></span>
<span id="cb269-9"><a href="generalized-linear-models-glm.html#cb269-9" tabindex="-1"></a>tax<span class="sc">$</span>pct_freq_zero <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tax<span class="sc">$</span>cell_patterns <span class="sc">/</span> tax<span class="sc">$</span>possible_cells</span></code></pre></div>
<p>There are 137 observed combinations of model variables (predictors), and 372 possible combinations (predictors * outcome levels), so 63.2% of cells have zero frequencies. Ideally, zero frequencies should be less than 20%, so if you were to use the deviance or Pearson tests, you would need to report this. The results below are contradictory and bogus. I think you’d only use this test if you didn’t have continuous predictor variables.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="generalized-linear-models-glm.html#cb270-1" tabindex="-1"></a>observed <span class="ot">&lt;-</span> tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb270-2"><a href="generalized-linear-models-glm.html#cb270-2" tabindex="-1"></a>  <span class="fu">count</span>(biz_owner, age, politics, tax_too_high) <span class="sc">%&gt;%</span></span>
<span id="cb270-3"><a href="generalized-linear-models-glm.html#cb270-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> tax_too_high, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb270-4"><a href="generalized-linear-models-glm.html#cb270-4" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="at">Disagree =</span> <span class="dv">0</span>, <span class="at">Agree =</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb270-5"><a href="generalized-linear-models-glm.html#cb270-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">&quot;outcome&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;observed&quot;</span>)</span>
<span id="cb270-6"><a href="generalized-linear-models-glm.html#cb270-6" tabindex="-1"></a></span>
<span id="cb270-7"><a href="generalized-linear-models-glm.html#cb270-7" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb270-8"><a href="generalized-linear-models-glm.html#cb270-8" tabindex="-1"></a>  tax<span class="sc">$</span>dat, </span>
<span id="cb270-9"><a href="generalized-linear-models-glm.html#cb270-9" tabindex="-1"></a>  <span class="fu">predict</span>(tax<span class="sc">$</span>clm, <span class="fu">subset</span>(tax<span class="sc">$</span>dat, <span class="at">select =</span> <span class="sc">-</span>tax_too_high))<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb270-10"><a href="generalized-linear-models-glm.html#cb270-10" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb270-11"><a href="generalized-linear-models-glm.html#cb270-11" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="fu">c</span>(<span class="st">&quot;Strongly Disagree&quot;</span> <span class="ot">=</span> <span class="st">&quot;Strongly.Disagree&quot;</span>, <span class="st">&quot;Strongly Agree&quot;</span> <span class="ot">=</span> <span class="st">&quot;Strongly.Agree&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb270-12"><a href="generalized-linear-models-glm.html#cb270-12" tabindex="-1"></a>  <span class="fu">group_by</span>(biz_owner, age, politics) <span class="sc">%&gt;%</span></span>
<span id="cb270-13"><a href="generalized-linear-models-glm.html#cb270-13" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>, <span class="fu">across</span>(<span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, sum)) <span class="sc">%&gt;%</span></span>
<span id="cb270-14"><a href="generalized-linear-models-glm.html#cb270-14" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">&quot;outcome&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;expected&quot;</span>)</span>
<span id="cb270-15"><a href="generalized-linear-models-glm.html#cb270-15" tabindex="-1"></a></span>
<span id="cb270-16"><a href="generalized-linear-models-glm.html#cb270-16" tabindex="-1"></a>obs_exp <span class="ot">&lt;-</span> observed <span class="sc">%&gt;%</span></span>
<span id="cb270-17"><a href="generalized-linear-models-glm.html#cb270-17" tabindex="-1"></a>  <span class="fu">inner_join</span>(expected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;politics&quot;</span>, <span class="st">&quot;biz_owner&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;outcome&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb270-18"><a href="generalized-linear-models-glm.html#cb270-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epsilon_sq =</span> (observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb270-19"><a href="generalized-linear-models-glm.html#cb270-19" tabindex="-1"></a>         <span class="at">chi_sq =</span> epsilon_sq <span class="sc">/</span> expected,</span>
<span id="cb270-20"><a href="generalized-linear-models-glm.html#cb270-20" tabindex="-1"></a>         <span class="at">g_sq =</span> <span class="dv">2</span> <span class="sc">*</span> observed <span class="sc">*</span> <span class="fu">log</span>((observed<span class="fl">+.0001</span>) <span class="sc">/</span> expected)</span>
<span id="cb270-21"><a href="generalized-linear-models-glm.html#cb270-21" tabindex="-1"></a>  )</span>
<span id="cb270-22"><a href="generalized-linear-models-glm.html#cb270-22" tabindex="-1"></a></span>
<span id="cb270-23"><a href="generalized-linear-models-glm.html#cb270-23" tabindex="-1"></a>tax<span class="sc">$</span>chisq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb270-24"><a href="generalized-linear-models-glm.html#cb270-24" tabindex="-1"></a>tax<span class="sc">$</span>chisq<span class="sc">$</span>X2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>chi_sq)</span>
<span id="cb270-25"><a href="generalized-linear-models-glm.html#cb270-25" tabindex="-1"></a>tax<span class="sc">$</span>chisq<span class="sc">$</span>G2 <span class="ot">=</span> <span class="fu">sum</span>(obs_exp<span class="sc">$</span>g_sq)</span>
<span id="cb270-26"><a href="generalized-linear-models-glm.html#cb270-26" tabindex="-1"></a>tax<span class="sc">$</span>chisq<span class="sc">$</span>df <span class="ot">=</span> tax<span class="sc">$</span>covariate_patterns <span class="sc">*</span> (<span class="fu">length</span>(<span class="fu">levels</span>(tax<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">7</span></span>
<span id="cb270-27"><a href="generalized-linear-models-glm.html#cb270-27" tabindex="-1"></a>tax<span class="sc">$</span>chisq<span class="sc">$</span>X2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(tax<span class="sc">$</span>chisq<span class="sc">$</span>X2, <span class="at">df =</span> tax<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb270-28"><a href="generalized-linear-models-glm.html#cb270-28" tabindex="-1"></a>tax<span class="sc">$</span>chisq<span class="sc">$</span>G2_p.value <span class="ot">=</span> <span class="fu">pchisq</span>(tax<span class="sc">$</span>chisq<span class="sc">$</span>G2, <span class="at">df =</span> tax<span class="sc">$</span>chisq<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p>The Pearson goodness-of-fit test indicated that the model was <em>not</em> a good fit to the observed data, <span class="math inline">\(\chi^2\)</span>(272) = 745.4, <em>p</em> &lt; .001$. The deviance goodness-of-fit test indicated that the model was a good fit to the observed data, <span class="math inline">\(G^2\)</span>(272) = 232.6, <em>p</em> = 0.960.</p>
</blockquote>
</div>
<div id="pseudo-r2-measures" class="section level4 unnumbered hasAnchor">
<h4>Pseudo-R2 Measures<a href="generalized-linear-models-glm.html#pseudo-r2-measures" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are a number of measures in ordinal regression that attempt to provide a similar “variance explained” measure as that provided in ordinary least-squares linear regression. However, these measures do not have the direct interpretation that they do in ordinary linear regression and are often, therefore, referred to as “pseudo” R2 measures. The three most common measures (Cox and Snell, Nagelkerke, and McFadden) are not particularly good and not universally used. It is presented in the SPSS output, so you might encounter it in published work.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="generalized-linear-models-glm.html#cb271-1" tabindex="-1"></a>tax<span class="sc">$</span>nagelkerke <span class="ot">&lt;-</span> rcompanion<span class="sc">::</span><span class="fu">nagelkerke</span>(tax<span class="sc">$</span>clm)</span>
<span id="cb271-2"><a href="generalized-linear-models-glm.html#cb271-2" tabindex="-1"></a>tax<span class="sc">$</span>nagelkerke<span class="sc">$</span>Pseudo.R.squared.for.model.vs.null</span></code></pre></div>
<pre><code>##                              Pseudo.R.squared
## McFadden                             0.181957
## Cox and Snell (ML)                   0.367369
## Nagelkerke (Cragg and Uhler)         0.399641</code></pre>
</div>
<div id="likelihood-ratio-test-1" class="section level4 unnumbered hasAnchor">
<h4>Likelihood Ratio Test<a href="generalized-linear-models-glm.html#likelihood-ratio-test-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The best way to assess model fit is the likelihood ratio test comparing the model to an intercept-only model. The difference in the -2 log likelihood between the models has a <span class="math inline">\(\chi^2\)</span> distribution with degrees of freedom equal to the difference in the number of parameters.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="generalized-linear-models-glm.html#cb273-1" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span> <span class="fu">clm</span>(tax_too_high <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> tax<span class="sc">$</span>dat)</span>
<span id="cb273-2"><a href="generalized-linear-models-glm.html#cb273-2" tabindex="-1"></a>tax<span class="sc">$</span>lrt <span class="ot">&lt;-</span> <span class="fu">anova</span>(tax<span class="sc">$</span>clm, intercept_only)</span>
<span id="cb273-3"><a href="generalized-linear-models-glm.html#cb273-3" tabindex="-1"></a>tax<span class="sc">$</span>lrt</span></code></pre></div>
<pre><code>## Likelihood ratio tests of cumulative link models:
##  
##                formula:         link: threshold:
## intercept_only tax_too_high ~ 1 logit flexible  
## tax$clm        tax$fmla         logit flexible  
## 
##                no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)    
## intercept_only      3 489.14 -241.57                          
## tax$clm             7 409.23 -197.62  87.911  4  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The table shows the log likelihoods of the two models. LR.stat is the difference between 2 * the logLik values.</p>
<blockquote>
<p>The final model statistically significantly predicted the dependent variable over and above the intercept-only model, <span class="math inline">\(\chi^2(4)\)</span> = 87.9, <em>p</em> = 0.000.</p>
</blockquote>
</div>
</div>
<div id="interpret-results" class="section level3 unnumbered hasAnchor">
<h3>Interpret Results<a href="generalized-linear-models-glm.html#interpret-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Return to the model summary.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="generalized-linear-models-glm.html#cb275-1" tabindex="-1"></a><span class="fu">tidy</span>(tax<span class="sc">$</span>clm)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 6
##   term                       estimate std.error statistic  p.value coef.type
##   &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    
## 1 Strongly Disagree|Disagree   7.03      1.17       6.02  1.70e- 9 intercept
## 2 Disagree|Agree               8.77      1.23       7.12  1.08e-12 intercept
## 3 Agree|Strongly Agree        11.7       1.36       8.59  8.72e-18 intercept
## 4 biz_ownerYes                 0.665     0.289      2.30  2.14e- 2 location 
## 5 age                          0.242     0.0326     7.42  1.17e-13 location 
## 6 politicsLib                  0.0369    0.364      0.102 9.19e- 1 location 
## 7 politicsCon                  1.16      0.346      3.36  7.76e- 4 location</code></pre>
<p>The coefficients for <code>biz_owner</code>, <code>age</code>, and politics are positive. Positive parameters <em>increase</em> the likelihood of stronger agreement with the statement. In this case, discontent with taxes are higher for business owners, increase with age, and are higher for Liberal Democrats and Conservatives relative to the Labor Party. The expected cumulative log-odds of declaring <span class="math inline">\(\le j\)</span> level of agreement with the statement for the baseline group (<code>biz_ownerNo</code>, <code>age = 0</code>, <code>politicsLib</code>) is 7.026 for <span class="math inline">\(j = 1\)</span> (Strongly Disagree), 8.766 for <span class="math inline">\(j = 2\)</span> (Disagree), and 11.653 for <span class="math inline">\(j = 3\)</span> (Agree).</p>
<p>You could solve the logit equation for</p>
<p><span class="math display">\[\pi_j = \frac{\mathrm{exp}(Y_i)} {1 + \mathrm{exp}(Y_i)}\]</span>
to get the cumulative probabilities for each level. That’s what <code>predict(type = "cum.prob")</code> does. But it might be more intuitive to work with individual probabilities, the lagged differences to get the individual probabilities for each <span class="math inline">\(j\)</span>. That’s what <code>predict(type = "prob")</code> does. I like to play with predicted values to get a sense of the outcome distributions. In this case, I’ll take the median <code>age</code>, and each combination of <code>biz_owner</code> and <code>politics</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="generalized-linear-models-glm.html#cb277-1" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> tax<span class="sc">$</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb277-2"><a href="generalized-linear-models-glm.html#cb277-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">median</span>(tax<span class="sc">$</span>dat<span class="sc">$</span>age)) <span class="sc">%&gt;%</span> </span>
<span id="cb277-3"><a href="generalized-linear-models-glm.html#cb277-3" tabindex="-1"></a>  <span class="fu">expand</span>(age, politics, biz_owner)</span>
<span id="cb277-4"><a href="generalized-linear-models-glm.html#cb277-4" tabindex="-1"></a></span>
<span id="cb277-5"><a href="generalized-linear-models-glm.html#cb277-5" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tax<span class="sc">$</span>clm, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>)[[<span class="st">&quot;fit&quot;</span>]] <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb277-6"><a href="generalized-linear-models-glm.html#cb277-6" tabindex="-1"></a></span>
<span id="cb277-7"><a href="generalized-linear-models-glm.html#cb277-7" tabindex="-1"></a><span class="fu">bind_cols</span>(new_data, preds) <span class="sc">%&gt;%</span></span>
<span id="cb277-8"><a href="generalized-linear-models-glm.html#cb277-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">Strongly Disagree</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Strongly Agree</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb277-9"><a href="generalized-linear-models-glm.html#cb277-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">levels</span>(tax<span class="sc">$</span>dat<span class="sc">$</span>tax_too_high))) <span class="sc">%&gt;%</span></span>
<span id="cb277-10"><a href="generalized-linear-models-glm.html#cb277-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> politics, <span class="at">x =</span> value, <span class="at">fill =</span> <span class="fu">fct_rev</span>(name))) <span class="sc">+</span></span>
<span id="cb277-11"><a href="generalized-linear-models-glm.html#cb277-11" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb277-12"><a href="generalized-linear-models-glm.html#cb277-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>)), </span>
<span id="cb277-13"><a href="generalized-linear-models-glm.html#cb277-13" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb277-14"><a href="generalized-linear-models-glm.html#cb277-14" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span><span class="fu">paste</span>(<span class="st">&quot;Bus Owner = &quot;</span>, biz_owner)) <span class="sc">+</span></span>
<span id="cb277-15"><a href="generalized-linear-models-glm.html#cb277-15" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb277-16"><a href="generalized-linear-models-glm.html#cb277-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb277-17"><a href="generalized-linear-models-glm.html#cb277-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb277-18"><a href="generalized-linear-models-glm.html#cb277-18" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb277-19"><a href="generalized-linear-models-glm.html#cb277-19" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb277-20"><a href="generalized-linear-models-glm.html#cb277-20" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb277-21"><a href="generalized-linear-models-glm.html#cb277-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Taxes too High for Conservative Business Owners?&quot;</span>, </span>
<span id="cb277-22"><a href="generalized-linear-models-glm.html#cb277-22" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="supervised-ml_files/figure-html/unnamed-chunk-130-1.png" width="624" /></p>
<p>You will want to establish whether <code>politics</code> is statistically significant overall before exploring any specific contrasts. The ANOVA procedure with type I test reports an overall test of significance for each variable entered into the model.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="generalized-linear-models-glm.html#cb278-1" tabindex="-1"></a>(tax<span class="sc">$</span>anovaI <span class="ot">&lt;-</span> <span class="fu">anova</span>(tax<span class="sc">$</span>clm, <span class="at">type =</span> <span class="st">&quot;I&quot;</span>))</span></code></pre></div>
<pre><code>## Type I Analysis of Deviance Table with Wald chi-square tests
## 
##           Df  Chisq Pr(&gt;Chisq)    
## biz_owner  1 13.201  0.0002798 ***
## age        1 57.413  3.533e-14 ***
## politics   2 14.636  0.0006635 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<blockquote>
<p>The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald <span class="math inline">\(\chi^2\)</span>(2) = 14.6, <em>p</em> = 0.001.</p>
</blockquote>
<p>The best way to work with the data is with the <code>tidy(exponentiate = TRUE)</code> version.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="generalized-linear-models-glm.html#cb280-1" tabindex="-1"></a>tax<span class="sc">$</span>tidy <span class="ot">&lt;-</span> tax<span class="sc">$</span>clm <span class="sc">%&gt;%</span> <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb280-2"><a href="generalized-linear-models-glm.html#cb280-2" tabindex="-1"></a>tax<span class="sc">$</span>tidy</span></code></pre></div>
<pre><code>## # A tibble: 7 × 8
##   term        estimate std.error statistic  p.value conf.low conf.high coef.type
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 Strongly D…   1.13e3    1.17       6.02  1.70e- 9   NA         NA    intercept
## 2 Disagree|A…   6.41e3    1.23       7.12  1.08e-12   NA         NA    intercept
## 3 Agree|Stro…   1.15e5    1.36       8.59  8.72e-18   NA         NA    intercept
## 4 biz_ownerY…   1.94e0    0.289      2.30  2.14e- 2    1.11       3.44 location 
## 5 age           1.27e0    0.0326     7.42  1.17e-13    1.20       1.36 location 
## 6 politicsLib   1.04e0    0.364      0.102 9.19e- 1    0.508      2.12 location 
## 7 politicsCon   3.19e0    0.346      3.36  7.76e- 4    1.63       6.35 location</code></pre>
<p>Then you can summarize the table in words.</p>
<blockquote>
<p>The odds of business owners considering tax to be too high was 1.944 (95% CI, 1.107 to 3.443) times that of non-business owners, a statistically significant effect, <em>z</em> = 2.300, <em>p</em> = 0.021.</p>
</blockquote>
<blockquote>
<p>The odds of Conservative voters considering tax to be too high was 3.194 (95% CI, 1.635 to 6.351) times that of Labour voters, a statistically significant effect, <em>z</em> = 3.361, <em>p</em> = 0.001. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of 1.038 (95% CI, 0.508 to 2.121), <em>p</em> = 0.919.</p>
</blockquote>
<blockquote>
<p>An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of 1.274 (95% CI, 1.197 to 1.360), <em>z</em> = 7.421, <em>p</em> = 0.000.</p>
</blockquote>
</div>
<div id="reporting-2" class="section level3 unnumbered hasAnchor">
<h3>Reporting<a href="generalized-linear-models-glm.html#reporting-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the complete write-up.</p>
<blockquote>
<p>A cumulative odds ordinal logistic regression with proportional odds was run to determine the effect of business ownership, political party voted for, and age, on the belief that taxes are too high. There were proportional odds, as assessed by a full likelihood ratio test comparing the fitted model to a model with varying location parameters, <span class="math inline">\(\chi^2\)</span>(8) = 8.620, <em>p</em> = 0.375. The final model statistically significantly predicted the dependent variable over and above the intercept-only model, <span class="math inline">\(\chi^2(4)\)</span> = 87.9, <em>p</em> = 0.000. The odds of business owners considering tax to be too high was 1.944 (95% CI, 1.107 to 3.443) times that of non-business owners, a statistically significant effect, <em>z</em> = 2.300, <em>p</em> = 0.021. The political party last voted for has a statistically significant effect on the prediction of whether tax is thought to be too high, Wald <span class="math inline">\(\chi^2\)</span>(2) = 14.6, <em>p</em> = 0.001. The odds of Conservative voters considering tax to be too high was 3.194 (95% CI, 1.635 to 6.351) times that of Labour voters, a statistically significant effect, <em>z</em> = 3.361, <em>p</em> = 0.001. The odds of Liberal Democrat voters considering tax to be too high was similar to that of Labour voters (odds ratio of 1.038 (95% CI, 0.508 to 2.121), <em>p</em> = 0.919. An increase in age (expressed in years) was associated with an increase in the odds of considering tax too high, with an odds ratio of 1.274 (95% CI, 1.197 to 1.360), <em>z</em> = 7.421, <em>p</em> = 0.000.</p>
</blockquote>
<p>Package <strong>gtsummary</strong> shows a nice summary table.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="generalized-linear-models-glm.html#cb282-1" tabindex="-1"></a><span class="fu">tbl_regression</span>(tax<span class="sc">$</span>clm)</span></code></pre></div>
<div id="axptjscvqs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#axptjscvqs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#axptjscvqs thead, #axptjscvqs tbody, #axptjscvqs tfoot, #axptjscvqs tr, #axptjscvqs td, #axptjscvqs th {
  border-style: none;
}

#axptjscvqs p {
  margin: 0;
  padding: 0;
}

#axptjscvqs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#axptjscvqs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#axptjscvqs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#axptjscvqs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#axptjscvqs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axptjscvqs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axptjscvqs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axptjscvqs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#axptjscvqs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#axptjscvqs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#axptjscvqs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#axptjscvqs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#axptjscvqs .gt_spanner_row {
  border-bottom-style: hidden;
}

#axptjscvqs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#axptjscvqs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#axptjscvqs .gt_from_md > :first-child {
  margin-top: 0;
}

#axptjscvqs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#axptjscvqs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#axptjscvqs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#axptjscvqs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#axptjscvqs .gt_row_group_first td {
  border-top-width: 2px;
}

#axptjscvqs .gt_row_group_first th {
  border-top-width: 2px;
}

#axptjscvqs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axptjscvqs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#axptjscvqs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#axptjscvqs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axptjscvqs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axptjscvqs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#axptjscvqs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#axptjscvqs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#axptjscvqs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axptjscvqs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axptjscvqs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axptjscvqs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axptjscvqs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axptjscvqs .gt_left {
  text-align: left;
}

#axptjscvqs .gt_center {
  text-align: center;
}

#axptjscvqs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#axptjscvqs .gt_font_normal {
  font-weight: normal;
}

#axptjscvqs .gt_font_bold {
  font-weight: bold;
}

#axptjscvqs .gt_font_italic {
  font-style: italic;
}

#axptjscvqs .gt_super {
  font-size: 65%;
}

#axptjscvqs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#axptjscvqs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#axptjscvqs .gt_indent_1 {
  text-indent: 5px;
}

#axptjscvqs .gt_indent_2 {
  text-indent: 10px;
}

#axptjscvqs .gt_indent_3 {
  text-indent: 15px;
}

#axptjscvqs .gt_indent_4 {
  text-indent: 20px;
}

#axptjscvqs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;log(OR)&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>log(OR)</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">biz_owner</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    No</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Yes</td>
<td headers="estimate" class="gt_row gt_center">0.66</td>
<td headers="ci" class="gt_row gt_center">0.10, 1.2</td>
<td headers="p.value" class="gt_row gt_center">0.021</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center">0.24</td>
<td headers="ci" class="gt_row gt_center">0.18, 0.31</td>
<td headers="p.value" class="gt_row gt_center"><0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">politics</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Lab</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Lib</td>
<td headers="estimate" class="gt_row gt_center">0.04</td>
<td headers="ci" class="gt_row gt_center">-0.68, 0.75</td>
<td headers="p.value" class="gt_row gt_center">>0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Con</td>
<td headers="estimate" class="gt_row gt_center">1.2</td>
<td headers="ci" class="gt_row gt_center">0.49, 1.8</td>
<td headers="p.value" class="gt_row gt_center"><0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<div id="poissonregression" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Poisson Regression<a href="generalized-linear-models-glm.html#poissonregression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Poisson models count data, like “traffic tickets per day”, or “website hits per day”. The response is an expected <em>rate</em> or intensity. For count data, specify the generalized model, this time with <code>family = poisson</code> or <code>family = quasipoisson</code>.</p>
<p>Recall that the probability of achieving a count <span class="math inline">\(y\)</span> when the expected rate is <span class="math inline">\(\lambda\)</span> is distributed</p>
<p><span class="math display">\[P(Y = y|\lambda) = \frac{e^{-\lambda} \lambda^y}{y!}.\]</span></p>
<p>The poisson regression model is</p>
<p><span class="math display">\[\lambda = \exp(X \beta).\]</span></p>
<p>You can solve this for <span class="math inline">\(y\)</span> to get</p>
<p><span class="math display">\[y = X\beta = \ln(\lambda).\]</span></p>
<p>That is, the model predicts the log of the response rate. For a sample of size <em>n</em>, the likelihood function is</p>
<p><span class="math display">\[L(\beta; y, X) = \prod_{i=1}^n \frac{e^{-\exp({X_i\beta})}\exp({X_i\beta})^{y_i}}{y_i!}.\]</span></p>
<p>The log-likelihood is</p>
<p><span class="math display">\[l(\beta) = \sum_{i=1}^n (y_i X_i \beta - \sum_{i=1}^n\exp(X_i\beta) - \sum_{i=1}^n\log(y_i!).\]</span></p>
<p>Maximizing the log-likelihood has no closed-form solution, so the coefficient estimates are found through interatively reweighted least squares.</p>
<p>Poisson processes assume the variance of the response variable equals its mean. “Equals” means the mean and variance are of a similar order of magnitude. If that assumption does not hold, use the quasi-poisson. Use Poisson regression for large datasets. If the predicted counts are much greater than zero (&gt;30), the linear regression will work fine. Whereas RMSE is not useful for logistic models, it is a good metric in Poisson.</p>
</div>
<div id="cs4" class="section level2 unnumbered hasAnchor">
<h2>Case Study 4<a href="generalized-linear-models-glm.html#cs4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Dataset <code>fire</code> contains response variable <code>injuries</code> counting the number of injuries during the month and one explanatory variable, the month <code>mo</code>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="generalized-linear-models-glm.html#cb283-1" tabindex="-1"></a>fire <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;C:/Users/mpfol/OneDrive/Documents/Data Science/Data/CivilInjury_0.csv&quot;</span>)</span>
<span id="cb283-2"><a href="generalized-linear-models-glm.html#cb283-2" tabindex="-1"></a>fire <span class="ot">&lt;-</span> fire <span class="sc">%&gt;%</span> </span>
<span id="cb283-3"><a href="generalized-linear-models-glm.html#cb283-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mo =</span> <span class="fu">as.POSIXlt</span>(<span class="st">`</span><span class="at">Injury Date</span><span class="st">`</span>)<span class="sc">$</span>mon <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb283-4"><a href="generalized-linear-models-glm.html#cb283-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dt =</span> <span class="st">`</span><span class="at">Injury Date</span><span class="st">`</span>,</span>
<span id="cb283-5"><a href="generalized-linear-models-glm.html#cb283-5" tabindex="-1"></a>         <span class="at">injuries =</span> <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span>)</span>
<span id="cb283-6"><a href="generalized-linear-models-glm.html#cb283-6" tabindex="-1"></a><span class="fu">str</span>(fire)</span></code></pre></div>
<p>In a situation like this where there the relationship is bivariate, start with a visualization.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="generalized-linear-models-glm.html#cb284-1" tabindex="-1"></a><span class="fu">ggplot</span>(fire, <span class="fu">aes</span>(<span class="at">x =</span> mo, <span class="at">y =</span> injuries)) <span class="sc">+</span></span>
<span id="cb284-2"><a href="generalized-linear-models-glm.html#cb284-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb284-3"><a href="generalized-linear-models-glm.html#cb284-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)) <span class="sc">+</span></span>
<span id="cb284-4"><a href="generalized-linear-models-glm.html#cb284-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Injuries by Month&quot;</span>)</span></code></pre></div>
<p>Fit a poisson regression in R using <code>glm(formula, data, family = poisson)</code>. But first, check whether the mean and variance of <code>injuries</code> are the same magnitude? If not, then use <code>family = quasipoisson</code>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="generalized-linear-models-glm.html#cb285-1" tabindex="-1"></a><span class="fu">mean</span>(fire<span class="sc">$</span>injuries)</span>
<span id="cb285-2"><a href="generalized-linear-models-glm.html#cb285-2" tabindex="-1"></a><span class="fu">var</span>(fire<span class="sc">$</span>injuries)</span></code></pre></div>
<p>They are of the same magnitude, so fit the regression with <code>family = poisson</code>.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="generalized-linear-models-glm.html#cb286-1" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(injuries <span class="sc">~</span> mo, <span class="at">family =</span> poisson, <span class="at">data =</span> fire)</span>
<span id="cb286-2"><a href="generalized-linear-models-glm.html#cb286-2" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code></pre></div>
<p>The <em>predicted</em> value <span class="math inline">\(\hat{y}\)</span> is the estimated <strong>log</strong> of the response variable,</p>
<p><span class="math display">\[\hat{y} = X \hat{\beta} = \ln (\lambda).\]</span></p>
<p>Suppose <code>mo</code> is January (mo = <code>), then the log of</code>injuries` is <span class="math inline">\(\hat{y} = 0.323787\)</span>. Or, more intuitively, the expected count of injuries is <span class="math inline">\(\exp(0.323787) = 1.38\)</span></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="generalized-linear-models-glm.html#cb287-1" tabindex="-1"></a><span class="fu">predict</span>(m2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">mo=</span><span class="dv">1</span>))</span>
<span id="cb287-2"><a href="generalized-linear-models-glm.html#cb287-2" tabindex="-1"></a><span class="fu">predict</span>(m2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">mo=</span><span class="dv">1</span>), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<p>Here is a plot of the predicted counts in red.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="generalized-linear-models-glm.html#cb288-1" tabindex="-1"></a><span class="fu">augment</span>(m2, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="generalized-linear-models-glm.html#cb288-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mo, <span class="at">y =</span> injuries)) <span class="sc">+</span></span>
<span id="cb288-3"><a href="generalized-linear-models-glm.html#cb288-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb288-4"><a href="generalized-linear-models-glm.html#cb288-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb288-5"><a href="generalized-linear-models-glm.html#cb288-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb288-6"><a href="generalized-linear-models-glm.html#cb288-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb288-7"><a href="generalized-linear-models-glm.html#cb288-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Injuries&quot;</span>,</span>
<span id="cb288-8"><a href="generalized-linear-models-glm.html#cb288-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Poisson Fitted Line Plot&quot;</span>)</span></code></pre></div>
<p>Evaluate a logistic model fit with an analysis of deviance.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="generalized-linear-models-glm.html#cb289-1" tabindex="-1"></a>(perf <span class="ot">&lt;-</span> <span class="fu">glance</span>(m2))</span>
<span id="cb289-2"><a href="generalized-linear-models-glm.html#cb289-2" tabindex="-1"></a>(pseudoR2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> perf<span class="sc">$</span>deviance <span class="sc">/</span> perf<span class="sc">$</span>null.deviance)</span></code></pre></div>
<p>The deviance of the null model (no regressors) is 139.9. The deviance of the full model is 132.2. The psuedo-R2 is very low at .05. How about the RMSE?</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="generalized-linear-models-glm.html#cb290-1" tabindex="-1"></a><span class="fu">RMSE</span>(<span class="at">pred =</span> <span class="fu">predict</span>(m2, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>), <span class="at">obs =</span> fire<span class="sc">$</span>injuries)</span></code></pre></div>
<p>The average prediction error is about 0.99. That’s almost as much as the variance of <code>injuries</code> - i.e., just predicting the mean of <code>injuries</code> would be almost as good! Use the <code>GainCurvePlot()</code> function to plot the gain curve.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="generalized-linear-models-glm.html#cb291-1" tabindex="-1"></a><span class="fu">augment</span>(m2, <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb291-2"><a href="generalized-linear-models-glm.html#cb291-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> injuries, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb291-3"><a href="generalized-linear-models-glm.html#cb291-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb291-4"><a href="generalized-linear-models-glm.html#cb291-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb291-5"><a href="generalized-linear-models-glm.html#cb291-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Actual&quot;</span>,</span>
<span id="cb291-6"><a href="generalized-linear-models-glm.html#cb291-6" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted&quot;</span>,</span>
<span id="cb291-7"><a href="generalized-linear-models-glm.html#cb291-7" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Poisson Fitted vs Actual&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="generalized-linear-models-glm.html#cb292-1" tabindex="-1"></a><span class="fu">augment</span>(m2) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb292-2"><a href="generalized-linear-models-glm.html#cb292-2" tabindex="-1"></a>  <span class="fu">GainCurvePlot</span>(<span class="at">xvar =</span> <span class="st">&quot;.fitted&quot;</span>, <span class="at">truthVar =</span> <span class="st">&quot;injuries&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Poisson Model&quot;</span>)</span></code></pre></div>
<p>It seems that <code>mo</code> was a poor predictor of <code>injuries</code>.</p>

</div>
</div>
<h3>References<a href="references-1.html#references-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Agresti2013" class="csl-entry">
Agresti, Alan. 2013. <em>Categorical Data Analysis</em>. 3rd ed. Wiley. <a href="https://www.amazon.com/Categorical-Analysis-Wiley-Probability-Statistics-ebook-dp-B00CAYUFM2/dp/B00CAYUFM2/ref=mt_kindle?_encoding=UTF8&amp;me=&amp;qid=">https://www.amazon.com/Categorical-Analysis-Wiley-Probability-Statistics-ebook-dp-B00CAYUFM2/dp/B00CAYUFM2/ref=mt_kindle?_encoding=UTF8&amp;me=&amp;qid=</a>.
</div>
<div id="ref-Molner2020" class="csl-entry">
Molnar, Christoph. 2020. <em>Interpretable Machine Learning</em>. <a href="https://christophm.github.io/interpretable-ml-book/">https://christophm.github.io/interpretable-ml-book/</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>These notes are primarily from PSU’s <a href="https://online.stat.psu.edu/stat504">Analysis of Discrete Data</a> which uses Alan Agresti’s <strong>Categorical Data Analysis</strong> <span class="citation">(<a href="#ref-Agresti2013">Agresti 2013</a>)</span>. I also reviewed PSU’s <a href="https://newonlinecourses.science.psu.edu/stat501/lesson/15">Regression Methods</a>, DataCamp’s <a href="https://www.datacamp.com/courses/generalized-linear-models-in-r">Generalized Linear Models in R</a>, DataCamp’s <a href="https://www.datacamp.com/courses/multiple-and-logistic-regression">Multiple and Logistic Regression</a>, and <strong>Interpretable machine learning</strong> <span class="citation">(<a href="#ref-Molner2020">Molnar 2020</a>)</span>.<a href="generalized-linear-models-glm.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>The related probit regression link function is <span class="math inline">\(f(E(Y|X)) = \Phi^{-1}(E(Y|X)) = \Phi^{-1}(\pi)\)</span>. The difference between the logistic and probit link function is theoretical, and <a href="https://www.theanalysisfactor.com/the-difference-between-logistic-and-probit-regression/">the practical significance is slight</a>. You can safely ignore probit.<a href="generalized-linear-models-glm.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Notes from <a href="https://machinelearningmastery.com/logistic-regression-with-maximum-likelihood-estimation/">Machine Learning Mastery</a>.<a href="generalized-linear-models-glm.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p> <a href="https://data.library.virginia.edu/understanding-deviance-residuals/">UVA</a> discusses the three types of residuals you can calculate from a binary logistic regression.<a href="generalized-linear-models-glm.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>See probability notes on the binomial distribution <a href="https://bookdown.org/mpfoley1973/probability/binomial.html">here</a><a href="generalized-linear-models-glm.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p><a href="https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290">This article</a> suggests using three standard deviations for an outliers threshold.<a href="generalized-linear-models-glm.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Nice write-up <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">here</a>. Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit<a href="generalized-linear-models-glm.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>These notes rely on the course notes from <a href="https://online.stat.psu.edu/stat504/">PSU STAT 504, Analysis of Discrete Data</a> and <a href="https://stats.oarc.ucla.edu/r/dae/multinomial-logistic-regression/">UCLA</a>.<a href="generalized-linear-models-glm.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p><a href="https://towardsdatascience.com/assumptions-of-logistic-regression-clearly-explained-44d85a22b290">This article</a> suggests using three standard deviations for an outliers threshold.<a href="generalized-linear-models-glm.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Nice write-up <a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faq-what-are-pseudo-r-squareds/">here</a>. Sounds like you should use pseudo R2 for model comparison, not for reporting goodness of fit<a href="generalized-linear-models-glm.html#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ordinary-least-squares.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regularization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["supervised-ml.pdf", "supervised-ml.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
